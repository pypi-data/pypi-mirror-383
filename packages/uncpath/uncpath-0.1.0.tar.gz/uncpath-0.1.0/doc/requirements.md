# UNC路径转换工具需求分析

## 项目概述

基于现有的 `uncpath-py` 项目，扩展开发一个命令行工具 `uncd`，用于将 Windows/SMB 的 UNC 路径一键转换为 Linux 本地挂载路径，方便开发者在终端中直接切换目录。

## 核心需求

### 1. 功能需求

#### 1.1 UNC路径识别与解析
- **支持格式**：
  - Windows UNC格式：`\\host\share\path`
  - Unix UNC格式：`//host/share/path`
  - SMB协议格式：`smb://host/share/path`

#### 1.2 路径映射转换
- **输入**：UNC路径（如 `\\192.168.10.172\sambaShare\`）
- **输出**：Linux本地挂载路径（如 `/opt/samba/`）
- **映射规则**：通过配置文件自定义

#### 1.3 命令行工具
- **命令名称**：`uncd`
- **使用方式**：`uncd \\192.168.10.172\sambaShare\`
- **功能**：直接切换到对应的本地挂载目录

### 2. 技术需求

#### 2.1 配置管理
- **配置文件格式**：YAML 或 JSON
- **配置位置**：`~/.config/uncpath/config.yaml`
- **配置内容**：host/share 到本地路径的映射关系

#### 2.2 路径解析
- **UNC路径标准化**：统一处理不同格式的UNC路径
- **路径验证**：验证UNC路径格式的正确性
- **映射查找**：根据配置查找对应的本地路径

#### 2.3 错误处理
- **无效路径**：处理不存在的映射关系
- **配置错误**：处理配置文件格式错误
- **权限问题**：处理目录访问权限问题

## 使用场景

### 场景1：开发环境切换
```bash
# 开发者需要从Windows SMB共享切换到Linux本地挂载
uncd \\192.168.10.172\sambaShare\
# 自动切换到 /opt/samba/
```

### 场景2：多服务器环境
```bash
# 不同服务器的共享目录映射
uncd //server1/shared/
# 切换到 /mnt/smb/server1/

uncd smb://fileserver/docs/
# 切换到 /home/user/smb/docs/
```

### 场景3：脚本自动化
```bash
# 在脚本中使用
cd $(uncd --path-only \\192.168.10.172\sambaShare\)
```

## 配置文件示例

```yaml
# ~/.config/uncpath/config.yaml
mappings:
  # Windows IP地址映射
  "192.168.10.172/sambaShare": "/opt/samba"
  "192.168.1.100/shared": "/mnt/smb/shared"
  
  # 服务器名称映射
  "server1/shared": "/mnt/smb/server1"
  "fileserver/docs": "/home/user/smb/docs"
  
  # 默认映射规则
  defaults:
    base_path: "/mnt/smb"
    auto_create: true
```

## 扩展功能需求

### 1. 高级功能
- **自动挂载检测**：检查本地挂载点是否存在
- **路径补全**：支持Tab键自动补全
- **历史记录**：记录最近使用的路径
- **批量操作**：支持批量路径转换

### 2. Samba自动发现功能（v0.2.0）
- **网络扫描**：自动扫描网络中的Samba服务器
- **共享枚举**：自动枚举服务器上的共享目录
- **自动映射**：根据发现的共享自动生成映射关系
- **配置更新**：自动更新配置文件，无需手动配置

### 3. 集成功能
- **Shell集成**：支持bash/zsh/fish等shell
- **IDE集成**：提供VS Code等编辑器的扩展
- **API接口**：提供Python API供其他工具调用

## 非功能性需求

### 1. 性能要求
- **响应时间**：路径转换应在100ms内完成
- **内存占用**：工具运行内存占用小于10MB
- **启动时间**：命令行工具启动时间小于500ms

### 2. 兼容性要求
- **Python版本**：支持Python 3.8+
- **操作系统**：主要支持Linux，兼容macOS
- **Shell支持**：支持主流shell环境

### 3. 可用性要求
- **易用性**：命令行接口简单直观
- **可配置性**：支持灵活的配置选项
- **错误提示**：提供清晰的错误信息和解决建议

## 验收标准

### 1. 基本功能（v0.1.0）
- [ ] 能够正确解析三种UNC路径格式
- [ ] 能够根据配置文件进行路径映射
- [ ] 能够通过uncd命令切换目录
- [ ] 配置文件格式正确且可读

### 2. Samba自动发现功能（v0.2.0）
- [ ] 能够扫描网络中的Samba服务器
- [ ] 能够枚举服务器上的共享目录
- [ ] 能够自动生成映射关系
- [ ] 能够自动更新配置文件
- [ ] 支持多种扫描方法（nmap、smbclient）
- [ ] 支持认证和匿名访问

### 3. 错误处理
- [ ] 处理无效的UNC路径格式
- [ ] 处理不存在的映射关系
- [ ] 处理配置文件格式错误
- [ ] 提供有意义的错误信息
- [ ] 处理网络扫描失败的情况
- [ ] 处理Samba连接失败的情况

### 4. 用户体验
- [ ] 命令行工具响应迅速
- [ ] 提供帮助信息和用法示例
- [ ] 支持--help和--version参数
- [ ] 配置文件有详细注释和示例
- [ ] 提供Samba发现的进度提示
- [ ] 支持预览模式（不更新配置）

## 技术约束

### 1. 依赖限制
- **最小依赖**：尽量使用Python标准库
- **可选依赖**：YAML解析等可通过可选依赖提供
- **外部工具**：不依赖外部系统工具

### 2. 安全考虑
- **路径安全**：防止路径遍历攻击
- **配置安全**：验证配置文件的安全性
- **权限检查**：检查目标目录的访问权限

### 3. 维护性
- **代码质量**：遵循PEP 8编码规范
- **测试覆盖**：提供完整的单元测试和集成测试
- **文档完整**：提供完整的API文档和用户指南
