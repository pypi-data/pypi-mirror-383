import{r as n,k as z,X as K,c as T,j as e,R as $,C as L,E as P,F as v,B,a as _,Z as q}from"./main-CuY7LwDi.js";import{d as H}from"./index-C56i7L-C.js";import{C as F}from"./index-BMhTxeKN.js";import{T as I}from"./Table-C4qk6tSP.js";import"./index-C3ZkAJoo.js";import"./index-CozlEGtu.js";import"./addEventListener-3f_zys3z.js";import"./index-DFeHvYNt.js";import"./index-DQ88mTzX.js";import"./index-KrImrJYw.js";import"./index-BVW_ZuQG.js";import"./UpOutlined-DnwtgvX4.js";import"./index-qOmqaMb2.js";import"./Dropdown-BHbGj-Fl.js";import"./index-CMWrhJTm.js";import"./index-BHZG3skE.js";import"./study-page-B40m6mCQ.js";import"./usePagination-7P2VlRbv.js";import"./index-C59h2Yua.js";import"./RedoOutlined-BNTfk6-k.js";import"./index-BYHgQKhy.js";import"./callSuper-C5M9W9Ql.js";const le=()=>{const[l,o]=n.useState(!1),{project:x,projectObj:u}=z(),[d,w]=n.useState(),[f,p]=n.useState(),k=K(),s=new URLSearchParams(k.search).get("key"),[a,r]=n.useState(s);n.useRef(null),T();const m=t=>{const i=window.location.hash,[c,g=""]=i.replace(/^#/,"").split("?"),y=new URLSearchParams(g);y.set("key",t);const j=`#${c}?${y.toString()}`;window.history.pushState({},"",j)},h=n.useRef(null),[C,A]=n.useState(null),R=()=>{if(h.current){const t=h.current.getBoundingClientRect().top;A(t)}};n.useEffect(()=>(R(),window.addEventListener("resize",R),()=>{window.removeEventListener("resize",R)}),[]);const S=async()=>{var i,c,g,y,j;o(!0);let t=await _.post("/list-analysis-tree",{is_report:!0,project:x});w(t.data),!s&&t.data.length>0&&(i=t.data[0])!=null&&i.children&&((c=t.data[0])==null?void 0:c.children.length)>0&&(p((g=t.data[0])==null?void 0:g.children[0]),r((j=(y=t.data[0])==null?void 0:y.children[0])==null?void 0:j.key)),o(!1)};return n.useEffect(()=>{S()},[x]),e.jsx("div",{style:{maxWidth:"1500px",margin:"0 auto"},children:e.jsxs($,{style:{marginTop:"1rem"},children:[e.jsx(L,{lg:6,sm:6,xs:24,ref:h,style:{position:"sticky",top:`${C}px`,alignSelf:"flex-start",height:`calc(100vh - ${C}px - 1rem )`},children:e.jsx(F,{loading:l,title:u==null?void 0:u.project_name,size:"small",style:{height:"100%"},styles:{body:{height:"90%",overflowY:"auto"}},extra:e.jsx(v,{gap:"small",children:e.jsx(B,{size:"small",color:"cyan",variant:"solid",onClick:S,children:"刷新"})}),children:Array.isArray(d)&&d.length!=0?e.jsx(e.Fragment,{children:e.jsx(U,{onSelect:t=>{var i,c;((i=t.node)==null?void 0:i.type)=="analysis"?(p(t.node),r(t.node.key),m(t.node.key)):((c=t.node)==null?void 0:c.type)=="components"&&console.log(t.node)},defaultSelectKey:a,treeData:d})}):e.jsx(e.Fragment,{children:e.jsx(P,{})})})}),e.jsx(L,{lg:18,sm:18,xs:24,style:{paddingLeft:"1rem"},children:a?e.jsx(e.Fragment,{children:e.jsx(H,{cancalReportCallback:()=>{S()},analysis_id:a})}):e.jsx(e.Fragment,{children:e.jsx(F,{size:"small",children:e.jsx(P,{})})})})]})})},U=({treeData:l,defaultSelectKey:o,onSelect:x})=>{const[u,d]=n.useState(o),[w,f]=n.useState([]),p=(s,a,r=[])=>{for(const m of a){if(m.key===s)return r;if(m.children){const h=p(s,m.children,[...r,m.key]);if(h.length)return h}}return[]};n.useEffect(()=>{if(o){const s=p(o,l);f(s),d(o)}},[o,l]);const k=(s,a)=>{if(s.length>0){x(a),d(s[0]);const r=p(s[0],l);f(r)}},E=s=>{f(s)};return e.jsx(e.Fragment,{children:e.jsx(I,{selectedKeys:[u],showLine:!0,expandedKeys:w,onExpand:E,autoExpandParent:!0,switcherIcon:e.jsx(q,{}),onSelect:k,treeData:l})})};export{le as default};
