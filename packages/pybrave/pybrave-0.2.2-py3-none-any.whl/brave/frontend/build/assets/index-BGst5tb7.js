import{r as a,x as Oe,_ as Ie,a0 as W,a1 as oe,V as D,Z as Fe,a2 as Pe,a3 as Re,a4 as $e,a5 as Q,a6 as Ee,a7 as ee,a8 as ze,j as t,I as ae,i as X,B as x,a as J,k as le,b as ie,F as R,P as K,f as ce,u as Be,M as Ae,Y as Te,t as y,l as de}from"./main-CuY7LwDi.js";import{b as me,c as ue,s as Ne,L as E,r as Me,f as Le}from"./index-C56i7L-C.js";import{C as z}from"./index-BMhTxeKN.js";import{a as De,R as Xe,b as Ke,S as He,F as pe}from"./Table-C4qk6tSP.js";import{L}from"./index-BTG2_cbq.js";import{R as Ue}from"./index-DFeHvYNt.js";import{P as Ve,S as fe}from"./index-C59h2Yua.js";import{b as We}from"./index-IVhR9oa8.js";import{A as Je}from"./index-BHv34jHO.js";import qe from"./index-C3ZkAJoo.js";import{T as q}from"./index-qOmqaMb2.js";import{B as he}from"./index-yDSewexe.js";var Ye={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.1 209.3l-56.4 44.1C775.8 155.1 656.2 92 521.9 92 290 92 102.3 279.5 102 511.5 101.7 743.7 289.8 932 521.9 932c181.3 0 335.8-115 394.6-276.1 1.5-4.2-.7-8.9-4.9-10.3l-56.7-19.5a8 8 0 00-10.1 4.8c-1.8 5-3.8 10-5.9 14.9-17.3 41-42.1 77.8-73.7 109.4A344.77 344.77 0 01655.9 829c-42.3 17.9-87.4 27-133.8 27-46.5 0-91.5-9.1-133.8-27A341.5 341.5 0 01279 755.2a342.16 342.16 0 01-73.7-109.4c-17.9-42.4-27-87.4-27-133.9s9.1-91.5 27-133.9c17.3-41 42.1-77.8 73.7-109.4 31.6-31.6 68.4-56.4 109.3-73.8 42.3-17.9 87.4-27 133.8-27 46.5 0 91.5 9.1 133.8 27a341.5 341.5 0 01109.3 73.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.6 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c-.1-6.6-7.8-10.3-13-6.2z"}}]},name:"reload",theme:"outlined"},Ze=function(r,n){return a.createElement(Oe,Ie({},r,{ref:n,icon:Ye}))},te=a.forwardRef(Ze);const B=e=>{let{children:r}=e;const{getPrefixCls:n}=a.useContext(W),s=n("breadcrumb");return a.createElement("li",{className:`${s}-separator`,"aria-hidden":"true"},r===""?r:r||"/")};B.__ANT_BREADCRUMB_SEPARATOR=!0;var Ge=function(e,r){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&r.indexOf(s)<0&&(n[s]=e[s]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,s=Object.getOwnPropertySymbols(e);o<s.length;o++)r.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(n[s[o]]=e[s[o]]);return n};function Qe(e,r){if(e.title===void 0||e.title===null)return null;const n=Object.keys(r).join("|");return typeof e.title=="object"?e.title:String(e.title).replace(new RegExp(`:(${n})`,"g"),(s,o)=>r[o]||s)}function ge(e,r,n,s){if(n==null)return null;const{className:o,onClick:i}=r,m=Ge(r,["className","onClick"]),d=Object.assign(Object.assign({},oe(m,{data:!0,aria:!0})),{onClick:i});return s!==void 0?a.createElement("a",Object.assign({},d,{className:D(`${e}-link`,o),href:s}),n):a.createElement("span",Object.assign({},d,{className:D(`${e}-link`,o)}),n)}function et(e,r){return(s,o,i,m,d)=>{if(r)return r(s,o,i,m);const l=Qe(s,o);return ge(e,s,l,d)}}var H=function(e,r){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&r.indexOf(s)<0&&(n[s]=e[s]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,s=Object.getOwnPropertySymbols(e);o<s.length;o++)r.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(n[s[o]]=e[s[o]]);return n};const xe=e=>{const{prefixCls:r,separator:n="/",children:s,menu:o,overlay:i,dropdownProps:m,href:d}=e,c=(g=>{if(o||i){const p=Object.assign({},m);if(o){const u=o||{},{items:b}=u,h=H(u,["items"]);p.menu=Object.assign(Object.assign({},h),{items:b==null?void 0:b.map((j,C)=>{var{key:S,title:f,label:v,path:_}=j,k=H(j,["key","title","label","path"]);let I=v??f;return _&&(I=a.createElement("a",{href:`${d}${_}`},I)),Object.assign(Object.assign({},k),{key:S??C,label:I})})})}else i&&(p.overlay=i);return a.createElement(De,Object.assign({placement:"bottom"},p),a.createElement("span",{className:`${r}-overlay-link`},g,a.createElement(Fe,null)))}return g})(s);return c!=null?a.createElement(a.Fragment,null,a.createElement("li",null,c),n&&a.createElement(B,null,n)):null},je=e=>{const{prefixCls:r,children:n,href:s}=e,o=H(e,["prefixCls","children","href"]),{getPrefixCls:i}=a.useContext(W),m=i("breadcrumb",r);return a.createElement(xe,Object.assign({},o,{prefixCls:m}),ge(m,o,n,s))};je.__ANT_BREADCRUMB_ITEM=!0;const tt=e=>{const{componentCls:r,iconCls:n,calc:s}=e;return{[r]:Object.assign(Object.assign({},$e(e)),{color:e.itemColor,fontSize:e.fontSize,[n]:{fontSize:e.iconFontSize},ol:{display:"flex",flexWrap:"wrap",margin:0,padding:0,listStyle:"none"},a:Object.assign({color:e.linkColor,transition:`color ${e.motionDurationMid}`,padding:`0 ${Q(e.paddingXXS)}`,borderRadius:e.borderRadiusSM,height:e.fontHeight,display:"inline-block",marginInline:s(e.marginXXS).mul(-1).equal(),"&:hover":{color:e.linkHoverColor,backgroundColor:e.colorBgTextHover}},Ee(e)),"li:last-child":{color:e.lastItemColor},[`${r}-separator`]:{marginInline:e.separatorMargin,color:e.separatorColor},[`${r}-link`]:{[`
          > ${n} + span,
          > ${n} + a
        `]:{marginInlineStart:e.marginXXS}},[`${r}-overlay-link`]:{borderRadius:e.borderRadiusSM,height:e.fontHeight,display:"inline-block",padding:`0 ${Q(e.paddingXXS)}`,marginInline:s(e.marginXXS).mul(-1).equal(),[`> ${n}`]:{marginInlineStart:e.marginXXS,fontSize:e.fontSizeIcon},"&:hover":{color:e.linkHoverColor,backgroundColor:e.colorBgTextHover,a:{color:e.linkHoverColor}},a:{"&:hover":{backgroundColor:"transparent"}}},[`&${e.componentCls}-rtl`]:{direction:"rtl"}})}},rt=e=>({itemColor:e.colorTextDescription,lastItemColor:e.colorText,iconFontSize:e.fontSize,linkColor:e.colorTextDescription,linkHoverColor:e.colorText,separatorColor:e.colorTextDescription,separatorMargin:e.marginXS}),nt=Pe("Breadcrumb",e=>{const r=Re(e,{});return tt(r)},rt);var re=function(e,r){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&r.indexOf(s)<0&&(n[s]=e[s]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,s=Object.getOwnPropertySymbols(e);o<s.length;o++)r.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(n[s[o]]=e[s[o]]);return n};function st(e){const{breadcrumbName:r,children:n}=e,s=re(e,["breadcrumbName","children"]),o=Object.assign({title:r},s);return n&&(o.menu={items:n.map(i=>{var{breadcrumbName:m}=i,d=re(i,["breadcrumbName"]);return Object.assign(Object.assign({},d),{title:m})})}),o}function ot(e,r){return a.useMemo(()=>e||(r?r.map(st):null),[e,r])}var at=function(e,r){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&r.indexOf(s)<0&&(n[s]=e[s]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,s=Object.getOwnPropertySymbols(e);o<s.length;o++)r.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(n[s[o]]=e[s[o]]);return n};const lt=(e,r)=>{if(r===void 0)return r;let n=(r||"").replace(/^\//,"");return Object.keys(e).forEach(s=>{n=n.replace(`:${s}`,e[s])}),n},P=e=>{const{prefixCls:r,separator:n="/",style:s,className:o,rootClassName:i,routes:m,items:d,children:l,itemRender:c,params:g={}}=e,p=at(e,["prefixCls","separator","style","className","rootClassName","routes","items","children","itemRender","params"]),{getPrefixCls:u,direction:b,breadcrumb:h}=a.useContext(W);let j;const C=u("breadcrumb",r),[S,f,v]=nt(C),_=ot(d,m),k=et(C,c);if(_&&_.length>0){const O=[],F=d||m;j=_.map((w,$)=>{const{path:ye,key:A,type:_e,menu:Y,overlay:Z,onClick:Ce,className:ve,separator:Se,dropdownProps:we}=w,T=lt(g,ye);T!==void 0&&O.push(T);const G=A??$;if(_e==="separator")return a.createElement(B,{key:G},Se);const N={},ke=$===_.length-1;Y?N.menu=Y:Z&&(N.overlay=Z);let{href:M}=w;return O.length&&T!==void 0&&(M=`#/${O.join("/")}`),a.createElement(xe,Object.assign({key:G},N,oe(w,{data:!0,aria:!0}),{className:ve,dropdownProps:we,href:M,separator:ke?"":n,onClick:Ce,prefixCls:C}),k(w,g,F,O,M))})}else if(l){const O=ee(l).length;j=ee(l).map((F,w)=>{if(!F)return F;const $=w===O-1;return ze(F,{separator:$?"":n,key:w})})}const I=D(C,h==null?void 0:h.className,{[`${C}-rtl`]:b==="rtl"},o,i,f,v),be=Object.assign(Object.assign({},h==null?void 0:h.style),s);return S(a.createElement("nav",Object.assign({className:I,style:be},p),a.createElement("ol",null,j)))};P.Item=je;P.Separator=B;const{Search:it}=ae,{Text:ne}=X,ct=({path:e,onSelectFile:r})=>{const[n,s]=a.useState([]),[o,i]=a.useState(e),[m,d]=a.useState(""),[l,c]=a.useState(1),[g,p]=a.useState(0),u=10,b=async(f=o,v=m,_=l)=>{const k=await J.get("/file-operation/list-dir-v2",{params:{path:f,keyword:v,page:_,limit:u}});s(k.data.items),p(k.data.total),i(f),c(_)};a.useEffect(()=>{b(e)},[e]);const h=f=>{b(`${o}/${f}`,"",1)},j=f=>{b(o,f,1)},C=f=>{r({path:o+"/"+f.name,file:f.name})},S=o.split("/").filter(Boolean);return t.jsxs(z,{title:"文件浏览器",extra:t.jsxs(He,{children:[t.jsx(x,{icon:t.jsx(te,{}),onClick:()=>b(e),size:"small",children:"重置"}),t.jsx(x,{icon:t.jsx(te,{}),onClick:()=>b(o),size:"small",children:"刷新"})]}),children:[t.jsxs(P,{style:{marginBottom:"1rem"},children:[t.jsx(P.Item,{children:t.jsx("a",{onClick:()=>b("/"),children:"根目录"})}),S.map((f,v)=>t.jsx(P.Item,{children:t.jsx("a",{onClick:()=>{const _="/"+S.slice(0,v+1).join("/");b(_)},children:f})},v))]}),t.jsx(it,{placeholder:"搜索文件名",enterButton:"搜索",value:m,onChange:f=>d(f.target.value),onSearch:j,style:{marginBottom:16}}),t.jsx(L,{size:"small",bordered:!0,dataSource:n,locale:{emptyText:"暂无文件"},renderItem:f=>t.jsx(L.Item,{actions:f.is_dir?[t.jsx(x,{size:"small",onClick:()=>h(f.name),children:"进入"})]:[t.jsx(x,{type:"link",size:"small",icon:t.jsx(Ue,{}),href:`/brave-api/file-operation/download?path=${encodeURIComponent(o+"/"+f.name)}`,target:"_blank",children:"下载"}),t.jsx(x,{type:"link",size:"small",onClick:()=>C(f),children:"选择"})],children:t.jsx(L.Item.Meta,{avatar:f.is_dir?t.jsx(Xe,{}):t.jsx(Ke,{}),title:t.jsx(ne,{strong:!0,style:{cursor:f.is_dir?"pointer":"default"},onClick:()=>f.is_dir&&h(f.name),children:f.name}),description:!f.is_dir&&t.jsxs(ne,{type:"secondary",children:[(f.size/1024).toFixed(1)," KB"]})})})}),t.jsx(Ve,{style:{marginTop:"1rem",textAlign:"center"},current:l,total:g,pageSize:u,onChange:f=>b(o,m,f),showSizeChanger:!1})]})},dt=(e,r)=>J.post(`/fast-api/parse-analysis-result/${e}?save=${r}`),mt=a.memo(({analysis_id:e,callback:r})=>{const[n,s]=a.useState(),[o,i]=a.useState(!1),{messageApi:m}=le(),{modal:d,openModal:l,closeModal:c}=ie(),g=async(p=!1)=>{i(!0);try{const u=await dt(e,p);s(u.data),i(!1),r&&p&&r()}catch(u){i(!1),m.error(u.response.data.detail)}};return a.useEffect(()=>{g(!1)},[e]),t.jsxs(t.Fragment,{children:[t.jsxs(R,{gap:"small",justify:"flex-end",align:"center",children:[(n==null?void 0:n.file_format_list)&&t.jsx(t.Fragment,{children:n==null?void 0:n.file_format_list.map(p=>t.jsx(x,{size:"small",color:"cyan",variant:"solid",onClick:()=>l("modalA",{params:{component_id:p.component_id},title:p.name}),children:p.name}))}),t.jsx(K,{title:"确定解析吗？",onConfirm:()=>{g(!0),m.success("解析成功")},children:t.jsx(x,{size:"small",color:"cyan",variant:"solid",children:"解析"})}),t.jsx(x,{size:"small",color:"primary",variant:"solid",onClick:()=>g(!1),children:"刷新"})]}),t.jsx(fe,{spinning:o,children:n&&t.jsx(t.Fragment,{children:n!=null&&n.error?t.jsx(X,{children:t.jsx("pre",{children:n==null?void 0:n.error})}):t.jsxs(t.Fragment,{children:[t.jsx(pe,{size:"small",pagination:!1,rowKey:"component_id",columns:[{title:"名称",dataIndex:"name",key:"name"},{title:"目录",dataIndex:"dir",key:"dir"},{title:"文件组件ID",dataIndex:"component_id",key:"component_id"},{title:"文件格式",dataIndex:"fileFormat",key:"fileFormat",render:(p,u)=>t.jsx("div",{style:{overflowWrap:"break-word",wordBreak:"break-all"},children:JSON.stringify(u.fileFormat)})},{title:"操作",dataIndex:"component_id",key:"component_id",render:(p,u)=>t.jsx(t.Fragment,{children:t.jsx(x,{color:"cyan",variant:"solid",size:"small",onClick:()=>{l("modalC",{data:{component_id:u.component_id},structure:{component_type:"file",files:n==null?void 0:n.file_dict[u.dir]}})},children:"编辑"})})}],dataSource:n==null?void 0:n.file_format_list}),t.jsx(z,{style:{maxHeight:"20rem",overflow:"auto"},children:t.jsx(X,{children:t.jsx("pre",{children:JSON.stringify(n,null,2)})})})]})})}),t.jsx(We,{callback:g,visible:d.key=="modalC"&&d.visible,onClose:c,params:d.params}),t.jsx(Je,{visible:d.key=="modalA"&&d.visible,params:d.params,onClose:c,analysis:n})]})});var U=function(){return U=Object.assign||function(e){for(var r,n=1,s=arguments.length;n<s;n++){r=arguments[n];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},U.apply(this,arguments)},ut=a.forwardRef(function(e,r){return ce.createElement(he,U({},e,{chartType:"Bar",ref:r}))}),V=function(){return V=Object.assign||function(e){for(var r,n=1,s=arguments.length;n<s;n++){r=arguments[n];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},V.apply(this,arguments)},pt=a.forwardRef(function(e,r){return ce.createElement(he,V({},e,{chartType:"Column",ref:r}))});const ft=({visible:e,onClose:r,params:n})=>{const[s,o]=a.useState(),[i,m]=a.useState([]),[d,l]=a.useState(),[c,g]=a.useState(),{baseURL:p}=Be(h=>h.user);a.useEffect(()=>{if(e){const h=Object.entries(n.content).map(([j,C])=>({key:C,label:j}));if(m(h),h.length>0){const j=h[0].key;l(j),u(j)}}},[e]);const u=async h=>{g(!0);const j=await me(h);o(j.data),g(!1)},b=h=>{const j=`${p}/brave-api/file-operation/download?path=${h}`;window.open(j,"_blank")};return e?t.jsxs(Ae,{width:"80vw",open:e,onCancel:r,title:"打开文件",footer:!1,children:[t.jsx(q,{tabBarExtraContent:t.jsxs(R,{gap:"small",align:"center",children:[t.jsx(x,{size:"small",color:"cyan",variant:"solid",onClick:()=>{b(d)},children:"Download"}),t.jsx(x,{size:"small",color:"cyan",variant:"solid",onClick:()=>{u(d)},children:"Refresh"})]}),items:i,onChange:h=>{u(h),l(h)}}),t.jsx(fe,{spinning:c,children:t.jsx(ue,{...s})}),(n==null?void 0:n.description)&&t.jsx(qe,{data:n.description})]}):null},se=({file_path:e})=>{a.useEffect(()=>{e&&s(e)},[e]);const[r,n]=a.useState([]),s=async(o,i=!1)=>{const m=await me(o);n(m.data)};return t.jsx(t.Fragment,{children:t.jsx(z,{title:t.jsxs(de,{color:"blue",children:["文件: ",e]}),extra:t.jsx(x,{size:"small",color:"cyan",variant:"solid",onClick:()=>{s(e)},children:"刷新日志"}),bodyStyle:{padding:0},children:t.jsx(ue,{...r})})})},ht=({output_dir:e,...r})=>(JSON.stringify(r),t.jsx(ct,{path:e})),gt=({data:e})=>{const r={data:e,xField:"task",yField:"realtime",colorField:"process",group:{padding:0},label:{text:n=>n.label,textBaseline:"bottom"}};return t.jsx(t.Fragment,{children:t.jsx(pt,{...r})})},xt=({data:e})=>{const r=Array.from(new Set(e.map(i=>i.process))),[n,s]=a.useState(r[0]),o=e.filter(i=>i.process===n);return t.jsxs("div",{children:[t.jsx("div",{style:{marginBottom:16},children:r.map(i=>t.jsx(x,{size:"small",type:i===n?"primary":"default",onClick:()=>s(i),style:{marginRight:8},children:i},i))}),t.jsx(gt,{data:o})]})},jt=({data:e})=>{const r={data:e,xField:"process",yField:"count",colorField:"status",stack:!0,sort:{reverse:!0,by:"y"},style:{maxWidth:50}};return t.jsx(ut,{...r})},bt=({data:e})=>{const{modal:r,openModal:n,closeModal:s}=ie(),o=[{title:"process",dataIndex:"process",key:"process",ellipsis:!0},{title:"tag",dataIndex:"tag",key:"tag",ellipsis:!0},{title:"name",dataIndex:"name",key:"name",ellipsis:!0,render:(l,c)=>t.jsx(y,{title:t.jsx(t.Fragment,{children:t.jsx("ul",{children:t.jsxs("li",{children:[" ",c.workdir," "]})})}),children:l})},{title:"container",dataIndex:"container",key:"container",ellipsis:!0},{title:"status",dataIndex:"status",key:"status",ellipsis:!0},{title:"realtime",dataIndex:"realtime",key:"realtime",ellipsis:!0},{title:"cpus",dataIndex:"cpus",key:"cpus",ellipsis:!0,render:(l,c)=>t.jsx(y,{title:t.jsx(t.Fragment,{children:c["%cpu"]}),children:l})},{title:"memory",dataIndex:"memory",key:"memory",ellipsis:!0,width:100,render:(l,c)=>t.jsx(y,{title:t.jsx(t.Fragment,{children:c["%mem"]}),children:l})},{title:"操作",key:"action",fixed:"right",ellipsis:!0,width:200,render:(l,c)=>t.jsx(R,{gap:"small",children:t.jsx(x,{size:"small",color:"cyan",variant:"solid",onClick:()=>{n("openFile",{content:{".command.sh":`${c.workdir}/.command.sh`,".command.trace":`${c.workdir}/.command.trace`,".command.run":`${c.workdir}/.command.run`,".command.out":`${c.workdir}/.command.out`,".command.err":`${c.workdir}/.command.err`,".command.begin":`${c.workdir}/.command.begin`}})},children:"查看"})})}],[i,m]=a.useState(""),d=a.useMemo(()=>i?e.filter(l=>Object.values(l).some(c=>String(c).toLowerCase().includes(i.toLowerCase()))):e,[e,i]);return t.jsxs(t.Fragment,{children:[t.jsx(pe,{title:()=>t.jsx(ae.Search,{size:"small",placeholder:"搜索任务...",allowClear:!0,enterButton:!0,value:i,onChange:l=>m(l.target.value),style:{width:300}}),scroll:{x:"max-content",y:55*5},size:"small",bordered:!0,footer:()=>`A total of ${d.length} records`,columns:o,dataSource:d,rowKey:l=>l.task_id}),t.jsx(ft,{visible:r.key=="openFile"&&r.visible,onClose:s,params:r.params})]})},yt=({analysis_id:e})=>{const[r,n]=a.useState(),[s,o]=a.useState(!1);function i(d){const l=d.match(/(\d+)m/),c=d.match(/(\d+)s/),g=l?parseInt(l[1]):0,p=c?parseInt(c[1]):0;return g*60+p}const m=async()=>{o(!0);const d=await J.get(`/analysis/analysis-progress/${e}`),l={};d.data.forEach(p=>{const u=`${p.process}-${p.status}`;l[u]||(l[u]={process:p.process,status:p.status,count:0}),l[u].count+=1});const c=Object.values(l),g=d.data.map(p=>({process:p.process,task:p.task_id,realtime:i(p.realtime),label:p.realtime}));n({table:d.data,statusData:c,timeData:g}),o(!1)};return a.useEffect(()=>{m()},[]),t.jsxs("div",{children:[t.jsx(R,{justify:"flex-end",gap:"small",children:t.jsx(x,{size:"small",color:"cyan",variant:"solid",onClick:m,children:"刷新"})}),r&&t.jsx(q,{defaultActiveKey:"0",onChange:()=>{window.dispatchEvent(new Event("resize"))},items:[{key:"0",label:"任务表格",children:t.jsx(bt,{data:(r==null?void 0:r.table)||[]})},{key:"1",label:"任务状态",children:t.jsx(jt,{data:(r==null?void 0:r.statusData)||[]})},{key:"2",label:"运行时间",children:t.jsx(xt,{data:(r==null?void 0:r.timeData)||[]})}]})]})},_t={output_dir:ht,workflow_log_file:E,executor_log_file:E,trace_file:E,command_log_path:E,params_path:se,command_path:se,result_parse:mt,analysis_progress:yt},Ct=({analysis:e,file:r,fileKey:n})=>{const s=_t[n];return s?t.jsx(s,{...e,file_path:r,file:r,fileKey:n}):t.jsx(t.Fragment,{children:"no component"})},vt=a.memo(({analysis:e,callback:r})=>{const[n,s]=a.useState("command_log_path"),{messageApi:o}=le(),{eventSourceRef:i,status:m,reconnect:d}=Te(),l=a.useRef(n);if(!e)return null;const c={workflow_log_file:e.workflow_log_file,executor_log_file:e.executor_log_file,trace_file:e.trace_file,params_path:e.params_path,command_path:e.command_path,command_log_path:e.command_log_path},g=async()=>{await Me(e==null?void 0:e.analysis_id,"job"),o.success("运行成功"),r&&r()},p=[{key:"command_log_path",label:t.jsx(y,{title:t.jsx("ul",{children:t.jsx("li",{children:e==null?void 0:e.command_log_path})}),children:"Run Log"})},{key:"trace_file",label:t.jsx(y,{title:t.jsx("ul",{children:t.jsx("li",{children:e==null?void 0:e.trace_file})}),children:"Progress"})},{key:"workflow_log_file",label:t.jsx(y,{title:t.jsx("ul",{children:t.jsx("li",{children:e==null?void 0:e.workflow_log_file})}),children:"Workflow Log"})},{key:"executor_log_file",label:t.jsx(y,{title:t.jsx("ul",{children:t.jsx("li",{children:e==null?void 0:e.executor_log_file})}),children:"Executor Log"})},{key:"params_path",label:t.jsx(y,{title:t.jsx("ul",{children:t.jsx("li",{children:e==null?void 0:e.params_path})}),children:"Parameters"})},{key:"command_path",label:t.jsx(y,{title:t.jsx("ul",{children:t.jsx("li",{children:e==null?void 0:e.command_path})}),children:"Command"})},{key:"output_dir",label:t.jsx(y,{title:t.jsx("ul",{children:t.jsx("li",{children:e==null?void 0:e.output_dir})}),children:"Output File"})},{key:"analysis_progress",label:t.jsx(y,{title:t.jsx("ul",{children:t.jsx("li",{children:e==null?void 0:e.output_dir})}),children:"Analysis Visualization"})},{key:"result_parse",label:t.jsx(y,{title:t.jsx("ul",{children:t.jsx("li",{children:e==null?void 0:e.output_dir})}),children:"Result Parsing"})}];return t.jsx(t.Fragment,{children:t.jsx(q,{tabBarExtraContent:t.jsxs(R,{gap:"small",align:"center",children:[t.jsx(de,{color:"cyan",children:e==null?void 0:e.job_status}),t.jsx(y,{title:t.jsx(t.Fragment,{children:c[n]})}),e.job_status=="running"?t.jsx(t.Fragment,{children:t.jsx(K,{title:"Stop the job?",onConfirm:async()=>{await Ne(e.analysis_id,"job"),o.success("Stopped successfully")},children:t.jsx(x,{size:"small",color:"cyan",variant:"solid",children:"Stop"})})}):t.jsx(t.Fragment,{children:t.jsx(K,{title:"Run the job?",onConfirm:g,children:t.jsx(x,{size:"small",color:"cyan",variant:"solid",children:e.analysis_status=="created"?"Run":"Re-Run"})})})]}),activeKey:n,onChange:u=>{s(u),l.current=u},size:"small",items:p.map(u=>({key:u.key,label:u.label,children:t.jsx(Ct,{file:c[u.key],fileKey:u.key,analysis:e})}))})})}),At=a.forwardRef(({visible:e,params:r,onClose:n,callback:s},o)=>{console.log("loading PipelineInfo...");const i=async()=>{l(),s&&s()},{analysis_id:m,...d}=r||{},l=async()=>{if(m){const u=(await Le(m)).data;g(u)}},[c,g]=a.useState();return a.useImperativeHandle(o,()=>({relaod:l})),a.useEffect(()=>{e&&l()},[e&&(r==null?void 0:r.analysis_id)]),e?t.jsx(t.Fragment,{children:t.jsx(z,{size:"small",title:`Process Monitoring ${m}`,extra:t.jsx(t.Fragment,{children:t.jsx(x,{size:"small",onClick:n,color:"cyan",variant:"solid",children:"关闭"})}),children:t.jsx(vt,{analysis:c,callback:i,loadAnalysis:l})})}):t.jsx(t.Fragment,{})});export{vt as F,ft as O,At as P};
