import{r as v,f as Pr,j as m,g as dt,P as Zi,B as le,a as It,F as Oe,e as Ke,h as Ji,I as en,E as _r,i as $r,d as Lr,M as dn,k as Tr,l as Qi,R as fe,m as Ao,n as St,o as Or,b as ea,u as ta,p as na,q as oa,t as ra}from"./main-gLMaKCvr.js";import{U as zr,A as Hr,a as sa}from"./index-DUqcjVqJ.js";import{c as ia}from"./utils-D2B0dIuM.js";import{s as aa,a as ca,C as la,b as ua,d as da}from"./index-D2XNTdXQ.js";import{M as fa,a as ga}from"./index-ByQpjXWK.js";import{D as ha}from"./index-DDpcHwmR.js";import{T as Br}from"./index-ZwmWfN3I.js";import{F as pa,B as ma,P as ya}from"./index-DEhiFitC.js";import{C as Fr}from"./index-Jdu54dr5.js";import{F as Vr}from"./Table-CWRWFg95.js";import{D as xa}from"./index-BnHaSyf8.js";import{f as va,u as ba,a as wa,M as Sa,B as Ca}from"./index-CV4Rr1j0.js";import{O as Ea}from"./index-D1xRfB3g.js";import{i as Ro,a as Ma,s as fn,p as Yr,z as Xr,b as Na,d as Wr,c as Rn,t as Da}from"./zoom-BGsqVsDF.js";import{c as Ia,i as jo,a as Po}from"./rgb-BwIoVOhg.js";import{M as ka}from"./index-CjYZg4K2.js";import{T as Aa}from"./index-BrNLqRge.js";import"./index-Ci9o3BMm.js";import"./index-BpTPZbHm.js";import"./index-4ifBGcWk.js";import"./index-B-_sZvQI.js";import"./usePagination-DK-N3QaW.js";import"./DeleteOutlined-CBRh7405.js";import"./UpOutlined-CEatmWIN.js";import"./Dropdown-CSp8FTqG.js";import"./study-page-BLC-2qgz.js";import"./index-Das8pPKs.js";import"./index-CWqFacgc.js";import"./callSuper-DlyBkZi7.js";import"./index-B__zS0KG.js";import"./addEventListener-BwXlid1p.js";import"./index-B6vjdRJB.js";function Ra(e,t){t||(t=[]);var n=e?Math.min(t.length,e.length):0,o=t.slice(),r;return function(s){for(r=0;r<n;++r)o[r]=e[r]*(1-s)+t[r]*s;return o}}function ja(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Pa(e,t){var n=t?t.length:0,o=e?Math.min(n,e.length):0,r=new Array(o),s=new Array(n),i;for(i=0;i<o;++i)r[i]=Ct(e[i],t[i]);for(;i<n;++i)s[i]=t[i];return function(a){for(i=0;i<o;++i)s[i]=r[i](a);return s}}function _a(e,t){var n=new Date;return e=+e,t=+t,function(o){return n.setTime(e*(1-o)+t*o),n}}function $a(e,t){var n={},o={},r;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(r in t)r in e?n[r]=Ct(e[r],t[r]):o[r]=t[r];return function(s){for(r in n)o[r]=n[r](s);return o}}function Ct(e,t){var n=typeof t,o;return t==null||n==="boolean"?Ia(t):(n==="number"?Ro:n==="string"?(o=Po(t))?(t=o,jo):Ma:t instanceof Po?jo:t instanceof Date?_a:ja(t)?Ra:Array.isArray(t)?Pa:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?$a:Ro)(e,t)}const La=({visible:e,onClose:t,params:n,callback:o})=>{if(!e)return null;const[r,s]=v.useState(),[i,a]=Pr.useMessage(),[u,f]=v.useState("main"),l=v.useRef(null),d=async c=>{try{const g=await It.get(`/get-component-module-content/${c.component_id}?script_name=${u}`);console.log(g),s(g.data)}catch(g){i.error(`${g.response.data.detail}`)}};return v.useEffect(()=>{d(n)},[JSON.stringify(n),u]),m.jsxs(m.Fragment,{children:[a,m.jsxs(ha,{extra:m.jsxs(dt,{justify:"flex-end",gap:"small",children:[m.jsx(Zi,{title:"是否生成脚本",onConfirm:async()=>{await It.post(`/component/convert-ipynb/${n.component_id}`),i.success("是否生成脚本成功!"),d(n)},children:m.jsx(le,{size:"small",color:"cyan",variant:"solid",children:"生成脚本"})}),m.jsx(le,{size:"small",color:"cyan",variant:"solid",onClick:()=>{d(n)},children:"刷新"}),m.jsx(le,{size:"small",color:"cyan",variant:"solid",onClick:()=>{l.current.setValue(r==null?void 0:r.content)},children:"保存"})]}),title:"查看文件",open:e,onClose:t,width:"50%",children:[m.jsx("ul",{children:m.jsxs("li",{children:["path:",r==null?void 0:r.path]})}),m.jsx("hr",{}),m.jsx(Br,{onChange:c=>{f(c)},items:[{label:"main",key:"main"},{label:"input_parse",key:"input_parse"},{label:"output_parse",key:"output_parse"}]}),m.jsx(fa,{value:r==null?void 0:r.content,editorRef:l,defaultLanguage:"python"})]})]})},Ta=({parseData:e,columns:t,importData:n})=>m.jsx(Vr,{size:"small",bordered:!0,pagination:!1,footer:()=>m.jsxs("div",{style:{textAlign:"right"},children:["一共",e.length,"条记录   ",m.jsx(le,{size:"small",color:"cyan",variant:"solid",onClick:n,children:"确认"})]}),columns:t,dataSource:e}),jn=({component_type:e,component_id:t,component_name:n,inputForm:o,operatePipeline:r,name:s,callback:i})=>{const[a]=Oe.useForm();console.log("-->ImportFile渲染");const{messageApi:u,project:f}=Ke(),[l,d]=v.useState([]);Ji(h=>h.global.setting);const[c,g]=v.useState(),y=v.useRef(null);v.useEffect(()=>{if(o){let w=o.map(S=>Array.isArray(S.name)?S.name[1]:S.name).map(S=>({title:S,dataIndex:S,key:S,render:E=>m.jsx("span",{children:E})}));w=[{title:"样本名称",dataIndex:"sample_name",key:"sample_name",render:S=>m.jsx("span",{children:S})},...w,{title:"操作",dataIndex:"action",key:"action",ellipsis:!0,render:(S,E)=>m.jsx(dt,{gap:"small",children:m.jsx(le,{size:"small",danger:!0,onClick:()=>{p(E.sample_name)},children:"删除"})})}],console.log(w),y.current=w,g(w)}},[o]);const p=h=>{d(w=>w.filter(S=>S.sample_name!==h))},x=h=>{const{content:w,sample_name:S}=h;return l?l.map(E=>{const{sample_name:N,...M}=E;return{...h,project:f,component_id:t,content:JSON.stringify(M),sample_name:N}}):[{...h,project:f,component_id:t,content:JSON.stringify(w),sample_name:S}]},b=async()=>{const h=await a.validateFields();if(h.length==0){u.error("没有数据添加!");return}if(o&&o.length==0){u.error("该组件没有配置inputForm!");return}const w=x(h);try{const S=await It.post("/import-data",w);u.success("导入成功"),i&&i()}catch(S){u.error(S.response.data.detail)}},C=async()=>{const h=await a.validateFields();if(o&&o.length==0){u.error("该组件没有配置inputForm!");return}const w=await It.post("/parse-import-data",{content:JSON.stringify(h.content)});console.log(w),d(w.data)};return v.useEffect(()=>{const h=w=>{var $;const S=(($=w.clipboardData)==null?void 0:$.getData("Text"))||"";if(!S)return;const E=S.includes("	")?"	":",",M=S.split(/\r?\n/).filter(D=>D.trim()!=="").map(D=>D.split(E).map(k=>k.trim()));console.log(M);const A=M.map(D=>{const k={};return y.current.forEach((R,P)=>{D.length<=P?k[R.dataIndex]="unknown":k[R.dataIndex]=D[P]}),k});d(A),u.success("粘贴成功！")};return document.addEventListener("paste",h),()=>{document.removeEventListener("paste",h)}},[]),m.jsx(m.Fragment,{children:m.jsx(Fr,{title:`${n}(${t})`,extra:m.jsxs(dt,{gap:"small",children:[m.jsx(le,{size:"small",color:"cyan",variant:"solid",onClick:()=>{r.openModal("modalC",{data:{component_id:t},structure:{component_type:e}})},children:"编辑inputForm"}),m.jsx(le,{size:"small",color:"cyan",variant:"solid",disabled:!l,onClick:()=>d([]),children:"清空"}),m.jsx(le,{size:"small",color:"cyan",variant:"solid",disabled:!o,onClick:C,children:"解析"})]}),children:m.jsxs(Oe,{form:a,children:[m.jsx(Oe.Item,{name:"sample_source",label:"样本来源",children:m.jsx(en,{})}),o?m.jsx(m.Fragment,{children:m.jsx(pa,{formJson:o,dataMap:{}})}):m.jsx(m.Fragment,{children:m.jsx(_r,{description:"该组件没有配置inputForm!",children:m.jsx(le,{color:"cyan",variant:"solid",onClick:()=>{r.openModal("modalC",{data:{component_id:t},structure:{component_type:e}})},children:"配置inputForm"})})}),m.jsx(Ta,{parseData:l,columns:c,importData:b}),m.jsx($r,{ghost:!0,items:[{key:"1",label:"更多",children:m.jsx(m.Fragment,{children:m.jsx(Oe.Item,{noStyle:!0,shouldUpdate:!0,children:()=>m.jsx(Lr,{children:m.jsx("pre",{children:JSON.stringify(x(a.getFieldsValue()),null,2)})})})})}]})]})})})},Oa=({visible:e,onClose:t,params:n,callback:o})=>e?m.jsx(m.Fragment,{children:m.jsx(dn,{open:e,onClose:t,width:"80%",onCancel:t,title:"导入数据",footer:null,children:m.jsx(Ha,{params:n,type:"inputFile",callback:t})})}):null,za=({params:e,type:t,callback:n})=>{if(!e)return m.jsx(m.Fragment,{children:"无数据"});if(e.component_type=="software"){if(e[t]&&Array.isArray(e[t])&&e[t].length>0)return e[t].map((o,r)=>v.createElement(jn,{...o,operatePipeline:e.operatePipeline,key:r,callback:n}))}else{if(e.component_type=="pipeline")return m.jsx(jn,{...e});if(e.component_type=="file")return m.jsx(jn,{...e})}},Ha=v.memo(za);en.TextArea;const Ba=({visible:e,onClose:t,params:n})=>{var d;if(!e)return null;const[o]=Oe.useForm(),{callback:r}=n,{messageApi:s}=Ke(),{project:i,projectObj:a}=Ke(),u=c=>{const g=c.metadata;return delete c.metadata,{...c,sample_id:n.sample_id,project:i,analysis_result_id:n.analysis_result_id,metadata:JSON.stringify(g)}},f=async()=>{const c=await va(n.sample_id);o.setFieldsValue(c.data)};v.useEffect(()=>{n.sample_id&&f()},[n==null?void 0:n.sample_id]);const l=async()=>{const c=await o.validateFields(),g=u(c);g.sample_id?(await ba(g),s.success("更新成功")):(await wa(g),s.success("添加成功")),r==null||r(),t()};return m.jsxs(dn,{onOk:l,open:e,onClose:t,onCancel:t,title:`${n.sample_id?"编辑":"添加"}metadata`,children:[JSON.stringify(a),m.jsxs(Oe,{form:o,children:[m.jsx(Oe.Item,{label:"样本名称",name:"sample_name",children:m.jsx(en,{})}),(a==null?void 0:a.metadata_form)&&Array.isArray(a==null?void 0:a.metadata_form)&&((d=a==null?void 0:a.metadata_form)==null?void 0:d.map(c=>m.jsx(Oe.Item,{label:c.label,name:["metadata",c.name],children:m.jsx(en,{})},c.name))),m.jsx($r,{ghost:!0,items:[{key:"1",label:"更多",children:m.jsx(m.Fragment,{children:m.jsx(Oe.Item,{noStyle:!0,shouldUpdate:!0,children:()=>m.jsx(Lr,{children:m.jsx("pre",{children:JSON.stringify(u(o.getFieldsValue()),null,2)})})})})}]})]})]})};function ie(e){if(typeof e=="string"||typeof e=="number")return""+e;let t="";if(Array.isArray(e))for(let n=0,o;n<e.length;n++)(o=ie(e[n]))!==""&&(t+=(t&&" ")+o);else for(let n in e)e[n]&&(t+=(t&&" ")+n);return t}const Pe={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:e=>`Node type "${e}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:e=>`The old edge with id=${e} does not exist.`,error009:e=>`Marker type "${e}" doesn't exist.`,error008:(e,{id:t,sourceHandle:n,targetHandle:o})=>`Couldn't create edge for ${e} handle id: "${e==="source"?n:o}", edge id: ${t}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:e=>`Edge type "${e}" not found. Using fallback type "default".`,error012:e=>`Node with id "${e}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`,error013:(e="react")=>`It seems that you haven't loaded the styles. Please import '@xyflow/${e}/dist/style.css' or base.css to make sure everything is working properly.`,error014:()=>"useNodeConnections: No node ID found. Call useNodeConnections inside a custom Node or provide a node ID.",error015:()=>"It seems that you are trying to drag a node that is not initialized. Please use onNodesChange as explained in the docs."},kt=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],Ur=["Enter"," ","Escape"],Gr={"node.a11yDescription.default":"Press enter or space to select a node. Press delete to remove it and escape to cancel.","node.a11yDescription.keyboardDisabled":"Press enter or space to select a node. You can then use the arrow keys to move the node around. Press delete to remove it and escape to cancel.","node.a11yDescription.ariaLiveMessage":({direction:e,x:t,y:n})=>`Moved selected node ${e}. New position, x: ${t}, y: ${n}`,"edge.a11yDescription.default":"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel.","controls.ariaLabel":"Control Panel","controls.zoomIn.ariaLabel":"Zoom In","controls.zoomOut.ariaLabel":"Zoom Out","controls.fitView.ariaLabel":"Fit View","controls.interactive.ariaLabel":"Toggle Interactivity","minimap.ariaLabel":"Mini Map","handle.ariaLabel":"Handle"};var ft;(function(e){e.Strict="strict",e.Loose="loose"})(ft||(ft={}));var nt;(function(e){e.Free="free",e.Vertical="vertical",e.Horizontal="horizontal"})(nt||(nt={}));var At;(function(e){e.Partial="partial",e.Full="full"})(At||(At={}));const qr={inProgress:!1,isValid:null,from:null,fromHandle:null,fromPosition:null,fromNode:null,to:null,toHandle:null,toPosition:null,toNode:null};var Ge;(function(e){e.Bezier="default",e.Straight="straight",e.Step="step",e.SmoothStep="smoothstep",e.SimpleBezier="simplebezier"})(Ge||(Ge={}));var tn;(function(e){e.Arrow="arrow",e.ArrowClosed="arrowclosed"})(tn||(tn={}));var X;(function(e){e.Left="left",e.Top="top",e.Right="right",e.Bottom="bottom"})(X||(X={}));const _o={[X.Left]:X.Right,[X.Right]:X.Left,[X.Top]:X.Bottom,[X.Bottom]:X.Top};function Kr(e){return e===null?null:e?"valid":"invalid"}const Zr=e=>"id"in e&&"source"in e&&"target"in e,Fa=e=>"id"in e&&"position"in e&&!("source"in e)&&!("target"in e),ro=e=>"id"in e&&"internals"in e&&!("source"in e)&&!("target"in e),Tt=(e,t=[0,0])=>{const{width:n,height:o}=He(e),r=e.origin??t,s=n*r[0],i=o*r[1];return{x:e.position.x-s,y:e.position.y-i}},Va=(e,t={nodeOrigin:[0,0]})=>{if(e.length===0)return{x:0,y:0,width:0,height:0};const n=e.reduce((o,r)=>{const s=typeof r=="string";let i=!t.nodeLookup&&!s?r:void 0;t.nodeLookup&&(i=s?t.nodeLookup.get(r):ro(r)?r:t.nodeLookup.get(r.id));const a=i?nn(i,t.nodeOrigin):{x:0,y:0,x2:0,y2:0};return gn(o,a)},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return hn(n)},Ot=(e,t={})=>{if(e.size===0)return{x:0,y:0,width:0,height:0};let n={x:1/0,y:1/0,x2:-1/0,y2:-1/0};return e.forEach(o=>{if(t.filter===void 0||t.filter(o)){const r=nn(o);n=gn(n,r)}}),hn(n)},so=(e,t,[n,o,r]=[0,0,1],s=!1,i=!1)=>{const a={...zt(t,[n,o,r]),width:t.width/r,height:t.height/r},u=[];for(const f of e.values()){const{measured:l,selectable:d=!0,hidden:c=!1}=f;if(i&&!d||c)continue;const g=l.width??f.width??f.initialWidth??null,y=l.height??f.height??f.initialHeight??null,p=Rt(a,ht(f)),x=(g??0)*(y??0),b=s&&p>0;(!f.internals.handleBounds||b||p>=x||f.dragging)&&u.push(f)}return u},Ya=(e,t)=>{const n=new Set;return e.forEach(o=>{n.add(o.id)}),t.filter(o=>n.has(o.source)||n.has(o.target))};function Xa(e,t){const n=new Map,o=t!=null&&t.nodes?new Set(t.nodes.map(r=>r.id)):null;return e.forEach(r=>{r.measured.width&&r.measured.height&&((t==null?void 0:t.includeHiddenNodes)||!r.hidden)&&(!o||o.has(r.id))&&n.set(r.id,r)}),n}async function Wa({nodes:e,width:t,height:n,panZoom:o,minZoom:r,maxZoom:s},i){if(e.size===0)return Promise.resolve(!0);const a=Xa(e,i),u=Ot(a),f=io(u,t,n,(i==null?void 0:i.minZoom)??r,(i==null?void 0:i.maxZoom)??s,(i==null?void 0:i.padding)??.1);return await o.setViewport(f,{duration:i==null?void 0:i.duration,ease:i==null?void 0:i.ease,interpolate:i==null?void 0:i.interpolate}),Promise.resolve(!0)}function Jr({nodeId:e,nextPosition:t,nodeLookup:n,nodeOrigin:o=[0,0],nodeExtent:r,onError:s}){const i=n.get(e),a=i.parentId?n.get(i.parentId):void 0,{x:u,y:f}=a?a.internals.positionAbsolute:{x:0,y:0},l=i.origin??o;let d=i.extent||r;if(i.extent==="parent"&&!i.expandParent)if(!a)s==null||s("005",Pe.error005());else{const g=a.measured.width,y=a.measured.height;g&&y&&(d=[[u,f],[u+g,f+y]])}else a&&pt(i.extent)&&(d=[[i.extent[0][0]+u,i.extent[0][1]+f],[i.extent[1][0]+u,i.extent[1][1]+f]]);const c=pt(d)?ot(t,d,i.measured):t;return(i.measured.width===void 0||i.measured.height===void 0)&&(s==null||s("015",Pe.error015())),{position:{x:c.x-u+(i.measured.width??0)*l[0],y:c.y-f+(i.measured.height??0)*l[1]},positionAbsolute:c}}async function Ua({nodesToRemove:e=[],edgesToRemove:t=[],nodes:n,edges:o,onBeforeDelete:r}){const s=new Set(e.map(c=>c.id)),i=[];for(const c of n){if(c.deletable===!1)continue;const g=s.has(c.id),y=!g&&c.parentId&&i.find(p=>p.id===c.parentId);(g||y)&&i.push(c)}const a=new Set(t.map(c=>c.id)),u=o.filter(c=>c.deletable!==!1),l=Ya(i,u);for(const c of u)a.has(c.id)&&!l.find(y=>y.id===c.id)&&l.push(c);if(!r)return{edges:l,nodes:i};const d=await r({nodes:i,edges:l});return typeof d=="boolean"?d?{edges:l,nodes:i}:{edges:[],nodes:[]}:d}const gt=(e,t=0,n=1)=>Math.min(Math.max(e,t),n),ot=(e={x:0,y:0},t,n)=>({x:gt(e.x,t[0][0],t[1][0]-((n==null?void 0:n.width)??0)),y:gt(e.y,t[0][1],t[1][1]-((n==null?void 0:n.height)??0))});function Qr(e,t,n){const{width:o,height:r}=He(n),{x:s,y:i}=n.internals.positionAbsolute;return ot(e,[[s,i],[s+o,i+r]],t)}const $o=(e,t,n)=>e<t?gt(Math.abs(e-t),1,t)/t:e>n?-gt(Math.abs(e-n),1,t)/t:0,es=(e,t,n=15,o=40)=>{const r=$o(e.x,o,t.width-o)*n,s=$o(e.y,o,t.height-o)*n;return[r,s]},gn=(e,t)=>({x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}),Un=({x:e,y:t,width:n,height:o})=>({x:e,y:t,x2:e+n,y2:t+o}),hn=({x:e,y:t,x2:n,y2:o})=>({x:e,y:t,width:n-e,height:o-t}),ht=(e,t=[0,0])=>{var r,s;const{x:n,y:o}=ro(e)?e.internals.positionAbsolute:Tt(e,t);return{x:n,y:o,width:((r=e.measured)==null?void 0:r.width)??e.width??e.initialWidth??0,height:((s=e.measured)==null?void 0:s.height)??e.height??e.initialHeight??0}},nn=(e,t=[0,0])=>{var r,s;const{x:n,y:o}=ro(e)?e.internals.positionAbsolute:Tt(e,t);return{x:n,y:o,x2:n+(((r=e.measured)==null?void 0:r.width)??e.width??e.initialWidth??0),y2:o+(((s=e.measured)==null?void 0:s.height)??e.height??e.initialHeight??0)}},ts=(e,t)=>hn(gn(Un(e),Un(t))),Rt=(e,t)=>{const n=Math.max(0,Math.min(e.x+e.width,t.x+t.width)-Math.max(e.x,t.x)),o=Math.max(0,Math.min(e.y+e.height,t.y+t.height)-Math.max(e.y,t.y));return Math.ceil(n*o)},Lo=e=>Ne(e.width)&&Ne(e.height)&&Ne(e.x)&&Ne(e.y),Ne=e=>!isNaN(e)&&isFinite(e),Ga=(e,t)=>{},pn=(e,t=[1,1])=>({x:t[0]*Math.round(e.x/t[0]),y:t[1]*Math.round(e.y/t[1])}),zt=({x:e,y:t},[n,o,r],s=!1,i=[1,1])=>{const a={x:(e-n)/r,y:(t-o)/r};return s?pn(a,i):a},on=({x:e,y:t},[n,o,r])=>({x:e*r+n,y:t*r+o});function at(e,t){if(typeof e=="number")return Math.floor((t-t/(1+e))*.5);if(typeof e=="string"&&e.endsWith("px")){const n=parseFloat(e);if(!Number.isNaN(n))return Math.floor(n)}if(typeof e=="string"&&e.endsWith("%")){const n=parseFloat(e);if(!Number.isNaN(n))return Math.floor(t*n*.01)}return console.error(`[React Flow] The padding value "${e}" is invalid. Please provide a number or a string with a valid unit (px or %).`),0}function qa(e,t,n){if(typeof e=="string"||typeof e=="number"){const o=at(e,n),r=at(e,t);return{top:o,right:r,bottom:o,left:r,x:r*2,y:o*2}}if(typeof e=="object"){const o=at(e.top??e.y??0,n),r=at(e.bottom??e.y??0,n),s=at(e.left??e.x??0,t),i=at(e.right??e.x??0,t);return{top:o,right:i,bottom:r,left:s,x:s+i,y:o+r}}return{top:0,right:0,bottom:0,left:0,x:0,y:0}}function Ka(e,t,n,o,r,s){const{x:i,y:a}=on(e,[t,n,o]),{x:u,y:f}=on({x:e.x+e.width,y:e.y+e.height},[t,n,o]),l=r-u,d=s-f;return{left:Math.floor(i),top:Math.floor(a),right:Math.floor(l),bottom:Math.floor(d)}}const io=(e,t,n,o,r,s)=>{const i=qa(s,t,n),a=(t-i.x)/e.width,u=(n-i.y)/e.height,f=Math.min(a,u),l=gt(f,o,r),d=e.x+e.width/2,c=e.y+e.height/2,g=t/2-d*l,y=n/2-c*l,p=Ka(e,g,y,l,t,n),x={left:Math.min(p.left-i.left,0),top:Math.min(p.top-i.top,0),right:Math.min(p.right-i.right,0),bottom:Math.min(p.bottom-i.bottom,0)};return{x:g-x.left+x.right,y:y-x.top+x.bottom,zoom:l}},rn=()=>{var e;return typeof navigator<"u"&&((e=navigator==null?void 0:navigator.userAgent)==null?void 0:e.indexOf("Mac"))>=0};function pt(e){return e!==void 0&&e!=="parent"}function He(e){var t,n;return{width:((t=e.measured)==null?void 0:t.width)??e.width??e.initialWidth??0,height:((n=e.measured)==null?void 0:n.height)??e.height??e.initialHeight??0}}function ns(e){var t,n;return(((t=e.measured)==null?void 0:t.width)??e.width??e.initialWidth)!==void 0&&(((n=e.measured)==null?void 0:n.height)??e.height??e.initialHeight)!==void 0}function os(e,t={width:0,height:0},n,o,r){const s={...e},i=o.get(n);if(i){const a=i.origin||r;s.x+=i.internals.positionAbsolute.x-(t.width??0)*a[0],s.y+=i.internals.positionAbsolute.y-(t.height??0)*a[1]}return s}function To(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function Za(){let e,t;return{promise:new Promise((o,r)=>{e=o,t=r}),resolve:e,reject:t}}function Ja(e){return{...Gr,...e||{}}}function Et(e,{snapGrid:t=[0,0],snapToGrid:n=!1,transform:o,containerBounds:r}){const{x:s,y:i}=je(e),a=zt({x:s-((r==null?void 0:r.left)??0),y:i-((r==null?void 0:r.top)??0)},o),{x:u,y:f}=n?pn(a,t):a;return{xSnapped:u,ySnapped:f,...a}}const ao=e=>({width:e.offsetWidth,height:e.offsetHeight}),rs=e=>{var t;return((t=e==null?void 0:e.getRootNode)==null?void 0:t.call(e))||(window==null?void 0:window.document)},Qa=["INPUT","SELECT","TEXTAREA"];function ss(e){var o,r;const t=((r=(o=e.composedPath)==null?void 0:o.call(e))==null?void 0:r[0])||e.target;return(t==null?void 0:t.nodeType)!==1?!1:Qa.includes(t.nodeName)||t.hasAttribute("contenteditable")||!!t.closest(".nokey")}const is=e=>"clientX"in e,je=(e,t)=>{var s,i;const n=is(e),o=n?e.clientX:(s=e.touches)==null?void 0:s[0].clientX,r=n?e.clientY:(i=e.touches)==null?void 0:i[0].clientY;return{x:o-((t==null?void 0:t.left)??0),y:r-((t==null?void 0:t.top)??0)}},Oo=(e,t,n,o,r)=>{const s=t.querySelectorAll(`.${e}`);return!s||!s.length?null:Array.from(s).map(i=>{const a=i.getBoundingClientRect();return{id:i.getAttribute("data-handleid"),type:e,nodeId:r,position:i.getAttribute("data-handlepos"),x:(a.left-n.left)/o,y:(a.top-n.top)/o,...ao(i)}})};function as({sourceX:e,sourceY:t,targetX:n,targetY:o,sourceControlX:r,sourceControlY:s,targetControlX:i,targetControlY:a}){const u=e*.125+r*.375+i*.375+n*.125,f=t*.125+s*.375+a*.375+o*.125,l=Math.abs(u-e),d=Math.abs(f-t);return[u,f,l,d]}function Ut(e,t){return e>=0?.5*e:t*25*Math.sqrt(-e)}function zo({pos:e,x1:t,y1:n,x2:o,y2:r,c:s}){switch(e){case X.Left:return[t-Ut(t-o,s),n];case X.Right:return[t+Ut(o-t,s),n];case X.Top:return[t,n-Ut(n-r,s)];case X.Bottom:return[t,n+Ut(r-n,s)]}}function cs({sourceX:e,sourceY:t,sourcePosition:n=X.Bottom,targetX:o,targetY:r,targetPosition:s=X.Top,curvature:i=.25}){const[a,u]=zo({pos:n,x1:e,y1:t,x2:o,y2:r,c:i}),[f,l]=zo({pos:s,x1:o,y1:r,x2:e,y2:t,c:i}),[d,c,g,y]=as({sourceX:e,sourceY:t,targetX:o,targetY:r,sourceControlX:a,sourceControlY:u,targetControlX:f,targetControlY:l});return[`M${e},${t} C${a},${u} ${f},${l} ${o},${r}`,d,c,g,y]}function ls({sourceX:e,sourceY:t,targetX:n,targetY:o}){const r=Math.abs(n-e)/2,s=n<e?n+r:n-r,i=Math.abs(o-t)/2,a=o<t?o+i:o-i;return[s,a,r,i]}function ec({sourceNode:e,targetNode:t,selected:n=!1,zIndex:o,elevateOnSelect:r=!1}){if(o!==void 0)return o;const s=r&&n?1e3:0,i=Math.max(e.parentId?e.internals.z:0,t.parentId?t.internals.z:0);return s+i}function tc({sourceNode:e,targetNode:t,width:n,height:o,transform:r}){const s=gn(nn(e),nn(t));s.x===s.x2&&(s.x2+=1),s.y===s.y2&&(s.y2+=1);const i={x:-r[0]/r[2],y:-r[1]/r[2],width:n/r[2],height:o/r[2]};return Rt(i,hn(s))>0}const nc=({source:e,sourceHandle:t,target:n,targetHandle:o})=>`xy-edge__${e}${t||""}-${n}${o||""}`,oc=(e,t)=>t.some(n=>n.source===e.source&&n.target===e.target&&(n.sourceHandle===e.sourceHandle||!n.sourceHandle&&!e.sourceHandle)&&(n.targetHandle===e.targetHandle||!n.targetHandle&&!e.targetHandle)),us=(e,t)=>{if(!e.source||!e.target)return t;let n;return Zr(e)?n={...e}:n={...e,id:nc(e)},oc(n,t)?t:(n.sourceHandle===null&&delete n.sourceHandle,n.targetHandle===null&&delete n.targetHandle,t.concat(n))};function ds({sourceX:e,sourceY:t,targetX:n,targetY:o}){const[r,s,i,a]=ls({sourceX:e,sourceY:t,targetX:n,targetY:o});return[`M ${e},${t}L ${n},${o}`,r,s,i,a]}const Ho={[X.Left]:{x:-1,y:0},[X.Right]:{x:1,y:0},[X.Top]:{x:0,y:-1},[X.Bottom]:{x:0,y:1}},rc=({source:e,sourcePosition:t=X.Bottom,target:n})=>t===X.Left||t===X.Right?e.x<n.x?{x:1,y:0}:{x:-1,y:0}:e.y<n.y?{x:0,y:1}:{x:0,y:-1},Bo=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));function sc({source:e,sourcePosition:t=X.Bottom,target:n,targetPosition:o=X.Top,center:r,offset:s,stepPosition:i}){const a=Ho[t],u=Ho[o],f={x:e.x+a.x*s,y:e.y+a.y*s},l={x:n.x+u.x*s,y:n.y+u.y*s},d=rc({source:f,sourcePosition:t,target:l}),c=d.x!==0?"x":"y",g=d[c];let y=[],p,x;const b={x:0,y:0},C={x:0,y:0},[,,h,w]=ls({sourceX:e.x,sourceY:e.y,targetX:n.x,targetY:n.y});if(a[c]*u[c]===-1){c==="x"?(p=r.x??f.x+(l.x-f.x)*i,x=r.y??(f.y+l.y)/2):(p=r.x??(f.x+l.x)/2,x=r.y??f.y+(l.y-f.y)*i);const E=[{x:p,y:f.y},{x:p,y:l.y}],N=[{x:f.x,y:x},{x:l.x,y:x}];a[c]===g?y=c==="x"?E:N:y=c==="x"?N:E}else{const E=[{x:f.x,y:l.y}],N=[{x:l.x,y:f.y}];if(c==="x"?y=a.x===g?N:E:y=a.y===g?E:N,t===o){const k=Math.abs(e[c]-n[c]);if(k<=s){const R=Math.min(s-1,s-k);a[c]===g?b[c]=(f[c]>e[c]?-1:1)*R:C[c]=(l[c]>n[c]?-1:1)*R}}if(t!==o){const k=c==="x"?"y":"x",R=a[c]===u[k],P=f[k]>l[k],_=f[k]<l[k];(a[c]===1&&(!R&&P||R&&_)||a[c]!==1&&(!R&&_||R&&P))&&(y=c==="x"?E:N)}const M={x:f.x+b.x,y:f.y+b.y},A={x:l.x+C.x,y:l.y+C.y},$=Math.max(Math.abs(M.x-y[0].x),Math.abs(A.x-y[0].x)),D=Math.max(Math.abs(M.y-y[0].y),Math.abs(A.y-y[0].y));$>=D?(p=(M.x+A.x)/2,x=y[0].y):(p=y[0].x,x=(M.y+A.y)/2)}return[[e,{x:f.x+b.x,y:f.y+b.y},...y,{x:l.x+C.x,y:l.y+C.y},n],p,x,h,w]}function ic(e,t,n,o){const r=Math.min(Bo(e,t)/2,Bo(t,n)/2,o),{x:s,y:i}=t;if(e.x===s&&s===n.x||e.y===i&&i===n.y)return`L${s} ${i}`;if(e.y===i){const f=e.x<n.x?-1:1,l=e.y<n.y?1:-1;return`L ${s+r*f},${i}Q ${s},${i} ${s},${i+r*l}`}const a=e.x<n.x?1:-1,u=e.y<n.y?-1:1;return`L ${s},${i+r*u}Q ${s},${i} ${s+r*a},${i}`}function Gn({sourceX:e,sourceY:t,sourcePosition:n=X.Bottom,targetX:o,targetY:r,targetPosition:s=X.Top,borderRadius:i=5,centerX:a,centerY:u,offset:f=20,stepPosition:l=.5}){const[d,c,g,y,p]=sc({source:{x:e,y:t},sourcePosition:n,target:{x:o,y:r},targetPosition:s,center:{x:a,y:u},offset:f,stepPosition:l});return[d.reduce((b,C,h)=>{let w="";return h>0&&h<d.length-1?w=ic(d[h-1],C,d[h+1],i):w=`${h===0?"M":"L"}${C.x} ${C.y}`,b+=w,b},""),c,g,y,p]}function Fo(e){var t;return e&&!!(e.internals.handleBounds||(t=e.handles)!=null&&t.length)&&!!(e.measured.width||e.width||e.initialWidth)}function ac(e){var d;const{sourceNode:t,targetNode:n}=e;if(!Fo(t)||!Fo(n))return null;const o=t.internals.handleBounds||Vo(t.handles),r=n.internals.handleBounds||Vo(n.handles),s=Yo((o==null?void 0:o.source)??[],e.sourceHandle),i=Yo(e.connectionMode===ft.Strict?(r==null?void 0:r.target)??[]:((r==null?void 0:r.target)??[]).concat((r==null?void 0:r.source)??[]),e.targetHandle);if(!s||!i)return(d=e.onError)==null||d.call(e,"008",Pe.error008(s?"target":"source",{id:e.id,sourceHandle:e.sourceHandle,targetHandle:e.targetHandle})),null;const a=(s==null?void 0:s.position)||X.Bottom,u=(i==null?void 0:i.position)||X.Top,f=jt(t,s,a),l=jt(n,i,u);return{sourceX:f.x,sourceY:f.y,targetX:l.x,targetY:l.y,sourcePosition:a,targetPosition:u}}function Vo(e){if(!e)return null;const t=[],n=[];for(const o of e)o.width=o.width??1,o.height=o.height??1,o.type==="source"?t.push(o):o.type==="target"&&n.push(o);return{source:t,target:n}}function jt(e,t,n=X.Left,o=!1){const r=((t==null?void 0:t.x)??0)+e.internals.positionAbsolute.x,s=((t==null?void 0:t.y)??0)+e.internals.positionAbsolute.y,{width:i,height:a}=t??He(e);if(o)return{x:r+i/2,y:s+a/2};switch((t==null?void 0:t.position)??n){case X.Top:return{x:r+i/2,y:s};case X.Right:return{x:r+i,y:s+a/2};case X.Bottom:return{x:r+i/2,y:s+a};case X.Left:return{x:r,y:s+a/2}}}function Yo(e,t){return e&&(t?e.find(n=>n.id===t):e[0])||null}function qn(e,t){return e?typeof e=="string"?e:`${t?`${t}__`:""}${Object.keys(e).sort().map(o=>`${o}=${e[o]}`).join("&")}`:""}function cc(e,{id:t,defaultColor:n,defaultMarkerStart:o,defaultMarkerEnd:r}){const s=new Set;return e.reduce((i,a)=>([a.markerStart||o,a.markerEnd||r].forEach(u=>{if(u&&typeof u=="object"){const f=qn(u,t);s.has(f)||(i.push({id:f,color:u.color||n,...u}),s.add(f))}}),i),[]).sort((i,a)=>i.id.localeCompare(a.id))}const co={nodeOrigin:[0,0],nodeExtent:kt,elevateNodesOnSelect:!0,defaults:{}},lc={...co,checkEquality:!0};function lo(e,t){const n={...e};for(const o in t)t[o]!==void 0&&(n[o]=t[o]);return n}function uc(e,t,n){const o=lo(co,n);for(const r of e.values())if(r.parentId)uo(r,e,t,o);else{const s=Tt(r,o.nodeOrigin),i=pt(r.extent)?r.extent:o.nodeExtent,a=ot(s,i,He(r));r.internals.positionAbsolute=a}}function Kn(e,t,n,o){var u,f;const r=lo(lc,o);let s=e.length>0;const i=new Map(t),a=r!=null&&r.elevateNodesOnSelect?1e3:0;t.clear(),n.clear();for(const l of e){let d=i.get(l.id);if(r.checkEquality&&l===(d==null?void 0:d.internals.userNode))t.set(l.id,d);else{const c=Tt(l,r.nodeOrigin),g=pt(l.extent)?l.extent:r.nodeExtent,y=ot(c,g,He(l));d={...r.defaults,...l,measured:{width:(u=l.measured)==null?void 0:u.width,height:(f=l.measured)==null?void 0:f.height},internals:{positionAbsolute:y,handleBounds:l.measured?d==null?void 0:d.internals.handleBounds:void 0,z:fs(l,a),userNode:l}},t.set(l.id,d)}(d.measured===void 0||d.measured.width===void 0||d.measured.height===void 0)&&!d.hidden&&(s=!1),l.parentId&&uo(d,t,n,o)}return s}function dc(e,t){if(!e.parentId)return;const n=t.get(e.parentId);n?n.set(e.id,e):t.set(e.parentId,new Map([[e.id,e]]))}function uo(e,t,n,o){const{elevateNodesOnSelect:r,nodeOrigin:s,nodeExtent:i}=lo(co,o),a=e.parentId,u=t.get(a);if(!u){console.warn(`Parent node ${a} not found. Please make sure that parent nodes are in front of their child nodes in the nodes array.`);return}dc(e,n);const f=r?1e3:0,{x:l,y:d,z:c}=fc(e,u,s,i,f),{positionAbsolute:g}=e.internals,y=l!==g.x||d!==g.y;(y||c!==e.internals.z)&&t.set(e.id,{...e,internals:{...e.internals,positionAbsolute:y?{x:l,y:d}:g,z:c}})}function fs(e,t){return(Ne(e.zIndex)?e.zIndex:0)+(e.selected?t:0)}function fc(e,t,n,o,r){const{x:s,y:i}=t.internals.positionAbsolute,a=He(e),u=Tt(e,n),f=pt(e.extent)?ot(u,e.extent,a):u;let l=ot({x:s+f.x,y:i+f.y},o,a);e.extent==="parent"&&(l=Qr(l,a,t));const d=fs(e,r),c=t.internals.z??0;return{x:l.x,y:l.y,z:c>=d?c+1:d}}function fo(e,t,n,o=[0,0]){var i;const r=[],s=new Map;for(const a of e){const u=t.get(a.parentId);if(!u)continue;const f=((i=s.get(a.parentId))==null?void 0:i.expandedRect)??ht(u),l=ts(f,a.rect);s.set(a.parentId,{expandedRect:l,parent:u})}return s.size>0&&s.forEach(({expandedRect:a,parent:u},f)=>{var h;const l=u.internals.positionAbsolute,d=He(u),c=u.origin??o,g=a.x<l.x?Math.round(Math.abs(l.x-a.x)):0,y=a.y<l.y?Math.round(Math.abs(l.y-a.y)):0,p=Math.max(d.width,Math.round(a.width)),x=Math.max(d.height,Math.round(a.height)),b=(p-d.width)*c[0],C=(x-d.height)*c[1];(g>0||y>0||b||C)&&(r.push({id:f,type:"position",position:{x:u.position.x-g+b,y:u.position.y-y+C}}),(h=n.get(f))==null||h.forEach(w=>{e.some(S=>S.id===w.id)||r.push({id:w.id,type:"position",position:{x:w.position.x+g,y:w.position.y+y}})})),(d.width<a.width||d.height<a.height||g||y)&&r.push({id:f,type:"dimensions",setAttributes:!0,dimensions:{width:p+(g?c[0]*g-b:0),height:x+(y?c[1]*y-C:0)}})}),r}function gc(e,t,n,o,r,s){const i=o==null?void 0:o.querySelector(".xyflow__viewport");let a=!1;if(!i)return{changes:[],updatedInternals:a};const u=[],f=window.getComputedStyle(i),{m22:l}=new window.DOMMatrixReadOnly(f.transform),d=[];for(const c of e.values()){const g=t.get(c.id);if(!g)continue;if(g.hidden){t.set(g.id,{...g,internals:{...g.internals,handleBounds:void 0}}),a=!0;continue}const y=ao(c.nodeElement),p=g.measured.width!==y.width||g.measured.height!==y.height;if(!!(y.width&&y.height&&(p||!g.internals.handleBounds||c.force))){const b=c.nodeElement.getBoundingClientRect(),C=pt(g.extent)?g.extent:s;let{positionAbsolute:h}=g.internals;g.parentId&&g.extent==="parent"?h=Qr(h,y,t.get(g.parentId)):C&&(h=ot(h,C,y));const w={...g,measured:y,internals:{...g.internals,positionAbsolute:h,handleBounds:{source:Oo("source",c.nodeElement,b,l,g.id),target:Oo("target",c.nodeElement,b,l,g.id)}}};t.set(g.id,w),g.parentId&&uo(w,t,n,{nodeOrigin:r}),a=!0,p&&(u.push({id:g.id,type:"dimensions",dimensions:y}),g.expandParent&&g.parentId&&d.push({id:g.id,parentId:g.parentId,rect:ht(w,r)}))}}if(d.length>0){const c=fo(d,t,n,r);u.push(...c)}return{changes:u,updatedInternals:a}}async function hc({delta:e,panZoom:t,transform:n,translateExtent:o,width:r,height:s}){if(!t||!e.x&&!e.y)return Promise.resolve(!1);const i=await t.setViewportConstrained({x:n[0]+e.x,y:n[1]+e.y,zoom:n[2]},[[0,0],[r,s]],o),a=!!i&&(i.x!==n[0]||i.y!==n[1]||i.k!==n[2]);return Promise.resolve(a)}function Xo(e,t,n,o,r,s){let i=r;const a=o.get(i)||new Map;o.set(i,a.set(n,t)),i=`${r}-${e}`;const u=o.get(i)||new Map;if(o.set(i,u.set(n,t)),s){i=`${r}-${e}-${s}`;const f=o.get(i)||new Map;o.set(i,f.set(n,t))}}function gs(e,t,n){e.clear(),t.clear();for(const o of n){const{source:r,target:s,sourceHandle:i=null,targetHandle:a=null}=o,u={edgeId:o.id,source:r,target:s,sourceHandle:i,targetHandle:a},f=`${r}-${i}--${s}-${a}`,l=`${s}-${a}--${r}-${i}`;Xo("source",u,l,e,r,i),Xo("target",u,f,e,s,a),t.set(o.id,o)}}function hs(e,t){if(!e.parentId)return!1;const n=t.get(e.parentId);return n?n.selected?!0:hs(n,t):!1}function Wo(e,t,n){var r;let o=e;do{if((r=o==null?void 0:o.matches)!=null&&r.call(o,t))return!0;if(o===n)return!1;o=o==null?void 0:o.parentElement}while(o);return!1}function pc(e,t,n,o){const r=new Map;for(const[s,i]of e)if((i.selected||i.id===o)&&(!i.parentId||!hs(i,e))&&(i.draggable||t&&typeof i.draggable>"u")){const a=e.get(s);a&&r.set(s,{id:s,position:a.position||{x:0,y:0},distance:{x:n.x-a.internals.positionAbsolute.x,y:n.y-a.internals.positionAbsolute.y},extent:a.extent,parentId:a.parentId,origin:a.origin,expandParent:a.expandParent,internals:{positionAbsolute:a.internals.positionAbsolute||{x:0,y:0}},measured:{width:a.measured.width??0,height:a.measured.height??0}})}return r}function Pn({nodeId:e,dragItems:t,nodeLookup:n,dragging:o=!0}){var i,a,u;const r=[];for(const[f,l]of t){const d=(i=n.get(f))==null?void 0:i.internals.userNode;d&&r.push({...d,position:l.position,dragging:o})}if(!e)return[r[0],r];const s=(a=n.get(e))==null?void 0:a.internals.userNode;return[s?{...s,position:((u=t.get(e))==null?void 0:u.position)||s.position,dragging:o}:r[0],r]}function mc({onNodeMouseDown:e,getStoreItems:t,onDragStart:n,onDrag:o,onDragStop:r}){let s={x:null,y:null},i=0,a=new Map,u=!1,f={x:0,y:0},l=null,d=!1,c=null,g=!1,y=!1;function p({noDragClassName:b,handleSelector:C,domNode:h,isSelectable:w,nodeId:S,nodeClickDistance:E=0}){c=fn(h);function N({x:D,y:k},R){const{nodeLookup:P,nodeExtent:_,snapGrid:L,snapToGrid:j,nodeOrigin:z,onNodeDrag:I,onSelectionDrag:T,onError:O,updateNodePositions:H}=t();s={x:D,y:k};let V=!1,W={x:0,y:0,x2:0,y2:0};if(a.size>1&&_){const Z=Ot(a);W=Un(Z)}for(const[Z,G]of a){if(!P.has(Z))continue;let J={x:D-G.distance.x,y:k-G.distance.y};j&&(J=pn(J,L));let B=[[_[0][0],_[0][1]],[_[1][0],_[1][1]]];if(a.size>1&&_&&!G.extent){const{positionAbsolute:Q}=G.internals,Y=Q.x-W.x+_[0][0],K=Q.x+G.measured.width-W.x2+_[1][0],U=Q.y-W.y+_[0][1],te=Q.y+G.measured.height-W.y2+_[1][1];B=[[Y,U],[K,te]]}const{position:q,positionAbsolute:F}=Jr({nodeId:Z,nextPosition:J,nodeLookup:P,nodeExtent:B,nodeOrigin:z,onError:O});V=V||G.position.x!==q.x||G.position.y!==q.y,G.position=q,G.internals.positionAbsolute=F}if(y=y||V,!!V&&(H(a,!0),R&&(o||I||!S&&T))){const[Z,G]=Pn({nodeId:S,dragItems:a,nodeLookup:P});o==null||o(R,a,Z,G),I==null||I(R,Z,G),S||T==null||T(R,G)}}async function M(){if(!l)return;const{transform:D,panBy:k,autoPanSpeed:R,autoPanOnNodeDrag:P}=t();if(!P){u=!1,cancelAnimationFrame(i);return}const[_,L]=es(f,l,R);(_!==0||L!==0)&&(s.x=(s.x??0)-_/D[2],s.y=(s.y??0)-L/D[2],await k({x:_,y:L})&&N(s,null)),i=requestAnimationFrame(M)}function A(D){var V;const{nodeLookup:k,multiSelectionActive:R,nodesDraggable:P,transform:_,snapGrid:L,snapToGrid:j,selectNodesOnDrag:z,onNodeDragStart:I,onSelectionDragStart:T,unselectNodesAndEdges:O}=t();d=!0,(!z||!w)&&!R&&S&&((V=k.get(S))!=null&&V.selected||O()),w&&z&&S&&(e==null||e(S));const H=Et(D.sourceEvent,{transform:_,snapGrid:L,snapToGrid:j,containerBounds:l});if(s=H,a=pc(k,P,H,S),a.size>0&&(n||I||!S&&T)){const[W,Z]=Pn({nodeId:S,dragItems:a,nodeLookup:k});n==null||n(D.sourceEvent,a,W,Z),I==null||I(D.sourceEvent,W,Z),S||T==null||T(D.sourceEvent,Z)}}const $=Wr().clickDistance(E).on("start",D=>{const{domNode:k,nodeDragThreshold:R,transform:P,snapGrid:_,snapToGrid:L}=t();l=(k==null?void 0:k.getBoundingClientRect())||null,g=!1,y=!1,R===0&&A(D),s=Et(D.sourceEvent,{transform:P,snapGrid:_,snapToGrid:L,containerBounds:l}),f=je(D.sourceEvent,l)}).on("drag",D=>{const{autoPanOnNodeDrag:k,transform:R,snapGrid:P,snapToGrid:_,nodeDragThreshold:L,nodeLookup:j}=t(),z=Et(D.sourceEvent,{transform:R,snapGrid:P,snapToGrid:_,containerBounds:l});if((D.sourceEvent.type==="touchmove"&&D.sourceEvent.touches.length>1||S&&!j.has(S))&&(g=!0),!g){if(!u&&k&&d&&(u=!0,M()),!d){const I=z.xSnapped-(s.x??0),T=z.ySnapped-(s.y??0);Math.sqrt(I*I+T*T)>L&&A(D)}(s.x!==z.xSnapped||s.y!==z.ySnapped)&&a&&d&&(f=je(D.sourceEvent,l),N(z,D.sourceEvent))}}).on("end",D=>{if(!(!d||g)&&(u=!1,d=!1,cancelAnimationFrame(i),a.size>0)){const{nodeLookup:k,updateNodePositions:R,onNodeDragStop:P,onSelectionDragStop:_}=t();if(y&&(R(a,!1),y=!1),r||P||!S&&_){const[L,j]=Pn({nodeId:S,dragItems:a,nodeLookup:k,dragging:!1});r==null||r(D.sourceEvent,a,L,j),P==null||P(D.sourceEvent,L,j),S||_==null||_(D.sourceEvent,j)}}}).filter(D=>{const k=D.target;return!D.button&&(!b||!Wo(k,`.${b}`,h))&&(!C||Wo(k,C,h))});c.call($)}function x(){c==null||c.on(".drag",null)}return{update:p,destroy:x}}function yc(e,t,n){const o=[],r={x:e.x-n,y:e.y-n,width:n*2,height:n*2};for(const s of t.values())Rt(r,ht(s))>0&&o.push(s);return o}const xc=250;function vc(e,t,n,o){var a,u;let r=[],s=1/0;const i=yc(e,n,t+xc);for(const f of i){const l=[...((a=f.internals.handleBounds)==null?void 0:a.source)??[],...((u=f.internals.handleBounds)==null?void 0:u.target)??[]];for(const d of l){if(o.nodeId===d.nodeId&&o.type===d.type&&o.id===d.id)continue;const{x:c,y:g}=jt(f,d,d.position,!0),y=Math.sqrt(Math.pow(c-e.x,2)+Math.pow(g-e.y,2));y>t||(y<s?(r=[{...d,x:c,y:g}],s=y):y===s&&r.push({...d,x:c,y:g}))}}if(!r.length)return null;if(r.length>1){const f=o.type==="source"?"target":"source";return r.find(l=>l.type===f)??r[0]}return r[0]}function ps(e,t,n,o,r,s=!1){var f,l,d;const i=o.get(e);if(!i)return null;const a=r==="strict"?(f=i.internals.handleBounds)==null?void 0:f[t]:[...((l=i.internals.handleBounds)==null?void 0:l.source)??[],...((d=i.internals.handleBounds)==null?void 0:d.target)??[]],u=(n?a==null?void 0:a.find(c=>c.id===n):a==null?void 0:a[0])??null;return u&&s?{...u,...jt(i,u,u.position,!0)}:u}function ms(e,t){return e||(t!=null&&t.classList.contains("target")?"target":t!=null&&t.classList.contains("source")?"source":null)}function bc(e,t){let n=null;return t?n=!0:e&&!t&&(n=!1),n}const ys=()=>!0;function wc(e,{connectionMode:t,connectionRadius:n,handleId:o,nodeId:r,edgeUpdaterType:s,isTarget:i,domNode:a,nodeLookup:u,lib:f,autoPanOnConnect:l,flowId:d,panBy:c,cancelConnection:g,onConnectStart:y,onConnect:p,onConnectEnd:x,isValidConnection:b=ys,onReconnectEnd:C,updateConnection:h,getTransform:w,getFromHandle:S,autoPanSpeed:E,dragThreshold:N=1}){const M=rs(e.target);let A=0,$;const{x:D,y:k}=je(e),R=M==null?void 0:M.elementFromPoint(D,k),P=ms(s,R),_=a==null?void 0:a.getBoundingClientRect();let L=!1;if(!_||!P)return;const j=ps(r,P,o,u,t);if(!j)return;let z=je(e,_),I=!1,T=null,O=!1,H=null;function V(){if(!l||!_)return;const[Q,Y]=es(z,_,E);c({x:Q,y:Y}),A=requestAnimationFrame(V)}const W={...j,nodeId:r,type:P,position:j.position},Z=u.get(r);let J={inProgress:!0,isValid:null,from:jt(Z,W,X.Left,!0),fromHandle:W,fromPosition:W.position,fromNode:Z,to:z,toHandle:null,toPosition:_o[W.position],toNode:null};function B(){L=!0,h(J),y==null||y(e,{nodeId:r,handleId:o,handleType:P})}N===0&&B();function q(Q){if(!L){const{x:te,y:oe}=je(Q),ve=te-D,$e=oe-k;if(!(ve*ve+$e*$e>N*N))return;B()}if(!S()||!W){F(Q);return}const Y=w();z=je(Q,_),$=vc(zt(z,Y,!1,[1,1]),n,u,W),I||(V(),I=!0);const K=xs(Q,{handle:$,connectionMode:t,fromNodeId:r,fromHandleId:o,fromType:i?"target":"source",isValidConnection:b,doc:M,lib:f,flowId:d,nodeLookup:u});H=K.handleDomNode,T=K.connection,O=bc(!!$,K.isValid);const U={...J,isValid:O,to:K.toHandle&&O?on({x:K.toHandle.x,y:K.toHandle.y},Y):z,toHandle:K.toHandle,toPosition:O&&K.toHandle?K.toHandle.position:_o[W.position],toNode:K.toHandle?u.get(K.toHandle.nodeId):null};O&&$&&J.toHandle&&U.toHandle&&J.toHandle.type===U.toHandle.type&&J.toHandle.nodeId===U.toHandle.nodeId&&J.toHandle.id===U.toHandle.id&&J.to.x===U.to.x&&J.to.y===U.to.y||(h(U),J=U)}function F(Q){if(L){($||H)&&T&&O&&(p==null||p(T));const{inProgress:Y,...K}=J,U={...K,toPosition:J.toHandle?J.toPosition:null};x==null||x(Q,U),s&&(C==null||C(Q,U))}g(),cancelAnimationFrame(A),I=!1,O=!1,T=null,H=null,M.removeEventListener("mousemove",q),M.removeEventListener("mouseup",F),M.removeEventListener("touchmove",q),M.removeEventListener("touchend",F)}M.addEventListener("mousemove",q),M.addEventListener("mouseup",F),M.addEventListener("touchmove",q),M.addEventListener("touchend",F)}function xs(e,{handle:t,connectionMode:n,fromNodeId:o,fromHandleId:r,fromType:s,doc:i,lib:a,flowId:u,isValidConnection:f=ys,nodeLookup:l}){const d=s==="target",c=t?i.querySelector(`.${a}-flow__handle[data-id="${u}-${t==null?void 0:t.nodeId}-${t==null?void 0:t.id}-${t==null?void 0:t.type}"]`):null,{x:g,y}=je(e),p=i.elementFromPoint(g,y),x=p!=null&&p.classList.contains(`${a}-flow__handle`)?p:c,b={handleDomNode:x,isValid:!1,connection:null,toHandle:null};if(x){const C=ms(void 0,x),h=x.getAttribute("data-nodeid"),w=x.getAttribute("data-handleid"),S=x.classList.contains("connectable"),E=x.classList.contains("connectableend");if(!h||!C)return b;const N={source:d?h:o,sourceHandle:d?w:r,target:d?o:h,targetHandle:d?r:w};b.connection=N;const A=S&&E&&(n===ft.Strict?d&&C==="source"||!d&&C==="target":h!==o||w!==r);b.isValid=A&&f(N),b.toHandle=ps(h,C,w,l,n,!0)}return b}const Zn={onPointerDown:wc,isValid:xs};function Sc({domNode:e,panZoom:t,getTransform:n,getViewScale:o}){const r=fn(e);function s({translateExtent:a,width:u,height:f,zoomStep:l=10,pannable:d=!0,zoomable:c=!0,inversePan:g=!1}){const y=h=>{const w=n();if(h.sourceEvent.type!=="wheel"||!t)return;const S=-h.sourceEvent.deltaY*(h.sourceEvent.deltaMode===1?.05:h.sourceEvent.deltaMode?1:.002)*l,E=w[2]*Math.pow(2,S);t.scaleTo(E)};let p=[0,0];const x=h=>{(h.sourceEvent.type==="mousedown"||h.sourceEvent.type==="touchstart")&&(p=[h.sourceEvent.clientX??h.sourceEvent.touches[0].clientX,h.sourceEvent.clientY??h.sourceEvent.touches[0].clientY])},b=h=>{const w=n();if(h.sourceEvent.type!=="mousemove"&&h.sourceEvent.type!=="touchmove"||!t)return;const S=[h.sourceEvent.clientX??h.sourceEvent.touches[0].clientX,h.sourceEvent.clientY??h.sourceEvent.touches[0].clientY],E=[S[0]-p[0],S[1]-p[1]];p=S;const N=o()*Math.max(w[2],Math.log(w[2]))*(g?-1:1),M={x:w[0]-E[0]*N,y:w[1]-E[1]*N},A=[[0,0],[u,f]];t.setViewportConstrained({x:M.x,y:M.y,zoom:w[2]},A,a)},C=Xr().on("start",x).on("zoom",d?b:null).on("zoom.wheel",c?y:null);r.call(C,{})}function i(){r.on("zoom",null)}return{update:s,destroy:i,pointer:Yr}}const Cc=(e,t)=>e.x!==t.x||e.y!==t.y||e.zoom!==t.k,mn=e=>({x:e.x,y:e.y,zoom:e.k}),_n=({x:e,y:t,zoom:n})=>Na.translate(e,t).scale(n),ct=(e,t)=>e.target.closest(`.${t}`),vs=(e,t)=>t===2&&Array.isArray(e)&&e.includes(2),Ec=e=>((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2,$n=(e,t=0,n=Ec,o=()=>{})=>{const r=typeof t=="number"&&t>0;return r||o(),r?e.transition().duration(t).ease(n).on("end",o):e},bs=e=>{const t=e.ctrlKey&&rn()?10:1;return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*t};function Mc({zoomPanValues:e,noWheelClassName:t,d3Selection:n,d3Zoom:o,panOnScrollMode:r,panOnScrollSpeed:s,zoomOnPinch:i,onPanZoomStart:a,onPanZoom:u,onPanZoomEnd:f}){return l=>{if(ct(l,t))return!1;l.preventDefault(),l.stopImmediatePropagation();const d=n.property("__zoom").k||1;if(l.ctrlKey&&i){const x=Yr(l),b=bs(l),C=d*Math.pow(2,b);o.scaleTo(n,C,x,l);return}const c=l.deltaMode===1?20:1;let g=r===nt.Vertical?0:l.deltaX*c,y=r===nt.Horizontal?0:l.deltaY*c;!rn()&&l.shiftKey&&r!==nt.Vertical&&(g=l.deltaY*c,y=0),o.translateBy(n,-(g/d)*s,-(y/d)*s,{internal:!0});const p=mn(n.property("__zoom"));clearTimeout(e.panScrollTimeout),e.isPanScrolling||(e.isPanScrolling=!0,a==null||a(l,p)),e.isPanScrolling&&(u==null||u(l,p),e.panScrollTimeout=setTimeout(()=>{f==null||f(l,p),e.isPanScrolling=!1},150))}}function Nc({noWheelClassName:e,preventScrolling:t,d3ZoomHandler:n}){return function(o,r){const s=o.type==="wheel",i=!t&&s&&!o.ctrlKey,a=ct(o,e);if(o.ctrlKey&&s&&a&&o.preventDefault(),i||a)return null;o.preventDefault(),n.call(this,o,r)}}function Dc({zoomPanValues:e,onDraggingChange:t,onPanZoomStart:n}){return o=>{var s,i,a;if((s=o.sourceEvent)!=null&&s.internal)return;const r=mn(o.transform);e.mouseButton=((i=o.sourceEvent)==null?void 0:i.button)||0,e.isZoomingOrPanning=!0,e.prevViewport=r,((a=o.sourceEvent)==null?void 0:a.type)==="mousedown"&&t(!0),n&&(n==null||n(o.sourceEvent,r))}}function Ic({zoomPanValues:e,panOnDrag:t,onPaneContextMenu:n,onTransformChange:o,onPanZoom:r}){return s=>{var i,a;e.usedRightMouseButton=!!(n&&vs(t,e.mouseButton??0)),(i=s.sourceEvent)!=null&&i.sync||o([s.transform.x,s.transform.y,s.transform.k]),r&&!((a=s.sourceEvent)!=null&&a.internal)&&(r==null||r(s.sourceEvent,mn(s.transform)))}}function kc({zoomPanValues:e,panOnDrag:t,panOnScroll:n,onDraggingChange:o,onPanZoomEnd:r,onPaneContextMenu:s}){return i=>{var a;if(!((a=i.sourceEvent)!=null&&a.internal)&&(e.isZoomingOrPanning=!1,s&&vs(t,e.mouseButton??0)&&!e.usedRightMouseButton&&i.sourceEvent&&s(i.sourceEvent),e.usedRightMouseButton=!1,o(!1),r&&Cc(e.prevViewport,i.transform))){const u=mn(i.transform);e.prevViewport=u,clearTimeout(e.timerId),e.timerId=setTimeout(()=>{r==null||r(i.sourceEvent,u)},n?150:0)}}}function Ac({zoomActivationKeyPressed:e,zoomOnScroll:t,zoomOnPinch:n,panOnDrag:o,panOnScroll:r,zoomOnDoubleClick:s,userSelectionActive:i,noWheelClassName:a,noPanClassName:u,lib:f}){return l=>{var y;const d=e||t,c=n&&l.ctrlKey;if(l.button===1&&l.type==="mousedown"&&(ct(l,`${f}-flow__node`)||ct(l,`${f}-flow__edge`)))return!0;if(!o&&!d&&!r&&!s&&!n||i||ct(l,a)&&l.type==="wheel"||ct(l,u)&&(l.type!=="wheel"||r&&l.type==="wheel"&&!e)||!n&&l.ctrlKey&&l.type==="wheel")return!1;if(!n&&l.type==="touchstart"&&((y=l.touches)==null?void 0:y.length)>1)return l.preventDefault(),!1;if(!d&&!r&&!c&&l.type==="wheel"||!o&&(l.type==="mousedown"||l.type==="touchstart")||Array.isArray(o)&&!o.includes(l.button)&&l.type==="mousedown")return!1;const g=Array.isArray(o)&&o.includes(l.button)||!l.button||l.button<=1;return(!l.ctrlKey||l.type==="wheel")&&g}}function Rc({domNode:e,minZoom:t,maxZoom:n,paneClickDistance:o,translateExtent:r,viewport:s,onPanZoom:i,onPanZoomStart:a,onPanZoomEnd:u,onDraggingChange:f}){const l={isZoomingOrPanning:!1,usedRightMouseButton:!1,prevViewport:{x:0,y:0,zoom:0},mouseButton:0,timerId:void 0,panScrollTimeout:void 0,isPanScrolling:!1},d=e.getBoundingClientRect(),c=Xr().clickDistance(!Ne(o)||o<0?0:o).scaleExtent([t,n]).translateExtent(r),g=fn(e).call(c);h({x:s.x,y:s.y,zoom:gt(s.zoom,t,n)},[[0,0],[d.width,d.height]],r);const y=g.on("wheel.zoom"),p=g.on("dblclick.zoom");c.wheelDelta(bs);function x(k,R){return g?new Promise(P=>{c==null||c.interpolate((R==null?void 0:R.interpolate)==="linear"?Ct:Rn).transform($n(g,R==null?void 0:R.duration,R==null?void 0:R.ease,()=>P(!0)),k)}):Promise.resolve(!1)}function b({noWheelClassName:k,noPanClassName:R,onPaneContextMenu:P,userSelectionActive:_,panOnScroll:L,panOnDrag:j,panOnScrollMode:z,panOnScrollSpeed:I,preventScrolling:T,zoomOnPinch:O,zoomOnScroll:H,zoomOnDoubleClick:V,zoomActivationKeyPressed:W,lib:Z,onTransformChange:G}){_&&!l.isZoomingOrPanning&&C();const B=L&&!W&&!_?Mc({zoomPanValues:l,noWheelClassName:k,d3Selection:g,d3Zoom:c,panOnScrollMode:z,panOnScrollSpeed:I,zoomOnPinch:O,onPanZoomStart:a,onPanZoom:i,onPanZoomEnd:u}):Nc({noWheelClassName:k,preventScrolling:T,d3ZoomHandler:y});if(g.on("wheel.zoom",B,{passive:!1}),!_){const F=Dc({zoomPanValues:l,onDraggingChange:f,onPanZoomStart:a});c.on("start",F);const Q=Ic({zoomPanValues:l,panOnDrag:j,onPaneContextMenu:!!P,onPanZoom:i,onTransformChange:G});c.on("zoom",Q);const Y=kc({zoomPanValues:l,panOnDrag:j,panOnScroll:L,onPaneContextMenu:P,onPanZoomEnd:u,onDraggingChange:f});c.on("end",Y)}const q=Ac({zoomActivationKeyPressed:W,panOnDrag:j,zoomOnScroll:H,panOnScroll:L,zoomOnDoubleClick:V,zoomOnPinch:O,userSelectionActive:_,noPanClassName:R,noWheelClassName:k,lib:Z});c.filter(q),V?g.on("dblclick.zoom",p):g.on("dblclick.zoom",null)}function C(){c.on("zoom",null)}async function h(k,R,P){const _=_n(k),L=c==null?void 0:c.constrain()(_,R,P);return L&&await x(L),new Promise(j=>j(L))}async function w(k,R){const P=_n(k);return await x(P,R),new Promise(_=>_(P))}function S(k){if(g){const R=_n(k),P=g.property("__zoom");(P.k!==k.zoom||P.x!==k.x||P.y!==k.y)&&(c==null||c.transform(g,R,null,{sync:!0}))}}function E(){const k=g?Da(g.node()):{x:0,y:0,k:1};return{x:k.x,y:k.y,zoom:k.k}}function N(k,R){return g?new Promise(P=>{c==null||c.interpolate((R==null?void 0:R.interpolate)==="linear"?Ct:Rn).scaleTo($n(g,R==null?void 0:R.duration,R==null?void 0:R.ease,()=>P(!0)),k)}):Promise.resolve(!1)}function M(k,R){return g?new Promise(P=>{c==null||c.interpolate((R==null?void 0:R.interpolate)==="linear"?Ct:Rn).scaleBy($n(g,R==null?void 0:R.duration,R==null?void 0:R.ease,()=>P(!0)),k)}):Promise.resolve(!1)}function A(k){c==null||c.scaleExtent(k)}function $(k){c==null||c.translateExtent(k)}function D(k){const R=!Ne(k)||k<0?0:k;c==null||c.clickDistance(R)}return{update:b,destroy:C,setViewport:w,setViewportConstrained:h,getViewport:E,scaleTo:N,scaleBy:M,setScaleExtent:A,setTranslateExtent:$,syncViewport:S,setClickDistance:D}}var mt;(function(e){e.Line="line",e.Handle="handle"})(mt||(mt={}));function jc({width:e,prevWidth:t,height:n,prevHeight:o,affectsX:r,affectsY:s}){const i=e-t,a=n-o,u=[i>0?1:i<0?-1:0,a>0?1:a<0?-1:0];return i&&r&&(u[0]=u[0]*-1),a&&s&&(u[1]=u[1]*-1),u}function Pc(e){const t=e.includes("right")||e.includes("left"),n=e.includes("bottom")||e.includes("top"),o=e.includes("left"),r=e.includes("top");return{isHorizontal:t,isVertical:n,affectsX:o,affectsY:r}}function Xe(e,t){return Math.max(0,t-e)}function We(e,t){return Math.max(0,e-t)}function Gt(e,t,n){return Math.max(0,t-e,e-n)}function Uo(e,t){return e?!t:t}function _c(e,t,n,o,r,s,i,a){let{affectsX:u,affectsY:f}=t;const{isHorizontal:l,isVertical:d}=t,c=l&&d,{xSnapped:g,ySnapped:y}=n,{minWidth:p,maxWidth:x,minHeight:b,maxHeight:C}=o,{x:h,y:w,width:S,height:E,aspectRatio:N}=e;let M=Math.floor(l?g-e.pointerX:0),A=Math.floor(d?y-e.pointerY:0);const $=S+(u?-M:M),D=E+(f?-A:A),k=-s[0]*S,R=-s[1]*E;let P=Gt($,p,x),_=Gt(D,b,C);if(i){let z=0,I=0;u&&M<0?z=Xe(h+M+k,i[0][0]):!u&&M>0&&(z=We(h+$+k,i[1][0])),f&&A<0?I=Xe(w+A+R,i[0][1]):!f&&A>0&&(I=We(w+D+R,i[1][1])),P=Math.max(P,z),_=Math.max(_,I)}if(a){let z=0,I=0;u&&M>0?z=We(h+M,a[0][0]):!u&&M<0&&(z=Xe(h+$,a[1][0])),f&&A>0?I=We(w+A,a[0][1]):!f&&A<0&&(I=Xe(w+D,a[1][1])),P=Math.max(P,z),_=Math.max(_,I)}if(r){if(l){const z=Gt($/N,b,C)*N;if(P=Math.max(P,z),i){let I=0;!u&&!f||u&&!f&&c?I=We(w+R+$/N,i[1][1])*N:I=Xe(w+R+(u?M:-M)/N,i[0][1])*N,P=Math.max(P,I)}if(a){let I=0;!u&&!f||u&&!f&&c?I=Xe(w+$/N,a[1][1])*N:I=We(w+(u?M:-M)/N,a[0][1])*N,P=Math.max(P,I)}}if(d){const z=Gt(D*N,p,x)/N;if(_=Math.max(_,z),i){let I=0;!u&&!f||f&&!u&&c?I=We(h+D*N+k,i[1][0])/N:I=Xe(h+(f?A:-A)*N+k,i[0][0])/N,_=Math.max(_,I)}if(a){let I=0;!u&&!f||f&&!u&&c?I=Xe(h+D*N,a[1][0])/N:I=We(h+(f?A:-A)*N,a[0][0])/N,_=Math.max(_,I)}}}A=A+(A<0?_:-_),M=M+(M<0?P:-P),r&&(c?$>D*N?A=(Uo(u,f)?-M:M)/N:M=(Uo(u,f)?-A:A)*N:l?(A=M/N,f=u):(M=A*N,u=f));const L=u?h+M:h,j=f?w+A:w;return{width:S+(u?-M:M),height:E+(f?-A:A),x:s[0]*M*(u?-1:1)+L,y:s[1]*A*(f?-1:1)+j}}const ws={width:0,height:0,x:0,y:0},$c={...ws,pointerX:0,pointerY:0,aspectRatio:1};function Lc(e){return[[0,0],[e.measured.width,e.measured.height]]}function Tc(e,t,n){const o=t.position.x+e.position.x,r=t.position.y+e.position.y,s=e.measured.width??0,i=e.measured.height??0,a=n[0]*s,u=n[1]*i;return[[o-a,r-u],[o+s-a,r+i-u]]}function Oc({domNode:e,nodeId:t,getStoreItems:n,onChange:o,onEnd:r}){const s=fn(e);function i({controlPosition:u,boundaries:f,keepAspectRatio:l,resizeDirection:d,onResizeStart:c,onResize:g,onResizeEnd:y,shouldResize:p}){let x={...ws},b={...$c};const C=Pc(u);let h,w=null,S=[],E,N,M;const A=Wr().on("start",$=>{const{nodeLookup:D,transform:k,snapGrid:R,snapToGrid:P,nodeOrigin:_,paneDomNode:L}=n();if(h=D.get(t),!h)return;w=(L==null?void 0:L.getBoundingClientRect())??null;const{xSnapped:j,ySnapped:z}=Et($.sourceEvent,{transform:k,snapGrid:R,snapToGrid:P,containerBounds:w});x={width:h.measured.width??0,height:h.measured.height??0,x:h.position.x??0,y:h.position.y??0},b={...x,pointerX:j,pointerY:z,aspectRatio:x.width/x.height},E=void 0,h.parentId&&(h.extent==="parent"||h.expandParent)&&(E=D.get(h.parentId),N=E&&h.extent==="parent"?Lc(E):void 0),S=[],M=void 0;for(const[I,T]of D)if(T.parentId===t&&(S.push({id:I,position:{...T.position},extent:T.extent}),T.extent==="parent"||T.expandParent)){const O=Tc(T,h,T.origin??_);M?M=[[Math.min(O[0][0],M[0][0]),Math.min(O[0][1],M[0][1])],[Math.max(O[1][0],M[1][0]),Math.max(O[1][1],M[1][1])]]:M=O}c==null||c($,{...x})}).on("drag",$=>{const{transform:D,snapGrid:k,snapToGrid:R,nodeOrigin:P}=n(),_=Et($.sourceEvent,{transform:D,snapGrid:k,snapToGrid:R,containerBounds:w}),L=[];if(!h)return;const{x:j,y:z,width:I,height:T}=x,O={},H=h.origin??P,{width:V,height:W,x:Z,y:G}=_c(b,C,_,f,l,H,N,M),J=V!==I,B=W!==T,q=Z!==j&&J,F=G!==z&&B;if(!q&&!F&&!J&&!B)return;if((q||F||H[0]===1||H[1]===1)&&(O.x=q?Z:x.x,O.y=F?G:x.y,x.x=O.x,x.y=O.y,S.length>0)){const U=Z-j,te=G-z;for(const oe of S)oe.position={x:oe.position.x-U+H[0]*(V-I),y:oe.position.y-te+H[1]*(W-T)},L.push(oe)}if((J||B)&&(O.width=J&&(!d||d==="horizontal")?V:x.width,O.height=B&&(!d||d==="vertical")?W:x.height,x.width=O.width,x.height=O.height),E&&h.expandParent){const U=H[0]*(O.width??0);O.x&&O.x<U&&(x.x=U,b.x=b.x-(O.x-U));const te=H[1]*(O.height??0);O.y&&O.y<te&&(x.y=te,b.y=b.y-(O.y-te))}const Q=jc({width:x.width,prevWidth:I,height:x.height,prevHeight:T,affectsX:C.affectsX,affectsY:C.affectsY}),Y={...x,direction:Q};(p==null?void 0:p($,Y))!==!1&&(g==null||g($,Y),o(O,L))}).on("end",$=>{y==null||y($,{...x}),r==null||r({...x})});s.call(A)}function a(){s.on(".drag",null)}return{update:i,destroy:a}}var Ln={exports:{}},Tn={},On={exports:{}},zn={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Go;function zc(){if(Go)return zn;Go=1;var e=Tr();function t(d,c){return d===c&&(d!==0||1/d===1/c)||d!==d&&c!==c}var n=typeof Object.is=="function"?Object.is:t,o=e.useState,r=e.useEffect,s=e.useLayoutEffect,i=e.useDebugValue;function a(d,c){var g=c(),y=o({inst:{value:g,getSnapshot:c}}),p=y[0].inst,x=y[1];return s(function(){p.value=g,p.getSnapshot=c,u(p)&&x({inst:p})},[d,g,c]),r(function(){return u(p)&&x({inst:p}),d(function(){u(p)&&x({inst:p})})},[d]),i(g),g}function u(d){var c=d.getSnapshot;d=d.value;try{var g=c();return!n(d,g)}catch{return!0}}function f(d,c){return c()}var l=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?f:a;return zn.useSyncExternalStore=e.useSyncExternalStore!==void 0?e.useSyncExternalStore:l,zn}var qo;function Hc(){return qo||(qo=1,On.exports=zc()),On.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ko;function Bc(){if(Ko)return Tn;Ko=1;var e=Tr(),t=Hc();function n(f,l){return f===l&&(f!==0||1/f===1/l)||f!==f&&l!==l}var o=typeof Object.is=="function"?Object.is:n,r=t.useSyncExternalStore,s=e.useRef,i=e.useEffect,a=e.useMemo,u=e.useDebugValue;return Tn.useSyncExternalStoreWithSelector=function(f,l,d,c,g){var y=s(null);if(y.current===null){var p={hasValue:!1,value:null};y.current=p}else p=y.current;y=a(function(){function b(E){if(!C){if(C=!0,h=E,E=c(E),g!==void 0&&p.hasValue){var N=p.value;if(g(N,E))return w=N}return w=E}if(N=w,o(h,E))return N;var M=c(E);return g!==void 0&&g(N,M)?(h=E,N):(h=E,w=M)}var C=!1,h,w,S=d===void 0?null:d;return[function(){return b(l())},S===null?void 0:function(){return b(S())}]},[l,d,c,g]);var x=r(f,y[0],y[1]);return i(function(){p.hasValue=!0,p.value=x},[x]),u(x),x},Tn}var Zo;function Fc(){return Zo||(Zo=1,Ln.exports=Bc()),Ln.exports}var Vc=Fc();const Yc=Qi(Vc),Xc={},Jo=e=>{let t;const n=new Set,o=(l,d)=>{const c=typeof l=="function"?l(t):l;if(!Object.is(c,t)){const g=t;t=d??(typeof c!="object"||c===null)?c:Object.assign({},t,c),n.forEach(y=>y(t,g))}},r=()=>t,u={setState:o,getState:r,getInitialState:()=>f,subscribe:l=>(n.add(l),()=>n.delete(l)),destroy:()=>{(Xc?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},f=t=e(o,r,u);return u},Wc=e=>e?Jo(e):Jo,{useDebugValue:Uc}=fe,{useSyncExternalStoreWithSelector:Gc}=Yc,qc=e=>e;function Ss(e,t=qc,n){const o=Gc(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return Uc(o),o}const Qo=(e,t)=>{const n=Wc(e),o=(r,s=t)=>Ss(n,r,s);return Object.assign(o,n),o},Kc=(e,t)=>e?Qo(e,t):Qo;function se(e,t){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[o,r]of e)if(!Object.is(r,t.get(o)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const o of e)if(!t.has(o))return!1;return!0}const n=Object.keys(e);if(n.length!==Object.keys(t).length)return!1;for(const o of n)if(!Object.prototype.hasOwnProperty.call(t,o)||!Object.is(e[o],t[o]))return!1;return!0}const yn=v.createContext(null),Zc=yn.Provider,Cs=Pe.error001();function ee(e,t){const n=v.useContext(yn);if(n===null)throw new Error(Cs);return Ss(n,e,t)}function re(){const e=v.useContext(yn);if(e===null)throw new Error(Cs);return v.useMemo(()=>({getState:e.getState,setState:e.setState,subscribe:e.subscribe}),[e])}const er={display:"none"},Jc={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},Es="react-flow__node-desc",Ms="react-flow__edge-desc",Qc="react-flow__aria-live",el=e=>e.ariaLiveMessage,tl=e=>e.ariaLabelConfig;function nl({rfId:e}){const t=ee(el);return m.jsx("div",{id:`${Qc}-${e}`,"aria-live":"assertive","aria-atomic":"true",style:Jc,children:t})}function ol({rfId:e,disableKeyboardA11y:t}){const n=ee(tl);return m.jsxs(m.Fragment,{children:[m.jsx("div",{id:`${Es}-${e}`,style:er,children:t?n["node.a11yDescription.default"]:n["node.a11yDescription.keyboardDisabled"]}),m.jsx("div",{id:`${Ms}-${e}`,style:er,children:n["edge.a11yDescription.default"]}),!t&&m.jsx(nl,{rfId:e})]})}const xn=v.forwardRef(({position:e="top-left",children:t,className:n,style:o,...r},s)=>{const i=`${e}`.split("-");return m.jsx("div",{className:ie(["react-flow__panel",n,...i]),style:o,ref:s,...r,children:t})});xn.displayName="Panel";function rl({proOptions:e,position:t="bottom-right"}){return e!=null&&e.hideAttribution?null:m.jsx(xn,{position:t,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://pro.reactflow.dev",children:m.jsx("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution",children:"React Flow"})})}const sl=e=>{const t=[],n=[];for(const[,o]of e.nodeLookup)o.selected&&t.push(o.internals.userNode);for(const[,o]of e.edgeLookup)o.selected&&n.push(o);return{selectedNodes:t,selectedEdges:n}},qt=e=>e.id;function il(e,t){return se(e.selectedNodes.map(qt),t.selectedNodes.map(qt))&&se(e.selectedEdges.map(qt),t.selectedEdges.map(qt))}function al({onSelectionChange:e}){const t=re(),{selectedNodes:n,selectedEdges:o}=ee(sl,il);return v.useEffect(()=>{const r={nodes:n,edges:o};e==null||e(r),t.getState().onSelectionChangeHandlers.forEach(s=>s(r))},[n,o,e]),null}const cl=e=>!!e.onSelectionChangeHandlers;function ll({onSelectionChange:e}){const t=ee(cl);return e||t?m.jsx(al,{onSelectionChange:e}):null}const Ns=[0,0],ul={x:0,y:0,zoom:1},dl=["nodes","edges","defaultNodes","defaultEdges","onConnect","onConnectStart","onConnectEnd","onClickConnectStart","onClickConnectEnd","nodesDraggable","autoPanOnNodeFocus","nodesConnectable","nodesFocusable","edgesFocusable","edgesReconnectable","elevateNodesOnSelect","elevateEdgesOnSelect","minZoom","maxZoom","nodeExtent","onNodesChange","onEdgesChange","elementsSelectable","connectionMode","snapGrid","snapToGrid","translateExtent","connectOnClick","defaultEdgeOptions","fitView","fitViewOptions","onNodesDelete","onEdgesDelete","onDelete","onNodeDrag","onNodeDragStart","onNodeDragStop","onSelectionDrag","onSelectionDragStart","onSelectionDragStop","onMoveStart","onMove","onMoveEnd","noPanClassName","nodeOrigin","autoPanOnConnect","autoPanOnNodeDrag","onError","connectionRadius","isValidConnection","selectNodesOnDrag","nodeDragThreshold","connectionDragThreshold","onBeforeDelete","debug","autoPanSpeed","paneClickDistance","ariaLabelConfig"],tr=[...dl,"rfId"],fl=e=>({setNodes:e.setNodes,setEdges:e.setEdges,setMinZoom:e.setMinZoom,setMaxZoom:e.setMaxZoom,setTranslateExtent:e.setTranslateExtent,setNodeExtent:e.setNodeExtent,reset:e.reset,setDefaultNodesAndEdges:e.setDefaultNodesAndEdges,setPaneClickDistance:e.setPaneClickDistance}),nr={translateExtent:kt,nodeOrigin:Ns,minZoom:.5,maxZoom:2,elementsSelectable:!0,noPanClassName:"nopan",rfId:"1",paneClickDistance:0};function gl(e){const{setNodes:t,setEdges:n,setMinZoom:o,setMaxZoom:r,setTranslateExtent:s,setNodeExtent:i,reset:a,setDefaultNodesAndEdges:u,setPaneClickDistance:f}=ee(fl,se),l=re();v.useEffect(()=>(u(e.defaultNodes,e.defaultEdges),()=>{d.current=nr,a()}),[]);const d=v.useRef(nr);return v.useEffect(()=>{for(const c of tr){const g=e[c],y=d.current[c];g!==y&&(typeof e[c]>"u"||(c==="nodes"?t(g):c==="edges"?n(g):c==="minZoom"?o(g):c==="maxZoom"?r(g):c==="translateExtent"?s(g):c==="nodeExtent"?i(g):c==="paneClickDistance"?f(g):c==="ariaLabelConfig"?l.setState({ariaLabelConfig:Ja(g)}):c==="fitView"?l.setState({fitViewQueued:g}):c==="fitViewOptions"?l.setState({fitViewOptions:g}):l.setState({[c]:g})))}d.current=e},tr.map(c=>e[c])),null}function or(){return typeof window>"u"||!window.matchMedia?null:window.matchMedia("(prefers-color-scheme: dark)")}function hl(e){var o;const[t,n]=v.useState(e==="system"?null:e);return v.useEffect(()=>{if(e!=="system"){n(e);return}const r=or(),s=()=>n(r!=null&&r.matches?"dark":"light");return s(),r==null||r.addEventListener("change",s),()=>{r==null||r.removeEventListener("change",s)}},[e]),t!==null?t:(o=or())!=null&&o.matches?"dark":"light"}const rr=typeof document<"u"?document:null;function Pt(e=null,t={target:rr,actInsideInputWithModifier:!0}){const[n,o]=v.useState(!1),r=v.useRef(!1),s=v.useRef(new Set([])),[i,a]=v.useMemo(()=>{if(e!==null){const f=(Array.isArray(e)?e:[e]).filter(d=>typeof d=="string").map(d=>d.replace("+",`
`).replace(`

`,`
+`).split(`
`)),l=f.reduce((d,c)=>d.concat(...c),[]);return[f,l]}return[[],[]]},[e]);return v.useEffect(()=>{const u=(t==null?void 0:t.target)??rr,f=(t==null?void 0:t.actInsideInputWithModifier)??!0;if(e!==null){const l=g=>{var x,b;if(r.current=g.ctrlKey||g.metaKey||g.shiftKey||g.altKey,(!r.current||r.current&&!f)&&ss(g))return!1;const p=ir(g.code,a);if(s.current.add(g[p]),sr(i,s.current,!1)){const C=((b=(x=g.composedPath)==null?void 0:x.call(g))==null?void 0:b[0])||g.target,h=(C==null?void 0:C.nodeName)==="BUTTON"||(C==null?void 0:C.nodeName)==="A";t.preventDefault!==!1&&(r.current||!h)&&g.preventDefault(),o(!0)}},d=g=>{const y=ir(g.code,a);sr(i,s.current,!0)?(o(!1),s.current.clear()):s.current.delete(g[y]),g.key==="Meta"&&s.current.clear(),r.current=!1},c=()=>{s.current.clear(),o(!1)};return u==null||u.addEventListener("keydown",l),u==null||u.addEventListener("keyup",d),window.addEventListener("blur",c),window.addEventListener("contextmenu",c),()=>{u==null||u.removeEventListener("keydown",l),u==null||u.removeEventListener("keyup",d),window.removeEventListener("blur",c),window.removeEventListener("contextmenu",c)}}},[e,o]),n}function sr(e,t,n){return e.filter(o=>n||o.length===t.size).some(o=>o.every(r=>t.has(r)))}function ir(e,t){return t.includes(e)?"code":"key"}const pl=()=>{const e=re();return v.useMemo(()=>({zoomIn:t=>{const{panZoom:n}=e.getState();return n?n.scaleBy(1.2,{duration:t==null?void 0:t.duration}):Promise.resolve(!1)},zoomOut:t=>{const{panZoom:n}=e.getState();return n?n.scaleBy(1/1.2,{duration:t==null?void 0:t.duration}):Promise.resolve(!1)},zoomTo:(t,n)=>{const{panZoom:o}=e.getState();return o?o.scaleTo(t,{duration:n==null?void 0:n.duration}):Promise.resolve(!1)},getZoom:()=>e.getState().transform[2],setViewport:async(t,n)=>{const{transform:[o,r,s],panZoom:i}=e.getState();return i?(await i.setViewport({x:t.x??o,y:t.y??r,zoom:t.zoom??s},n),Promise.resolve(!0)):Promise.resolve(!1)},getViewport:()=>{const[t,n,o]=e.getState().transform;return{x:t,y:n,zoom:o}},setCenter:async(t,n,o)=>e.getState().setCenter(t,n,o),fitBounds:async(t,n)=>{const{width:o,height:r,minZoom:s,maxZoom:i,panZoom:a}=e.getState(),u=io(t,o,r,s,i,(n==null?void 0:n.padding)??.1);return a?(await a.setViewport(u,{duration:n==null?void 0:n.duration,ease:n==null?void 0:n.ease,interpolate:n==null?void 0:n.interpolate}),Promise.resolve(!0)):Promise.resolve(!1)},screenToFlowPosition:(t,n={})=>{const{transform:o,snapGrid:r,snapToGrid:s,domNode:i}=e.getState();if(!i)return t;const{x:a,y:u}=i.getBoundingClientRect(),f={x:t.x-a,y:t.y-u},l=n.snapGrid??r,d=n.snapToGrid??s;return zt(f,o,d,l)},flowToScreenPosition:t=>{const{transform:n,domNode:o}=e.getState();if(!o)return t;const{x:r,y:s}=o.getBoundingClientRect(),i=on(t,n);return{x:i.x+r,y:i.y+s}}}),[])};function Ds(e,t){const n=[],o=new Map,r=[];for(const s of e)if(s.type==="add"){r.push(s);continue}else if(s.type==="remove"||s.type==="replace")o.set(s.id,[s]);else{const i=o.get(s.id);i?i.push(s):o.set(s.id,[s])}for(const s of t){const i=o.get(s.id);if(!i){n.push(s);continue}if(i[0].type==="remove")continue;if(i[0].type==="replace"){n.push({...i[0].item});continue}const a={...s};for(const u of i)ml(u,a);n.push(a)}return r.length&&r.forEach(s=>{s.index!==void 0?n.splice(s.index,0,{...s.item}):n.push({...s.item})}),n}function ml(e,t){switch(e.type){case"select":{t.selected=e.selected;break}case"position":{typeof e.position<"u"&&(t.position=e.position),typeof e.dragging<"u"&&(t.dragging=e.dragging);break}case"dimensions":{typeof e.dimensions<"u"&&(t.measured??(t.measured={}),t.measured.width=e.dimensions.width,t.measured.height=e.dimensions.height,e.setAttributes&&((e.setAttributes===!0||e.setAttributes==="width")&&(t.width=e.dimensions.width),(e.setAttributes===!0||e.setAttributes==="height")&&(t.height=e.dimensions.height))),typeof e.resizing=="boolean"&&(t.resizing=e.resizing);break}}}function Is(e,t){return Ds(e,t)}function ks(e,t){return Ds(e,t)}function tt(e,t){return{id:e,type:"select",selected:t}}function lt(e,t=new Set,n=!1){const o=[];for(const[r,s]of e){const i=t.has(r);!(s.selected===void 0&&!i)&&s.selected!==i&&(n&&(s.selected=i),o.push(tt(s.id,i)))}return o}function ar({items:e=[],lookup:t}){var r;const n=[],o=new Map(e.map(s=>[s.id,s]));for(const[s,i]of e.entries()){const a=t.get(i.id),u=((r=a==null?void 0:a.internals)==null?void 0:r.userNode)??a;u!==void 0&&u!==i&&n.push({id:i.id,item:i,type:"replace"}),u===void 0&&n.push({item:i,type:"add",index:s})}for(const[s]of t)o.get(s)===void 0&&n.push({id:s,type:"remove"});return n}function cr(e){return{id:e.id,type:"remove"}}const lr=e=>Fa(e),yl=e=>Zr(e);function As(e){return v.forwardRef(e)}const xl=typeof window<"u"?v.useLayoutEffect:v.useEffect;function ur(e){const[t,n]=v.useState(BigInt(0)),[o]=v.useState(()=>vl(()=>n(r=>r+BigInt(1))));return xl(()=>{const r=o.get();r.length&&(e(r),o.reset())},[t]),o}function vl(e){let t=[];return{get:()=>t,reset:()=>{t=[]},push:n=>{t.push(n),e()}}}const Rs=v.createContext(null);function bl({children:e}){const t=re(),n=v.useCallback(a=>{const{nodes:u=[],setNodes:f,hasDefaultNodes:l,onNodesChange:d,nodeLookup:c,fitViewQueued:g}=t.getState();let y=u;for(const x of a)y=typeof x=="function"?x(y):x;const p=ar({items:y,lookup:c});l&&f(y),p.length>0?d==null||d(p):g&&window.requestAnimationFrame(()=>{const{fitViewQueued:x,nodes:b,setNodes:C}=t.getState();x&&C(b)})},[]),o=ur(n),r=v.useCallback(a=>{const{edges:u=[],setEdges:f,hasDefaultEdges:l,onEdgesChange:d,edgeLookup:c}=t.getState();let g=u;for(const y of a)g=typeof y=="function"?y(g):y;l?f(g):d&&d(ar({items:g,lookup:c}))},[]),s=ur(r),i=v.useMemo(()=>({nodeQueue:o,edgeQueue:s}),[]);return m.jsx(Rs.Provider,{value:i,children:e})}function wl(){const e=v.useContext(Rs);if(!e)throw new Error("useBatchContext must be used within a BatchProvider");return e}const Sl=e=>!!e.panZoom;function go(){const e=pl(),t=re(),n=wl(),o=ee(Sl),r=v.useMemo(()=>{const s=d=>t.getState().nodeLookup.get(d),i=d=>{n.nodeQueue.push(d)},a=d=>{n.edgeQueue.push(d)},u=d=>{var b,C;const{nodeLookup:c,nodeOrigin:g}=t.getState(),y=lr(d)?d:c.get(d.id),p=y.parentId?os(y.position,y.measured,y.parentId,c,g):y.position,x={...y,position:p,width:((b=y.measured)==null?void 0:b.width)??y.width,height:((C=y.measured)==null?void 0:C.height)??y.height};return ht(x)},f=(d,c,g={replace:!1})=>{i(y=>y.map(p=>{if(p.id===d){const x=typeof c=="function"?c(p):c;return g.replace&&lr(x)?x:{...p,...x}}return p}))},l=(d,c,g={replace:!1})=>{a(y=>y.map(p=>{if(p.id===d){const x=typeof c=="function"?c(p):c;return g.replace&&yl(x)?x:{...p,...x}}return p}))};return{getNodes:()=>t.getState().nodes.map(d=>({...d})),getNode:d=>{var c;return(c=s(d))==null?void 0:c.internals.userNode},getInternalNode:s,getEdges:()=>{const{edges:d=[]}=t.getState();return d.map(c=>({...c}))},getEdge:d=>t.getState().edgeLookup.get(d),setNodes:i,setEdges:a,addNodes:d=>{const c=Array.isArray(d)?d:[d];n.nodeQueue.push(g=>[...g,...c])},addEdges:d=>{const c=Array.isArray(d)?d:[d];n.edgeQueue.push(g=>[...g,...c])},toObject:()=>{const{nodes:d=[],edges:c=[],transform:g}=t.getState(),[y,p,x]=g;return{nodes:d.map(b=>({...b})),edges:c.map(b=>({...b})),viewport:{x:y,y:p,zoom:x}}},deleteElements:async({nodes:d=[],edges:c=[]})=>{const{nodes:g,edges:y,onNodesDelete:p,onEdgesDelete:x,triggerNodeChanges:b,triggerEdgeChanges:C,onDelete:h,onBeforeDelete:w}=t.getState(),{nodes:S,edges:E}=await Ua({nodesToRemove:d,edgesToRemove:c,nodes:g,edges:y,onBeforeDelete:w}),N=E.length>0,M=S.length>0;if(N){const A=E.map(cr);x==null||x(E),C(A)}if(M){const A=S.map(cr);p==null||p(S),b(A)}return(M||N)&&(h==null||h({nodes:S,edges:E})),{deletedNodes:S,deletedEdges:E}},getIntersectingNodes:(d,c=!0,g)=>{const y=Lo(d),p=y?d:u(d),x=g!==void 0;return p?(g||t.getState().nodes).filter(b=>{const C=t.getState().nodeLookup.get(b.id);if(C&&!y&&(b.id===d.id||!C.internals.positionAbsolute))return!1;const h=ht(x?b:C),w=Rt(h,p);return c&&w>0||w>=h.width*h.height||w>=p.width*p.height}):[]},isNodeIntersecting:(d,c,g=!0)=>{const p=Lo(d)?d:u(d);if(!p)return!1;const x=Rt(p,c);return g&&x>0||x>=p.width*p.height},updateNode:f,updateNodeData:(d,c,g={replace:!1})=>{f(d,y=>{const p=typeof c=="function"?c(y):c;return g.replace?{...y,data:p}:{...y,data:{...y.data,...p}}},g)},updateEdge:l,updateEdgeData:(d,c,g={replace:!1})=>{l(d,y=>{const p=typeof c=="function"?c(y):c;return g.replace?{...y,data:p}:{...y,data:{...y.data,...p}}},g)},getNodesBounds:d=>{const{nodeLookup:c,nodeOrigin:g}=t.getState();return Va(d,{nodeLookup:c,nodeOrigin:g})},getHandleConnections:({type:d,id:c,nodeId:g})=>{var y;return Array.from(((y=t.getState().connectionLookup.get(`${g}-${d}${c?`-${c}`:""}`))==null?void 0:y.values())??[])},getNodeConnections:({type:d,handleId:c,nodeId:g})=>{var y;return Array.from(((y=t.getState().connectionLookup.get(`${g}${d?c?`-${d}-${c}`:`-${d}`:""}`))==null?void 0:y.values())??[])},fitView:async d=>{const c=t.getState().fitViewResolver??Za();return t.setState({fitViewQueued:!0,fitViewOptions:d,fitViewResolver:c}),n.nodeQueue.push(g=>[...g]),c.promise}}},[]);return v.useMemo(()=>({...r,...e,viewportInitialized:o}),[o])}const dr=e=>e.selected,Cl=typeof window<"u"?window:void 0;function El({deleteKeyCode:e,multiSelectionKeyCode:t}){const n=re(),{deleteElements:o}=go(),r=Pt(e,{actInsideInputWithModifier:!1}),s=Pt(t,{target:Cl});v.useEffect(()=>{if(r){const{edges:i,nodes:a}=n.getState();o({nodes:a.filter(dr),edges:i.filter(dr)}),n.setState({nodesSelectionActive:!1})}},[r]),v.useEffect(()=>{n.setState({multiSelectionActive:s})},[s])}function Ml(e){const t=re();v.useEffect(()=>{const n=()=>{var r,s;if(!e.current)return!1;const o=ao(e.current);(o.height===0||o.width===0)&&((s=(r=t.getState()).onError)==null||s.call(r,"004",Pe.error004())),t.setState({width:o.width||500,height:o.height||500})};if(e.current){n(),window.addEventListener("resize",n);const o=new ResizeObserver(()=>n());return o.observe(e.current),()=>{window.removeEventListener("resize",n),o&&e.current&&o.unobserve(e.current)}}},[])}const vn={position:"absolute",width:"100%",height:"100%",top:0,left:0},Nl=e=>({userSelectionActive:e.userSelectionActive,lib:e.lib});function Dl({onPaneContextMenu:e,zoomOnScroll:t=!0,zoomOnPinch:n=!0,panOnScroll:o=!1,panOnScrollSpeed:r=.5,panOnScrollMode:s=nt.Free,zoomOnDoubleClick:i=!0,panOnDrag:a=!0,defaultViewport:u,translateExtent:f,minZoom:l,maxZoom:d,zoomActivationKeyCode:c,preventScrolling:g=!0,children:y,noWheelClassName:p,noPanClassName:x,onViewportChange:b,isControlledViewport:C,paneClickDistance:h}){const w=re(),S=v.useRef(null),{userSelectionActive:E,lib:N}=ee(Nl,se),M=Pt(c),A=v.useRef();Ml(S);const $=v.useCallback(D=>{b==null||b({x:D[0],y:D[1],zoom:D[2]}),C||w.setState({transform:D})},[b,C]);return v.useEffect(()=>{if(S.current){A.current=Rc({domNode:S.current,minZoom:l,maxZoom:d,translateExtent:f,viewport:u,paneClickDistance:h,onDraggingChange:P=>w.setState({paneDragging:P}),onPanZoomStart:(P,_)=>{const{onViewportChangeStart:L,onMoveStart:j}=w.getState();j==null||j(P,_),L==null||L(_)},onPanZoom:(P,_)=>{const{onViewportChange:L,onMove:j}=w.getState();j==null||j(P,_),L==null||L(_)},onPanZoomEnd:(P,_)=>{const{onViewportChangeEnd:L,onMoveEnd:j}=w.getState();j==null||j(P,_),L==null||L(_)}});const{x:D,y:k,zoom:R}=A.current.getViewport();return w.setState({panZoom:A.current,transform:[D,k,R],domNode:S.current.closest(".react-flow")}),()=>{var P;(P=A.current)==null||P.destroy()}}},[]),v.useEffect(()=>{var D;(D=A.current)==null||D.update({onPaneContextMenu:e,zoomOnScroll:t,zoomOnPinch:n,panOnScroll:o,panOnScrollSpeed:r,panOnScrollMode:s,zoomOnDoubleClick:i,panOnDrag:a,zoomActivationKeyPressed:M,preventScrolling:g,noPanClassName:x,userSelectionActive:E,noWheelClassName:p,lib:N,onTransformChange:$})},[e,t,n,o,r,s,i,a,M,g,x,E,p,N,$]),m.jsx("div",{className:"react-flow__renderer",ref:S,style:vn,children:y})}const Il=e=>({userSelectionActive:e.userSelectionActive,userSelectionRect:e.userSelectionRect});function kl(){const{userSelectionActive:e,userSelectionRect:t}=ee(Il,se);return e&&t?m.jsx("div",{className:"react-flow__selection react-flow__container",style:{width:t.width,height:t.height,transform:`translate(${t.x}px, ${t.y}px)`}}):null}const Hn=(e,t)=>n=>{n.target===t.current&&(e==null||e(n))},Al=e=>({userSelectionActive:e.userSelectionActive,elementsSelectable:e.elementsSelectable,connectionInProgress:e.connection.inProgress,dragging:e.paneDragging});function Rl({isSelecting:e,selectionKeyPressed:t,selectionMode:n=At.Full,panOnDrag:o,selectionOnDrag:r,onSelectionStart:s,onSelectionEnd:i,onPaneClick:a,onPaneContextMenu:u,onPaneScroll:f,onPaneMouseEnter:l,onPaneMouseMove:d,onPaneMouseLeave:c,children:g}){const y=re(),{userSelectionActive:p,elementsSelectable:x,dragging:b,connectionInProgress:C}=ee(Al,se),h=x&&(e||p),w=v.useRef(null),S=v.useRef(),E=v.useRef(new Set),N=v.useRef(new Set),M=v.useRef(!1),A=v.useRef(!1),$=j=>{if(M.current||C){M.current=!1;return}a==null||a(j),y.getState().resetSelectedElements(),y.setState({nodesSelectionActive:!1})},D=j=>{if(Array.isArray(o)&&(o!=null&&o.includes(2))){j.preventDefault();return}u==null||u(j)},k=f?j=>f(j):void 0,R=j=>{var H,V;const{resetSelectedElements:z,domNode:I}=y.getState();if(S.current=I==null?void 0:I.getBoundingClientRect(),!x||!e||j.button!==0||j.target!==w.current||!S.current)return;(V=(H=j.target)==null?void 0:H.setPointerCapture)==null||V.call(H,j.pointerId),A.current=!0,M.current=!1;const{x:T,y:O}=je(j.nativeEvent,S.current);z(),y.setState({userSelectionRect:{width:0,height:0,startX:T,startY:O,x:T,y:O}}),s==null||s(j)},P=j=>{const{userSelectionRect:z,transform:I,nodeLookup:T,edgeLookup:O,connectionLookup:H,triggerNodeChanges:V,triggerEdgeChanges:W,defaultEdgeOptions:Z}=y.getState();if(!S.current||!z)return;M.current=!0;const{x:G,y:J}=je(j.nativeEvent,S.current),{startX:B,startY:q}=z,F={startX:B,startY:q,x:G<B?G:B,y:J<q?J:q,width:Math.abs(G-B),height:Math.abs(J-q)},Q=E.current,Y=N.current;E.current=new Set(so(T,F,I,n===At.Partial,!0).map(U=>U.id)),N.current=new Set;const K=(Z==null?void 0:Z.selectable)??!0;for(const U of E.current){const te=H.get(U);if(te)for(const{edgeId:oe}of te.values()){const ve=O.get(oe);ve&&(ve.selectable??K)&&N.current.add(oe)}}if(!To(Q,E.current)){const U=lt(T,E.current,!0);V(U)}if(!To(Y,N.current)){const U=lt(O,N.current);W(U)}y.setState({userSelectionRect:F,userSelectionActive:!0,nodesSelectionActive:!1})},_=j=>{var I,T;if(j.button!==0||!A.current)return;(T=(I=j.target)==null?void 0:I.releasePointerCapture)==null||T.call(I,j.pointerId);const{userSelectionRect:z}=y.getState();!p&&z&&j.target===w.current&&($==null||$(j)),y.setState({userSelectionActive:!1,userSelectionRect:null,nodesSelectionActive:E.current.size>0}),i==null||i(j),(t||r)&&(M.current=!1),A.current=!1},L=o===!0||Array.isArray(o)&&o.includes(0);return m.jsxs("div",{className:ie(["react-flow__pane",{draggable:L,dragging:b,selection:e}]),onClick:h?void 0:Hn($,w),onContextMenu:Hn(D,w),onWheel:Hn(k,w),onPointerEnter:h?void 0:l,onPointerDown:h?R:d,onPointerMove:h?P:d,onPointerUp:h?_:void 0,onPointerLeave:c,ref:w,style:vn,children:[g,m.jsx(kl,{})]})}function Jn({id:e,store:t,unselect:n=!1,nodeRef:o}){const{addSelectedNodes:r,unselectNodesAndEdges:s,multiSelectionActive:i,nodeLookup:a,onError:u}=t.getState(),f=a.get(e);if(!f){u==null||u("012",Pe.error012(e));return}t.setState({nodesSelectionActive:!1}),f.selected?(n||f.selected&&i)&&(s({nodes:[f],edges:[]}),requestAnimationFrame(()=>{var l;return(l=o==null?void 0:o.current)==null?void 0:l.blur()})):r([e])}function js({nodeRef:e,disabled:t=!1,noDragClassName:n,handleSelector:o,nodeId:r,isSelectable:s,nodeClickDistance:i}){const a=re(),[u,f]=v.useState(!1),l=v.useRef();return v.useEffect(()=>{l.current=mc({getStoreItems:()=>a.getState(),onNodeMouseDown:d=>{Jn({id:d,store:a,nodeRef:e})},onDragStart:()=>{f(!0)},onDragStop:()=>{f(!1)}})},[]),v.useEffect(()=>{var d,c;if(t)(d=l.current)==null||d.destroy();else if(e.current)return(c=l.current)==null||c.update({noDragClassName:n,handleSelector:o,domNode:e.current,isSelectable:s,nodeId:r,nodeClickDistance:i}),()=>{var g;(g=l.current)==null||g.destroy()}},[n,o,t,s,e,r]),u}const jl=e=>t=>t.selected&&(t.draggable||e&&typeof t.draggable>"u");function Ps(){const e=re();return v.useCallback(n=>{const{nodeExtent:o,snapToGrid:r,snapGrid:s,nodesDraggable:i,onError:a,updateNodePositions:u,nodeLookup:f,nodeOrigin:l}=e.getState(),d=new Map,c=jl(i),g=r?s[0]:5,y=r?s[1]:5,p=n.direction.x*g*n.factor,x=n.direction.y*y*n.factor;for(const[,b]of f){if(!c(b))continue;let C={x:b.internals.positionAbsolute.x+p,y:b.internals.positionAbsolute.y+x};r&&(C=pn(C,s));const{position:h,positionAbsolute:w}=Jr({nodeId:b.id,nextPosition:C,nodeLookup:f,nodeExtent:o,nodeOrigin:l,onError:a});b.position=h,b.internals.positionAbsolute=w,d.set(b.id,b)}u(d)},[])}const ho=v.createContext(null),Pl=ho.Provider;ho.Consumer;const _s=()=>v.useContext(ho),_l=e=>({connectOnClick:e.connectOnClick,noPanClassName:e.noPanClassName,rfId:e.rfId}),$l=(e,t,n)=>o=>{const{connectionClickStartHandle:r,connectionMode:s,connection:i}=o,{fromHandle:a,toHandle:u,isValid:f}=i,l=(u==null?void 0:u.nodeId)===e&&(u==null?void 0:u.id)===t&&(u==null?void 0:u.type)===n;return{connectingFrom:(a==null?void 0:a.nodeId)===e&&(a==null?void 0:a.id)===t&&(a==null?void 0:a.type)===n,connectingTo:l,clickConnecting:(r==null?void 0:r.nodeId)===e&&(r==null?void 0:r.id)===t&&(r==null?void 0:r.type)===n,isPossibleEndHandle:s===ft.Strict?(a==null?void 0:a.type)!==n:e!==(a==null?void 0:a.nodeId)||t!==(a==null?void 0:a.id),connectionInProcess:!!a,clickConnectionInProcess:!!r,valid:l&&f}};function Ll({type:e="source",position:t=X.Top,isValidConnection:n,isConnectable:o=!0,isConnectableStart:r=!0,isConnectableEnd:s=!0,id:i,onConnect:a,children:u,className:f,onMouseDown:l,onTouchStart:d,...c},g){var _,L;const y=i||null,p=e==="target",x=re(),b=_s(),{connectOnClick:C,noPanClassName:h,rfId:w}=ee(_l,se),{connectingFrom:S,connectingTo:E,clickConnecting:N,isPossibleEndHandle:M,connectionInProcess:A,clickConnectionInProcess:$,valid:D}=ee($l(b,y,e),se);b||(L=(_=x.getState()).onError)==null||L.call(_,"010",Pe.error010());const k=j=>{const{defaultEdgeOptions:z,onConnect:I,hasDefaultEdges:T}=x.getState(),O={...z,...j};if(T){const{edges:H,setEdges:V}=x.getState();V(us(O,H))}I==null||I(O),a==null||a(O)},R=j=>{if(!b)return;const z=is(j.nativeEvent);if(r&&(z&&j.button===0||!z)){const I=x.getState();Zn.onPointerDown(j.nativeEvent,{autoPanOnConnect:I.autoPanOnConnect,connectionMode:I.connectionMode,connectionRadius:I.connectionRadius,domNode:I.domNode,nodeLookup:I.nodeLookup,lib:I.lib,isTarget:p,handleId:y,nodeId:b,flowId:I.rfId,panBy:I.panBy,cancelConnection:I.cancelConnection,onConnectStart:I.onConnectStart,onConnectEnd:I.onConnectEnd,updateConnection:I.updateConnection,onConnect:k,isValidConnection:n||I.isValidConnection,getTransform:()=>x.getState().transform,getFromHandle:()=>x.getState().connection.fromHandle,autoPanSpeed:I.autoPanSpeed,dragThreshold:I.connectionDragThreshold})}z?l==null||l(j):d==null||d(j)},P=j=>{const{onClickConnectStart:z,onClickConnectEnd:I,connectionClickStartHandle:T,connectionMode:O,isValidConnection:H,lib:V,rfId:W,nodeLookup:Z,connection:G}=x.getState();if(!b||!T&&!r)return;if(!T){z==null||z(j.nativeEvent,{nodeId:b,handleId:y,handleType:e}),x.setState({connectionClickStartHandle:{nodeId:b,type:e,id:y}});return}const J=rs(j.target),B=n||H,{connection:q,isValid:F}=Zn.isValid(j.nativeEvent,{handle:{nodeId:b,id:y,type:e},connectionMode:O,fromNodeId:T.nodeId,fromHandleId:T.id||null,fromType:T.type,isValidConnection:B,flowId:W,doc:J,lib:V,nodeLookup:Z});F&&q&&k(q);const Q=structuredClone(G);delete Q.inProgress,Q.toPosition=Q.toHandle?Q.toHandle.position:null,I==null||I(j,Q),x.setState({connectionClickStartHandle:null})};return m.jsx("div",{"data-handleid":y,"data-nodeid":b,"data-handlepos":t,"data-id":`${w}-${b}-${y}-${e}`,className:ie(["react-flow__handle",`react-flow__handle-${t}`,"nodrag",h,f,{source:!p,target:p,connectable:o,connectablestart:r,connectableend:s,clickconnecting:N,connectingfrom:S,connectingto:E,valid:D,connectionindicator:o&&(!A||M)&&(A||$?s:r)}]),onMouseDown:R,onTouchStart:R,onClick:C?P:void 0,ref:g,...c,children:u})}const ze=v.memo(As(Ll));function Tl({data:e,isConnectable:t,sourcePosition:n=X.Bottom}){return m.jsxs(m.Fragment,{children:[e==null?void 0:e.label,m.jsx(ze,{type:"source",position:n,isConnectable:t})]})}function Ol({data:e,isConnectable:t,targetPosition:n=X.Top,sourcePosition:o=X.Bottom}){return m.jsxs(m.Fragment,{children:[m.jsx(ze,{type:"target",position:n,isConnectable:t}),e==null?void 0:e.label,m.jsx(ze,{type:"source",position:o,isConnectable:t})]})}function zl(){return null}function Hl({data:e,isConnectable:t,targetPosition:n=X.Top}){return m.jsxs(m.Fragment,{children:[m.jsx(ze,{type:"target",position:n,isConnectable:t}),e==null?void 0:e.label]})}const sn={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}},fr={input:Tl,default:Ol,output:Hl,group:zl};function Bl(e){var t,n,o,r;return e.internals.handleBounds===void 0?{width:e.width??e.initialWidth??((t=e.style)==null?void 0:t.width),height:e.height??e.initialHeight??((n=e.style)==null?void 0:n.height)}:{width:e.width??((o=e.style)==null?void 0:o.width),height:e.height??((r=e.style)==null?void 0:r.height)}}const Fl=e=>{const{width:t,height:n,x:o,y:r}=Ot(e.nodeLookup,{filter:s=>!!s.selected});return{width:Ne(t)?t:null,height:Ne(n)?n:null,userSelectionActive:e.userSelectionActive,transformString:`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]}) translate(${o}px,${r}px)`}};function Vl({onSelectionContextMenu:e,noPanClassName:t,disableKeyboardA11y:n}){const o=re(),{width:r,height:s,transformString:i,userSelectionActive:a}=ee(Fl,se),u=Ps(),f=v.useRef(null);if(v.useEffect(()=>{var c;n||(c=f.current)==null||c.focus({preventScroll:!0})},[n]),js({nodeRef:f}),a||!r||!s)return null;const l=e?c=>{const g=o.getState().nodes.filter(y=>y.selected);e(c,g)}:void 0,d=c=>{Object.prototype.hasOwnProperty.call(sn,c.key)&&(c.preventDefault(),u({direction:sn[c.key],factor:c.shiftKey?4:1}))};return m.jsx("div",{className:ie(["react-flow__nodesselection","react-flow__container",t]),style:{transform:i},children:m.jsx("div",{ref:f,className:"react-flow__nodesselection-rect",onContextMenu:l,tabIndex:n?void 0:-1,onKeyDown:n?void 0:d,style:{width:r,height:s}})})}const gr=typeof window<"u"?window:void 0,Yl=e=>({nodesSelectionActive:e.nodesSelectionActive,userSelectionActive:e.userSelectionActive});function $s({children:e,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:o,onPaneMouseLeave:r,onPaneContextMenu:s,onPaneScroll:i,paneClickDistance:a,deleteKeyCode:u,selectionKeyCode:f,selectionOnDrag:l,selectionMode:d,onSelectionStart:c,onSelectionEnd:g,multiSelectionKeyCode:y,panActivationKeyCode:p,zoomActivationKeyCode:x,elementsSelectable:b,zoomOnScroll:C,zoomOnPinch:h,panOnScroll:w,panOnScrollSpeed:S,panOnScrollMode:E,zoomOnDoubleClick:N,panOnDrag:M,defaultViewport:A,translateExtent:$,minZoom:D,maxZoom:k,preventScrolling:R,onSelectionContextMenu:P,noWheelClassName:_,noPanClassName:L,disableKeyboardA11y:j,onViewportChange:z,isControlledViewport:I}){const{nodesSelectionActive:T,userSelectionActive:O}=ee(Yl),H=Pt(f,{target:gr}),V=Pt(p,{target:gr}),W=V||M,Z=V||w,G=l&&W!==!0,J=H||O||G;return El({deleteKeyCode:u,multiSelectionKeyCode:y}),m.jsx(Dl,{onPaneContextMenu:s,elementsSelectable:b,zoomOnScroll:C,zoomOnPinch:h,panOnScroll:Z,panOnScrollSpeed:S,panOnScrollMode:E,zoomOnDoubleClick:N,panOnDrag:!H&&W,defaultViewport:A,translateExtent:$,minZoom:D,maxZoom:k,zoomActivationKeyCode:x,preventScrolling:R,noWheelClassName:_,noPanClassName:L,onViewportChange:z,isControlledViewport:I,paneClickDistance:a,children:m.jsxs(Rl,{onSelectionStart:c,onSelectionEnd:g,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:o,onPaneMouseLeave:r,onPaneContextMenu:s,onPaneScroll:i,panOnDrag:W,isSelecting:!!J,selectionMode:d,selectionKeyPressed:H,selectionOnDrag:G,children:[e,T&&m.jsx(Vl,{onSelectionContextMenu:P,noPanClassName:L,disableKeyboardA11y:j})]})})}$s.displayName="FlowRenderer";const Xl=v.memo($s),Wl=e=>t=>e?so(t.nodeLookup,{x:0,y:0,width:t.width,height:t.height},t.transform,!0).map(n=>n.id):Array.from(t.nodeLookup.keys());function Ul(e){return ee(v.useCallback(Wl(e),[e]),se)}const Gl=e=>e.updateNodeInternals;function ql(){const e=ee(Gl),[t]=v.useState(()=>typeof ResizeObserver>"u"?null:new ResizeObserver(n=>{const o=new Map;n.forEach(r=>{const s=r.target.getAttribute("data-id");o.set(s,{id:s,nodeElement:r.target,force:!0})}),e(o)}));return v.useEffect(()=>()=>{t==null||t.disconnect()},[t]),t}function Kl({node:e,nodeType:t,hasDimensions:n,resizeObserver:o}){const r=re(),s=v.useRef(null),i=v.useRef(null),a=v.useRef(e.sourcePosition),u=v.useRef(e.targetPosition),f=v.useRef(t),l=n&&!!e.internals.handleBounds;return v.useEffect(()=>{s.current&&!e.hidden&&(!l||i.current!==s.current)&&(i.current&&(o==null||o.unobserve(i.current)),o==null||o.observe(s.current),i.current=s.current)},[l,e.hidden]),v.useEffect(()=>()=>{i.current&&(o==null||o.unobserve(i.current),i.current=null)},[]),v.useEffect(()=>{if(s.current){const d=f.current!==t,c=a.current!==e.sourcePosition,g=u.current!==e.targetPosition;(d||c||g)&&(f.current=t,a.current=e.sourcePosition,u.current=e.targetPosition,r.getState().updateNodeInternals(new Map([[e.id,{id:e.id,nodeElement:s.current,force:!0}]])))}},[e.id,t,e.sourcePosition,e.targetPosition]),s}function Zl({id:e,onClick:t,onMouseEnter:n,onMouseMove:o,onMouseLeave:r,onContextMenu:s,onDoubleClick:i,nodesDraggable:a,elementsSelectable:u,nodesConnectable:f,nodesFocusable:l,resizeObserver:d,noDragClassName:c,noPanClassName:g,disableKeyboardA11y:y,rfId:p,nodeTypes:x,nodeClickDistance:b,onError:C}){const{node:h,internals:w,isParent:S}=ee(B=>{const q=B.nodeLookup.get(e),F=B.parentLookup.has(e);return{node:q,internals:q.internals,isParent:F}},se);let E=h.type||"default",N=(x==null?void 0:x[E])||fr[E];N===void 0&&(C==null||C("003",Pe.error003(E)),E="default",N=(x==null?void 0:x.default)||fr.default);const M=!!(h.draggable||a&&typeof h.draggable>"u"),A=!!(h.selectable||u&&typeof h.selectable>"u"),$=!!(h.connectable||f&&typeof h.connectable>"u"),D=!!(h.focusable||l&&typeof h.focusable>"u"),k=re(),R=ns(h),P=Kl({node:h,nodeType:E,hasDimensions:R,resizeObserver:d}),_=js({nodeRef:P,disabled:h.hidden||!M,noDragClassName:c,handleSelector:h.dragHandle,nodeId:e,isSelectable:A,nodeClickDistance:b}),L=Ps();if(h.hidden)return null;const j=He(h),z=Bl(h),I=A||M||t||n||o||r,T=n?B=>n(B,{...w.userNode}):void 0,O=o?B=>o(B,{...w.userNode}):void 0,H=r?B=>r(B,{...w.userNode}):void 0,V=s?B=>s(B,{...w.userNode}):void 0,W=i?B=>i(B,{...w.userNode}):void 0,Z=B=>{const{selectNodesOnDrag:q,nodeDragThreshold:F}=k.getState();A&&(!q||!M||F>0)&&Jn({id:e,store:k,nodeRef:P}),t&&t(B,{...w.userNode})},G=B=>{if(!(ss(B.nativeEvent)||y)){if(Ur.includes(B.key)&&A){const q=B.key==="Escape";Jn({id:e,store:k,unselect:q,nodeRef:P})}else if(M&&h.selected&&Object.prototype.hasOwnProperty.call(sn,B.key)){B.preventDefault();const{ariaLabelConfig:q}=k.getState();k.setState({ariaLiveMessage:q["node.a11yDescription.ariaLiveMessage"]({direction:B.key.replace("Arrow","").toLowerCase(),x:~~w.positionAbsolute.x,y:~~w.positionAbsolute.y})}),L({direction:sn[B.key],factor:B.shiftKey?4:1})}}},J=()=>{var U;if(y||!((U=P.current)!=null&&U.matches(":focus-visible")))return;const{transform:B,width:q,height:F,autoPanOnNodeFocus:Q,setCenter:Y}=k.getState();if(!Q)return;so(new Map([[e,h]]),{x:0,y:0,width:q,height:F},B,!0).length>0||Y(h.position.x+j.width/2,h.position.y+j.height/2,{zoom:B[2]})};return m.jsx("div",{className:ie(["react-flow__node",`react-flow__node-${E}`,{[g]:M},h.className,{selected:h.selected,selectable:A,parent:S,draggable:M,dragging:_}]),ref:P,style:{zIndex:w.z,transform:`translate(${w.positionAbsolute.x}px,${w.positionAbsolute.y}px)`,pointerEvents:I?"all":"none",visibility:R?"visible":"hidden",...h.style,...z},"data-id":e,"data-testid":`rf__node-${e}`,onMouseEnter:T,onMouseMove:O,onMouseLeave:H,onContextMenu:V,onClick:Z,onDoubleClick:W,onKeyDown:D?G:void 0,tabIndex:D?0:void 0,onFocus:D?J:void 0,role:h.ariaRole??(D?"group":void 0),"aria-roledescription":"node","aria-describedby":y?void 0:`${Es}-${p}`,"aria-label":h.ariaLabel,...h.domAttributes,children:m.jsx(Pl,{value:e,children:m.jsx(N,{id:e,data:h.data,type:E,positionAbsoluteX:w.positionAbsolute.x,positionAbsoluteY:w.positionAbsolute.y,selected:h.selected??!1,selectable:A,draggable:M,deletable:h.deletable??!0,isConnectable:$,sourcePosition:h.sourcePosition,targetPosition:h.targetPosition,dragging:_,dragHandle:h.dragHandle,zIndex:w.z,parentId:h.parentId,...j})})})}const Jl=e=>({nodesDraggable:e.nodesDraggable,nodesConnectable:e.nodesConnectable,nodesFocusable:e.nodesFocusable,elementsSelectable:e.elementsSelectable,onError:e.onError});function Ls(e){const{nodesDraggable:t,nodesConnectable:n,nodesFocusable:o,elementsSelectable:r,onError:s}=ee(Jl,se),i=Ul(e.onlyRenderVisibleElements),a=ql();return m.jsx("div",{className:"react-flow__nodes",style:vn,children:i.map(u=>m.jsx(Zl,{id:u,nodeTypes:e.nodeTypes,nodeExtent:e.nodeExtent,onClick:e.onNodeClick,onMouseEnter:e.onNodeMouseEnter,onMouseMove:e.onNodeMouseMove,onMouseLeave:e.onNodeMouseLeave,onContextMenu:e.onNodeContextMenu,onDoubleClick:e.onNodeDoubleClick,noDragClassName:e.noDragClassName,noPanClassName:e.noPanClassName,rfId:e.rfId,disableKeyboardA11y:e.disableKeyboardA11y,resizeObserver:a,nodesDraggable:t,nodesConnectable:n,nodesFocusable:o,elementsSelectable:r,nodeClickDistance:e.nodeClickDistance,onError:s},u))})}Ls.displayName="NodeRenderer";const Ql=v.memo(Ls);function eu(e){return ee(v.useCallback(n=>{if(!e)return n.edges.map(r=>r.id);const o=[];if(n.width&&n.height)for(const r of n.edges){const s=n.nodeLookup.get(r.source),i=n.nodeLookup.get(r.target);s&&i&&tc({sourceNode:s,targetNode:i,width:n.width,height:n.height,transform:n.transform})&&o.push(r.id)}return o},[e]),se)}const tu=({color:e="none",strokeWidth:t=1})=>m.jsx("polyline",{style:{stroke:e,strokeWidth:t},strokeLinecap:"round",strokeLinejoin:"round",fill:"none",points:"-5,-4 0,0 -5,4"}),nu=({color:e="none",strokeWidth:t=1})=>m.jsx("polyline",{style:{stroke:e,fill:e,strokeWidth:t},strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"}),hr={[tn.Arrow]:tu,[tn.ArrowClosed]:nu};function ou(e){const t=re();return v.useMemo(()=>{var r,s;return Object.prototype.hasOwnProperty.call(hr,e)?hr[e]:((s=(r=t.getState()).onError)==null||s.call(r,"009",Pe.error009(e)),null)},[e])}const ru=({id:e,type:t,color:n,width:o=12.5,height:r=12.5,markerUnits:s="strokeWidth",strokeWidth:i,orient:a="auto-start-reverse"})=>{const u=ou(t);return u?m.jsx("marker",{className:"react-flow__arrowhead",id:e,markerWidth:`${o}`,markerHeight:`${r}`,viewBox:"-10 -10 20 20",markerUnits:s,orient:a,refX:"0",refY:"0",children:m.jsx(u,{color:n,strokeWidth:i})}):null},Ts=({defaultColor:e,rfId:t})=>{const n=ee(s=>s.edges),o=ee(s=>s.defaultEdgeOptions),r=v.useMemo(()=>cc(n,{id:t,defaultColor:e,defaultMarkerStart:o==null?void 0:o.markerStart,defaultMarkerEnd:o==null?void 0:o.markerEnd}),[n,o,t,e]);return r.length?m.jsx("svg",{className:"react-flow__marker","aria-hidden":"true",children:m.jsx("defs",{children:r.map(s=>m.jsx(ru,{id:s.id,type:s.type,color:s.color,width:s.width,height:s.height,markerUnits:s.markerUnits,strokeWidth:s.strokeWidth,orient:s.orient},s.id))})}):null};Ts.displayName="MarkerDefinitions";var su=v.memo(Ts);function Os({x:e,y:t,label:n,labelStyle:o,labelShowBg:r=!0,labelBgStyle:s,labelBgPadding:i=[2,4],labelBgBorderRadius:a=2,children:u,className:f,...l}){const[d,c]=v.useState({x:1,y:0,width:0,height:0}),g=ie(["react-flow__edge-textwrapper",f]),y=v.useRef(null);return v.useEffect(()=>{if(y.current){const p=y.current.getBBox();c({x:p.x,y:p.y,width:p.width,height:p.height})}},[n]),n?m.jsxs("g",{transform:`translate(${e-d.width/2} ${t-d.height/2})`,className:g,visibility:d.width?"visible":"hidden",...l,children:[r&&m.jsx("rect",{width:d.width+2*i[0],x:-i[0],y:-i[1],height:d.height+2*i[1],className:"react-flow__edge-textbg",style:s,rx:a,ry:a}),m.jsx("text",{className:"react-flow__edge-text",y:d.height/2,dy:"0.3em",ref:y,style:o,children:n}),u]}):null}Os.displayName="EdgeText";const iu=v.memo(Os);function bn({path:e,labelX:t,labelY:n,label:o,labelStyle:r,labelShowBg:s,labelBgStyle:i,labelBgPadding:a,labelBgBorderRadius:u,interactionWidth:f=20,...l}){return m.jsxs(m.Fragment,{children:[m.jsx("path",{...l,d:e,fill:"none",className:ie(["react-flow__edge-path",l.className])}),f&&m.jsx("path",{d:e,fill:"none",strokeOpacity:0,strokeWidth:f,className:"react-flow__edge-interaction"}),o&&Ne(t)&&Ne(n)?m.jsx(iu,{x:t,y:n,label:o,labelStyle:r,labelShowBg:s,labelBgStyle:i,labelBgPadding:a,labelBgBorderRadius:u}):null]})}function pr({pos:e,x1:t,y1:n,x2:o,y2:r}){return e===X.Left||e===X.Right?[.5*(t+o),n]:[t,.5*(n+r)]}function zs({sourceX:e,sourceY:t,sourcePosition:n=X.Bottom,targetX:o,targetY:r,targetPosition:s=X.Top}){const[i,a]=pr({pos:n,x1:e,y1:t,x2:o,y2:r}),[u,f]=pr({pos:s,x1:o,y1:r,x2:e,y2:t}),[l,d,c,g]=as({sourceX:e,sourceY:t,targetX:o,targetY:r,sourceControlX:i,sourceControlY:a,targetControlX:u,targetControlY:f});return[`M${e},${t} C${i},${a} ${u},${f} ${o},${r}`,l,d,c,g]}function Hs(e){return v.memo(({id:t,sourceX:n,sourceY:o,targetX:r,targetY:s,sourcePosition:i,targetPosition:a,label:u,labelStyle:f,labelShowBg:l,labelBgStyle:d,labelBgPadding:c,labelBgBorderRadius:g,style:y,markerEnd:p,markerStart:x,interactionWidth:b})=>{const[C,h,w]=zs({sourceX:n,sourceY:o,sourcePosition:i,targetX:r,targetY:s,targetPosition:a}),S=e.isInternal?void 0:t;return m.jsx(bn,{id:S,path:C,labelX:h,labelY:w,label:u,labelStyle:f,labelShowBg:l,labelBgStyle:d,labelBgPadding:c,labelBgBorderRadius:g,style:y,markerEnd:p,markerStart:x,interactionWidth:b})})}const au=Hs({isInternal:!1}),Bs=Hs({isInternal:!0});au.displayName="SimpleBezierEdge";Bs.displayName="SimpleBezierEdgeInternal";function Fs(e){return v.memo(({id:t,sourceX:n,sourceY:o,targetX:r,targetY:s,label:i,labelStyle:a,labelShowBg:u,labelBgStyle:f,labelBgPadding:l,labelBgBorderRadius:d,style:c,sourcePosition:g=X.Bottom,targetPosition:y=X.Top,markerEnd:p,markerStart:x,pathOptions:b,interactionWidth:C})=>{const[h,w,S]=Gn({sourceX:n,sourceY:o,sourcePosition:g,targetX:r,targetY:s,targetPosition:y,borderRadius:b==null?void 0:b.borderRadius,offset:b==null?void 0:b.offset,stepPosition:b==null?void 0:b.stepPosition}),E=e.isInternal?void 0:t;return m.jsx(bn,{id:E,path:h,labelX:w,labelY:S,label:i,labelStyle:a,labelShowBg:u,labelBgStyle:f,labelBgPadding:l,labelBgBorderRadius:d,style:c,markerEnd:p,markerStart:x,interactionWidth:C})})}const Vs=Fs({isInternal:!1}),Ys=Fs({isInternal:!0});Vs.displayName="SmoothStepEdge";Ys.displayName="SmoothStepEdgeInternal";function Xs(e){return v.memo(({id:t,...n})=>{var r;const o=e.isInternal?void 0:t;return m.jsx(Vs,{...n,id:o,pathOptions:v.useMemo(()=>{var s;return{borderRadius:0,offset:(s=n.pathOptions)==null?void 0:s.offset}},[(r=n.pathOptions)==null?void 0:r.offset])})})}const cu=Xs({isInternal:!1}),Ws=Xs({isInternal:!0});cu.displayName="StepEdge";Ws.displayName="StepEdgeInternal";function Us(e){return v.memo(({id:t,sourceX:n,sourceY:o,targetX:r,targetY:s,label:i,labelStyle:a,labelShowBg:u,labelBgStyle:f,labelBgPadding:l,labelBgBorderRadius:d,style:c,markerEnd:g,markerStart:y,interactionWidth:p})=>{const[x,b,C]=ds({sourceX:n,sourceY:o,targetX:r,targetY:s}),h=e.isInternal?void 0:t;return m.jsx(bn,{id:h,path:x,labelX:b,labelY:C,label:i,labelStyle:a,labelShowBg:u,labelBgStyle:f,labelBgPadding:l,labelBgBorderRadius:d,style:c,markerEnd:g,markerStart:y,interactionWidth:p})})}const lu=Us({isInternal:!1}),Gs=Us({isInternal:!0});lu.displayName="StraightEdge";Gs.displayName="StraightEdgeInternal";function qs(e){return v.memo(({id:t,sourceX:n,sourceY:o,targetX:r,targetY:s,sourcePosition:i=X.Bottom,targetPosition:a=X.Top,label:u,labelStyle:f,labelShowBg:l,labelBgStyle:d,labelBgPadding:c,labelBgBorderRadius:g,style:y,markerEnd:p,markerStart:x,pathOptions:b,interactionWidth:C})=>{const[h,w,S]=cs({sourceX:n,sourceY:o,sourcePosition:i,targetX:r,targetY:s,targetPosition:a,curvature:b==null?void 0:b.curvature}),E=e.isInternal?void 0:t;return m.jsx(bn,{id:E,path:h,labelX:w,labelY:S,label:u,labelStyle:f,labelShowBg:l,labelBgStyle:d,labelBgPadding:c,labelBgBorderRadius:g,style:y,markerEnd:p,markerStart:x,interactionWidth:C})})}const uu=qs({isInternal:!1}),Ks=qs({isInternal:!0});uu.displayName="BezierEdge";Ks.displayName="BezierEdgeInternal";const mr={default:Ks,straight:Gs,step:Ws,smoothstep:Ys,simplebezier:Bs},yr={sourceX:null,sourceY:null,targetX:null,targetY:null,sourcePosition:null,targetPosition:null},du=(e,t,n)=>n===X.Left?e-t:n===X.Right?e+t:e,fu=(e,t,n)=>n===X.Top?e-t:n===X.Bottom?e+t:e,xr="react-flow__edgeupdater";function vr({position:e,centerX:t,centerY:n,radius:o=10,onMouseDown:r,onMouseEnter:s,onMouseOut:i,type:a}){return m.jsx("circle",{onMouseDown:r,onMouseEnter:s,onMouseOut:i,className:ie([xr,`${xr}-${a}`]),cx:du(t,o,e),cy:fu(n,o,e),r:o,stroke:"transparent",fill:"transparent"})}function gu({isReconnectable:e,reconnectRadius:t,edge:n,sourceX:o,sourceY:r,targetX:s,targetY:i,sourcePosition:a,targetPosition:u,onReconnect:f,onReconnectStart:l,onReconnectEnd:d,setReconnecting:c,setUpdateHover:g}){const y=re(),p=(w,S)=>{if(w.button!==0)return;const{autoPanOnConnect:E,domNode:N,isValidConnection:M,connectionMode:A,connectionRadius:$,lib:D,onConnectStart:k,onConnectEnd:R,cancelConnection:P,nodeLookup:_,rfId:L,panBy:j,updateConnection:z}=y.getState(),I=S.type==="target",T=(V,W)=>{c(!1),d==null||d(V,n,S.type,W)},O=V=>f==null?void 0:f(n,V),H=(V,W)=>{c(!0),l==null||l(w,n,S.type),k==null||k(V,W)};Zn.onPointerDown(w.nativeEvent,{autoPanOnConnect:E,connectionMode:A,connectionRadius:$,domNode:N,handleId:S.id,nodeId:S.nodeId,nodeLookup:_,isTarget:I,edgeUpdaterType:S.type,lib:D,flowId:L,cancelConnection:P,panBy:j,isValidConnection:M,onConnect:O,onConnectStart:H,onConnectEnd:R,onReconnectEnd:T,updateConnection:z,getTransform:()=>y.getState().transform,getFromHandle:()=>y.getState().connection.fromHandle,dragThreshold:y.getState().connectionDragThreshold})},x=w=>p(w,{nodeId:n.target,id:n.targetHandle??null,type:"target"}),b=w=>p(w,{nodeId:n.source,id:n.sourceHandle??null,type:"source"}),C=()=>g(!0),h=()=>g(!1);return m.jsxs(m.Fragment,{children:[(e===!0||e==="source")&&m.jsx(vr,{position:a,centerX:o,centerY:r,radius:t,onMouseDown:x,onMouseEnter:C,onMouseOut:h,type:"source"}),(e===!0||e==="target")&&m.jsx(vr,{position:u,centerX:s,centerY:i,radius:t,onMouseDown:b,onMouseEnter:C,onMouseOut:h,type:"target"})]})}function hu({id:e,edgesFocusable:t,edgesReconnectable:n,elementsSelectable:o,onClick:r,onDoubleClick:s,onContextMenu:i,onMouseEnter:a,onMouseMove:u,onMouseLeave:f,reconnectRadius:l,onReconnect:d,onReconnectStart:c,onReconnectEnd:g,rfId:y,edgeTypes:p,noPanClassName:x,onError:b,disableKeyboardA11y:C}){let h=ee(Y=>Y.edgeLookup.get(e));const w=ee(Y=>Y.defaultEdgeOptions);h=w?{...w,...h}:h;let S=h.type||"default",E=(p==null?void 0:p[S])||mr[S];E===void 0&&(b==null||b("011",Pe.error011(S)),S="default",E=(p==null?void 0:p.default)||mr.default);const N=!!(h.focusable||t&&typeof h.focusable>"u"),M=typeof d<"u"&&(h.reconnectable||n&&typeof h.reconnectable>"u"),A=!!(h.selectable||o&&typeof h.selectable>"u"),$=v.useRef(null),[D,k]=v.useState(!1),[R,P]=v.useState(!1),_=re(),{zIndex:L,sourceX:j,sourceY:z,targetX:I,targetY:T,sourcePosition:O,targetPosition:H}=ee(v.useCallback(Y=>{const K=Y.nodeLookup.get(h.source),U=Y.nodeLookup.get(h.target);if(!K||!U)return{zIndex:h.zIndex,...yr};const te=ac({id:e,sourceNode:K,targetNode:U,sourceHandle:h.sourceHandle||null,targetHandle:h.targetHandle||null,connectionMode:Y.connectionMode,onError:b});return{zIndex:ec({selected:h.selected,zIndex:h.zIndex,sourceNode:K,targetNode:U,elevateOnSelect:Y.elevateEdgesOnSelect}),...te||yr}},[h.source,h.target,h.sourceHandle,h.targetHandle,h.selected,h.zIndex]),se),V=v.useMemo(()=>h.markerStart?`url('#${qn(h.markerStart,y)}')`:void 0,[h.markerStart,y]),W=v.useMemo(()=>h.markerEnd?`url('#${qn(h.markerEnd,y)}')`:void 0,[h.markerEnd,y]);if(h.hidden||j===null||z===null||I===null||T===null)return null;const Z=Y=>{var oe;const{addSelectedEdges:K,unselectNodesAndEdges:U,multiSelectionActive:te}=_.getState();A&&(_.setState({nodesSelectionActive:!1}),h.selected&&te?(U({nodes:[],edges:[h]}),(oe=$.current)==null||oe.blur()):K([e])),r&&r(Y,h)},G=s?Y=>{s(Y,{...h})}:void 0,J=i?Y=>{i(Y,{...h})}:void 0,B=a?Y=>{a(Y,{...h})}:void 0,q=u?Y=>{u(Y,{...h})}:void 0,F=f?Y=>{f(Y,{...h})}:void 0,Q=Y=>{var K;if(!C&&Ur.includes(Y.key)&&A){const{unselectNodesAndEdges:U,addSelectedEdges:te}=_.getState();Y.key==="Escape"?((K=$.current)==null||K.blur(),U({edges:[h]})):te([e])}};return m.jsx("svg",{style:{zIndex:L},children:m.jsxs("g",{className:ie(["react-flow__edge",`react-flow__edge-${S}`,h.className,x,{selected:h.selected,animated:h.animated,inactive:!A&&!r,updating:D,selectable:A}]),onClick:Z,onDoubleClick:G,onContextMenu:J,onMouseEnter:B,onMouseMove:q,onMouseLeave:F,onKeyDown:N?Q:void 0,tabIndex:N?0:void 0,role:h.ariaRole??(N?"group":"img"),"aria-roledescription":"edge","data-id":e,"data-testid":`rf__edge-${e}`,"aria-label":h.ariaLabel===null?void 0:h.ariaLabel||`Edge from ${h.source} to ${h.target}`,"aria-describedby":N?`${Ms}-${y}`:void 0,ref:$,...h.domAttributes,children:[!R&&m.jsx(E,{id:e,source:h.source,target:h.target,type:h.type,selected:h.selected,animated:h.animated,selectable:A,deletable:h.deletable??!0,label:h.label,labelStyle:h.labelStyle,labelShowBg:h.labelShowBg,labelBgStyle:h.labelBgStyle,labelBgPadding:h.labelBgPadding,labelBgBorderRadius:h.labelBgBorderRadius,sourceX:j,sourceY:z,targetX:I,targetY:T,sourcePosition:O,targetPosition:H,data:h.data,style:h.style,sourceHandleId:h.sourceHandle,targetHandleId:h.targetHandle,markerStart:V,markerEnd:W,pathOptions:"pathOptions"in h?h.pathOptions:void 0,interactionWidth:h.interactionWidth}),M&&m.jsx(gu,{edge:h,isReconnectable:M,reconnectRadius:l,onReconnect:d,onReconnectStart:c,onReconnectEnd:g,sourceX:j,sourceY:z,targetX:I,targetY:T,sourcePosition:O,targetPosition:H,setUpdateHover:k,setReconnecting:P})]})})}const pu=e=>({edgesFocusable:e.edgesFocusable,edgesReconnectable:e.edgesReconnectable,elementsSelectable:e.elementsSelectable,connectionMode:e.connectionMode,onError:e.onError});function Zs({defaultMarkerColor:e,onlyRenderVisibleElements:t,rfId:n,edgeTypes:o,noPanClassName:r,onReconnect:s,onEdgeContextMenu:i,onEdgeMouseEnter:a,onEdgeMouseMove:u,onEdgeMouseLeave:f,onEdgeClick:l,reconnectRadius:d,onEdgeDoubleClick:c,onReconnectStart:g,onReconnectEnd:y,disableKeyboardA11y:p}){const{edgesFocusable:x,edgesReconnectable:b,elementsSelectable:C,onError:h}=ee(pu,se),w=eu(t);return m.jsxs("div",{className:"react-flow__edges",children:[m.jsx(su,{defaultColor:e,rfId:n}),w.map(S=>m.jsx(hu,{id:S,edgesFocusable:x,edgesReconnectable:b,elementsSelectable:C,noPanClassName:r,onReconnect:s,onContextMenu:i,onMouseEnter:a,onMouseMove:u,onMouseLeave:f,onClick:l,reconnectRadius:d,onDoubleClick:c,onReconnectStart:g,onReconnectEnd:y,rfId:n,onError:h,edgeTypes:o,disableKeyboardA11y:p},S))]})}Zs.displayName="EdgeRenderer";const mu=v.memo(Zs),yu=e=>`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`;function xu({children:e}){const t=ee(yu);return m.jsx("div",{className:"react-flow__viewport xyflow__viewport react-flow__container",style:{transform:t},children:e})}function vu(e){const t=go(),n=v.useRef(!1);v.useEffect(()=>{!n.current&&t.viewportInitialized&&e&&(setTimeout(()=>e(t),1),n.current=!0)},[e,t.viewportInitialized])}const bu=e=>{var t;return(t=e.panZoom)==null?void 0:t.syncViewport};function wu(e){const t=ee(bu),n=re();return v.useEffect(()=>{e&&(t==null||t(e),n.setState({transform:[e.x,e.y,e.zoom]}))},[e,t]),null}function Su(e){return e.connection.inProgress?{...e.connection,to:zt(e.connection.to,e.transform)}:{...e.connection}}function Cu(e){return Su}function Eu(e){const t=Cu();return ee(t,se)}const Mu=e=>({nodesConnectable:e.nodesConnectable,isValid:e.connection.isValid,inProgress:e.connection.inProgress,width:e.width,height:e.height});function Nu({containerStyle:e,style:t,type:n,component:o}){const{nodesConnectable:r,width:s,height:i,isValid:a,inProgress:u}=ee(Mu,se);return!(s&&r&&u)?null:m.jsx("svg",{style:e,width:s,height:i,className:"react-flow__connectionline react-flow__container",children:m.jsx("g",{className:ie(["react-flow__connection",Kr(a)]),children:m.jsx(Js,{style:t,type:n,CustomComponent:o,isValid:a})})})}const Js=({style:e,type:t=Ge.Bezier,CustomComponent:n,isValid:o})=>{const{inProgress:r,from:s,fromNode:i,fromHandle:a,fromPosition:u,to:f,toNode:l,toHandle:d,toPosition:c}=Eu();if(!r)return;if(n)return m.jsx(n,{connectionLineType:t,connectionLineStyle:e,fromNode:i,fromHandle:a,fromX:s.x,fromY:s.y,toX:f.x,toY:f.y,fromPosition:u,toPosition:c,connectionStatus:Kr(o),toNode:l,toHandle:d});let g="";const y={sourceX:s.x,sourceY:s.y,sourcePosition:u,targetX:f.x,targetY:f.y,targetPosition:c};switch(t){case Ge.Bezier:[g]=cs(y);break;case Ge.SimpleBezier:[g]=zs(y);break;case Ge.Step:[g]=Gn({...y,borderRadius:0});break;case Ge.SmoothStep:[g]=Gn(y);break;default:[g]=ds(y)}return m.jsx("path",{d:g,fill:"none",className:"react-flow__connection-path",style:e})};Js.displayName="ConnectionLine";const Du={};function br(e=Du){v.useRef(e),re(),v.useEffect(()=>{},[e])}function Iu(){re(),v.useRef(!1),v.useEffect(()=>{},[])}function Qs({nodeTypes:e,edgeTypes:t,onInit:n,onNodeClick:o,onEdgeClick:r,onNodeDoubleClick:s,onEdgeDoubleClick:i,onNodeMouseEnter:a,onNodeMouseMove:u,onNodeMouseLeave:f,onNodeContextMenu:l,onSelectionContextMenu:d,onSelectionStart:c,onSelectionEnd:g,connectionLineType:y,connectionLineStyle:p,connectionLineComponent:x,connectionLineContainerStyle:b,selectionKeyCode:C,selectionOnDrag:h,selectionMode:w,multiSelectionKeyCode:S,panActivationKeyCode:E,zoomActivationKeyCode:N,deleteKeyCode:M,onlyRenderVisibleElements:A,elementsSelectable:$,defaultViewport:D,translateExtent:k,minZoom:R,maxZoom:P,preventScrolling:_,defaultMarkerColor:L,zoomOnScroll:j,zoomOnPinch:z,panOnScroll:I,panOnScrollSpeed:T,panOnScrollMode:O,zoomOnDoubleClick:H,panOnDrag:V,onPaneClick:W,onPaneMouseEnter:Z,onPaneMouseMove:G,onPaneMouseLeave:J,onPaneScroll:B,onPaneContextMenu:q,paneClickDistance:F,nodeClickDistance:Q,onEdgeContextMenu:Y,onEdgeMouseEnter:K,onEdgeMouseMove:U,onEdgeMouseLeave:te,reconnectRadius:oe,onReconnect:ve,onReconnectStart:$e,onReconnectEnd:Be,noDragClassName:xe,noWheelClassName:Le,noPanClassName:Ie,disableKeyboardA11y:Fe,nodeExtent:rt,rfId:st,viewport:Ve,onViewportChange:be}){return br(e),br(t),Iu(),vu(n),wu(Ve),m.jsx(Xl,{onPaneClick:W,onPaneMouseEnter:Z,onPaneMouseMove:G,onPaneMouseLeave:J,onPaneContextMenu:q,onPaneScroll:B,paneClickDistance:F,deleteKeyCode:M,selectionKeyCode:C,selectionOnDrag:h,selectionMode:w,onSelectionStart:c,onSelectionEnd:g,multiSelectionKeyCode:S,panActivationKeyCode:E,zoomActivationKeyCode:N,elementsSelectable:$,zoomOnScroll:j,zoomOnPinch:z,zoomOnDoubleClick:H,panOnScroll:I,panOnScrollSpeed:T,panOnScrollMode:O,panOnDrag:V,defaultViewport:D,translateExtent:k,minZoom:R,maxZoom:P,onSelectionContextMenu:d,preventScrolling:_,noDragClassName:xe,noWheelClassName:Le,noPanClassName:Ie,disableKeyboardA11y:Fe,onViewportChange:be,isControlledViewport:!!Ve,children:m.jsxs(xu,{children:[m.jsx(mu,{edgeTypes:t,onEdgeClick:r,onEdgeDoubleClick:i,onReconnect:ve,onReconnectStart:$e,onReconnectEnd:Be,onlyRenderVisibleElements:A,onEdgeContextMenu:Y,onEdgeMouseEnter:K,onEdgeMouseMove:U,onEdgeMouseLeave:te,reconnectRadius:oe,defaultMarkerColor:L,noPanClassName:Ie,disableKeyboardA11y:Fe,rfId:st}),m.jsx(Nu,{style:p,type:y,component:x,containerStyle:b}),m.jsx("div",{className:"react-flow__edgelabel-renderer"}),m.jsx(Ql,{nodeTypes:e,onNodeClick:o,onNodeDoubleClick:s,onNodeMouseEnter:a,onNodeMouseMove:u,onNodeMouseLeave:f,onNodeContextMenu:l,nodeClickDistance:Q,onlyRenderVisibleElements:A,noPanClassName:Ie,noDragClassName:xe,disableKeyboardA11y:Fe,nodeExtent:rt,rfId:st}),m.jsx("div",{className:"react-flow__viewport-portal"})]})})}Qs.displayName="GraphView";const ku=v.memo(Qs),wr=({nodes:e,edges:t,defaultNodes:n,defaultEdges:o,width:r,height:s,fitView:i,fitViewOptions:a,minZoom:u=.5,maxZoom:f=2,nodeOrigin:l,nodeExtent:d}={})=>{const c=new Map,g=new Map,y=new Map,p=new Map,x=o??t??[],b=n??e??[],C=l??[0,0],h=d??kt;gs(y,p,x);const w=Kn(b,c,g,{nodeOrigin:C,nodeExtent:h,elevateNodesOnSelect:!1});let S=[0,0,1];if(i&&r&&s){const E=Ot(c,{filter:$=>!!(($.width||$.initialWidth)&&($.height||$.initialHeight))}),{x:N,y:M,zoom:A}=io(E,r,s,u,f,(a==null?void 0:a.padding)??.1);S=[N,M,A]}return{rfId:"1",width:0,height:0,transform:S,nodes:b,nodesInitialized:w,nodeLookup:c,parentLookup:g,edges:x,edgeLookup:p,connectionLookup:y,onNodesChange:null,onEdgesChange:null,hasDefaultNodes:n!==void 0,hasDefaultEdges:o!==void 0,panZoom:null,minZoom:u,maxZoom:f,translateExtent:kt,nodeExtent:h,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionMode:ft.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:C,nodeDragThreshold:1,connectionDragThreshold:1,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesReconnectable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,elevateEdgesOnSelect:!1,selectNodesOnDrag:!0,multiSelectionActive:!1,fitViewQueued:i??!1,fitViewOptions:a,fitViewResolver:null,connection:{...qr},connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,autoPanOnNodeFocus:!0,autoPanSpeed:15,connectionRadius:20,onError:Ga,isValidConnection:void 0,onSelectionChangeHandlers:[],lib:"react",debug:!1,ariaLabelConfig:Gr}},Au=({nodes:e,edges:t,defaultNodes:n,defaultEdges:o,width:r,height:s,fitView:i,fitViewOptions:a,minZoom:u,maxZoom:f,nodeOrigin:l,nodeExtent:d})=>Kc((c,g)=>{async function y(){const{nodeLookup:p,panZoom:x,fitViewOptions:b,fitViewResolver:C,width:h,height:w,minZoom:S,maxZoom:E}=g();x&&(await Wa({nodes:p,width:h,height:w,panZoom:x,minZoom:S,maxZoom:E},b),C==null||C.resolve(!0),c({fitViewResolver:null}))}return{...wr({nodes:e,edges:t,width:r,height:s,fitView:i,fitViewOptions:a,minZoom:u,maxZoom:f,nodeOrigin:l,nodeExtent:d,defaultNodes:n,defaultEdges:o}),setNodes:p=>{const{nodeLookup:x,parentLookup:b,nodeOrigin:C,elevateNodesOnSelect:h,fitViewQueued:w}=g(),S=Kn(p,x,b,{nodeOrigin:C,nodeExtent:d,elevateNodesOnSelect:h,checkEquality:!0});w&&S?(y(),c({nodes:p,nodesInitialized:S,fitViewQueued:!1,fitViewOptions:void 0})):c({nodes:p,nodesInitialized:S})},setEdges:p=>{const{connectionLookup:x,edgeLookup:b}=g();gs(x,b,p),c({edges:p})},setDefaultNodesAndEdges:(p,x)=>{if(p){const{setNodes:b}=g();b(p),c({hasDefaultNodes:!0})}if(x){const{setEdges:b}=g();b(x),c({hasDefaultEdges:!0})}},updateNodeInternals:p=>{const{triggerNodeChanges:x,nodeLookup:b,parentLookup:C,domNode:h,nodeOrigin:w,nodeExtent:S,debug:E,fitViewQueued:N}=g(),{changes:M,updatedInternals:A}=gc(p,b,C,h,w,S);A&&(uc(b,C,{nodeOrigin:w,nodeExtent:S}),N?(y(),c({fitViewQueued:!1,fitViewOptions:void 0})):c({}),(M==null?void 0:M.length)>0&&(E&&console.log("React Flow: trigger node changes",M),x==null||x(M)))},updateNodePositions:(p,x=!1)=>{const b=[],C=[],{nodeLookup:h,triggerNodeChanges:w}=g();for(const[S,E]of p){const N=h.get(S),M=!!(N!=null&&N.expandParent&&(N!=null&&N.parentId)&&(E!=null&&E.position)),A={id:S,type:"position",position:M?{x:Math.max(0,E.position.x),y:Math.max(0,E.position.y)}:E.position,dragging:x};M&&N.parentId&&b.push({id:S,parentId:N.parentId,rect:{...E.internals.positionAbsolute,width:E.measured.width??0,height:E.measured.height??0}}),C.push(A)}if(b.length>0){const{parentLookup:S,nodeOrigin:E}=g(),N=fo(b,h,S,E);C.push(...N)}w(C)},triggerNodeChanges:p=>{const{onNodesChange:x,setNodes:b,nodes:C,hasDefaultNodes:h,debug:w}=g();if(p!=null&&p.length){if(h){const S=Is(p,C);b(S)}w&&console.log("React Flow: trigger node changes",p),x==null||x(p)}},triggerEdgeChanges:p=>{const{onEdgesChange:x,setEdges:b,edges:C,hasDefaultEdges:h,debug:w}=g();if(p!=null&&p.length){if(h){const S=ks(p,C);b(S)}w&&console.log("React Flow: trigger edge changes",p),x==null||x(p)}},addSelectedNodes:p=>{const{multiSelectionActive:x,edgeLookup:b,nodeLookup:C,triggerNodeChanges:h,triggerEdgeChanges:w}=g();if(x){const S=p.map(E=>tt(E,!0));h(S);return}h(lt(C,new Set([...p]),!0)),w(lt(b))},addSelectedEdges:p=>{const{multiSelectionActive:x,edgeLookup:b,nodeLookup:C,triggerNodeChanges:h,triggerEdgeChanges:w}=g();if(x){const S=p.map(E=>tt(E,!0));w(S);return}w(lt(b,new Set([...p]))),h(lt(C,new Set,!0))},unselectNodesAndEdges:({nodes:p,edges:x}={})=>{const{edges:b,nodes:C,nodeLookup:h,triggerNodeChanges:w,triggerEdgeChanges:S}=g(),E=p||C,N=x||b,M=E.map($=>{const D=h.get($.id);return D&&(D.selected=!1),tt($.id,!1)}),A=N.map($=>tt($.id,!1));w(M),S(A)},setMinZoom:p=>{const{panZoom:x,maxZoom:b}=g();x==null||x.setScaleExtent([p,b]),c({minZoom:p})},setMaxZoom:p=>{const{panZoom:x,minZoom:b}=g();x==null||x.setScaleExtent([b,p]),c({maxZoom:p})},setTranslateExtent:p=>{var x;(x=g().panZoom)==null||x.setTranslateExtent(p),c({translateExtent:p})},setPaneClickDistance:p=>{var x;(x=g().panZoom)==null||x.setClickDistance(p)},resetSelectedElements:()=>{const{edges:p,nodes:x,triggerNodeChanges:b,triggerEdgeChanges:C,elementsSelectable:h}=g();if(!h)return;const w=x.reduce((E,N)=>N.selected?[...E,tt(N.id,!1)]:E,[]),S=p.reduce((E,N)=>N.selected?[...E,tt(N.id,!1)]:E,[]);b(w),C(S)},setNodeExtent:p=>{const{nodes:x,nodeLookup:b,parentLookup:C,nodeOrigin:h,elevateNodesOnSelect:w,nodeExtent:S}=g();p[0][0]===S[0][0]&&p[0][1]===S[0][1]&&p[1][0]===S[1][0]&&p[1][1]===S[1][1]||(Kn(x,b,C,{nodeOrigin:h,nodeExtent:p,elevateNodesOnSelect:w,checkEquality:!1}),c({nodeExtent:p}))},panBy:p=>{const{transform:x,width:b,height:C,panZoom:h,translateExtent:w}=g();return hc({delta:p,panZoom:h,transform:x,translateExtent:w,width:b,height:C})},setCenter:async(p,x,b)=>{const{width:C,height:h,maxZoom:w,panZoom:S}=g();if(!S)return Promise.resolve(!1);const E=typeof(b==null?void 0:b.zoom)<"u"?b.zoom:w;return await S.setViewport({x:C/2-p*E,y:h/2-x*E,zoom:E},{duration:b==null?void 0:b.duration,ease:b==null?void 0:b.ease,interpolate:b==null?void 0:b.interpolate}),Promise.resolve(!0)},cancelConnection:()=>{c({connection:{...qr}})},updateConnection:p=>{c({connection:p})},reset:()=>c({...wr()})}},Object.is);function Ru({initialNodes:e,initialEdges:t,defaultNodes:n,defaultEdges:o,initialWidth:r,initialHeight:s,initialMinZoom:i,initialMaxZoom:a,initialFitViewOptions:u,fitView:f,nodeOrigin:l,nodeExtent:d,children:c}){const[g]=v.useState(()=>Au({nodes:e,edges:t,defaultNodes:n,defaultEdges:o,width:r,height:s,fitView:f,minZoom:i,maxZoom:a,fitViewOptions:u,nodeOrigin:l,nodeExtent:d}));return m.jsx(Zc,{value:g,children:m.jsx(bl,{children:c})})}function ju({children:e,nodes:t,edges:n,defaultNodes:o,defaultEdges:r,width:s,height:i,fitView:a,fitViewOptions:u,minZoom:f,maxZoom:l,nodeOrigin:d,nodeExtent:c}){return v.useContext(yn)?m.jsx(m.Fragment,{children:e}):m.jsx(Ru,{initialNodes:t,initialEdges:n,defaultNodes:o,defaultEdges:r,initialWidth:s,initialHeight:i,fitView:a,initialFitViewOptions:u,initialMinZoom:f,initialMaxZoom:l,nodeOrigin:d,nodeExtent:c,children:e})}const Pu={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0};function _u({nodes:e,edges:t,defaultNodes:n,defaultEdges:o,className:r,nodeTypes:s,edgeTypes:i,onNodeClick:a,onEdgeClick:u,onInit:f,onMove:l,onMoveStart:d,onMoveEnd:c,onConnect:g,onConnectStart:y,onConnectEnd:p,onClickConnectStart:x,onClickConnectEnd:b,onNodeMouseEnter:C,onNodeMouseMove:h,onNodeMouseLeave:w,onNodeContextMenu:S,onNodeDoubleClick:E,onNodeDragStart:N,onNodeDrag:M,onNodeDragStop:A,onNodesDelete:$,onEdgesDelete:D,onDelete:k,onSelectionChange:R,onSelectionDragStart:P,onSelectionDrag:_,onSelectionDragStop:L,onSelectionContextMenu:j,onSelectionStart:z,onSelectionEnd:I,onBeforeDelete:T,connectionMode:O,connectionLineType:H=Ge.Bezier,connectionLineStyle:V,connectionLineComponent:W,connectionLineContainerStyle:Z,deleteKeyCode:G="Backspace",selectionKeyCode:J="Shift",selectionOnDrag:B=!1,selectionMode:q=At.Full,panActivationKeyCode:F="Space",multiSelectionKeyCode:Q=rn()?"Meta":"Control",zoomActivationKeyCode:Y=rn()?"Meta":"Control",snapToGrid:K,snapGrid:U,onlyRenderVisibleElements:te=!1,selectNodesOnDrag:oe,nodesDraggable:ve,autoPanOnNodeFocus:$e,nodesConnectable:Be,nodesFocusable:xe,nodeOrigin:Le=Ns,edgesFocusable:Ie,edgesReconnectable:Fe,elementsSelectable:rt=!0,defaultViewport:st=ul,minZoom:Ve=.5,maxZoom:be=2,translateExtent:Te=kt,preventScrolling:Ze=!0,nodeExtent:it,defaultMarkerColor:ke="#b1b1b7",zoomOnScroll:Vt=!0,zoomOnPinch:En=!0,panOnScroll:Mn=!1,panOnScrollSpeed:bt=.5,panOnScrollMode:Yt=nt.Free,zoomOnDoubleClick:Nn=!0,panOnDrag:Xt=!0,onPaneClick:Dn,onPaneMouseEnter:In,onPaneMouseMove:kn,onPaneMouseLeave:ue,onPaneScroll:ge,onPaneContextMenu:he,paneClickDistance:Ee=0,nodeClickDistance:me=0,children:pe,onReconnect:we,onReconnectStart:Ye,onReconnectEnd:ae,onEdgeContextMenu:Ae,onEdgeDoubleClick:Se,onEdgeMouseEnter:Me,onEdgeMouseMove:Je,onEdgeMouseLeave:Qe,reconnectRadius:Re=10,onNodesChange:et,onEdgesChange:wt,noDragClassName:Ci="nodrag",noWheelClassName:Ei="nowheel",noPanClassName:Eo="nopan",fitView:Mo,fitViewOptions:No,connectOnClick:Mi,attributionPosition:Ni,proOptions:Di,defaultEdgeOptions:Ii,elevateNodesOnSelect:ki,elevateEdgesOnSelect:Ai,disableKeyboardA11y:Do=!1,autoPanOnConnect:Ri,autoPanOnNodeDrag:ji,autoPanSpeed:Pi,connectionRadius:_i,isValidConnection:$i,onError:Li,style:Ti,id:Io,nodeDragThreshold:Oi,connectionDragThreshold:zi,viewport:Hi,onViewportChange:Bi,width:Fi,height:Vi,colorMode:Yi="light",debug:Xi,onScroll:Wt,ariaLabelConfig:Wi,...Ui},Gi){const An=Io||"1",qi=hl(Yi),Ki=v.useCallback(ko=>{ko.currentTarget.scrollTo({top:0,left:0,behavior:"instant"}),Wt==null||Wt(ko)},[Wt]);return m.jsx("div",{"data-testid":"rf__wrapper",...Ui,onScroll:Ki,style:{...Ti,...Pu},ref:Gi,className:ie(["react-flow",r,qi]),id:Io,role:"application",children:m.jsxs(ju,{nodes:e,edges:t,width:Fi,height:Vi,fitView:Mo,fitViewOptions:No,minZoom:Ve,maxZoom:be,nodeOrigin:Le,nodeExtent:it,children:[m.jsx(ku,{onInit:f,onNodeClick:a,onEdgeClick:u,onNodeMouseEnter:C,onNodeMouseMove:h,onNodeMouseLeave:w,onNodeContextMenu:S,onNodeDoubleClick:E,nodeTypes:s,edgeTypes:i,connectionLineType:H,connectionLineStyle:V,connectionLineComponent:W,connectionLineContainerStyle:Z,selectionKeyCode:J,selectionOnDrag:B,selectionMode:q,deleteKeyCode:G,multiSelectionKeyCode:Q,panActivationKeyCode:F,zoomActivationKeyCode:Y,onlyRenderVisibleElements:te,defaultViewport:st,translateExtent:Te,minZoom:Ve,maxZoom:be,preventScrolling:Ze,zoomOnScroll:Vt,zoomOnPinch:En,zoomOnDoubleClick:Nn,panOnScroll:Mn,panOnScrollSpeed:bt,panOnScrollMode:Yt,panOnDrag:Xt,onPaneClick:Dn,onPaneMouseEnter:In,onPaneMouseMove:kn,onPaneMouseLeave:ue,onPaneScroll:ge,onPaneContextMenu:he,paneClickDistance:Ee,nodeClickDistance:me,onSelectionContextMenu:j,onSelectionStart:z,onSelectionEnd:I,onReconnect:we,onReconnectStart:Ye,onReconnectEnd:ae,onEdgeContextMenu:Ae,onEdgeDoubleClick:Se,onEdgeMouseEnter:Me,onEdgeMouseMove:Je,onEdgeMouseLeave:Qe,reconnectRadius:Re,defaultMarkerColor:ke,noDragClassName:Ci,noWheelClassName:Ei,noPanClassName:Eo,rfId:An,disableKeyboardA11y:Do,nodeExtent:it,viewport:Hi,onViewportChange:Bi}),m.jsx(gl,{nodes:e,edges:t,defaultNodes:n,defaultEdges:o,onConnect:g,onConnectStart:y,onConnectEnd:p,onClickConnectStart:x,onClickConnectEnd:b,nodesDraggable:ve,autoPanOnNodeFocus:$e,nodesConnectable:Be,nodesFocusable:xe,edgesFocusable:Ie,edgesReconnectable:Fe,elementsSelectable:rt,elevateNodesOnSelect:ki,elevateEdgesOnSelect:Ai,minZoom:Ve,maxZoom:be,nodeExtent:it,onNodesChange:et,onEdgesChange:wt,snapToGrid:K,snapGrid:U,connectionMode:O,translateExtent:Te,connectOnClick:Mi,defaultEdgeOptions:Ii,fitView:Mo,fitViewOptions:No,onNodesDelete:$,onEdgesDelete:D,onDelete:k,onNodeDragStart:N,onNodeDrag:M,onNodeDragStop:A,onSelectionDrag:_,onSelectionDragStart:P,onSelectionDragStop:L,onMove:l,onMoveStart:d,onMoveEnd:c,noPanClassName:Eo,nodeOrigin:Le,rfId:An,autoPanOnConnect:Ri,autoPanOnNodeDrag:ji,autoPanSpeed:Pi,onError:Li,connectionRadius:_i,isValidConnection:$i,selectNodesOnDrag:oe,nodeDragThreshold:Oi,connectionDragThreshold:zi,onBeforeDelete:T,paneClickDistance:Ee,debug:Xi,ariaLabelConfig:Wi}),m.jsx(ll,{onSelectionChange:R}),pe,m.jsx(rl,{proOptions:Di,position:Ni}),m.jsx(ol,{rfId:An,disableKeyboardA11y:Do})]})})}var $u=As(_u);function Lu({dimensions:e,lineWidth:t,variant:n,className:o}){return m.jsx("path",{strokeWidth:t,d:`M${e[0]/2} 0 V${e[1]} M0 ${e[1]/2} H${e[0]}`,className:ie(["react-flow__background-pattern",n,o])})}function Tu({radius:e,className:t}){return m.jsx("circle",{cx:e,cy:e,r:e,className:ie(["react-flow__background-pattern","dots",t])})}var qe;(function(e){e.Lines="lines",e.Dots="dots",e.Cross="cross"})(qe||(qe={}));const Ou={[qe.Dots]:1,[qe.Lines]:1,[qe.Cross]:6},zu=e=>({transform:e.transform,patternId:`pattern-${e.rfId}`});function ei({id:e,variant:t=qe.Dots,gap:n=20,size:o,lineWidth:r=1,offset:s=0,color:i,bgColor:a,style:u,className:f,patternClassName:l}){const d=v.useRef(null),{transform:c,patternId:g}=ee(zu,se),y=o||Ou[t],p=t===qe.Dots,x=t===qe.Cross,b=Array.isArray(n)?n:[n,n],C=[b[0]*c[2]||1,b[1]*c[2]||1],h=y*c[2],w=Array.isArray(s)?s:[s,s],S=x?[h,h]:C,E=[w[0]*c[2]||1+S[0]/2,w[1]*c[2]||1+S[1]/2],N=`${g}${e||""}`;return m.jsxs("svg",{className:ie(["react-flow__background",f]),style:{...u,...vn,"--xy-background-color-props":a,"--xy-background-pattern-color-props":i},ref:d,"data-testid":"rf__background",children:[m.jsx("pattern",{id:N,x:c[0]%C[0],y:c[1]%C[1],width:C[0],height:C[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${E[0]},-${E[1]})`,children:p?m.jsx(Tu,{radius:h/2,className:l}):m.jsx(Lu,{dimensions:S,lineWidth:r,variant:t,className:l})}),m.jsx("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${N})`})]})}ei.displayName="Background";const Hu=v.memo(ei);function Bu(){return m.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",children:m.jsx("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"})})}function Fu(){return m.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5",children:m.jsx("path",{d:"M0 0h32v4.2H0z"})})}function Vu(){return m.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30",children:m.jsx("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"})})}function Yu(){return m.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:m.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"})})}function Xu(){return m.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:m.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"})})}function Kt({children:e,className:t,...n}){return m.jsx("button",{type:"button",className:ie(["react-flow__controls-button",t]),...n,children:e})}const Wu=e=>({isInteractive:e.nodesDraggable||e.nodesConnectable||e.elementsSelectable,minZoomReached:e.transform[2]<=e.minZoom,maxZoomReached:e.transform[2]>=e.maxZoom,ariaLabelConfig:e.ariaLabelConfig});function ti({style:e,showZoom:t=!0,showFitView:n=!0,showInteractive:o=!0,fitViewOptions:r,onZoomIn:s,onZoomOut:i,onFitView:a,onInteractiveChange:u,className:f,children:l,position:d="bottom-left",orientation:c="vertical","aria-label":g}){const y=re(),{isInteractive:p,minZoomReached:x,maxZoomReached:b,ariaLabelConfig:C}=ee(Wu,se),{zoomIn:h,zoomOut:w,fitView:S}=go(),E=()=>{h(),s==null||s()},N=()=>{w(),i==null||i()},M=()=>{S(r),a==null||a()},A=()=>{y.setState({nodesDraggable:!p,nodesConnectable:!p,elementsSelectable:!p}),u==null||u(!p)},$=c==="horizontal"?"horizontal":"vertical";return m.jsxs(xn,{className:ie(["react-flow__controls",$,f]),position:d,style:e,"data-testid":"rf__controls","aria-label":g??C["controls.ariaLabel"],children:[t&&m.jsxs(m.Fragment,{children:[m.jsx(Kt,{onClick:E,className:"react-flow__controls-zoomin",title:C["controls.zoomIn.ariaLabel"],"aria-label":C["controls.zoomIn.ariaLabel"],disabled:b,children:m.jsx(Bu,{})}),m.jsx(Kt,{onClick:N,className:"react-flow__controls-zoomout",title:C["controls.zoomOut.ariaLabel"],"aria-label":C["controls.zoomOut.ariaLabel"],disabled:x,children:m.jsx(Fu,{})})]}),n&&m.jsx(Kt,{className:"react-flow__controls-fitview",onClick:M,title:C["controls.fitView.ariaLabel"],"aria-label":C["controls.fitView.ariaLabel"],children:m.jsx(Vu,{})}),o&&m.jsx(Kt,{className:"react-flow__controls-interactive",onClick:A,title:C["controls.interactive.ariaLabel"],"aria-label":C["controls.interactive.ariaLabel"],children:p?m.jsx(Xu,{}):m.jsx(Yu,{})}),l]})}ti.displayName="Controls";const Uu=v.memo(ti);function Gu({id:e,x:t,y:n,width:o,height:r,style:s,color:i,strokeColor:a,strokeWidth:u,className:f,borderRadius:l,shapeRendering:d,selected:c,onClick:g}){const{background:y,backgroundColor:p}=s||{},x=i||y||p;return m.jsx("rect",{className:ie(["react-flow__minimap-node",{selected:c},f]),x:t,y:n,rx:l,ry:l,width:o,height:r,style:{fill:x,stroke:a,strokeWidth:u},shapeRendering:d,onClick:g?b=>g(b,e):void 0})}const qu=v.memo(Gu),Ku=e=>e.nodes.map(t=>t.id),Bn=e=>e instanceof Function?e:()=>e;function Zu({nodeStrokeColor:e,nodeColor:t,nodeClassName:n="",nodeBorderRadius:o=5,nodeStrokeWidth:r,nodeComponent:s=qu,onClick:i}){const a=ee(Ku,se),u=Bn(t),f=Bn(e),l=Bn(n),d=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return m.jsx(m.Fragment,{children:a.map(c=>m.jsx(Qu,{id:c,nodeColorFunc:u,nodeStrokeColorFunc:f,nodeClassNameFunc:l,nodeBorderRadius:o,nodeStrokeWidth:r,NodeComponent:s,onClick:i,shapeRendering:d},c))})}function Ju({id:e,nodeColorFunc:t,nodeStrokeColorFunc:n,nodeClassNameFunc:o,nodeBorderRadius:r,nodeStrokeWidth:s,shapeRendering:i,NodeComponent:a,onClick:u}){const{node:f,x:l,y:d,width:c,height:g}=ee(y=>{const{internals:p}=y.nodeLookup.get(e),x=p.userNode,{x:b,y:C}=p.positionAbsolute,{width:h,height:w}=He(x);return{node:x,x:b,y:C,width:h,height:w}},se);return!f||f.hidden||!ns(f)?null:m.jsx(a,{x:l,y:d,width:c,height:g,style:f.style,selected:!!f.selected,className:o(f),color:t(f),borderRadius:r,strokeColor:n(f),strokeWidth:s,shapeRendering:i,onClick:u,id:f.id})}const Qu=v.memo(Ju);var ed=v.memo(Zu);const td=200,nd=150,od=e=>!e.hidden,rd=e=>{const t={x:-e.transform[0]/e.transform[2],y:-e.transform[1]/e.transform[2],width:e.width/e.transform[2],height:e.height/e.transform[2]};return{viewBB:t,boundingRect:e.nodeLookup.size>0?ts(Ot(e.nodeLookup,{filter:od}),t):t,rfId:e.rfId,panZoom:e.panZoom,translateExtent:e.translateExtent,flowWidth:e.width,flowHeight:e.height,ariaLabelConfig:e.ariaLabelConfig}},sd="react-flow__minimap-desc";function ni({style:e,className:t,nodeStrokeColor:n,nodeColor:o,nodeClassName:r="",nodeBorderRadius:s=5,nodeStrokeWidth:i,nodeComponent:a,bgColor:u,maskColor:f,maskStrokeColor:l,maskStrokeWidth:d,position:c="bottom-right",onClick:g,onNodeClick:y,pannable:p=!1,zoomable:x=!1,ariaLabel:b,inversePan:C,zoomStep:h=10,offsetScale:w=5}){const S=re(),E=v.useRef(null),{boundingRect:N,viewBB:M,rfId:A,panZoom:$,translateExtent:D,flowWidth:k,flowHeight:R,ariaLabelConfig:P}=ee(rd,se),_=(e==null?void 0:e.width)??td,L=(e==null?void 0:e.height)??nd,j=N.width/_,z=N.height/L,I=Math.max(j,z),T=I*_,O=I*L,H=w*I,V=N.x-(T-N.width)/2-H,W=N.y-(O-N.height)/2-H,Z=T+H*2,G=O+H*2,J=`${sd}-${A}`,B=v.useRef(0),q=v.useRef();B.current=I,v.useEffect(()=>{if(E.current&&$)return q.current=Sc({domNode:E.current,panZoom:$,getTransform:()=>S.getState().transform,getViewScale:()=>B.current}),()=>{var K;(K=q.current)==null||K.destroy()}},[$]),v.useEffect(()=>{var K;(K=q.current)==null||K.update({translateExtent:D,width:k,height:R,inversePan:C,pannable:p,zoomStep:h,zoomable:x})},[p,x,C,h,D,k,R]);const F=g?K=>{var oe;const[U,te]=((oe=q.current)==null?void 0:oe.pointer(K))||[0,0];g(K,{x:U,y:te})}:void 0,Q=y?v.useCallback((K,U)=>{const te=S.getState().nodeLookup.get(U).internals.userNode;y(K,te)},[]):void 0,Y=b??P["minimap.ariaLabel"];return m.jsx(xn,{position:c,style:{...e,"--xy-minimap-background-color-props":typeof u=="string"?u:void 0,"--xy-minimap-mask-background-color-props":typeof f=="string"?f:void 0,"--xy-minimap-mask-stroke-color-props":typeof l=="string"?l:void 0,"--xy-minimap-mask-stroke-width-props":typeof d=="number"?d*I:void 0,"--xy-minimap-node-background-color-props":typeof o=="string"?o:void 0,"--xy-minimap-node-stroke-color-props":typeof n=="string"?n:void 0,"--xy-minimap-node-stroke-width-props":typeof i=="number"?i:void 0},className:ie(["react-flow__minimap",t]),"data-testid":"rf__minimap",children:m.jsxs("svg",{width:_,height:L,viewBox:`${V} ${W} ${Z} ${G}`,className:"react-flow__minimap-svg",role:"img","aria-labelledby":J,ref:E,onClick:F,children:[Y&&m.jsx("title",{id:J,children:Y}),m.jsx(ed,{onClick:Q,nodeColor:o,nodeStrokeColor:n,nodeBorderRadius:s,nodeClassName:r,nodeStrokeWidth:i,nodeComponent:a}),m.jsx("path",{className:"react-flow__minimap-mask",d:`M${V-H},${W-H}h${Z+H*2}v${G+H*2}h${-Z-H*2}z
        M${M.x},${M.y}h${M.width}v${M.height}h${-M.width}z`,fillRule:"evenodd",pointerEvents:"none"})]})})}ni.displayName="MiniMap";const id=v.memo(ni),ad=e=>t=>e?`${Math.max(1/t.transform[2],1)}`:void 0,cd={[mt.Line]:"right",[mt.Handle]:"bottom-right"};function ld({nodeId:e,position:t,variant:n=mt.Handle,className:o,style:r=void 0,children:s,color:i,minWidth:a=10,minHeight:u=10,maxWidth:f=Number.MAX_VALUE,maxHeight:l=Number.MAX_VALUE,keepAspectRatio:d=!1,resizeDirection:c,autoScale:g=!0,shouldResize:y,onResizeStart:p,onResize:x,onResizeEnd:b}){const C=_s(),h=typeof e=="string"?e:C,w=re(),S=v.useRef(null),E=n===mt.Handle,N=ee(v.useCallback(ad(E&&g),[E,g]),se),M=v.useRef(null),A=t??cd[n];v.useEffect(()=>{if(!(!S.current||!h))return M.current||(M.current=Oc({domNode:S.current,nodeId:h,getStoreItems:()=>{const{nodeLookup:D,transform:k,snapGrid:R,snapToGrid:P,nodeOrigin:_,domNode:L}=w.getState();return{nodeLookup:D,transform:k,snapGrid:R,snapToGrid:P,nodeOrigin:_,paneDomNode:L}},onChange:(D,k)=>{const{triggerNodeChanges:R,nodeLookup:P,parentLookup:_,nodeOrigin:L}=w.getState(),j=[],z={x:D.x,y:D.y},I=P.get(h);if(I&&I.expandParent&&I.parentId){const T=I.origin??L,O=D.width??I.measured.width??0,H=D.height??I.measured.height??0,V={id:I.id,parentId:I.parentId,rect:{width:O,height:H,...os({x:D.x??I.position.x,y:D.y??I.position.y},{width:O,height:H},I.parentId,P,T)}},W=fo([V],P,_,L);j.push(...W),z.x=D.x?Math.max(T[0]*O,D.x):void 0,z.y=D.y?Math.max(T[1]*H,D.y):void 0}if(z.x!==void 0&&z.y!==void 0){const T={id:h,type:"position",position:{...z}};j.push(T)}if(D.width!==void 0&&D.height!==void 0){const O={id:h,type:"dimensions",resizing:!0,setAttributes:c?c==="horizontal"?"width":"height":!0,dimensions:{width:D.width,height:D.height}};j.push(O)}for(const T of k){const O={...T,type:"position"};j.push(O)}R(j)},onEnd:({width:D,height:k})=>{const R={id:h,type:"dimensions",resizing:!1,dimensions:{width:D,height:k}};w.getState().triggerNodeChanges([R])}})),M.current.update({controlPosition:A,boundaries:{minWidth:a,minHeight:u,maxWidth:f,maxHeight:l},keepAspectRatio:d,resizeDirection:c,onResizeStart:p,onResize:x,onResizeEnd:b,shouldResize:y}),()=>{var D;(D=M.current)==null||D.destroy()}},[A,a,u,f,l,d,p,x,b,y]);const $=A.split("-");return m.jsx("div",{className:ie(["react-flow__resize-control","nodrag",...$,n,o]),ref:S,style:{...r,scale:N,...i&&{[E?"backgroundColor":"borderColor"]:i}},children:s})}v.memo(ld);const Fn={width:10,height:10,bottom:-5};v.memo(({data:e,isConnectable:t})=>m.jsx(m.Fragment,{children:m.jsxs("div",{style:{padding:25},children:[m.jsx("div",{children:"Node"}),m.jsx(ze,{type:"source",id:"red",position:X.Bottom,style:{...Fn,left:"15%",background:"red"},onConnect:n=>console.log("handle onConnect",n),isConnectable:t}),m.jsx(ze,{type:"source",position:X.Bottom,id:"blue",style:{...Fn,left:"50%",background:"blue"},isConnectable:t}),m.jsx(ze,{type:"target",position:X.Bottom,id:"orange",style:{...Fn,left:"85%",background:"orange"},isConnectable:t})]})}));const ud={custom:fd};function dd({initialNodes:e,initialEdges:t,component:n}){const{messageApi:o}=Ke(),[r,s]=v.useState(e),[i,a]=v.useState(t);v.useEffect(()=>{s(e)},[e]);const u=v.useCallback(c=>s(g=>Is(c,g)),[]),f=v.useCallback(c=>a(g=>ks(c,g)),[]),l=v.useCallback(c=>a(g=>us(c,g)),[]),d=async()=>{const c=r.map(p=>({component_id:p.id,position:p.position})),g={position:JSON.stringify(c),edges:JSON.stringify(i),component_id:n.component_id},y=await aa(g);console.log(y),o.success("保存成功")};return m.jsx(Fr,{title:"流程图",extra:m.jsx(le,{size:"small",color:"cyan",variant:"solid",onClick:d,children:"保存"}),bodyStyle:{padding:0},children:m.jsx("div",{style:{height:"40vh"},children:m.jsxs($u,{nodes:r,edges:i,nodeTypes:ud,onNodesChange:u,onEdgesChange:f,onConnect:l,fitView:!0,children:[m.jsx(Uu,{}),m.jsx(id,{}),m.jsx(Hu,{gap:12,size:1})]})})})}function fd({data:e}){const t=e.inputs||[],n=e.outputs||[];return m.jsxs("div",{style:{background:e.color||"#1976d2",color:"white",padding:10,borderRadius:12,minWidth:150,position:"relative"},children:[m.jsx("div",{style:{fontWeight:"bold",marginBottom:4},children:e.label}),t.map((o,r)=>m.jsx(Ao,{content:m.jsx("div",{children:o.component_name}),children:m.jsx(ze,{type:"target",position:X.Left,id:o.component_id,style:{top:30+r*20,background:"#555"}},o.component_id)})),n.map((o,r)=>m.jsx(Ao,{content:m.jsx("div",{children:o.component_name}),children:m.jsx(ze,{type:"source",position:X.Right,id:o.component_id,style:{top:30+r*20,background:"#888"}},o.component_id)}))]})}function gd(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return v.useMemo(()=>o=>{t.forEach(r=>r(o))},t)}const wn=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function yt(e){const t=Object.prototype.toString.call(e);return t==="[object Window]"||t==="[object global]"}function po(e){return"nodeType"in e}function ye(e){var t,n;return e?yt(e)?e:po(e)&&(t=(n=e.ownerDocument)==null?void 0:n.defaultView)!=null?t:window:window}function mo(e){const{Document:t}=ye(e);return e instanceof t}function Ht(e){return yt(e)?!1:e instanceof ye(e).HTMLElement}function oi(e){return e instanceof ye(e).SVGElement}function xt(e){return e?yt(e)?e.document:po(e)?mo(e)?e:Ht(e)||oi(e)?e.ownerDocument:document:document:document}const _e=wn?v.useLayoutEffect:v.useEffect;function yo(e){const t=v.useRef(e);return _e(()=>{t.current=e}),v.useCallback(function(){for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return t.current==null?void 0:t.current(...o)},[])}function hd(){const e=v.useRef(null),t=v.useCallback((o,r)=>{e.current=setInterval(o,r)},[]),n=v.useCallback(()=>{e.current!==null&&(clearInterval(e.current),e.current=null)},[]);return[t,n]}function _t(e,t){t===void 0&&(t=[e]);const n=v.useRef(e);return _e(()=>{n.current!==e&&(n.current=e)},t),n}function Bt(e,t){const n=v.useRef();return v.useMemo(()=>{const o=e(n.current);return n.current=o,o},[...t])}function an(e){const t=yo(e),n=v.useRef(null),o=v.useCallback(r=>{r!==n.current&&(t==null||t(r,n.current)),n.current=r},[]);return[n,o]}function Qn(e){const t=v.useRef();return v.useEffect(()=>{t.current=e},[e]),t.current}let Vn={};function Ft(e,t){return v.useMemo(()=>{if(t)return t;const n=Vn[e]==null?0:Vn[e]+1;return Vn[e]=n,e+"-"+n},[e,t])}function ri(e){return function(t){for(var n=arguments.length,o=new Array(n>1?n-1:0),r=1;r<n;r++)o[r-1]=arguments[r];return o.reduce((s,i)=>{const a=Object.entries(i);for(const[u,f]of a){const l=s[u];l!=null&&(s[u]=l+e*f)}return s},{...t})}}const ut=ri(1),cn=ri(-1);function pd(e){return"clientX"in e&&"clientY"in e}function xo(e){if(!e)return!1;const{KeyboardEvent:t}=ye(e.target);return t&&e instanceof t}function md(e){if(!e)return!1;const{TouchEvent:t}=ye(e.target);return t&&e instanceof t}function eo(e){if(md(e)){if(e.touches&&e.touches.length){const{clientX:t,clientY:n}=e.touches[0];return{x:t,y:n}}else if(e.changedTouches&&e.changedTouches.length){const{clientX:t,clientY:n}=e.changedTouches[0];return{x:t,y:n}}}return pd(e)?{x:e.clientX,y:e.clientY}:null}const $t=Object.freeze({Translate:{toString(e){if(!e)return;const{x:t,y:n}=e;return"translate3d("+(t?Math.round(t):0)+"px, "+(n?Math.round(n):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:t,scaleY:n}=e;return"scaleX("+t+") scaleY("+n+")"}},Transform:{toString(e){if(e)return[$t.Translate.toString(e),$t.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:t,duration:n,easing:o}=e;return t+" "+n+"ms "+o}}}),Sr="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function yd(e){return e.matches(Sr)?e:e.querySelector(Sr)}const xd={display:"none"};function vd(e){let{id:t,value:n}=e;return fe.createElement("div",{id:t,style:xd},n)}function bd(e){let{id:t,announcement:n,ariaLiveType:o="assertive"}=e;const r={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return fe.createElement("div",{id:t,style:r,role:"status","aria-live":o,"aria-atomic":!0},n)}function wd(){const[e,t]=v.useState("");return{announce:v.useCallback(o=>{o!=null&&t(o)},[]),announcement:e}}const si=v.createContext(null);function Sd(e){const t=v.useContext(si);v.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(e)},[e,t])}function Cd(){const[e]=v.useState(()=>new Set),t=v.useCallback(o=>(e.add(o),()=>e.delete(o)),[e]);return[v.useCallback(o=>{let{type:r,event:s}=o;e.forEach(i=>{var a;return(a=i[r])==null?void 0:a.call(i,s)})},[e]),t]}const Ed={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},Md={onDragStart(e){let{active:t}=e;return"Picked up draggable item "+t.id+"."},onDragOver(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was moved over droppable area "+n.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was dropped over droppable area "+n.id:"Draggable item "+t.id+" was dropped."},onDragCancel(e){let{active:t}=e;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function Nd(e){let{announcements:t=Md,container:n,hiddenTextDescribedById:o,screenReaderInstructions:r=Ed}=e;const{announce:s,announcement:i}=wd(),a=Ft("DndLiveRegion"),[u,f]=v.useState(!1);if(v.useEffect(()=>{f(!0)},[]),Sd(v.useMemo(()=>({onDragStart(d){let{active:c}=d;s(t.onDragStart({active:c}))},onDragMove(d){let{active:c,over:g}=d;t.onDragMove&&s(t.onDragMove({active:c,over:g}))},onDragOver(d){let{active:c,over:g}=d;s(t.onDragOver({active:c,over:g}))},onDragEnd(d){let{active:c,over:g}=d;s(t.onDragEnd({active:c,over:g}))},onDragCancel(d){let{active:c,over:g}=d;s(t.onDragCancel({active:c,over:g}))}}),[s,t])),!u)return null;const l=fe.createElement(fe.Fragment,null,fe.createElement(vd,{id:o,value:r.draggable}),fe.createElement(bd,{id:a,announcement:i}));return n?St.createPortal(l,n):l}var ce;(function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"})(ce||(ce={}));function ln(){}function Dd(e,t){return v.useMemo(()=>({sensor:e,options:t??{}}),[e,t])}function Id(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return v.useMemo(()=>[...t].filter(o=>o!=null),[...t])}const De=Object.freeze({x:0,y:0});function kd(e,t){let{data:{value:n}}=e,{data:{value:o}}=t;return o-n}function Ad(e,t){if(!e||e.length===0)return null;const[n]=e;return n[t]}function Rd(e,t){const n=Math.max(t.top,e.top),o=Math.max(t.left,e.left),r=Math.min(t.left+t.width,e.left+e.width),s=Math.min(t.top+t.height,e.top+e.height),i=r-o,a=s-n;if(o<r&&n<s){const u=t.width*t.height,f=e.width*e.height,l=i*a,d=l/(u+f-l);return Number(d.toFixed(4))}return 0}const jd=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:o}=e;const r=[];for(const s of o){const{id:i}=s,a=n.get(i);if(a){const u=Rd(a,t);u>0&&r.push({id:i,data:{droppableContainer:s,value:u}})}}return r.sort(kd)};function Pd(e,t,n){return{...e,scaleX:t&&n?t.width/n.width:1,scaleY:t&&n?t.height/n.height:1}}function ii(e,t){return e&&t?{x:e.left-t.left,y:e.top-t.top}:De}function _d(e){return function(n){for(var o=arguments.length,r=new Array(o>1?o-1:0),s=1;s<o;s++)r[s-1]=arguments[s];return r.reduce((i,a)=>({...i,top:i.top+e*a.y,bottom:i.bottom+e*a.y,left:i.left+e*a.x,right:i.right+e*a.x}),{...n})}}const $d=_d(1);function Ld(e){if(e.startsWith("matrix3d(")){const t=e.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}else if(e.startsWith("matrix(")){const t=e.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}function Td(e,t,n){const o=Ld(t);if(!o)return e;const{scaleX:r,scaleY:s,x:i,y:a}=o,u=e.left-i-(1-r)*parseFloat(n),f=e.top-a-(1-s)*parseFloat(n.slice(n.indexOf(" ")+1)),l=r?e.width/r:e.width,d=s?e.height/s:e.height;return{width:l,height:d,top:f,right:u+l,bottom:f+d,left:u}}const Od={ignoreTransform:!1};function vt(e,t){t===void 0&&(t=Od);let n=e.getBoundingClientRect();if(t.ignoreTransform){const{transform:f,transformOrigin:l}=ye(e).getComputedStyle(e);f&&(n=Td(n,f,l))}const{top:o,left:r,width:s,height:i,bottom:a,right:u}=n;return{top:o,left:r,width:s,height:i,bottom:a,right:u}}function Cr(e){return vt(e,{ignoreTransform:!0})}function zd(e){const t=e.innerWidth,n=e.innerHeight;return{top:0,left:0,right:t,bottom:n,width:t,height:n}}function Hd(e,t){return t===void 0&&(t=ye(e).getComputedStyle(e)),t.position==="fixed"}function Bd(e,t){t===void 0&&(t=ye(e).getComputedStyle(e));const n=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(r=>{const s=t[r];return typeof s=="string"?n.test(s):!1})}function vo(e,t){const n=[];function o(r){if(t!=null&&n.length>=t||!r)return n;if(mo(r)&&r.scrollingElement!=null&&!n.includes(r.scrollingElement))return n.push(r.scrollingElement),n;if(!Ht(r)||oi(r)||n.includes(r))return n;const s=ye(e).getComputedStyle(r);return r!==e&&Bd(r,s)&&n.push(r),Hd(r,s)?n:o(r.parentNode)}return e?o(e):n}function ai(e){const[t]=vo(e,1);return t??null}function Yn(e){return!wn||!e?null:yt(e)?e:po(e)?mo(e)||e===xt(e).scrollingElement?window:Ht(e)?e:null:null}function ci(e){return yt(e)?e.scrollX:e.scrollLeft}function li(e){return yt(e)?e.scrollY:e.scrollTop}function to(e){return{x:ci(e),y:li(e)}}var de;(function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"})(de||(de={}));function ui(e){return!wn||!e?!1:e===document.scrollingElement}function di(e){const t={x:0,y:0},n=ui(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},o={x:e.scrollWidth-n.width,y:e.scrollHeight-n.height},r=e.scrollTop<=t.y,s=e.scrollLeft<=t.x,i=e.scrollTop>=o.y,a=e.scrollLeft>=o.x;return{isTop:r,isLeft:s,isBottom:i,isRight:a,maxScroll:o,minScroll:t}}const Fd={x:.2,y:.2};function Vd(e,t,n,o,r){let{top:s,left:i,right:a,bottom:u}=n;o===void 0&&(o=10),r===void 0&&(r=Fd);const{isTop:f,isBottom:l,isLeft:d,isRight:c}=di(e),g={x:0,y:0},y={x:0,y:0},p={height:t.height*r.y,width:t.width*r.x};return!f&&s<=t.top+p.height?(g.y=de.Backward,y.y=o*Math.abs((t.top+p.height-s)/p.height)):!l&&u>=t.bottom-p.height&&(g.y=de.Forward,y.y=o*Math.abs((t.bottom-p.height-u)/p.height)),!c&&a>=t.right-p.width?(g.x=de.Forward,y.x=o*Math.abs((t.right-p.width-a)/p.width)):!d&&i<=t.left+p.width&&(g.x=de.Backward,y.x=o*Math.abs((t.left+p.width-i)/p.width)),{direction:g,speed:y}}function Yd(e){if(e===document.scrollingElement){const{innerWidth:s,innerHeight:i}=window;return{top:0,left:0,right:s,bottom:i,width:s,height:i}}const{top:t,left:n,right:o,bottom:r}=e.getBoundingClientRect();return{top:t,left:n,right:o,bottom:r,width:e.clientWidth,height:e.clientHeight}}function fi(e){return e.reduce((t,n)=>ut(t,to(n)),De)}function Xd(e){return e.reduce((t,n)=>t+ci(n),0)}function Wd(e){return e.reduce((t,n)=>t+li(n),0)}function Ud(e,t){if(t===void 0&&(t=vt),!e)return;const{top:n,left:o,bottom:r,right:s}=t(e);ai(e)&&(r<=0||s<=0||n>=window.innerHeight||o>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}const Gd=[["x",["left","right"],Xd],["y",["top","bottom"],Wd]];class bo{constructor(t,n){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const o=vo(n),r=fi(o);this.rect={...t},this.width=t.width,this.height=t.height;for(const[s,i,a]of Gd)for(const u of i)Object.defineProperty(this,u,{get:()=>{const f=a(o),l=r[s]-f;return this.rect[u]+l},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Mt{constructor(t){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(n=>{var o;return(o=this.target)==null?void 0:o.removeEventListener(...n)})},this.target=t}add(t,n,o){var r;(r=this.target)==null||r.addEventListener(t,n,o),this.listeners.push([t,n,o])}}function qd(e){const{EventTarget:t}=ye(e);return e instanceof t?e:xt(e)}function Xn(e,t){const n=Math.abs(e.x),o=Math.abs(e.y);return typeof t=="number"?Math.sqrt(n**2+o**2)>t:"x"in t&&"y"in t?n>t.x&&o>t.y:"x"in t?n>t.x:"y"in t?o>t.y:!1}var Ce;(function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"})(Ce||(Ce={}));function Er(e){e.preventDefault()}function Kd(e){e.stopPropagation()}var ne;(function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"})(ne||(ne={}));const gi={start:[ne.Space,ne.Enter],cancel:[ne.Esc],end:[ne.Space,ne.Enter,ne.Tab]},Zd=(e,t)=>{let{currentCoordinates:n}=t;switch(e.code){case ne.Right:return{...n,x:n.x+25};case ne.Left:return{...n,x:n.x-25};case ne.Down:return{...n,y:n.y+25};case ne.Up:return{...n,y:n.y-25}}};class hi{constructor(t){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=t;const{event:{target:n}}=t;this.props=t,this.listeners=new Mt(xt(n)),this.windowListeners=new Mt(ye(n)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Ce.Resize,this.handleCancel),this.windowListeners.add(Ce.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Ce.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:t,onStart:n}=this.props,o=t.node.current;o&&Ud(o),n(De)}handleKeyDown(t){if(xo(t)){const{active:n,context:o,options:r}=this.props,{keyboardCodes:s=gi,coordinateGetter:i=Zd,scrollBehavior:a="smooth"}=r,{code:u}=t;if(s.end.includes(u)){this.handleEnd(t);return}if(s.cancel.includes(u)){this.handleCancel(t);return}const{collisionRect:f}=o.current,l=f?{x:f.left,y:f.top}:De;this.referenceCoordinates||(this.referenceCoordinates=l);const d=i(t,{active:n,context:o.current,currentCoordinates:l});if(d){const c=cn(d,l),g={x:0,y:0},{scrollableAncestors:y}=o.current;for(const p of y){const x=t.code,{isTop:b,isRight:C,isLeft:h,isBottom:w,maxScroll:S,minScroll:E}=di(p),N=Yd(p),M={x:Math.min(x===ne.Right?N.right-N.width/2:N.right,Math.max(x===ne.Right?N.left:N.left+N.width/2,d.x)),y:Math.min(x===ne.Down?N.bottom-N.height/2:N.bottom,Math.max(x===ne.Down?N.top:N.top+N.height/2,d.y))},A=x===ne.Right&&!C||x===ne.Left&&!h,$=x===ne.Down&&!w||x===ne.Up&&!b;if(A&&M.x!==d.x){const D=p.scrollLeft+c.x,k=x===ne.Right&&D<=S.x||x===ne.Left&&D>=E.x;if(k&&!c.y){p.scrollTo({left:D,behavior:a});return}k?g.x=p.scrollLeft-D:g.x=x===ne.Right?p.scrollLeft-S.x:p.scrollLeft-E.x,g.x&&p.scrollBy({left:-g.x,behavior:a});break}else if($&&M.y!==d.y){const D=p.scrollTop+c.y,k=x===ne.Down&&D<=S.y||x===ne.Up&&D>=E.y;if(k&&!c.x){p.scrollTo({top:D,behavior:a});return}k?g.y=p.scrollTop-D:g.y=x===ne.Down?p.scrollTop-S.y:p.scrollTop-E.y,g.y&&p.scrollBy({top:-g.y,behavior:a});break}}this.handleMove(t,ut(cn(d,this.referenceCoordinates),g))}}}handleMove(t,n){const{onMove:o}=this.props;t.preventDefault(),o(n)}handleEnd(t){const{onEnd:n}=this.props;t.preventDefault(),this.detach(),n()}handleCancel(t){const{onCancel:n}=this.props;t.preventDefault(),this.detach(),n()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}hi.activators=[{eventName:"onKeyDown",handler:(e,t,n)=>{let{keyboardCodes:o=gi,onActivation:r}=t,{active:s}=n;const{code:i}=e.nativeEvent;if(o.start.includes(i)){const a=s.activatorNode.current;return a&&e.target!==a?!1:(e.preventDefault(),r==null||r({event:e.nativeEvent}),!0)}return!1}}];function Mr(e){return!!(e&&"distance"in e)}function Nr(e){return!!(e&&"delay"in e)}class wo{constructor(t,n,o){var r;o===void 0&&(o=qd(t.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=t,this.events=n;const{event:s}=t,{target:i}=s;this.props=t,this.events=n,this.document=xt(i),this.documentListeners=new Mt(this.document),this.listeners=new Mt(o),this.windowListeners=new Mt(ye(i)),this.initialCoordinates=(r=eo(s))!=null?r:De,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:t,props:{options:{activationConstraint:n,bypassActivationConstraint:o}}}=this;if(this.listeners.add(t.move.name,this.handleMove,{passive:!1}),this.listeners.add(t.end.name,this.handleEnd),t.cancel&&this.listeners.add(t.cancel.name,this.handleCancel),this.windowListeners.add(Ce.Resize,this.handleCancel),this.windowListeners.add(Ce.DragStart,Er),this.windowListeners.add(Ce.VisibilityChange,this.handleCancel),this.windowListeners.add(Ce.ContextMenu,Er),this.documentListeners.add(Ce.Keydown,this.handleKeydown),n){if(o!=null&&o({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(Nr(n)){this.timeoutId=setTimeout(this.handleStart,n.delay),this.handlePending(n);return}if(Mr(n)){this.handlePending(n);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(t,n){const{active:o,onPending:r}=this.props;r(o,t,this.initialCoordinates,n)}handleStart(){const{initialCoordinates:t}=this,{onStart:n}=this.props;t&&(this.activated=!0,this.documentListeners.add(Ce.Click,Kd,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Ce.SelectionChange,this.removeTextSelection),n(t))}handleMove(t){var n;const{activated:o,initialCoordinates:r,props:s}=this,{onMove:i,options:{activationConstraint:a}}=s;if(!r)return;const u=(n=eo(t))!=null?n:De,f=cn(r,u);if(!o&&a){if(Mr(a)){if(a.tolerance!=null&&Xn(f,a.tolerance))return this.handleCancel();if(Xn(f,a.distance))return this.handleStart()}if(Nr(a)&&Xn(f,a.tolerance))return this.handleCancel();this.handlePending(a,f);return}t.cancelable&&t.preventDefault(),i(u)}handleEnd(){const{onAbort:t,onEnd:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleCancel(){const{onAbort:t,onCancel:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleKeydown(t){t.code===ne.Esc&&this.handleCancel()}removeTextSelection(){var t;(t=this.document.getSelection())==null||t.removeAllRanges()}}const Jd={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class So extends wo{constructor(t){const{event:n}=t,o=xt(n.target);super(t,Jd,o)}}So.activators=[{eventName:"onPointerDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:o}=t;return!n.isPrimary||n.button!==0?!1:(o==null||o({event:n}),!0)}}];const Qd={move:{name:"mousemove"},end:{name:"mouseup"}};var no;(function(e){e[e.RightClick=2]="RightClick"})(no||(no={}));class ef extends wo{constructor(t){super(t,Qd,xt(t.event.target))}}ef.activators=[{eventName:"onMouseDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:o}=t;return n.button===no.RightClick?!1:(o==null||o({event:n}),!0)}}];const Wn={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class tf extends wo{constructor(t){super(t,Wn)}static setup(){return window.addEventListener(Wn.move.name,t,{capture:!1,passive:!1}),function(){window.removeEventListener(Wn.move.name,t)};function t(){}}}tf.activators=[{eventName:"onTouchStart",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:o}=t;const{touches:r}=n;return r.length>1?!1:(o==null||o({event:n}),!0)}}];var Nt;(function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"})(Nt||(Nt={}));var un;(function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"})(un||(un={}));function nf(e){let{acceleration:t,activator:n=Nt.Pointer,canScroll:o,draggingRect:r,enabled:s,interval:i=5,order:a=un.TreeOrder,pointerCoordinates:u,scrollableAncestors:f,scrollableAncestorRects:l,delta:d,threshold:c}=e;const g=rf({delta:d,disabled:!s}),[y,p]=hd(),x=v.useRef({x:0,y:0}),b=v.useRef({x:0,y:0}),C=v.useMemo(()=>{switch(n){case Nt.Pointer:return u?{top:u.y,bottom:u.y,left:u.x,right:u.x}:null;case Nt.DraggableRect:return r}},[n,r,u]),h=v.useRef(null),w=v.useCallback(()=>{const E=h.current;if(!E)return;const N=x.current.x*b.current.x,M=x.current.y*b.current.y;E.scrollBy(N,M)},[]),S=v.useMemo(()=>a===un.TreeOrder?[...f].reverse():f,[a,f]);v.useEffect(()=>{if(!s||!f.length||!C){p();return}for(const E of S){if((o==null?void 0:o(E))===!1)continue;const N=f.indexOf(E),M=l[N];if(!M)continue;const{direction:A,speed:$}=Vd(E,M,C,t,c);for(const D of["x","y"])g[D][A[D]]||($[D]=0,A[D]=0);if($.x>0||$.y>0){p(),h.current=E,y(w,i),x.current=$,b.current=A;return}}x.current={x:0,y:0},b.current={x:0,y:0},p()},[t,w,o,p,s,i,JSON.stringify(C),JSON.stringify(g),y,f,S,l,JSON.stringify(c)])}const of={x:{[de.Backward]:!1,[de.Forward]:!1},y:{[de.Backward]:!1,[de.Forward]:!1}};function rf(e){let{delta:t,disabled:n}=e;const o=Qn(t);return Bt(r=>{if(n||!o||!r)return of;const s={x:Math.sign(t.x-o.x),y:Math.sign(t.y-o.y)};return{x:{[de.Backward]:r.x[de.Backward]||s.x===-1,[de.Forward]:r.x[de.Forward]||s.x===1},y:{[de.Backward]:r.y[de.Backward]||s.y===-1,[de.Forward]:r.y[de.Forward]||s.y===1}}},[n,t,o])}function sf(e,t){const n=t!=null?e.get(t):void 0,o=n?n.node.current:null;return Bt(r=>{var s;return t==null?null:(s=o??r)!=null?s:null},[o,t])}function af(e,t){return v.useMemo(()=>e.reduce((n,o)=>{const{sensor:r}=o,s=r.activators.map(i=>({eventName:i.eventName,handler:t(i.handler,o)}));return[...n,...s]},[]),[e,t])}var Lt;(function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"})(Lt||(Lt={}));var oo;(function(e){e.Optimized="optimized"})(oo||(oo={}));const Dr=new Map;function cf(e,t){let{dragging:n,dependencies:o,config:r}=t;const[s,i]=v.useState(null),{frequency:a,measure:u,strategy:f}=r,l=v.useRef(e),d=x(),c=_t(d),g=v.useCallback(function(b){b===void 0&&(b=[]),!c.current&&i(C=>C===null?b:C.concat(b.filter(h=>!C.includes(h))))},[c]),y=v.useRef(null),p=Bt(b=>{if(d&&!n)return Dr;if(!b||b===Dr||l.current!==e||s!=null){const C=new Map;for(let h of e){if(!h)continue;if(s&&s.length>0&&!s.includes(h.id)&&h.rect.current){C.set(h.id,h.rect.current);continue}const w=h.node.current,S=w?new bo(u(w),w):null;h.rect.current=S,S&&C.set(h.id,S)}return C}return b},[e,s,n,d,u]);return v.useEffect(()=>{l.current=e},[e]),v.useEffect(()=>{d||g()},[n,d]),v.useEffect(()=>{s&&s.length>0&&i(null)},[JSON.stringify(s)]),v.useEffect(()=>{d||typeof a!="number"||y.current!==null||(y.current=setTimeout(()=>{g(),y.current=null},a))},[a,d,g,...o]),{droppableRects:p,measureDroppableContainers:g,measuringScheduled:s!=null};function x(){switch(f){case Lt.Always:return!1;case Lt.BeforeDragging:return n;default:return!n}}}function pi(e,t){return Bt(n=>e?n||(typeof t=="function"?t(e):e):null,[t,e])}function lf(e,t){return pi(e,t)}function uf(e){let{callback:t,disabled:n}=e;const o=yo(t),r=v.useMemo(()=>{if(n||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:s}=window;return new s(o)},[o,n]);return v.useEffect(()=>()=>r==null?void 0:r.disconnect(),[r]),r}function Sn(e){let{callback:t,disabled:n}=e;const o=yo(t),r=v.useMemo(()=>{if(n||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:s}=window;return new s(o)},[n]);return v.useEffect(()=>()=>r==null?void 0:r.disconnect(),[r]),r}function df(e){return new bo(vt(e),e)}function Ir(e,t,n){t===void 0&&(t=df);const[o,r]=v.useState(null);function s(){r(u=>{if(!e)return null;if(e.isConnected===!1){var f;return(f=u??n)!=null?f:null}const l=t(e);return JSON.stringify(u)===JSON.stringify(l)?u:l})}const i=uf({callback(u){if(e)for(const f of u){const{type:l,target:d}=f;if(l==="childList"&&d instanceof HTMLElement&&d.contains(e)){s();break}}}}),a=Sn({callback:s});return _e(()=>{s(),e?(a==null||a.observe(e),i==null||i.observe(document.body,{childList:!0,subtree:!0})):(a==null||a.disconnect(),i==null||i.disconnect())},[e]),o}function ff(e){const t=pi(e);return ii(e,t)}const kr=[];function gf(e){const t=v.useRef(e),n=Bt(o=>e?o&&o!==kr&&e&&t.current&&e.parentNode===t.current.parentNode?o:vo(e):kr,[e]);return v.useEffect(()=>{t.current=e},[e]),n}function hf(e){const[t,n]=v.useState(null),o=v.useRef(e),r=v.useCallback(s=>{const i=Yn(s.target);i&&n(a=>a?(a.set(i,to(i)),new Map(a)):null)},[]);return v.useEffect(()=>{const s=o.current;if(e!==s){i(s);const a=e.map(u=>{const f=Yn(u);return f?(f.addEventListener("scroll",r,{passive:!0}),[f,to(f)]):null}).filter(u=>u!=null);n(a.length?new Map(a):null),o.current=e}return()=>{i(e),i(s)};function i(a){a.forEach(u=>{const f=Yn(u);f==null||f.removeEventListener("scroll",r)})}},[r,e]),v.useMemo(()=>e.length?t?Array.from(t.values()).reduce((s,i)=>ut(s,i),De):fi(e):De,[e,t])}function Ar(e,t){t===void 0&&(t=[]);const n=v.useRef(null);return v.useEffect(()=>{n.current=null},t),v.useEffect(()=>{const o=e!==De;o&&!n.current&&(n.current=e),!o&&n.current&&(n.current=null)},[e]),n.current?cn(e,n.current):De}function pf(e){v.useEffect(()=>{if(!wn)return;const t=e.map(n=>{let{sensor:o}=n;return o.setup==null?void 0:o.setup()});return()=>{for(const n of t)n==null||n()}},e.map(t=>{let{sensor:n}=t;return n}))}function mf(e,t){return v.useMemo(()=>e.reduce((n,o)=>{let{eventName:r,handler:s}=o;return n[r]=i=>{s(i,t)},n},{}),[e,t])}function mi(e){return v.useMemo(()=>e?zd(e):null,[e])}const Rr=[];function yf(e,t){t===void 0&&(t=vt);const[n]=e,o=mi(n?ye(n):null),[r,s]=v.useState(Rr);function i(){s(()=>e.length?e.map(u=>ui(u)?o:new bo(t(u),u)):Rr)}const a=Sn({callback:i});return _e(()=>{a==null||a.disconnect(),i(),e.forEach(u=>a==null?void 0:a.observe(u))},[e]),r}function xf(e){if(!e)return null;if(e.children.length>1)return e;const t=e.children[0];return Ht(t)?t:e}function vf(e){let{measure:t}=e;const[n,o]=v.useState(null),r=v.useCallback(f=>{for(const{target:l}of f)if(Ht(l)){o(d=>{const c=t(l);return d?{...d,width:c.width,height:c.height}:c});break}},[t]),s=Sn({callback:r}),i=v.useCallback(f=>{const l=xf(f);s==null||s.disconnect(),l&&(s==null||s.observe(l)),o(l?t(l):null)},[t,s]),[a,u]=an(i);return v.useMemo(()=>({nodeRef:a,rect:n,setRef:u}),[n,a,u])}const bf=[{sensor:So,options:{}},{sensor:hi,options:{}}],wf={current:{}},Qt={draggable:{measure:Cr},droppable:{measure:Cr,strategy:Lt.WhileDragging,frequency:oo.Optimized},dragOverlay:{measure:vt}};class Dt extends Map{get(t){var n;return t!=null&&(n=super.get(t))!=null?n:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(t=>{let{disabled:n}=t;return!n})}getNodeFor(t){var n,o;return(n=(o=this.get(t))==null?void 0:o.node.current)!=null?n:void 0}}const Sf={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new Dt,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:ln},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:Qt,measureDroppableContainers:ln,windowRect:null,measuringScheduled:!1},Cf={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:ln,draggableNodes:new Map,over:null,measureDroppableContainers:ln},Cn=v.createContext(Cf),yi=v.createContext(Sf);function Ef(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new Dt}}}function Mf(e,t){switch(t.type){case ce.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case ce.DragMove:return e.draggable.active==null?e:{...e,draggable:{...e.draggable,translate:{x:t.coordinates.x-e.draggable.initialCoordinates.x,y:t.coordinates.y-e.draggable.initialCoordinates.y}}};case ce.DragEnd:case ce.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case ce.RegisterDroppable:{const{element:n}=t,{id:o}=n,r=new Dt(e.droppable.containers);return r.set(o,n),{...e,droppable:{...e.droppable,containers:r}}}case ce.SetDroppableDisabled:{const{id:n,key:o,disabled:r}=t,s=e.droppable.containers.get(n);if(!s||o!==s.key)return e;const i=new Dt(e.droppable.containers);return i.set(n,{...s,disabled:r}),{...e,droppable:{...e.droppable,containers:i}}}case ce.UnregisterDroppable:{const{id:n,key:o}=t,r=e.droppable.containers.get(n);if(!r||o!==r.key)return e;const s=new Dt(e.droppable.containers);return s.delete(n),{...e,droppable:{...e.droppable,containers:s}}}default:return e}}function Nf(e){let{disabled:t}=e;const{active:n,activatorEvent:o,draggableNodes:r}=v.useContext(Cn),s=Qn(o),i=Qn(n==null?void 0:n.id);return v.useEffect(()=>{if(!t&&!o&&s&&i!=null){if(!xo(s)||document.activeElement===s.target)return;const a=r.get(i);if(!a)return;const{activatorNode:u,node:f}=a;if(!u.current&&!f.current)return;requestAnimationFrame(()=>{for(const l of[u.current,f.current]){if(!l)continue;const d=yd(l);if(d){d.focus();break}}})}},[o,t,r,i,s]),null}function Df(e,t){let{transform:n,...o}=t;return e!=null&&e.length?e.reduce((r,s)=>s({transform:r,...o}),n):n}function If(e){return v.useMemo(()=>({draggable:{...Qt.draggable,...e==null?void 0:e.draggable},droppable:{...Qt.droppable,...e==null?void 0:e.droppable},dragOverlay:{...Qt.dragOverlay,...e==null?void 0:e.dragOverlay}}),[e==null?void 0:e.draggable,e==null?void 0:e.droppable,e==null?void 0:e.dragOverlay])}function kf(e){let{activeNode:t,measure:n,initialRect:o,config:r=!0}=e;const s=v.useRef(!1),{x:i,y:a}=typeof r=="boolean"?{x:r,y:r}:r;_e(()=>{if(!i&&!a||!t){s.current=!1;return}if(s.current||!o)return;const f=t==null?void 0:t.node.current;if(!f||f.isConnected===!1)return;const l=n(f),d=ii(l,o);if(i||(d.x=0),a||(d.y=0),s.current=!0,Math.abs(d.x)>0||Math.abs(d.y)>0){const c=ai(f);c&&c.scrollBy({top:d.y,left:d.x})}},[t,i,a,o,n])}const xi=v.createContext({...De,scaleX:1,scaleY:1});var Ue;(function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"})(Ue||(Ue={}));const Af=v.memo(function(t){var n,o,r,s;let{id:i,accessibility:a,autoScroll:u=!0,children:f,sensors:l=bf,collisionDetection:d=jd,measuring:c,modifiers:g,...y}=t;const p=v.useReducer(Mf,void 0,Ef),[x,b]=p,[C,h]=Cd(),[w,S]=v.useState(Ue.Uninitialized),E=w===Ue.Initialized,{draggable:{active:N,nodes:M,translate:A},droppable:{containers:$}}=x,D=N!=null?M.get(N):null,k=v.useRef({initial:null,translated:null}),R=v.useMemo(()=>{var ue;return N!=null?{id:N,data:(ue=D==null?void 0:D.data)!=null?ue:wf,rect:k}:null},[N,D]),P=v.useRef(null),[_,L]=v.useState(null),[j,z]=v.useState(null),I=_t(y,Object.values(y)),T=Ft("DndDescribedBy",i),O=v.useMemo(()=>$.getEnabled(),[$]),H=If(c),{droppableRects:V,measureDroppableContainers:W,measuringScheduled:Z}=cf(O,{dragging:E,dependencies:[A.x,A.y],config:H.droppable}),G=sf(M,N),J=v.useMemo(()=>j?eo(j):null,[j]),B=kn(),q=lf(G,H.draggable.measure);kf({activeNode:N!=null?M.get(N):null,config:B.layoutShiftCompensation,initialRect:q,measure:H.draggable.measure});const F=Ir(G,H.draggable.measure,q),Q=Ir(G?G.parentElement:null),Y=v.useRef({activatorEvent:null,active:null,activeNode:G,collisionRect:null,collisions:null,droppableRects:V,draggableNodes:M,draggingNode:null,draggingNodeRect:null,droppableContainers:$,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),K=$.getNodeFor((n=Y.current.over)==null?void 0:n.id),U=vf({measure:H.dragOverlay.measure}),te=(o=U.nodeRef.current)!=null?o:G,oe=E?(r=U.rect)!=null?r:F:null,ve=!!(U.nodeRef.current&&U.rect),$e=ff(ve?null:F),Be=mi(te?ye(te):null),xe=gf(E?K??G:null),Le=yf(xe),Ie=Df(g,{transform:{x:A.x-$e.x,y:A.y-$e.y,scaleX:1,scaleY:1},activatorEvent:j,active:R,activeNodeRect:F,containerNodeRect:Q,draggingNodeRect:oe,over:Y.current.over,overlayNodeRect:U.rect,scrollableAncestors:xe,scrollableAncestorRects:Le,windowRect:Be}),Fe=J?ut(J,A):null,rt=hf(xe),st=Ar(rt),Ve=Ar(rt,[F]),be=ut(Ie,st),Te=oe?$d(oe,Ie):null,Ze=R&&Te?d({active:R,collisionRect:Te,droppableRects:V,droppableContainers:O,pointerCoordinates:Fe}):null,it=Ad(Ze,"id"),[ke,Vt]=v.useState(null),En=ve?Ie:ut(Ie,Ve),Mn=Pd(En,(s=ke==null?void 0:ke.rect)!=null?s:null,F),bt=v.useRef(null),Yt=v.useCallback((ue,ge)=>{let{sensor:he,options:Ee}=ge;if(P.current==null)return;const me=M.get(P.current);if(!me)return;const pe=ue.nativeEvent,we=new he({active:P.current,activeNode:me,event:pe,options:Ee,context:Y,onAbort(ae){if(!M.get(ae))return;const{onDragAbort:Se}=I.current,Me={id:ae};Se==null||Se(Me),C({type:"onDragAbort",event:Me})},onPending(ae,Ae,Se,Me){if(!M.get(ae))return;const{onDragPending:Qe}=I.current,Re={id:ae,constraint:Ae,initialCoordinates:Se,offset:Me};Qe==null||Qe(Re),C({type:"onDragPending",event:Re})},onStart(ae){const Ae=P.current;if(Ae==null)return;const Se=M.get(Ae);if(!Se)return;const{onDragStart:Me}=I.current,Je={activatorEvent:pe,active:{id:Ae,data:Se.data,rect:k}};St.unstable_batchedUpdates(()=>{Me==null||Me(Je),S(Ue.Initializing),b({type:ce.DragStart,initialCoordinates:ae,active:Ae}),C({type:"onDragStart",event:Je}),L(bt.current),z(pe)})},onMove(ae){b({type:ce.DragMove,coordinates:ae})},onEnd:Ye(ce.DragEnd),onCancel:Ye(ce.DragCancel)});bt.current=we;function Ye(ae){return async function(){const{active:Se,collisions:Me,over:Je,scrollAdjustedTranslate:Qe}=Y.current;let Re=null;if(Se&&Qe){const{cancelDrop:et}=I.current;Re={activatorEvent:pe,active:Se,collisions:Me,delta:Qe,over:Je},ae===ce.DragEnd&&typeof et=="function"&&await Promise.resolve(et(Re))&&(ae=ce.DragCancel)}P.current=null,St.unstable_batchedUpdates(()=>{b({type:ae}),S(Ue.Uninitialized),Vt(null),L(null),z(null),bt.current=null;const et=ae===ce.DragEnd?"onDragEnd":"onDragCancel";if(Re){const wt=I.current[et];wt==null||wt(Re),C({type:et,event:Re})}})}}},[M]),Nn=v.useCallback((ue,ge)=>(he,Ee)=>{const me=he.nativeEvent,pe=M.get(Ee);if(P.current!==null||!pe||me.dndKit||me.defaultPrevented)return;const we={active:pe};ue(he,ge.options,we)===!0&&(me.dndKit={capturedBy:ge.sensor},P.current=Ee,Yt(he,ge))},[M,Yt]),Xt=af(l,Nn);pf(l),_e(()=>{F&&w===Ue.Initializing&&S(Ue.Initialized)},[F,w]),v.useEffect(()=>{const{onDragMove:ue}=I.current,{active:ge,activatorEvent:he,collisions:Ee,over:me}=Y.current;if(!ge||!he)return;const pe={active:ge,activatorEvent:he,collisions:Ee,delta:{x:be.x,y:be.y},over:me};St.unstable_batchedUpdates(()=>{ue==null||ue(pe),C({type:"onDragMove",event:pe})})},[be.x,be.y]),v.useEffect(()=>{const{active:ue,activatorEvent:ge,collisions:he,droppableContainers:Ee,scrollAdjustedTranslate:me}=Y.current;if(!ue||P.current==null||!ge||!me)return;const{onDragOver:pe}=I.current,we=Ee.get(it),Ye=we&&we.rect.current?{id:we.id,rect:we.rect.current,data:we.data,disabled:we.disabled}:null,ae={active:ue,activatorEvent:ge,collisions:he,delta:{x:me.x,y:me.y},over:Ye};St.unstable_batchedUpdates(()=>{Vt(Ye),pe==null||pe(ae),C({type:"onDragOver",event:ae})})},[it]),_e(()=>{Y.current={activatorEvent:j,active:R,activeNode:G,collisionRect:Te,collisions:Ze,droppableRects:V,draggableNodes:M,draggingNode:te,draggingNodeRect:oe,droppableContainers:$,over:ke,scrollableAncestors:xe,scrollAdjustedTranslate:be},k.current={initial:oe,translated:Te}},[R,G,Ze,Te,M,te,oe,V,$,ke,xe,be]),nf({...B,delta:A,draggingRect:Te,pointerCoordinates:Fe,scrollableAncestors:xe,scrollableAncestorRects:Le});const Dn=v.useMemo(()=>({active:R,activeNode:G,activeNodeRect:F,activatorEvent:j,collisions:Ze,containerNodeRect:Q,dragOverlay:U,draggableNodes:M,droppableContainers:$,droppableRects:V,over:ke,measureDroppableContainers:W,scrollableAncestors:xe,scrollableAncestorRects:Le,measuringConfiguration:H,measuringScheduled:Z,windowRect:Be}),[R,G,F,j,Ze,Q,U,M,$,V,ke,W,xe,Le,H,Z,Be]),In=v.useMemo(()=>({activatorEvent:j,activators:Xt,active:R,activeNodeRect:F,ariaDescribedById:{draggable:T},dispatch:b,draggableNodes:M,over:ke,measureDroppableContainers:W}),[j,Xt,R,F,b,T,M,ke,W]);return fe.createElement(si.Provider,{value:h},fe.createElement(Cn.Provider,{value:In},fe.createElement(yi.Provider,{value:Dn},fe.createElement(xi.Provider,{value:Mn},f)),fe.createElement(Nf,{disabled:(a==null?void 0:a.restoreFocus)===!1})),fe.createElement(Nd,{...a,hiddenTextDescribedById:T}));function kn(){const ue=(_==null?void 0:_.autoScrollEnabled)===!1,ge=typeof u=="object"?u.enabled===!1:u===!1,he=E&&!ue&&!ge;return typeof u=="object"?{...u,enabled:he}:{enabled:he}}}),Rf=v.createContext(null),jr="button",jf="Draggable";function Pf(e){let{id:t,data:n,disabled:o=!1,attributes:r}=e;const s=Ft(jf),{activators:i,activatorEvent:a,active:u,activeNodeRect:f,ariaDescribedById:l,draggableNodes:d,over:c}=v.useContext(Cn),{role:g=jr,roleDescription:y="draggable",tabIndex:p=0}=r??{},x=(u==null?void 0:u.id)===t,b=v.useContext(x?xi:Rf),[C,h]=an(),[w,S]=an(),E=mf(i,t),N=_t(n);_e(()=>(d.set(t,{id:t,key:s,node:C,activatorNode:w,data:N}),()=>{const A=d.get(t);A&&A.key===s&&d.delete(t)}),[d,t]);const M=v.useMemo(()=>({role:g,tabIndex:p,"aria-disabled":o,"aria-pressed":x&&g===jr?!0:void 0,"aria-roledescription":y,"aria-describedby":l.draggable}),[o,g,p,x,y,l.draggable]);return{active:u,activatorEvent:a,activeNodeRect:f,attributes:M,isDragging:x,listeners:o?void 0:E,node:C,over:c,setNodeRef:h,setActivatorNodeRef:S,transform:b}}function _f(){return v.useContext(yi)}const $f="Droppable",Lf={timeout:25};function Tf(e){let{data:t,disabled:n=!1,id:o,resizeObserverConfig:r}=e;const s=Ft($f),{active:i,dispatch:a,over:u,measureDroppableContainers:f}=v.useContext(Cn),l=v.useRef({disabled:n}),d=v.useRef(!1),c=v.useRef(null),g=v.useRef(null),{disabled:y,updateMeasurementsFor:p,timeout:x}={...Lf,...r},b=_t(p??o),C=v.useCallback(()=>{if(!d.current){d.current=!0;return}g.current!=null&&clearTimeout(g.current),g.current=setTimeout(()=>{f(Array.isArray(b.current)?b.current:[b.current]),g.current=null},x)},[x]),h=Sn({callback:C,disabled:y||!i}),w=v.useCallback((M,A)=>{h&&(A&&(h.unobserve(A),d.current=!1),M&&h.observe(M))},[h]),[S,E]=an(w),N=_t(t);return v.useEffect(()=>{!h||!S.current||(h.disconnect(),d.current=!1,h.observe(S.current))},[S,h]),v.useEffect(()=>(a({type:ce.RegisterDroppable,element:{id:o,key:s,disabled:n,node:S,rect:c,data:N}}),()=>a({type:ce.UnregisterDroppable,key:s,id:o})),[o]),v.useEffect(()=>{n!==l.current.disabled&&(a({type:ce.SetDroppableDisabled,id:o,key:s,disabled:n}),l.current.disabled=n)},[o,s,n,a]),{active:i,rect:c,isOver:(u==null?void 0:u.id)===o,node:S,over:u,setNodeRef:E}}const Of=e=>{let{transform:t}=e;return{...t,x:0}};function Co(e,t,n){const o=e.slice();return o.splice(n<0?o.length+n:n,0,o.splice(t,1)[0]),o}function zf(e,t){return e.reduce((n,o,r)=>{const s=t.get(o);return s&&(n[r]=s),n},Array(e.length))}function Zt(e){return e!==null&&e>=0}function Hf(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Bf(e){return typeof e=="boolean"?{draggable:e,droppable:e}:e}const vi=e=>{let{rects:t,activeIndex:n,overIndex:o,index:r}=e;const s=Co(t,o,n),i=t[r],a=s[r];return!a||!i?null:{x:a.left-i.left,y:a.top-i.top,scaleX:a.width/i.width,scaleY:a.height/i.height}},Jt={scaleX:1,scaleY:1},Ff=e=>{var t;let{activeIndex:n,activeNodeRect:o,index:r,rects:s,overIndex:i}=e;const a=(t=s[n])!=null?t:o;if(!a)return null;if(r===n){const f=s[i];return f?{x:0,y:n<i?f.top+f.height-(a.top+a.height):f.top-a.top,...Jt}:null}const u=Vf(s,r,n);return r>n&&r<=i?{x:0,y:-a.height-u,...Jt}:r<n&&r>=i?{x:0,y:a.height+u,...Jt}:{x:0,y:0,...Jt}};function Vf(e,t,n){const o=e[t],r=e[t-1],s=e[t+1];return o?n<t?r?o.top-(r.top+r.height):s?s.top-(o.top+o.height):0:s?s.top-(o.top+o.height):r?o.top-(r.top+r.height):0:0}const bi="Sortable",wi=fe.createContext({activeIndex:-1,containerId:bi,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:vi,disabled:{draggable:!1,droppable:!1}});function Yf(e){let{children:t,id:n,items:o,strategy:r=vi,disabled:s=!1}=e;const{active:i,dragOverlay:a,droppableRects:u,over:f,measureDroppableContainers:l}=_f(),d=Ft(bi,n),c=a.rect!==null,g=v.useMemo(()=>o.map(E=>typeof E=="object"&&"id"in E?E.id:E),[o]),y=i!=null,p=i?g.indexOf(i.id):-1,x=f?g.indexOf(f.id):-1,b=v.useRef(g),C=!Hf(g,b.current),h=x!==-1&&p===-1||C,w=Bf(s);_e(()=>{C&&y&&l(g)},[C,g,y,l]),v.useEffect(()=>{b.current=g},[g]);const S=v.useMemo(()=>({activeIndex:p,containerId:d,disabled:w,disableTransforms:h,items:g,overIndex:x,useDragOverlay:c,sortedRects:zf(g,u),strategy:r}),[p,d,w.draggable,w.droppable,h,g,x,u,c,r]);return fe.createElement(wi.Provider,{value:S},t)}const Xf=e=>{let{id:t,items:n,activeIndex:o,overIndex:r}=e;return Co(n,o,r).indexOf(t)},Wf=e=>{let{containerId:t,isSorting:n,wasDragging:o,index:r,items:s,newIndex:i,previousItems:a,previousContainerId:u,transition:f}=e;return!f||!o||a!==s&&r===i?!1:n?!0:i!==r&&t===u},Uf={duration:200,easing:"ease"},Si="transform",Gf=$t.Transition.toString({property:Si,duration:0,easing:"linear"}),qf={roleDescription:"sortable"};function Kf(e){let{disabled:t,index:n,node:o,rect:r}=e;const[s,i]=v.useState(null),a=v.useRef(n);return _e(()=>{if(!t&&n!==a.current&&o.current){const u=r.current;if(u){const f=vt(o.current,{ignoreTransform:!0}),l={x:u.left-f.left,y:u.top-f.top,scaleX:u.width/f.width,scaleY:u.height/f.height};(l.x||l.y)&&i(l)}}n!==a.current&&(a.current=n)},[t,n,o,r]),v.useEffect(()=>{s&&i(null)},[s]),s}function Zf(e){let{animateLayoutChanges:t=Wf,attributes:n,disabled:o,data:r,getNewIndex:s=Xf,id:i,strategy:a,resizeObserverConfig:u,transition:f=Uf}=e;const{items:l,containerId:d,activeIndex:c,disabled:g,disableTransforms:y,sortedRects:p,overIndex:x,useDragOverlay:b,strategy:C}=v.useContext(wi),h=Jf(o,g),w=l.indexOf(i),S=v.useMemo(()=>({sortable:{containerId:d,index:w,items:l},...r}),[d,r,w,l]),E=v.useMemo(()=>l.slice(l.indexOf(i)),[l,i]),{rect:N,node:M,isOver:A,setNodeRef:$}=Tf({id:i,data:S,disabled:h.droppable,resizeObserverConfig:{updateMeasurementsFor:E,...u}}),{active:D,activatorEvent:k,activeNodeRect:R,attributes:P,setNodeRef:_,listeners:L,isDragging:j,over:z,setActivatorNodeRef:I,transform:T}=Pf({id:i,data:S,attributes:{...qf,...n},disabled:h.draggable}),O=gd($,_),H=!!D,V=H&&!y&&Zt(c)&&Zt(x),W=!b&&j,Z=W&&V?T:null,J=V?Z??(a??C)({rects:p,activeNodeRect:R,activeIndex:c,overIndex:x,index:w}):null,B=Zt(c)&&Zt(x)?s({id:i,items:l,activeIndex:c,overIndex:x}):w,q=D==null?void 0:D.id,F=v.useRef({activeId:q,items:l,newIndex:B,containerId:d}),Q=l!==F.current.items,Y=t({active:D,containerId:d,isDragging:j,isSorting:H,id:i,index:w,items:l,newIndex:F.current.newIndex,previousItems:F.current.items,previousContainerId:F.current.containerId,transition:f,wasDragging:F.current.activeId!=null}),K=Kf({disabled:!Y,index:w,node:M,rect:N});return v.useEffect(()=>{H&&F.current.newIndex!==B&&(F.current.newIndex=B),d!==F.current.containerId&&(F.current.containerId=d),l!==F.current.items&&(F.current.items=l)},[H,B,d,l]),v.useEffect(()=>{if(q===F.current.activeId)return;if(q!=null&&F.current.activeId==null){F.current.activeId=q;return}const te=setTimeout(()=>{F.current.activeId=q},50);return()=>clearTimeout(te)},[q]),{active:D,activeIndex:c,attributes:P,data:S,rect:N,index:w,newIndex:B,items:l,isOver:A,isSorting:H,isDragging:j,listeners:L,node:M,overIndex:x,over:z,setNodeRef:O,setActivatorNodeRef:I,setDroppableNodeRef:$,setDraggableNodeRef:_,transform:K??J,transition:U()};function U(){if(K||Q&&F.current.newIndex===w)return Gf;if(!(W&&!xo(k)||!f)&&(H||Y))return $t.Transition.toString({...f,property:Si})}}function Jf(e,t){var n,o;return typeof e=="boolean"?{draggable:e,droppable:!1}:{draggable:(n=e==null?void 0:e.draggable)!=null?n:t.draggable,droppable:(o=e==null?void 0:e.droppable)!=null?o:t.droppable}}ne.Down,ne.Right,ne.Up,ne.Left;const Qf=[{title:"component_name",dataIndex:"component_name",render:(e,t)=>m.jsx(Or,{placement:"right",title:m.jsx(m.Fragment,{children:m.jsxs("ul",{children:[m.jsxs("li",{children:["component_id: ",t.component_id]}),m.jsxs("li",{children:["relation_id: ",t.relation_id]})]})}),children:t.component_name})}],eg=e=>{const{attributes:t,listeners:n,setNodeRef:o,transform:r,transition:s,isDragging:i}=Zf({id:e["data-row-key"]}),a={...e.style,transform:$t.Translate.toString(r),transition:s,cursor:"move",...i?{position:"relative",zIndex:9999}:{}};return m.jsx("tr",{...e,ref:o,style:a,...t,...n})},tg=({data:e,callback:t})=>{const[n,o]=v.useState(e),{messageApi:r}=Ke(),s=Id(Dd(So,{activationConstraint:{distance:1}})),i=async()=>{const u=n.map((f,l)=>({order_index:l,relation_id:f.relation_id}));await ca(u),r.success("保存成功"),t&&t()},a=({active:u,over:f})=>{u.id!==(f==null?void 0:f.id)&&o(l=>{const d=l.findIndex(g=>g.key===u.id),c=l.findIndex(g=>g.key===(f==null?void 0:f.id));return Co(l,d,c)})};return m.jsx(Af,{sensors:s,modifiers:[Of],onDragEnd:a,children:m.jsx(Yf,{items:n.map(u=>u.key),strategy:Ff,children:m.jsx(Vr,{pagination:!1,size:"small",components:{body:{row:eg}},rowKey:"key",columns:Qf,dataSource:n,footer:()=>m.jsx(dt,{justify:"end",children:m.jsx(le,{size:"small",color:"cyan",variant:"solid",onClick:i,children:"保存"})})})})})},ng=({visible:e,onClose:t,params:n,callback:o})=>e?m.jsx(dn,{footer:null,open:e,onCancel:t,title:"更新排序",children:m.jsx(tg,{data:n.software.map(r=>({...r,key:r.component_id})),callback:o})}):null,og=({visible:e,onClose:t,params:n,callback:o})=>e?m.jsx(dn,{title:"说明",width:"50%",onCancel:t,onClose:t,open:e,footer:!1,children:m.jsx(ka,{data:n})}):null,Fg=({})=>{console.log("Pipeline");const{component_type:e,component_id:t}=ea(),[n,o]=v.useState(),r=ta(),[s,i]=v.useState(!0),[a,u]=Pr.useMessage(),f={inputFile:v.useRef(null),outputFile:v.useRef(null)},{modal:l,openModal:d,closeModal:c}=na(),{modals:g,openModals:y,closeModals:p}=oa(["modalD","metadataModal","bindSample"]),x=async()=>{let h=`/get-pipeline-v2/${t}?component_type=${e}`;e=="script"&&(h=`/get-component-parent/${t}?component_type=${e}`);let S=(await It.get(h)).data;"content"in S&&(S={...JSON.parse(S.content),...S}),S.tags&&(S.tags=JSON.parse(S.tags)),o(S),console.log(S)},C={deletePipelineRelation:async h=>{try{const w=await da(h);a.success("删除成功!"),x()}catch(w){console.log(w),a.error(`删除失败!${w.response.data.detail}`)}},openModal:d,openModals:y};return v.useEffect(()=>{x()},[]),m.jsxs("div",{style:{maxWidth:"1500px",margin:"0 auto"},children:[u,m.jsxs(dt,{style:{marginBottom:"1rem"},justify:"space-between",align:"center",gap:"small",children:[m.jsx("div",{children:n?m.jsxs(m.Fragment,{children:[m.jsxs("h2",{style:{margin:0},children:[n==null?void 0:n.component_name,m.jsx(Or,{title:n==null?void 0:n.namespace,children:m.jsxs("span",{style:{margin:"0",color:"rgba(0, 0, 0, 0.45)",fontSize:"1rem"},children:[" ",n==null?void 0:n.namespace_name]})})]}),!1,n.tags&&Array.isArray(n.tags)&&n.tags.map((h,w)=>m.jsx(Aa,{style:{marginTop:"0.5rem"},color:ia[w],children:h},w))]}):m.jsx(ra,{active:!0})}),m.jsxs(dt,{gap:"small",wrap:!0,children:[e=="pipeline"&&m.jsx(m.Fragment,{children:m.jsx(le,{size:"small",color:"cyan",variant:"solid",onClick:()=>{d("sortSoftware",{software:n.software})},children:"更新排序"})}),m.jsx(le,{size:"small",color:"cyan",variant:"solid",onClick:()=>{C.openModal("modalG",n)},children:"查看依赖"}),m.jsx(le,{size:"small",color:"cyan",variant:"solid",onClick:()=>{y("metadataModal",{...n,operatePipeline:C})},children:"metadata"}),m.jsxs(le,{size:"small",color:"cyan",variant:"solid",onClick:()=>{d("modalC",{data:n,structure:{component_type:e}})},children:["更新",e]}),m.jsx(le,{size:"small",color:"primary",variant:"solid",onClick:x,children:"刷新"}),m.jsx(le,{size:"small",color:"primary",variant:"solid",onClick:()=>r(`/${e}-card`),children:"返回"})]})]}),m.jsx(sg,{component_type:e||"",component:n,tableRef:f,operatePipeline:C}),m.jsx(La,{visible:l.key=="modalB"&&l.visible,onClose:c,callback:x,params:l.params}),m.jsx(la,{callback:x,visible:l.key=="modalA"&&l.visible,onClose:c,params:{...l.params,namespace:n==null?void 0:n.namespace}}),m.jsx(ua,{callback:x,visible:l.key=="modalC"&&l.visible,onClose:c,params:l.params}),m.jsx(Oa,{visible:g.modalD.visible,params:g.modalD.params,onClose:()=>p("modalD")}),m.jsx(ma,{visible:l.key=="modalE"&&l.visible,onClose:c,params:l.params}),m.jsx(ya,{visible:l.key=="modalF"&&l.visible,onClose:c,params:l.params}),m.jsx(xa,{visible:l.key=="modalG"&&l.visible,onClose:c,callback:x,params:l.params}),m.jsx(ga,{visible:l.key=="modalH"&&l.visible,onClose:c,value:l.params}),m.jsx(Sa,{visible:g.metadataModal.visible,onClose:()=>p("metadataModal"),params:g.metadataModal.params}),m.jsx(Ba,{visible:l.key=="metadataForm"&&l.visible,onClose:c,params:l.params}),m.jsx(Ca,{visible:g.bindSample.visible,onClose:()=>p("bindSample"),operatePipeline:C,params:g.bindSample.params}),m.jsx(Ea,{visible:l.key=="openFile"&&l.visible,onClose:c,params:l.params}),m.jsx(ng,{visible:l.key=="sortSoftware"&&l.visible,onClose:c,params:l.params,callback:x}),m.jsx(og,{visible:l.key=="descriptionModal"&&l.visible,onClose:c,params:l.params,callback:x})]})},rg=({component_type:e,operatePipeline:t,component:n,...o})=>{if(!e||!n)return null;const s={pipeline:lg,software:ig,file:ag,script:cg,module:"module-card"}[e];return s?m.jsx(s,{operatePipeline:t,component:n,...o}):null},sg=fe.memo(rg,(e,t)=>JSON.stringify(e)===JSON.stringify(t)),ig=({operatePipeline:e,component:t,...n})=>m.jsx(m.Fragment,{children:m.jsx(Hr,{...t,operatePipeline:e})}),ag=({operatePipeline:e,component:t,...n})=>{const{project:o}=Ke();return m.jsx(m.Fragment,{children:m.jsx(zr,{...t,analysisMethod:[t],operatePipeline:e,project:o})})},cg=({operatePipeline:e,component:t,...n})=>{const{project:o}=Ke();return m.jsx(m.Fragment,{children:m.jsx(zr,{component_type:t.component_type,script:t,analysisMethod:t.parent||[],operatePipeline:e,project:o})})},lg=({operatePipeline:e,component:t,...n})=>{const[o,r]=v.useState([]),{project:s}=Ke(),i=f=>{const l=f.software;return l?l.map((d,c)=>({key:d.component_id,label:d.component_name||d.component_id,children:m.jsx(Hr,{...n,...d,hiddenUpstreamAnalysis:!0,pipeline:{component_id:f.component_id},operatePipeline:e})})):[]},a=f=>{const l=f.software;if(!l)return[];const c=(JSON.parse(f.position)||[]).reduce((y,p)=>(y[p.component_id]=p.position,y),{});return l.map((y,p)=>{const x=y.component_name,b=(y.inputFile||[]).map(h=>h),C=(y.outputFile||[]).map(h=>h);return{id:y.component_id,type:"custom",position:c[y.component_id]||{x:p*300,y:100},data:{label:x,color:"#"+((1<<24)*Math.random()|0).toString(16),inputs:b,outputs:C}}})||[]},u=f=>JSON.parse(f.edges)||[];return v.useEffect(()=>{t&&r(i(t))},[JSON.stringify(t)]),console.log("--->PipelineComponent渲染"),m.jsxs(m.Fragment,{children:[m.jsx(dd,{initialEdges:u(t),initialNodes:a(t),component:t}),m.jsx("div",{style:{marginTop:"1rem"}}),m.jsx(sa,{...t,project:s,operatePipeline:e,inputAnalysisMethod:t.inputFile}),t&&Array.isArray(t==null?void 0:t.software)?m.jsx(Br,{destroyInactiveTabPane:!0,items:o}):m.jsxs(_r,{children:[m.jsx(le,{style:{marginRight:"0.5rem"},color:"cyan",variant:"solid",onClick:()=>{e.openModal("modalC",{data:void 0,structure:{component_type:"software",relation_type:"pipeline_software",parent_component_id:t.component_id,pipeline_id:t.component_id}})},children:"新增软件"}),m.jsx(le,{color:"cyan",variant:"solid",onClick:()=>{e.openModal("modalA",{data:void 0,pipelineStructure:{relation_type:"pipeline_software",parent_component_id:t.component_id,pipeline_id:t.component_id}})},children:"添加软件"})]})]})};export{Fg as default};
