import{r,x as m,_ as j,j as t,f as b,t as w,I as h,F as p,s as _,bm as k,E as R,P as z,a as y,at as M,l as $}from"./main-BzPVmAp-.js";import{C as v}from"./index-7u0Bo8e4.js";import{F as S}from"./Table-kIlrKW-9.js";import{R as F}from"./RedoOutlined-d_QTXv-s.js";import{R as I}from"./DeleteOutlined-DoDR38qq.js";import"./index-SGIbgpRk.js";import"./Dropdown-Clv_Pvnt.js";import"./addEventListener-CzbSevz3.js";import"./index-BZ6Sq__j.js";var T={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M952 474H829.8C812.5 327.6 696.4 211.5 550 194.2V72c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v122.2C327.6 211.5 211.5 327.6 194.2 474H72c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h122.2C211.5 696.4 327.6 812.5 474 829.8V952c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V829.8C696.4 812.5 812.5 696.4 829.8 550H952c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zM512 756c-134.8 0-244-109.2-244-244s109.2-244 244-244 244 109.2 244 244-109.2 244-244 244z"}},{tag:"path",attrs:{d:"M512 392c-32.1 0-62.1 12.4-84.8 35.2-22.7 22.7-35.2 52.7-35.2 84.8s12.5 62.1 35.2 84.8C449.9 619.4 480 632 512 632s62.1-12.5 84.8-35.2C619.4 574.1 632 544 632 512s-12.5-62.1-35.2-84.8A118.57 118.57 0 00512 392z"}}]},name:"aim",theme:"outlined"},A=function(n,i){return r.createElement(m,j({},n,{ref:i,icon:T}))},E=r.forwardRef(A),D={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M888.3 693.2c-42.5-24.6-94.3-18-129.2 12.8l-53-30.7V523.6c0-15.7-8.4-30.3-22-38.1l-136-78.3v-67.1c44.2-15 76-56.8 76-106.1 0-61.9-50.1-112-112-112s-112 50.1-112 112c0 49.3 31.8 91.1 76 106.1v67.1l-136 78.3c-13.6 7.8-22 22.4-22 38.1v151.6l-53 30.7c-34.9-30.8-86.8-37.4-129.2-12.8-53.5 31-71.7 99.4-41 152.9 30.8 53.5 98.9 71.9 152.2 41 42.5-24.6 62.7-73 53.6-118.8l48.7-28.3 140.6 81c6.8 3.9 14.4 5.9 22 5.9s15.2-2 22-5.9L674.5 740l48.7 28.3c-9.1 45.7 11.2 94.2 53.6 118.8 53.3 30.9 121.5 12.6 152.2-41 30.8-53.6 12.6-122-40.7-152.9zm-673 138.4a47.6 47.6 0 01-65.2-17.6c-13.2-22.9-5.4-52.3 17.5-65.5a47.6 47.6 0 0165.2 17.6c13.2 22.9 5.4 52.3-17.5 65.5zM522 463.8zM464 234a48.01 48.01 0 0196 0 48.01 48.01 0 01-96 0zm170 446.2l-122 70.3-122-70.3V539.8l122-70.3 122 70.3v140.4zm239.9 133.9c-13.2 22.9-42.4 30.8-65.2 17.6-22.8-13.2-30.7-42.6-17.5-65.5s42.4-30.8 65.2-17.6c22.9 13.2 30.7 42.5 17.5 65.5z"}}]},name:"deployment-unit",theme:"outlined"},L=function(n,i){return r.createElement(m,j({},n,{ref:i,icon:D}))},O=r.forwardRef(L);const V=({data:e})=>t.jsx("div",{style:{display:"flex",alignItems:"center",flexWrap:"wrap",gap:4},children:Array.isArray(e)&&e.map((n,i)=>t.jsxs(b.Fragment,{children:[t.jsx(w,{title:`${n.rank} (tax_id: ${n.tax_id})`,children:t.jsx("span",{style:{padding:"2px 6px",borderRadius:4,backgroundColor:"#f0f2f5",cursor:"pointer",transition:"background 0.3s"},onMouseEnter:o=>o.currentTarget.style.backgroundColor="#e6f7ff",onMouseLeave:o=>o.currentTarget.style.backgroundColor="#f0f2f5",children:n.entity_name})}),i<e.length-1&&t.jsx("span",{style:{margin:"0 4px"},children:"→"})]},n.tax_id))}),H=({data:e})=>{var n;return t.jsx(t.Fragment,{children:t.jsxs(v,{title:"Lineage",style:{marginTop:"1rem"},styles:{body:{padding:"0.5rem"}},size:"small",children:[t.jsx(V,{data:e.lineage}),t.jsx(B,{data:(n=e==null?void 0:e.graph_table)==null?void 0:n.studies})]})})},B=({data:e})=>{const{Search:n}=h,[i,o]=r.useState([]),a=l=>l?Object.keys(l).map(c=>({title:c,dataIndex:c,key:c,ellipsis:!0,width:150})):[];r.useEffect(()=>{if(e){const l=e.map((c,x)=>({...c,key:x}));o(l)}},[e]);const[u,s]=r.useState(""),d=r.useMemo(()=>u?e.filter(l=>Object.values(l).some(c=>String(c).toLowerCase().includes(u.toLowerCase()))):e,[e,u]);return t.jsx(t.Fragment,{children:Array.isArray(i)&&t.jsx(t.Fragment,{children:t.jsx(S,{size:"small",title:()=>t.jsx(p,{gap:"small",children:t.jsx(h.Search,{size:"small",placeholder:"搜索结果...",allowClear:!0,enterButton:!0,value:u,onChange:l=>s(l.target.value),style:{width:300}})}),scroll:{x:"max-content"},dataSource:d,pagination:!1,columns:a(e[0]),footer:()=>`A total of ${d==null?void 0:d.length} records`})})})},U=[{key:"Microbe",label:"taxonomy",component:H}],J=({data:e,view:n})=>{if(!n)return t.jsxs("div",{children:["未知类型",n]});const i=U.find(s=>s.key===n);if(!i)return t.jsxs("div",{children:["未知类型",n]});const{component:o,key:a,...u}=i;return t.jsx(o,{data:e,...u})},q=({data:e,close:n,height:i,graphOpt:o,queryParams:a,...u})=>{const[s,d]=r.useState(),[l,c]=r.useState(!1),[x,C]=_.useMessage(),g=async()=>{if(e!=null&&e.id){try{c(!0);const f=await y.post(`/entity/details/mesh/${e==null?void 0:e.id}`,{nodes:a.nodes});d(f.data)}catch(f){d(null),console.log(f),x.error("数据加载失败!")}c(!1)}else d(null)};return r.useEffect(()=>{g()},[JSON.stringify(e)]),t.jsxs("div",{children:[C,t.jsx(v,{loading:l,title:t.jsxs(t.Fragment,{children:[s==null?void 0:s.entity_name,t.jsx($,{style:{marginLeft:"0.5rem"},children:s==null?void 0:s.entity_type})]}),styles:{body:{padding:0,height:"100%"}},size:"small",extra:t.jsx(t.Fragment,{children:t.jsxs(p,{gap:"small",children:[a!=null&&a.entity_id?t.jsx(O,{onClick:()=>{o.updateQueryParam("entity_id",void 0)}}):t.jsx(E,{onClick:()=>{o.updateQueryParam("entity_id",e==null?void 0:e.id)}}),t.jsx(F,{onClick:g}),t.jsx(z,{title:`删除${e==null?void 0:e.entity_name} (${e==null?void 0:e.node_id})?`,onConfirm:async()=>{await y.delete(`/entity/node-id/${e==null?void 0:e.node_id}`),x.success("删除成功"),n(),o.loadGraph()},children:t.jsx(I,{})}),t.jsx(M,{onClick:n})]})}),style:{borderRadius:"12px",boxShadow:"0 4px 20px rgba(0,0,0,0.1)",padding:"0.5rem",overflow:"hidden",height:i},children:t.jsx("div",{style:{height:"100%",overflowY:"auto"},children:s?t.jsxs(t.Fragment,{children:[t.jsx(J,{data:s,view:s==null?void 0:s.entity_type}),t.jsx(k,{})]}):t.jsx(R,{description:JSON.stringify(e)})})})]})};export{J as ComponentsRender,q as default,U as viewMapping};
