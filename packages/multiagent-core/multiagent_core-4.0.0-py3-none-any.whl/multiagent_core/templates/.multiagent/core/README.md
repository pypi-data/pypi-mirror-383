# Core System - Project Setup Orchestrator

## Purpose

Master orchestrator that sets up your project infrastructure after SpecKit creates the spec. Triggers all other subsystems (security, deployment, testing, docs) automatically.

## What It Does

1. **Generates GitHub workflows** - CI/CD pipelines from templates
2. **Orchestrates subsystems** - Calls security, deployment, testing, docs setup
3. **Validates setup** - Ensures all infrastructure is properly configured
4. **Provides utilities** - Shared scripts and templates for all subsystems

## Agents Used

**No dedicated agents** - Core coordinates other subsystems' agents:
- Invokes `security-auth-compliance` for security setup
- Invokes `deployment-prep` for platform configs
- Invokes testing agents for test structure
- Invokes docs agents for documentation

## Commands

### Primary Command
- `/project-setup [spec-dir]` - Master setup orchestrator

### Commands It Invokes
- `/deploy-prepare specs/001-*` - Triggers deployment generation
- `/testing-workflow --generate` - Triggers test generation
- `/deploy-validate` - Validates deployment configs

## Directory Structure

```
.multiagent/core/
├── scripts/
│   ├── generation/
│   │   └── configure-workflows.sh  # Creates GitHub workflows from templates
│   ├── validation/
│   │   └── setup-checklist.sh     # Verifies complete setup
│   └── hooks/
│       └── post-plan-setup.sh     # Auto-triggered after /plan
├── templates/
│   ├── github-workflows/          # CI/CD workflow templates
│   │   ├── ci.yml.template       # Continuous integration
│   │   ├── deploy.yml.template   # Deployment automation
│   │   └── security.yml.template # Security scanning
│   └── runtime/                   # Utilities for all systems
│       ├── logger.py              # Structured logging
│       └── fs_utils.py            # File operations
└── docs/
    └── PROJECT_INITIALIZATION_FLOW.md
```

## Outputs

### 1. GitHub Workflows (`.github/workflows/`)

Generated by `configure-workflows.sh` from templates:

| File | Purpose | Variables Filled |
|------|---------|-----------------|
| `ci.yml` | Run tests, lint, build | NODE_VERSION, TEST_COMMAND, BUILD_COMMAND |
| `deploy.yml` | Deploy to cloud | DEPLOYMENT_TARGET (vercel/aws/docker) |
| `security.yml` | Security scanning | Language-specific scanners |

### 2. Git Hooks (`.git/hooks/`)

| File | Purpose | When Run |
|------|---------|----------|
| `pre-commit` | Lint and format | Before each commit |
| `pre-push` | Run tests | Before push to remote |

### 3. Configuration Files (Root Directory)

| File | Purpose | Content |
|------|---------|---------|
| `.env.example` | Environment template | Variables detected from spec |
| `.gitmessage` | Commit template | Standard commit format |

## Workflow

```mermaid
graph TD
    A[multiagent init] -->|Copies templates| B[.multiagent/core]
    B --> C[/specify]
    C -->|Creates spec| D[specs/001-*/spec.md]
    D --> E[/plan]
    E -->|Triggers hook| F[post-plan-setup.sh]
    F -->|Runs| G[/project-setup]
    G --> H[configure-workflows.sh]
    H -->|Creates| I[.github/workflows/*.yml]
    G --> J[/deploy-prepare]
    J -->|Creates| K[deployment/*]
    G --> L[/testing-workflow]
    L -->|Creates| M[tests/*]
    G --> N[setup-checklist.sh]
    N -->|Validates| O[Setup Complete]
```

## Template Variables

Templates use `{{VARIABLE|default}}` format:

### Common Variables
- `{{PROJECT_NAME|my-project}}`
- `{{NODE_VERSION|20}}` or `{{PYTHON_VERSION|3.11}}`
- `{{TEST_COMMAND|npm test}}` or `{{TEST_COMMAND|pytest}}`
- `{{BUILD_COMMAND|npm run build}}`
- `{{DEPLOYMENT_TARGET|docker}}`

### Conditional Blocks
```yaml
{{#IF_NODE}}
  - name: Run npm audit
    run: npm audit
{{/IF_NODE}}
```

## How Templates Work

1. **Spec Analysis**: Script reads `specs/001-*/spec.md`
2. **Detection**: Identifies project type (Node.js, Python, etc.)
3. **Variable Setting**: Sets appropriate values
4. **Template Processing**: Replaces variables and conditionals
5. **Output Generation**: Creates final workflow files

## Integration Points

### With Deployment System
- Core invokes `/deploy-prepare`
- Deployment creates `deployment/` directory
- Core doesn't duplicate deployment functionality

### With Testing System
- Core invokes `/testing-workflow --generate`
- Testing creates `tests/` directory
- Core doesn't create test files

### With PR Review System
- PR review workflows remain untouched
- Core preserves specialized workflows like `claude-code-review.yml`

## Validation

Run setup checklist to verify:
```bash
.multiagent/core/scripts/validation/setup-checklist.sh
```

Output:
```
✅ multiagent init completed
✅ Spec directory exists
✅ GitHub workflows exist
✅ Deployment configs exist (via deployment system)
✅ Test structure exists (via testing system)
✅ Git hooks configured
✅ Environment template exists
```

## Manual Post-Setup

After automatic setup:

1. **Add GitHub Secrets**:
   ```bash
   gh secret set VERCEL_TOKEN
   gh secret set CLAUDE_API_KEY
   ```

2. **Configure Environment**:
   ```bash
   cp .env.example .env
   # Edit with actual values
   ```

3. **Test Everything**:
   ```bash
   npm test  # or pytest
   ```

## Runtime Utilities

Available to all systems:
```python
from .multiagent.core.templates.runtime import Logger

logger = Logger("my-script")
logger.info("Operation complete")
```

## Key Points

- **Core orchestrates, doesn't duplicate**
- **Each system owns its domain** (deployment owns deployment/, testing owns tests/)
- **Templates are spec-driven** (not generic)
- **Workflows are project-specific** (Node.js gets different CI than Python)

## Related Documentation

- **Build System**: `../../template-management/README.md` - How templates get packaged and deployed
- **Initialization Flow**: `../ README.md` - User-facing initialization explanation
- **Deployment System**: `../deployment/README.md` - Deployment config generation
- **Testing System**: `../testing/README.md` - Test structure generation