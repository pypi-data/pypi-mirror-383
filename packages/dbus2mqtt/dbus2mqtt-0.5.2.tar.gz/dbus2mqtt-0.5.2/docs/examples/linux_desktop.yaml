dbus:
  subscriptions:

    # https://lira.no-ip.org:8443/doc/gnome-session/dbus/gnome-session.html
    - bus_name: org.gnome.SessionManager
      path: /org/gnome/SessionManager

      interfaces:
        - interface: org.freedesktop.DBus.Properties
          signals:
            - signal: PropertiesChanged
          methods:
            - method: GetAll

        - interface: org.gnome.SessionManager
          mqtt_command_topic: dbus2mqtt/SessionManager/command
          methods:
            - method: Logout
            - method: Reboot  # reboot dialog

      flows:
        - name: "publish state at startup and schedule"
          triggers:
            - type: object_added
            - type: schedule
              interval: {seconds: 5}
          actions:
            - type: mqtt_publish
              topic: dbus2mqtt/SessionManager
              payload_type: json
              payload_template:
                clients: "{{ dbus_call('org.gnome.SessionManager', '/org/gnome/SessionManager', 'org.gnome.SessionManager', 'GetClients') }}"

    - bus_name: org.freedesktop.Notifications
      path: /org/freedesktop/Notifications

      interfaces:
        - interface: org.freedesktop.DBus.Properties
          signals:
            - signal: PropertiesChanged
        - interface: org.freedesktop.Notifications
          mqtt_command_topic: dbus2mqtt/Notifications/command
          signals:
            - signal: NotificationClosed
            - signal: ActionInvoked
          methods:
            - method: Notify
            - method: CloseNotification
            - method: GetServerInformation

      flows:
        - name: "signal received"
          triggers:
            - type: dbus_signal
              interface: org.freedesktop.Notifications
              signal: NotificationClosed
            - type: dbus_signal
              interface: org.freedesktop.Notifications
              signal: ActionInvoked
          actions:
            - type: log
              msg: "dbus signal received: signal={{ signal }}, args={{ args }}"
