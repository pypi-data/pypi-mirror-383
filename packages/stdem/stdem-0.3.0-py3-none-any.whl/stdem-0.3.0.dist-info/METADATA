Metadata-Version: 2.4
Name: stdem
Version: 0.3.0
Summary: A powerful tool for converting Excel spreadsheets into JSON data with complex hierarchical structures
License-Expression: MIT
Requires-Python: >=3.12
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: openpyxl>=3.1.5
Dynamic: license-file

# stdem

[![License](https://img.shields.io/badge/license-MIT-blue.svg)](https://github.com/iccues/stdem/blob/main/LICENSE)
[![PyPI - Version](https://img.shields.io/pypi/v/stdem)](https://pypi.org/project/stdem/)
![PyPI - Python Version](https://img.shields.io/pypi/pyversions/stdem)

å°† Excel è¡¨æ ¼è½¬æ¢ä¸ºå…·æœ‰å¤æ‚å±‚æ¬¡ç»“æ„çš„ JSON æ•°æ®çš„å¼ºå¤§å·¥å…·ã€‚

ä¸­æ–‡æ–‡æ¡£ | [English](README_EN.md)

## âœ¨ ç‰¹æ€§

- ğŸ”„ **å¤æ‚æ•°æ®ç»“æ„æ”¯æŒ** - æ”¯æŒåµŒå¥—å¯¹è±¡ã€åˆ—è¡¨ã€å­—å…¸ç­‰å¤æ‚å±‚æ¬¡ç»“æ„
- ğŸ“Š **ç±»å‹å®‰å…¨** - å†…ç½®ç±»å‹éªŒè¯å’Œè½¬æ¢ï¼ˆint, float, string, list, dict, classï¼‰
- ğŸ¯ **è¯¦ç»†çš„é”™è¯¯æç¤º** - ç²¾ç¡®å®šä½é”™è¯¯å•å…ƒæ ¼å’Œé”™è¯¯åŸå› 
- ğŸš€ **æ‰¹é‡å¤„ç†** - ä¸€æ¬¡æ€§å¤„ç†æ•´ä¸ªç›®å½•çš„ Excel æ–‡ä»¶
- ğŸ” **æ ¼å¼åŒ–è¾“å‡º** - ç”Ÿæˆæ ¼å¼åŒ–çš„ JSON æ–‡ä»¶ï¼Œä¾¿äºé˜…è¯»

## ğŸ“¦ å®‰è£…

ä½¿ç”¨ pip å®‰è£…ï¼š

```bash
pip install stdem
```

æˆ–ä½¿ç”¨ uv å®‰è£…ï¼š

```bash
uv pip install stdem
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‘½ä»¤è¡Œä½¿ç”¨

stdem æä¾›äº†ç°ä»£åŒ–çš„å­å‘½ä»¤ç•Œé¢ï¼š

#### è½¬æ¢æ–‡ä»¶/ç›®å½•

```bash
# è½¬æ¢å•ä¸ªæ–‡ä»¶
stdem convert input.xlsx -o output.json

# è½¬æ¢æ•´ä¸ªç›®å½•
stdem convert excel_dir/ -o json_dir/

# è‡ªå®šä¹‰ JSON ç¼©è¿›
stdem convert data/ -o output/ --indent 4

# ä¿ç•™è¾“å‡ºç›®å½•ä¸­çš„ç°æœ‰æ–‡ä»¶ï¼ˆä¸æ¸…ç©ºï¼‰
stdem convert data/ -o output/ --no-clear

# é™é»˜æ¨¡å¼ï¼ˆä»…æ˜¾ç¤ºé”™è¯¯ï¼‰
stdem convert data/ -o output/ -q

# å¯ç”¨è¯¦ç»†é”™è¯¯è¾“å‡º
stdem convert data/ -o output/ -v
```

#### éªŒè¯æ–‡ä»¶æ ¼å¼

```bash
# éªŒè¯ Excel æ–‡ä»¶æ˜¯å¦ç¬¦åˆ stdem æ ¼å¼
stdem validate config.xlsx

# æ˜¾ç¤ºè¯¦ç»†éªŒè¯ä¿¡æ¯å’Œæ•°æ®é¢„è§ˆ
stdem validate config.xlsx -v
```

#### å…¶ä»–å‘½ä»¤

```bash
# æŸ¥çœ‹å¸®åŠ©
stdem --help
stdem convert --help
stdem validate --help

# æŸ¥çœ‹ç‰ˆæœ¬
stdem --version
```

### å‘½ä»¤è¡Œå‚æ•°è¯¦è§£

#### `stdem convert` å‚æ•°

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `input` | è¾“å…¥ Excel æ–‡ä»¶æˆ–ç›®å½•ï¼ˆå¿…éœ€ï¼‰ | - |
| `-o, --output` | è¾“å‡º JSON æ–‡ä»¶æˆ–ç›®å½•ï¼ˆå¿…éœ€ï¼‰ | - |
| `-i, --indent` | JSON ç¼©è¿›ç©ºæ ¼æ•° | 2 |
| `--no-clear` | ä¸æ¸…ç©ºè¾“å‡ºç›®å½• | false |
| `-q, --quiet` | é™é»˜æ¨¡å¼ï¼ˆä»…æ˜¾ç¤ºé”™è¯¯ï¼‰ | false |
| `-v, --verbose` | è¯¦ç»†é”™è¯¯è¾“å‡º | false |

#### `stdem validate` å‚æ•°

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `file` | è¦éªŒè¯çš„ Excel æ–‡ä»¶ï¼ˆå¿…éœ€ï¼‰ | - |
| `-v, --verbose` | æ˜¾ç¤ºè¯¦ç»†éªŒè¯ä¿¡æ¯ | false |

**âš ï¸ æ³¨æ„ï¼š**

- é»˜è®¤æƒ…å†µä¸‹ï¼Œè½¬æ¢ç›®å½•æ—¶ä¼šæ¸…ç©ºè¾“å‡ºç›®å½•ä¸­çš„æ‰€æœ‰ `.json` æ–‡ä»¶
- ä½¿ç”¨ `--no-clear` å‚æ•°å¯ä»¥ä¿ç•™ç°æœ‰æ–‡ä»¶
- å•æ–‡ä»¶è½¬æ¢ä¼šè‡ªåŠ¨åˆ›å»ºè¾“å‡ºç›®å½•ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰

### Python API ä½¿ç”¨

```python
from stdem import excel_parser

# è§£æå•ä¸ªæ–‡ä»¶ä¸º Python å¯¹è±¡
data = excel_parser.get_data("example.xlsx")

# è§£æå•ä¸ªæ–‡ä»¶ä¸º JSON å­—ç¬¦ä¸²
json_str = excel_parser.get_json("example.xlsx")

# æ‰¹é‡å¤„ç†ç›®å½•
from stdem import main
success, failed = main.parse_dir("excel/", "json/")
print(f"æˆåŠŸ: {success}, å¤±è´¥: {failed}")
```

## ğŸ“‹ Excel æ ¼å¼è¯´æ˜

### åŸºæœ¬æ ¼å¼

Excel æ–‡ä»¶å¿…é¡»éµå¾ªä»¥ä¸‹æ ¼å¼ï¼š

1. **ç¬¬ä¸€è¡Œç¬¬ä¸€åˆ—** å¿…é¡»æ˜¯ `#head` æ ‡è®°
2. **ç¬¬ä¸€è¡Œå…¶ä»–åˆ—** å®šä¹‰å­—æ®µåå’Œç±»å‹ï¼Œæ ¼å¼ä¸º `å­—æ®µå:ç±»å‹`
3. **è¡¨å¤´è¡Œ** å¯ä»¥æœ‰å¤šè¡Œï¼Œç”¨äºå®šä¹‰å¤æ‚åµŒå¥—ç»“æ„
4. **æ•°æ®è¡Œ** å¿…é¡»ä»¥ `#data` æ ‡è®°å¼€å§‹
5. **æ³¨é‡Šè¡Œ** ä»¥ `#` å¼€å§‹çš„è¡Œä¼šè¢«å¿½ç•¥

### æ”¯æŒçš„æ•°æ®ç±»å‹

| ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `int` | æ•´æ•° | `age:int` |
| `float` | æµ®ç‚¹æ•° | `price:float` |
| `string` | å­—ç¬¦ä¸² | `name:string` |
| `list` | åˆ—è¡¨ï¼ˆéœ€è¦ä¸¤ä¸ªå­åˆ—ï¼šç´¢å¼•å’Œå€¼ï¼‰ | `items:list` |
| `dict` | å­—å…¸ï¼ˆéœ€è¦ä¸¤ä¸ªå­åˆ—ï¼šé”®å’Œå€¼ï¼‰ | `config:dict` |
| `class` | åµŒå¥—å¯¹è±¡ | `player:class` |

### ç¤ºä¾‹ï¼šç®€å•è¡¨æ ¼

![Excel ç¤ºä¾‹è¡¨æ ¼](https://github.com/iccues/stdem/blob/main/docs/image/example.png)

è½¬æ¢ä¸ºï¼š

```json
{
  "Nyxra": {
    "hp": 10000,
    "attack": 200.0,
    "skills": ["Shadowstep", "Twilight Veil", "Void Requiem"]
  },
  "Orin": {
    "hp": 15000,
    "attack": 100.0,
    "skills": ["Mana Surge", "Celestial Wrath"]
  }
}
```

## ğŸ” é”™è¯¯å¤„ç†

stdem æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ï¼Œå¸®åŠ©å¿«é€Ÿå®šä½é—®é¢˜ï¼š

### æ–‡ä»¶ç›¸å…³é”™è¯¯

- `FileNotFoundError` - æ–‡ä»¶ä¸å­˜åœ¨
- `InvalidFileFormatError` - æ–‡ä»¶æ ¼å¼ä¸æ”¯æŒï¼ˆå¿…é¡»æ˜¯ .xlsx æˆ– .xlsmï¼‰
- `EmptyFileError` - æ–‡ä»¶ä¸ºç©º

### è¡¨å¤´ç›¸å…³é”™è¯¯

- `MissingHeaderMarkerError` - ç¼ºå°‘ `#head` æ ‡è®°
- `InvalidHeaderFormatError` - è¡¨å¤´æ ¼å¼é”™è¯¯ï¼ˆåº”ä¸º `name:type`ï¼‰
- `InvalidTypeNameError` - æ— æ•ˆçš„ç±»å‹åç§°
- `ChildAdditionError` - å­èŠ‚ç‚¹æ·»åŠ é”™è¯¯

### æ•°æ®ç›¸å…³é”™è¯¯

- `MissingDataMarkerError` - ç¼ºå°‘ `#data` æ ‡è®°
- `UnexpectedDataError` - åœ¨ç¦ç”¨çš„å•å…ƒæ ¼ä¸­å‘ç°æ•°æ®
- `TypeConversionError` - ç±»å‹è½¬æ¢å¤±è´¥
- `InvalidIndexError` - åˆ—è¡¨ç´¢å¼•é”™è¯¯

é”™è¯¯ç¤ºä¾‹ï¼š

```bash
$ stdem convert excel/ -o json/ -v

example.xlsx:   [OK] Success!
invalid.xlsx:   [ERROR] File: invalid.xlsx | Cell: B1 | Invalid type 'wrong'. Valid types: int, string, float, list, dict, class

[DONE] Processing complete: 1 succeeded, 1 failed
```

éªŒè¯ç¤ºä¾‹ï¼š

```bash
$ stdem validate tests/excel/example.xlsx -v
[OK] example.xlsx is valid!

Data structure preview:
{
  "Nyxra": {
    "hp": 10000,
    "attack": 200.0,
    "skills": ["Shadowstep", "Twilight Veil", "Void Requiem"]
  },
  ...
}
```

## ğŸ› ï¸ å¼€å‘

### å®‰è£…ä¾èµ–

```bash
# ä½¿ç”¨ uv
uv sync

# æˆ–ä½¿ç”¨ pip
pip install -e ".[dev]"
```

### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
python -m unittest discover tests -v

# è¿è¡Œç‰¹å®šæµ‹è¯•æ¨¡å—
python -m unittest tests.test_parsing -v
python -m unittest tests.test_errors -v
```

### æµ‹è¯•ç»“æ„

æµ‹è¯•æ–‡ä»¶æŒ‰åŠŸèƒ½ç»„ç»‡ï¼š

- `tests/test_base.py` - æµ‹è¯•åŸºç¡€å·¥å…·ç±»å’Œ fixtures
- `tests/test_parsing.py` - Excel è§£æå’Œ JSON æ ¼å¼åŒ–æµ‹è¯•
- `tests/test_errors.py` - é”™è¯¯å¤„ç†å’ŒéªŒè¯æµ‹è¯•

### é¡¹ç›®ç»“æ„

```text
stdem/
â”œâ”€â”€ src/stdem/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ __main__.py
â”‚   â”œâ”€â”€ ExcelParser.py      # Excel è§£ææ ¸å¿ƒ
â”‚   â”œâ”€â”€ HeadType.py          # ç±»å‹å®šä¹‰å’Œè½¬æ¢
â”‚   â”œâ”€â”€ TableException.py    # å¼‚å¸¸å®šä¹‰
â”‚   â””â”€â”€ Main.py              # CLI å…¥å£
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ excel/               # æµ‹è¯• Excel æ–‡ä»¶
â”‚   â”œâ”€â”€ json/                # é¢„æœŸ JSON ç»“æœ
â”‚   â”œâ”€â”€ test_base.py         # æµ‹è¯•åŸºç¡€å·¥å…·
â”‚   â”œâ”€â”€ test_parsing.py      # è§£æåŠŸèƒ½æµ‹è¯•
â”‚   â””â”€â”€ test_errors.py       # é”™è¯¯å¤„ç†æµ‹è¯•
â”œâ”€â”€ pyproject.toml
â””â”€â”€ README.md
```

## ğŸ“ ä½¿ç”¨åœºæ™¯

- **æ¸¸æˆå¼€å‘** - å°†ç­–åˆ’é…ç½®çš„ Excel è¡¨æ ¼è½¬æ¢ä¸ºæ¸¸æˆæ•°æ®
- **æ•°æ®è¿ç§»** - å°† Excel æ•°æ®å¯¼å…¥åˆ°æ•°æ®åº“æˆ–å…¶ä»–ç³»ç»Ÿ
- **é…ç½®ç®¡ç†** - ç”¨ Excel ç®¡ç†å¤æ‚çš„é…ç½®æ–‡ä»¶
- **æ•°æ®äº¤æ¢** - Excel ä¸ JSON æ ¼å¼çš„äº’è½¬

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®åŸºäº [MIT è®¸å¯è¯](https://github.com/iccues/stdem/blob/main/LICENSE) å¼€æºã€‚

## ğŸ”— é“¾æ¥

- [PyPI](https://pypi.org/project/stdem/)
- [GitHub](https://github.com/iccues/stdem)
- [é—®é¢˜åé¦ˆ](https://github.com/iccues/stdem/issues)

---

Made with â¤ï¸ by [iccues](https://github.com/iccues)
