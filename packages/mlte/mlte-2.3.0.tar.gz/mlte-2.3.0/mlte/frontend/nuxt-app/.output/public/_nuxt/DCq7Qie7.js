import{j as D,m as x,c as b,o as c,a as r,F as S,v as R,t as $,b as m,w as t,d as s,r as y,l as M,s as C,n as N,q as d,y as q,k as T,z as I}from"./C8NgpPpc.js";import{m as z,n as H,o as J,p as K,u as Q}from"./DJksR8kQ.js";import{G as W,a as X,U as G}from"./CpBh97f4.js";import{r as Y}from"./DueXm2QC.js";import{i as Z}from"./DeaeknEB.js";const O={class:"table usa-table usa-table--borderless"},ee=r("thead",null,[r("tr",null,[r("th",{"data-sortable":"",scope:"col",role:"columnheader"},"Username"),r("th",{"data-sortable":"",scope:"col",role:"columnheader"},"Email"),r("th",{"data-sortable":"",scope:"col",role:"columnheader"},"Full Name"),r("th",{"data-sortable":"",scope:"col",role:"columnheader"},"Disabled"),r("th",{scope:"col",role:"columnheader"},"Actions")])],-1),le={class:"centered-container",style:{"margin-bottom":"1.5em"}},ae=D({__name:"user-list",props:{modelValue:{type:Array,required:!0}},emits:["addUser","editUser","deleteUser"],setup(o,{emit:P}){const i=P,g=o;return(h,l)=>{const V=x("UsaCheckbox"),p=x("UsaButton");return c(),b("table",O,[ee,r("tbody",null,[(c(!0),b(S,null,R(g.modelValue,(w,u)=>(c(),b("tr",{key:u},[r("td",null,$(w.username),1),r("td",null,$(w.email),1),r("td",null,$(w.full_name),1),r("td",null,[r("div",le,[m(V,{modelValue:w.disabled,"onUpdate:modelValue":_=>w.disabled=_,disabled:""},null,8,["modelValue","onUpdate:modelValue"])])]),r("td",null,[m(p,{class:"secondary-button",onClick:_=>i("editUser",w)},{default:t(()=>[s(" Edit ")]),_:2},1032,["onClick"]),m(p,{class:"usa-button usa-button--secondary",onClick:_=>i("deleteUser",w.username)},{default:t(()=>[s(" Delete ")]),_:2},1032,["onClick"])])]))),128))])])}}}),se={key:0},oe={class:"section-header",style:{display:"inline"}},te={key:2},re={key:1},ne={class:"multi-line-checkbox-div"},ue=r("label",{class:"usa-label"},"Groups",-1),de={key:0},me=r("b",null,"create-model",-1),ie={class:"submit-footer"},ce=D({__name:"user-edit",props:{modelValue:{type:Object,required:!0},newUserFlag:{type:Boolean,required:!0,default:!1}},emits:["cancel","submit","updateUserGroups"],async setup(o,{emit:P}){let i,g;const h=P,l=o,V=y(!1),p=y(""),w=y([{value:"admin",text:"admin"},{value:"regular",text:"regular"}]),u=y({username:!1,role:!1,password:!1,confirmPassword:!1}),_=y([]),E=y([]);E.value=([i,g]=M(()=>z()),i=await i,g(),i),E.value&&E.value.forEach(n=>{_.value.push(new W(n.name,n.permissions,!1))}),_.value.forEach(n=>{l.modelValue.groups.find(e=>e.name===n.name)&&(n.selected=!0)}),l.newUserFlag&&(l.modelValue.role="regular");function A(){V.value=!0,l.modelValue.password=""}function B(){V.value=!1,delete l.modelValue.password}function f(n,e){if(n)l.modelValue.groups.push(new X(e.name,e.permissions));else{const k=l.modelValue.groups.find(U=>U.name===e.name);if(k){const U=l.modelValue.groups.indexOf(k);l.modelValue.groups.splice(U,1)}}}async function v(){u.value=Y(u.value);let n=!1;if(l.newUserFlag&&(l.modelValue.username.trim()===""&&(u.value.username=!0,n=!0),(l.modelValue.password==null||l.modelValue.password.trim()==="")&&(u.value.password=!0,n=!0)),V.value&&((l.modelValue.password==null||l.modelValue.password.trim()==="")&&(u.value.password=!0,n=!0),l.modelValue.password!==p.value&&(u.value.confirmPassword=!0,n=!0)),l.modelValue.role.trim()===""&&(u.value.role=!0,n=!0),n){Z();return}h("submit",l.modelValue)}return(n,e)=>{const k=x("UsaButton"),U=x("UsaTextInput"),F=x("UsaCheckbox"),j=x("UsaSelect");return c(),b("div",null,[o.newUserFlag?C("",!0):(c(),b("div",se,[r("h1",oe,$(o.modelValue.username),1),d(V)?C("",!0):(c(),N(k,{key:0,class:"secondary-button sub-header-float-button",onClick:A},{default:t(()=>[s(" Change Password ")]),_:1})),d(V)?(c(),N(k,{key:1,class:"secondary-button sub-header-float-button",onClick:B},{default:t(()=>[s(" Cancel Change ")]),_:1})):C("",!0),d(V)?(c(),b("div",te,[m(U,{modelValue:o.modelValue.password,"onUpdate:modelValue":e[0]||(e[0]=a=>o.modelValue.password=a),error:d(u).password,type:"password"},{label:t(()=>[s(" New Password ")]),"error-message":t(()=>[s(" Password is required ")]),_:1},8,["modelValue","error"]),m(U,{modelValue:d(p),"onUpdate:modelValue":e[1]||(e[1]=a=>q(p)?p.value=a:null),error:d(u).confirmPassword,type:"password"},{label:t(()=>[s(" Confirm New Password ")]),"error-message":t(()=>[s(" Passwords to not match ")]),_:1},8,["modelValue","error"])])):C("",!0)])),o.newUserFlag?(c(),b("div",re,[m(U,{modelValue:o.modelValue.username,"onUpdate:modelValue":e[2]||(e[2]=a=>o.modelValue.username=a),error:d(u).username},{label:t(()=>[s(" Username ")]),"error-message":t(()=>[s(" Username is required ")]),_:1},8,["modelValue","error"]),m(U,{modelValue:o.modelValue.password,"onUpdate:modelValue":e[3]||(e[3]=a=>o.modelValue.password=a),error:d(u).password,type:"password"},{label:t(()=>[s(" Password ")]),"error-message":t(()=>[s(" Password is required ")]),_:1},8,["modelValue","error"])])):C("",!0),m(U,{modelValue:o.modelValue.email,"onUpdate:modelValue":e[4]||(e[4]=a=>o.modelValue.email=a)},{label:t(()=>[s(" Email ")]),_:1},8,["modelValue"]),m(U,{modelValue:o.modelValue.full_name,"onUpdate:modelValue":e[5]||(e[5]=a=>o.modelValue.full_name=a)},{label:t(()=>[s(" Full Name ")]),_:1},8,["modelValue"]),m(F,{modelValue:o.modelValue.disabled,"onUpdate:modelValue":e[6]||(e[6]=a=>o.modelValue.disabled=a),label:"Disabled"},null,8,["modelValue"]),m(j,{modelValue:o.modelValue.role,"onUpdate:modelValue":e[7]||(e[7]=a=>o.modelValue.role=a),options:d(w),error:d(u).role,onChange:e[8]||(e[8]=a=>d(u).role=!1)},{label:t(()=>[s(" Role ")]),"error-message":t(()=>[s(" A role must be selected ")]),_:1},8,["modelValue","options","error"]),r("div",ne,[ue,o.newUserFlag?(c(),b("div",de,[s(" User will automatically be added to the "),me,s(" group upon submission. ")])):C("",!0),(c(!0),b(S,null,R(d(_),a=>(c(),b("span",{key:a.name,class:"multiple-per-line-checkbox"},[m(F,{modelValue:a.selected,"onUpdate:modelValue":[L=>a.selected=L,L=>f(a.selected,a)]},{default:t(()=>[s($(a.name),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])]))),128))]),r("div",ie,[m(k,{class:"primary-button",onClick:e[9]||(e[9]=a=>h("cancel"))},{default:t(()=>[s(" Cancel ")]),_:1}),m(k,{class:"primary-button",onClick:v},{default:t(()=>[s(" Save ")]),_:1})])])}}}),fe=r("title",null,"Manage Users",-1),Ve={key:0},pe={key:1},ge=D({__name:"manage-users",setup(o){const P=T("user"),i=y(!1),g=y(!1),h=y([]),l=y(new G);V(),p();async function V(){const f=await H();f&&(h.value=f)}function p(){l.value=new G}function w(){p(),i.value=!0,g.value=!0}function u(f){l.value=f,i.value=!0,g.value=!1}async function _(f){if(P.value===f){alert("Cannot delete the active user.");return}if(!confirm("Are you sure you want to delete user, "+f+"?"))return;await J(f)&&V()}function E(){i.value&&A()}function A(){confirm("Are you sure you want to cancel? All changes will be lost.")&&(i.value=!1,p())}async function B(f){let v=!0;g.value?await K(f)&&(v=!1):await Q(f)&&(v=!1),v||(V(),p(),i.value=!1)}return(f,v)=>{const n=x("UsaButton"),e=ae,k=ce,U=I;return c(),N(U,{name:"base-layout",onManageUsers:E},{"page-title":t(()=>[s("Manage Users")]),default:t(()=>[fe,d(i)?C("",!0):(c(),b("div",Ve,[m(n,{class:"secondary-button sub-header-float-button",onClick:w},{default:t(()=>[s(" Add User ")]),_:1}),m(e,{modelValue:d(h),"onUpdate:modelValue":v[0]||(v[0]=F=>q(h)?h.value=F:null),onEditUser:u,onDeleteUser:_},null,8,["modelValue"])])),d(i)?(c(),b("div",pe,[m(k,{modelValue:d(l),"onUpdate:modelValue":v[1]||(v[1]=F=>q(l)?l.value=F:null),"new-user-flag":d(g),onCancel:A,onSubmit:B},null,8,["modelValue","new-user-flag"])])):C("",!0)]),_:1})}}});export{ge as default};
