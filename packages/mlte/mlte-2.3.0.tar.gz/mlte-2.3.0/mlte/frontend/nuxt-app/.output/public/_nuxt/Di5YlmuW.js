import{j as F,m as x,c as a,o as t,a as l,F as B,v as E,t as d,b as G,w as f,d as h,r as w,l as N,s as $,q as k,n as P,z as D,y as L}from"./C8NgpPpc.js";import{q as R,m as S,r as T,s as j,t as I}from"./DJksR8kQ.js";import{P as M,b as z,a as q}from"./CpBh97f4.js";import{r as H}from"./DueXm2QC.js";const J={class:"table usa-table usa-table--borderless"},K=l("thead",null,[l("tr",null,[l("th",{"data-sortable":"",scope:"col",role:"columnheader"},"Name"),l("th",{"data-sortable":"",scope:"col",role:"columnheader"},[h(" Permissions "),l("br"),h(" (Resource Type - Resource ID - Method) ")]),l("th",{"data-sortable":"",scope:"col",role:"columnheader"},"Actions")])],-1),Q={class:"inline-input-left",style:{"max-width":"50ch"}},W={key:0},X={key:1},Y=F({__name:"group-list",props:{modelValue:{type:Array,required:!0}},emits:["addGroup","editGroup","deleteGroup"],setup(y,{emit:_}){const r=_,v=y;return(b,n)=>{const i=x("UsaButton");return t(),a("table",J,[K,(t(!0),a(B,null,E(v.modelValue,(p,V)=>(t(),a("tr",{key:V},[l("td",null,d(p.name),1),l("td",null,[(t(!0),a(B,null,E(p.permissions,(c,C)=>(t(),a("div",{key:C},[l("div",Q,[c.resource_id===null?(t(),a("span",W,d(c.resource_type)+" - (All) - "+d(c.method),1)):(t(),a("span",X,d(c.resource_type)+" - "+d(c.resource_id)+" - "+d(c.method),1))])]))),128))]),l("td",null,[G(i,{class:"secondary-button",onClick:c=>r("editGroup",p)},{default:f(()=>[h(" Edit ")]),_:2},1032,["onClick"]),G(i,{class:"usa-button usa-button--secondary",onClick:c=>r("deleteGroup",p.name)},{default:f(()=>[h(" Delete ")]),_:2},1032,["onClick"])])]))),128))])}}}),Z={key:0},O={class:"section-header"},ee={key:1},te=l("label",{class:"usa-label"},"Permissions",-1),oe={class:"multi-line-checkbox-div"},ae={key:0},se={key:1},le={class:"submit-footer"},ue=F({__name:"group-edit",props:{modelValue:{type:Object,required:!0},newGroupFlag:{type:Boolean,required:!0,default:!1}},emits:["cancel","submit"],async setup(y,{emit:_}){let r,v;const b=_,n=y,i=w({name:!1}),p=w([]),V=w([]);V.value=([r,v]=N(()=>R()),r=await r,v(),r),V.value&&V.value.forEach(o=>{p.value.push(new M(o.resource_type,o.resource_id,o.method,!1))}),p.value.forEach(o=>{n.modelValue.permissions.find(e=>e.resource_type===o.resource_type&&e.resource_id===o.resource_id&&e.method===o.method)&&(o.selected=!0)});function c(o,e){if(o)n.modelValue.permissions.push(new z(e.resource_type,e.resource_id,e.method));else{const u=n.modelValue.permissions.find(m=>m.resource_type===e.resource_type&&m.resource_id===e.resource_id&&m.method===e.method);if(u){const m=n.modelValue.permissions.indexOf(u);n.modelValue.permissions.splice(m,1)}}}function C(){i.value=H(i.value);let o=!1;n.newGroupFlag&&n.modelValue.name.trim()===""&&(i.value.name=!0,o=!0),!o&&b("submit",n.modelValue)}return(o,e)=>{const u=x("UsaTextInput"),m=x("UsaCheckbox"),U=x("UsaButton");return t(),a("div",null,[y.newGroupFlag?$("",!0):(t(),a("div",Z,[l("h1",O,d(y.modelValue.name),1)])),y.newGroupFlag?(t(),a("div",ee,[G(u,{modelValue:y.modelValue.name,"onUpdate:modelValue":e[0]||(e[0]=s=>y.modelValue.name=s),error:k(i).name},{label:f(()=>[h(" Group Name ")]),"error-message":f(()=>[h(" Group name is required ")]),_:1},8,["modelValue","error"])])):$("",!0),te,l("div",oe,[(t(!0),a(B,null,E(k(p),(s,A)=>(t(),a("span",{key:A,class:"multiple-per-line-checkbox"},[G(m,{modelValue:s.selected,"onUpdate:modelValue":[g=>s.selected=g,g=>c(s.selected,s)]},{default:f(()=>[s.resource_id===null?(t(),a("span",ae,d(s.resource_type)+" - (All) - "+d(s.method),1)):(t(),a("span",se,d(s.resource_type)+" - "+d(s.resource_id)+" - "+d(s.method),1))]),_:2},1032,["modelValue","onUpdate:modelValue"])]))),128))]),l("div",le,[G(U,{class:"primary-button",onClick:e[1]||(e[1]=s=>b("cancel"))},{default:f(()=>[h(" Cancel ")]),_:1}),G(U,{class:"primary-button",onClick:C},{default:f(()=>[h(" Save ")]),_:1})])])}}}),ne=l("title",null,"Manage Groups",-1),re={key:0},ce={key:1},pe=F({__name:"manage-groups",setup(y){const _=w(!1),r=w(!1),v=w([]),b=w(new q);n();async function n(){v.value=await S()}function i(){b.value=new q}function p(){i(),_.value=!0,r.value=!0}function V(e){b.value=e,_.value=!0,r.value=!1}async function c(e){if(!confirm("Are you sure you want to delete the group: "+e+"?"))return;await T(e)&&n()}function C(){confirm("Are you sure you want to cancel? All changes will be lost.")&&(_.value=!1,i())}async function o(e){let u=!0;r.value?await j(e)&&(u=!1):await I(e)&&(u=!1),u||(n(),i(),_.value=!1)}return(e,u)=>{const m=x("UsaButton"),U=Y,s=ue,A=D;return t(),P(A,{name:"base-layout"},{"page-title":f(()=>[h("Manage Groups")]),default:f(()=>[ne,k(_)?$("",!0):(t(),a("div",re,[G(m,{class:"secondary-button sub-header-float-button",onClick:p},{default:f(()=>[h(" Add Group ")]),_:1}),G(U,{modelValue:k(v),"onUpdate:modelValue":u[0]||(u[0]=g=>L(v)?v.value=g:null),onEditGroup:V,onDeleteGroup:c},null,8,["modelValue"])])),k(_)?(t(),a("div",ce,[G(s,{modelValue:k(b),"onUpdate:modelValue":u[1]||(u[1]=g=>L(b)?b.value=g:null),"new-group-flag":k(r),onCancel:C,onSubmit:o},null,8,["modelValue","new-group-flag"])])):$("",!0)]),_:1})}}});export{pe as default};
