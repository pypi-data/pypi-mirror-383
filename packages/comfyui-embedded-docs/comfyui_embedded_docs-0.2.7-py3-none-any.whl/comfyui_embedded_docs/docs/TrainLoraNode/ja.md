> このドキュメントは AI によって生成されました。エラーを見つけた場合や改善のご提案がある場合は、ぜひ貢献してください！ [GitHub で編集](https://github.com/Comfy-Org/embedded-docs/blob/main/comfyui_embedded_docs/docs/TrainLoraNode/ja.md)

TrainLoraNodeは、提供された潜在変数と条件付けデータを使用して拡散モデル上でLoRA（Low-Rank Adaptation）モデルを作成およびトレーニングします。カスタムトレーニングパラメータ、オプティマイザ、損失関数を使用してモデルを微調整することができます。このノードは、LoRAが適用されたトレーニング済みモデル、LoRAの重み、トレーニング損失メトリクス、および完了した総トレーニングステップ数を出力します。

## 入力

| パラメータ | データ型 | 必須 | 範囲 | 説明 |
|-----------|-----------|----------|-------|-------------|
| `model` | MODEL | はい | - | LoRAをトレーニングする対象のモデル。 |
| `latents` | LATENT | はい | - | トレーニングに使用する潜在変数。モデルのデータセット/入力として機能します。 |
| `positive` | CONDITIONING | はい | - | トレーニングに使用するポジティブな条件付け。 |
| `batch_size` | INT | はい | 1-10000 | トレーニングに使用するバッチサイズ（デフォルト: 1）。 |
| `grad_accumulation_steps` | INT | はい | 1-1024 | トレーニングに使用する勾配累積ステップ数（デフォルト: 1）。 |
| `steps` | INT | はい | 1-100000 | LoRAをトレーニングするステップ数（デフォルト: 16）。 |
| `learning_rate` | FLOAT | はい | 0.0000001-1.0 | トレーニングに使用する学習率（デフォルト: 0.0005）。 |
| `rank` | INT | はい | 1-128 | LoRAレイヤーのランク（デフォルト: 8）。 |
| `optimizer` | COMBO | はい | "AdamW"<br>"Adam"<br>"SGD"<br>"RMSprop" | トレーニングに使用するオプティマイザ（デフォルト: "AdamW"）。 |
| `loss_function` | COMBO | はい | "MSE"<br>"L1"<br>"Huber"<br>"SmoothL1" | トレーニングに使用する損失関数（デフォルト: "MSE"）。 |
| `seed` | INT | はい | 0-18446744073709551615 | トレーニングに使用するシード（LoRA重みの初期化とノイズサンプリングのジェネレーターで使用）（デフォルト: 0）。 |
| `training_dtype` | COMBO | はい | "bf16"<br>"fp32" | トレーニングに使用するデータ型（デフォルト: "bf16"）。 |
| `lora_dtype` | COMBO | はい | "bf16"<br>"fp32" | LoRAに使用するデータ型（デフォルト: "bf16"）。 |
| `algorithm` | COMBO | はい | 複数のオプションが利用可能 | トレーニングに使用するアルゴリズム。 |
| `gradient_checkpointing` | BOOLEAN | はい | - | トレーニングに勾配チェックポイントを使用する（デフォルト: True）。 |
| `existing_lora` | COMBO | はい | 複数のオプションが利用可能 | 追加する既存のLoRA。新しいLoRAの場合はNoneに設定します（デフォルト: "[None]"）。 |

**注意:** ポジティブな条件付け入力の数は、潜在画像の数と一致する必要があります。複数の画像に対して1つのポジティブな条件付けのみが提供された場合、すべての画像に対して自動的に繰り返されます。

## 出力

| 出力名 | データ型 | 説明 |
|-------------|-----------|-------------|
| `model_with_lora` | MODEL | トレーニングされたLoRAが適用された元のモデル。 |
| `lora` | LORA_MODEL | 保存したり他のモデルに適用したりできる、トレーニングされたLoRAの重み。 |
| `loss` | LOSS_MAP | 時間経過に伴うトレーニング損失値を含む辞書。 |
| `steps` | INT | 完了した総トレーニングステップ数（既存のLoRAからの以前のステップを含む）。 |
