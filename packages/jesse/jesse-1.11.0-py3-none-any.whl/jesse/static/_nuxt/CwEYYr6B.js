import{_ as Le}from"./Df8SRAdQ.js";import{g as He,V as Ee,h as Oe,r as c,v as qe,i as P,a7 as Ie,a8 as z,I as w,c as m,b as e,d as a,K as o,l as F,k as Ge,F as ye,p as be,w as g,Q as T,q as Je,a3 as Ke,a9 as Qe,C as We,o as d,t as _,m as ke,L as we,N as C,X as Xe,e as Ce,aa as Ye,H as L}from"./DClyChXX.js";import{_ as Ze}from"./HOilEgTM.js";import{_ as et}from"./57ZEouOQ.js";import{_ as tt}from"./BSYxhJPh.js";import{u as st}from"./C3vgktDp.js";import"./BKzONYoj.js";import"./CB7fxO7O.js";const at={class:"w-full"},lt={class:"mt-4 md:mt-8 p-3 md:p-4"},ot={class:"mb-6 flex flex-col gap-4 md:flex-row md:items-center md:justify-between"},nt={class:"flex items-center gap-3"},it={class:"flex flex-col gap-3 sm:flex-row sm:items-center"},rt={key:0,class:"space-y-4"},ct={class:"bg-white dark:bg-gray-800 shadow rounded-lg overflow-hidden"},dt={class:"divide-y divide-gray-200 dark:divide-gray-700"},ut={class:"hidden md:grid md:grid-cols-12 gap-4 items-center"},mt={class:"col-span-3"},_t={class:"col-span-2"},vt={class:"col-span-2 text-center"},pt={class:"col-span-2 text-center"},ft={class:"col-span-2"},gt={class:"col-span-1 flex justify-end gap-2"},ht={class:"md:hidden space-y-3"},xt={class:"flex items-start justify-between"},yt={class:"flex-1"},bt={class:"flex items-center justify-between"},kt={class:"flex items-center justify-between"},wt={class:"flex gap-1"},Ct={key:1,class:"space-y-4"},St={class:"bg-white dark:bg-gray-800 shadow rounded-lg overflow-hidden"},Vt={class:"divide-y divide-gray-200 dark:divide-gray-700"},Ut=["onClick"],Nt={class:"hidden md:grid md:grid-cols-12 gap-4 items-center"},zt={class:"col-span-3"},Tt={class:"text-sm font-medium text-gray-900 dark:text-white"},$t={class:"text-xs text-gray-500 dark:text-gray-400"},Dt={class:"col-span-2"},Bt={class:"text-sm text-gray-700 dark:text-gray-300"},jt={class:"text-xs text-gray-500 dark:text-gray-400"},At={class:"col-span-2 text-center"},Mt={key:1,class:"text-sm text-gray-400"},Rt={class:"col-span-2 text-center"},Pt={class:"col-span-2 text-sm text-gray-500 dark:text-gray-400"},Ft={class:"col-span-1 flex justify-end gap-2"},Lt={class:"md:hidden space-y-3"},Ht={class:"flex items-start justify-between"},Et={class:"flex-1 min-w-0"},Ot={class:"text-sm font-medium text-gray-900 dark:text-white truncate"},qt={class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},It={class:"flex items-center justify-between text-sm"},Gt={class:"flex items-center gap-3"},Jt={class:"text-gray-700 dark:text-gray-300 font-medium"},Kt={class:"text-gray-500 dark:text-gray-400 text-xs ml-1"},Qt={key:1,class:"text-sm text-gray-400"},Wt={class:"flex items-center justify-between"},Xt={class:"text-xs text-gray-500 dark:text-gray-400"},Yt={class:"flex gap-1"},Zt={key:0,class:"flex justify-center"},es={key:2,class:"bg-white dark:bg-gray-800 shadow rounded-lg p-12 text-center"},ts={class:"p-4"},ss={class:"flex justify-end gap-3"},as={class:"p-6"},ls={class:"mb-6"},os={class:"flex justify-end gap-3"},$=50,ps=He({__name:"history",setup(ns){st({title:"Backtest History - Jesse"});const S=Ee(),Se=Oe(()=>S.tabs),v=c([]),h=c(!1),x=c(null),U=c(!1),D=c(!1),B=c(!0),f=c(0),N=c(!1),p=c(null),y=c(!1),j=c(!1),b=c(30),i=c({title:"",status:"all",dateRange:"all_time"}),Ve=[{label:"All Statuses",value:"all"},{label:"Running",value:"running"},{label:"Finished",value:"finished"},{label:"Stopped",value:"stopped"},{label:"Cancelled",value:"cancelled"}],Ue=[{label:"All Time",value:"all_time"},{label:"Last 7 Days",value:"7_days"},{label:"Last 30 Days",value:"30_days"},{label:"Last 90 Days",value:"90_days"}],Ne=[{label:"1 day",value:1},{label:"7 days",value:7},{label:"30 days",value:30},{label:"3 months",value:90},{label:"6 months",value:180},{label:"1 year",value:365},{label:"2 years",value:730},{label:"All existing sessions",value:-1}];qe(()=>{setTimeout(()=>{V()},20)});const ze=Ie(()=>{f.value=0,V()},300);P(()=>i.value.title,()=>{ze()}),P(()=>i.value.status,()=>{f.value=0,V()}),P(()=>i.value.dateRange,()=>{f.value=0,V()});async function V(){var l;U.value=!0;try{const r=(await z("/backtest/sessions",{limit:$,offset:0,title_search:i.value.title||null,status_filter:i.value.status||null,date_filter:i.value.dateRange||null},!0)).data.value;v.value=(r==null?void 0:r.sessions)||[],f.value=v.value.length,B.value=((l=r==null?void 0:r.sessions)==null?void 0:l.length)===$}catch(t){w(t)}finally{U.value=!1}}async function Te(){D.value=!0;try{const t=(await z("/backtest/sessions",{limit:$,offset:f.value,title_search:i.value.title||null,status_filter:i.value.status||null,date_filter:i.value.dateRange||null},!0)).data.value,r=(t==null?void 0:t.sessions)||[];v.value=[...v.value,...r],f.value+=r.length,B.value=r.length===$}catch(l){w(l)}finally{D.value=!1}}function H(l){switch(l.toLowerCase()){case"running":return"blue";case"finished":return"green";case"stopped":return"red";case"cancelled":return"gray";default:return"gray"}}async function A(l){await S.loadSession(l)}function E(l){x.value=l,h.value=!0}async function $e(){x.value&&(await Be(x.value),v.value=v.value.filter(l=>l.id!==x.value),f.value-=1),h.value=!1,x.value=null}function De(){h.value=!1,x.value=null}async function Be(l){if(S.tabs[l]){L("error","Cannot delete a session that is currently open in a tab. Close the tab first.");return}try{const t=await z(`/backtest/sessions/${l}/remove`,{},!0);if(t.error.value){w(t.error.value);return}L("success","Session deleted successfully")}catch(t){w(t)}}function O(l){p.value=l,N.value=!0}async function je(){j.value=!0;try{const l=await z("/backtest/purge-sessions",{days_old:b.value===-1?null:b.value},!0);if(l.error.value){w(l.error.value);return}const t=l.data.value;L("success",`Successfully purged ${t.deleted_count} session(s)`),y.value=!1,f.value=0,await V()}catch(l){w(l)}finally{j.value=!1}}function Ae(){y.value=!1,b.value=30}function Me(l){if(p.value){const t=v.value.find(r=>r.id===p.value.id);t&&(t.title=l.title,t.description=l.description,p.value.title=l.title,p.value.description=l.description)}}return(l,t)=>{const r=Le,u=Je,Re=Ke,M=Qe,n=Ze,q=et,R=Xe,I=We,Pe=tt,Fe=Ye;return d(),m("div",null,[e("div",at,[a(r,{"current-tab":null,tabs:o(Se),onClose:o(S).closeTab,onCancel:o(S).cancel},null,8,["tabs","onClose","onCancel"])]),e("div",lt,[e("div",ot,[e("div",nt,[t[8]||(t[8]=e("h1",{class:"text-xl md:text-2xl font-bold text-gray-900 dark:text-white"}," Backtest History ",-1)),a(u,{icon:"i-heroicons-trash",color:"red",variant:"soft",size:"sm",label:"Purge",onClick:t[0]||(t[0]=s=>y.value=!0)})]),e("div",it,[a(Re,{modelValue:o(i).title,"onUpdate:modelValue":t[1]||(t[1]=s=>o(i).title=s),placeholder:"Search by title...",icon:"i-heroicons-magnifying-glass",size:"sm",class:"w-full sm:w-64"},null,8,["modelValue"]),a(M,{modelValue:o(i).status,"onUpdate:modelValue":t[2]||(t[2]=s=>o(i).status=s),options:Ve,size:"sm",class:"w-full sm:w-40"},null,8,["modelValue"]),a(M,{modelValue:o(i).dateRange,"onUpdate:modelValue":t[3]||(t[3]=s=>o(i).dateRange=s),options:Ue,size:"sm",class:"w-full sm:w-40"},null,8,["modelValue"])])]),o(U)?(d(),m("div",rt,[e("div",ct,[e("div",dt,[(d(),m(ye,null,be(5,s=>e("div",{key:s,class:"p-4"},[e("div",ut,[e("div",mt,[a(n,{class:"h-4 w-full mb-2"}),a(n,{class:"h-3 w-2/3"})]),e("div",_t,[a(n,{class:"h-4 w-full mb-2"}),a(n,{class:"h-3 w-2/3"})]),e("div",vt,[a(n,{class:"h-4 w-16 mx-auto"})]),e("div",pt,[a(n,{class:"h-6 w-20 mx-auto"})]),e("div",ft,[a(n,{class:"h-4 w-full"})]),e("div",gt,[a(n,{class:"h-8 w-8"}),a(n,{class:"h-8 w-8"}),a(n,{class:"h-8 w-8"})])]),e("div",ht,[e("div",xt,[e("div",yt,[a(n,{class:"h-4 w-3/4 mb-2"}),a(n,{class:"h-3 w-1/2"})]),a(n,{class:"h-6 w-16 ml-2"})]),e("div",bt,[a(n,{class:"h-4 w-24"}),a(n,{class:"h-4 w-16"})]),e("div",kt,[a(n,{class:"h-3 w-32"}),e("div",wt,[a(n,{class:"h-8 w-8"}),a(n,{class:"h-8 w-8"}),a(n,{class:"h-8 w-8"})])])])])),64))])])])):o(v).length?(d(),m("div",Ct,[e("div",St,[e("div",Vt,[(d(!0),m(ye,null,be(o(v),s=>{var G,J,K,Q,W,X,Y,Z,ee,te,se,ae,le,oe,ne,ie,re,ce,de,ue,me,_e,ve,pe,fe,ge,he,xe;return d(),m("div",{key:s.id,class:"p-4 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors cursor-pointer",onClick:k=>A(s.id)},[e("div",Nt,[e("div",zt,[e("div",Tt,_(s.title||((Q=(K=(J=(G=s.state)==null?void 0:G.form)==null?void 0:J.routes)==null?void 0:K[0])==null?void 0:Q.strategy)||"Unknown Strategy"),1),e("div",$t,_(((X=(W=s.state)==null?void 0:W.form)==null?void 0:X.exchange)||"Unknown Exchange"),1)]),e("div",Dt,[e("div",Bt,_(((te=(ee=(Z=(Y=s.state)==null?void 0:Y.form)==null?void 0:Z.routes)==null?void 0:ee[0])==null?void 0:te.symbol)||"N/A"),1),e("div",jt,_(((oe=(le=(ae=(se=s.state)==null?void 0:se.form)==null?void 0:ae.routes)==null?void 0:le[0])==null?void 0:oe.timeframe)||"N/A"),1)]),e("div",At,[s.net_profit_percentage!==null&&s.net_profit_percentage!==void 0?(d(),m("span",{key:0,class:ke([s.net_profit_percentage>0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400","text-sm font-semibold"])},_(s.net_profit_percentage.toFixed(2))+"% ",3)):(d(),m("span",Mt,"N/A"))]),e("div",Rt,[a(q,{color:H(s.status),label:s.status,variant:"soft",size:"sm"},null,8,["color","label"])]),e("div",Pt,_(o(we).timestampToReadableDateTime(s.updated_at)),1),e("div",Ft,[a(R,{text:"Add Note",popper:{arrow:!0}},{default:g(()=>[a(u,{icon:"i-heroicons-pencil-square",variant:"ghost",size:"sm",color:"gray",onClick:C(k=>O(s),["stop"])},null,8,["onClick"])]),_:2},1024),a(R,{text:"Load Session",popper:{arrow:!0}},{default:g(()=>[a(u,{icon:"i-heroicons-arrow-right",variant:"ghost",size:"sm",color:"gray",onClick:C(k=>A(s.id),["stop"])},null,8,["onClick"])]),_:2},1024),a(R,{text:"Delete",popper:{arrow:!0}},{default:g(()=>[a(u,{icon:"i-heroicons-trash",variant:"ghost",size:"sm",color:"red",onClick:C(k=>E(s.id),["stop"])},null,8,["onClick"])]),_:2},1024)])]),e("div",Lt,[e("div",Ht,[e("div",Et,[e("div",Ot,_(s.title||((ce=(re=(ie=(ne=s.state)==null?void 0:ne.form)==null?void 0:ie.routes)==null?void 0:re[0])==null?void 0:ce.strategy)||"Unknown Strategy"),1),e("div",qt,_(((ue=(de=s.state)==null?void 0:de.form)==null?void 0:ue.exchange)||"Unknown Exchange"),1)]),a(q,{color:H(s.status),label:s.status,variant:"soft",size:"sm",class:"ml-2 flex-shrink-0"},null,8,["color","label"])]),e("div",It,[e("div",Gt,[e("div",null,[e("span",Jt,_(((pe=(ve=(_e=(me=s.state)==null?void 0:me.form)==null?void 0:_e.routes)==null?void 0:ve[0])==null?void 0:pe.symbol)||"N/A"),1),e("span",Kt,_(((xe=(he=(ge=(fe=s.state)==null?void 0:fe.form)==null?void 0:ge.routes)==null?void 0:he[0])==null?void 0:xe.timeframe)||"N/A"),1)])]),s.net_profit_percentage!==null&&s.net_profit_percentage!==void 0?(d(),m("span",{key:0,class:ke([s.net_profit_percentage>0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400","text-sm font-bold"])},_(s.net_profit_percentage.toFixed(2))+"% ",3)):(d(),m("span",Qt,"N/A"))]),e("div",Wt,[e("div",Xt,_(o(we).timestampToReadableDateTime(s.updated_at)),1),e("div",Yt,[a(u,{icon:"i-heroicons-pencil-square",variant:"ghost",size:"sm",color:"gray",onClick:C(k=>O(s),["stop"])},null,8,["onClick"]),a(u,{icon:"i-heroicons-arrow-right",variant:"ghost",size:"sm",color:"gray",onClick:C(k=>A(s.id),["stop"])},null,8,["onClick"]),a(u,{icon:"i-heroicons-trash",variant:"ghost",size:"sm",color:"red",onClick:C(k=>E(s.id),["stop"])},null,8,["onClick"])])])])],8,Ut)}),128))])]),o(B)?(d(),m("div",Zt,[a(u,{label:"Load More",variant:"soft",color:"gray",loading:o(D),onClick:Te},null,8,["loading"])])):F("",!0)])):!o(U)&&o(v).length===0?(d(),m("div",es,t[9]||(t[9]=[e("div",{class:"text-gray-400 dark:text-gray-500"},[e("i",{class:"i-heroicons-clock h-12 w-12 mx-auto mb-4"}),e("p",{class:"text-lg"},"No backtest history found"),e("p",{class:"text-sm mt-2"},"Run a backtest or change filters to see items in backtest your history")],-1)]))):F("",!0),a(I,{modelValue:o(h),"onUpdate:modelValue":t[4]||(t[4]=s=>T(h)?h.value=s:null)},{default:g(()=>[e("div",ts,[t[12]||(t[12]=e("h3",{class:"text-lg font-medium leading-6 text-gray-900 dark:text-white mb-4"}," Confirm Deletion ",-1)),t[13]||(t[13]=e("p",{class:"text-sm text-gray-500 dark:text-gray-400 mb-6"}," Are you sure you want to delete this backtest session? This action cannot be undone. ",-1)),e("div",ss,[a(u,{color:"gray",variant:"ghost",onClick:De},{default:g(()=>t[10]||(t[10]=[Ce(" Cancel ")])),_:1}),a(u,{color:"red",onClick:$e},{default:g(()=>t[11]||(t[11]=[Ce(" Delete ")])),_:1})])])]),_:1},8,["modelValue"]),o(p)?(d(),Ge(Pe,{key:3,modelValue:o(N),"onUpdate:modelValue":t[5]||(t[5]=s=>T(N)?N.value=s:null),"session-id":o(p).id,"initial-title":o(p).title,"initial-description":o(p).description,onSaved:Me},null,8,["modelValue","session-id","initial-title","initial-description"])):F("",!0),a(I,{modelValue:o(y),"onUpdate:modelValue":t[7]||(t[7]=s=>T(y)?y.value=s:null)},{default:g(()=>[e("div",as,[t[16]||(t[16]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"}," Purge Backtest Sessions ",-1)),e("div",ls,[t[14]||(t[14]=e("div",{class:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 mb-4"},[e("div",{class:"flex items-start gap-3"},[e("i",{class:"i-heroicons-exclamation-triangle text-red-600 dark:text-red-400 text-xl flex-shrink-0 mt-0.5"}),e("div",{class:"text-sm text-red-800 dark:text-red-200"},[e("p",{class:"font-semibold mb-1"}," Warning: This action is permanent! "),e("p",null,"Deleted sessions cannot be recovered. Please select carefully.")])])],-1)),a(Fe,{label:"Delete sessions older than:",class:"mb-4"},{default:g(()=>[a(M,{modelValue:o(b),"onUpdate:modelValue":t[6]||(t[6]=s=>T(b)?b.value=s:null),options:Ne,size:"md"},null,8,["modelValue"])]),_:1}),t[15]||(t[15]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400"}," This will permanently delete all backtest sessions that match your criteria. ",-1))]),e("div",os,[a(u,{color:"gray",variant:"ghost",label:"Cancel",onClick:Ae}),a(u,{color:"red",label:"Purge Sessions",loading:o(j),onClick:je},null,8,["loading"])])])]),_:1},8,["modelValue"])])])}}});export{ps as default};
