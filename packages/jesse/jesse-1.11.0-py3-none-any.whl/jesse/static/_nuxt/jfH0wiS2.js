import{g as H,W as J,T as K,r as d,h as k,i as Q,v as X,c as g,b as r,d as i,l as m,K as _,F as A,p as G,q as R,o as s,w as x,e as B,a3 as Y,k as c,t as Z,L as C,X as ee,H as h}from"./DClyChXX.js";import{_ as te}from"./B65OE2Ty.js";import{_ as ne}from"./57ZEouOQ.js";import{_ as ae}from"./Cyc7KzJj.js";import{_ as oe}from"./AmEUVatr.js";import{u as se}from"./C3vgktDp.js";const le={class:"container my-8 pb-24 flex flex-col min-h-screen"},ie={class:"pb-12 flex-grow"},re={class:"flex justify-between items-center mb-4"},ce={class:"flex gap-2"},ue={class:"flex flex-col lg:flex-row gap-4 items-center"},de={class:"flex flex-col sm:flex-row gap-2 sm:gap-0"},me={class:"flex-grow flex justify-center"},pe={class:"flex items-center gap-2 justify-end"},ve=H({__name:"index",setup(ge){se({title:"Import Candles - Jesse"});const a=J(),S=K(),y=d([]),u=d(""),f=d([]),V=k(()=>S.backtestingExchangeNames),E=k(()=>a.forms.some(e=>!e.executing)),T=k(()=>a.forms.some(e=>e.executing)),b=d(new Set),v=d(new Set);function I(){const e=a.forms[a.forms.length-1];a.forms.push({id:C.uuid(),exchange:e.exchange,symbol:e.symbol,start_date:e.start_date,executing:!1,waiting:!1,progressbar:{current:0,estimated_remaining_seconds:0},exception:{error:"",traceback:""},alert:{message:"",type:""}})}function M(e){const t=a.forms.indexOf(e);a.forms.splice(t+1,0,{id:C.uuid(),exchange:e.exchange,symbol:e.symbol,start_date:e.start_date,executing:!1,waiting:!1,progressbar:{current:0,estimated_remaining_seconds:0},exception:{error:"",traceback:""},alert:{message:"",type:""}})}async function q(e){b.value.add(e.id),e.executing&&await w(e.id);const t=a.forms.indexOf(e);a.forms.length>1&&a.forms.splice(t,1),b.value.delete(e.id)}async function U(e){const t=await S.getExchangeSupportedSymbols(e.exchange);f.value=t,t.includes(e.symbol)||(e.symbol=t[0]),z(u.value)}function z(e){if(e.length==0||!f.value.length){y.value=[];return}const t=[];for(const o of f.value){if(t.length>50)break;o.toLowerCase().startsWith(e.toLowerCase())&&t.push(o)}y.value=t}Q(()=>u.value,e=>{z(e)});function F(e){const t=a.forms.find(o=>o.id===e);t&&L(t)&&a.start(e)}function L(e){return e.exchange?e.symbol?e.symbol.includes("-")?e.start_date?!0:(h("error","Start date parameter cannot be empty"),!1):(h("error",'Symbol parameter must contain "-" character!'),!1):(h("error","Symbol parameter cannot be empty"),!1):(h("error","Exchange parameter cannot be empty"),!1)}X(()=>{a.forms[0].exchange||(a.forms[0].exchange=V.value[0]),setTimeout(()=>{U(a.forms[0])},100)});async function w(e){v.value.add(e),await a.cancel(e),v.value.delete(e)}async function W(){const e=a.forms.filter(t=>!t.executing);await Promise.all(e.map(t=>F(t.id)))}async function j(){const e=a.forms.filter(t=>t.executing||t.waiting);await Promise.all(e.map(t=>w(t.id)))}return(e,t)=>{const o=R,$=te,D=Y,O=ne,N=ee,p=ae,P=oe;return s(),g("div",le,[r("div",ie,[r("div",re,[i(o,{class:"shadow-sm px-4 py-1.5",icon:"i-heroicons-plus",size:"lg",variant:"solid",label:"Add",onClick:I}),r("div",ce,[_(a).forms.length>1?(s(),g(A,{key:0},[i(o,{class:"shadow-sm px-4 py-1.5",icon:"i-heroicons-arrow-down-tray",size:"lg",variant:"outline",label:"Import All",disabled:!E.value,onClick:W},null,8,["disabled"]),i(o,{class:"shadow-sm px-4 py-1.5",icon:"i-heroicons-x-mark",variant:"outline",size:"lg",color:"rose",label:"Cancel All",disabled:!T.value,onClick:j},null,8,["disabled"])],64)):m("",!0),i(o,{class:"shadow-sm px-4 py-1.5",icon:"i-heroicons-wrench",size:"lg",variant:"outline",color:"gray",label:"Manage",to:"/candles/manage"})])]),(s(!0),g(A,null,G(_(a).forms,n=>(s(),g("div",{key:n.id,class:"mt-4 border rounded-lg p-4 bg-white dark:border-gray-900 dark:bg-gray-800"},[r("div",ue,[r("div",de,[i($,{modelValue:n.exchange,"onUpdate:modelValue":l=>n.exchange=l,class:"w-full sm:w-48",ui:{base:"sm:rounded-r-none",input:"rounded-lg sm:rounded-r-none sm:rounded-l-lg"},searchable:"",size:"lg",options:V.value,placeholder:"Select exchange...",onChange:()=>U(n)},null,8,["modelValue","onUpdate:modelValue","options","onChange"]),i($,{modelValue:n.symbol,"onUpdate:modelValue":l=>n.symbol=l,query:u.value,"onUpdate:query":t[0]||(t[0]=l=>u.value=l),"clear-search-on-close":"",class:"w-full sm:w-64",ui:{base:"sm:rounded-none",input:"rounded-lg sm:rounded-none"},searchable:"",size:"lg",options:y.value,placeholder:"Select symbol...",onChange:t[1]||(t[1]=l=>u.value="")},{empty:x(()=>t[2]||(t[2]=[B("Start typing...")])),_:2},1032,["modelValue","onUpdate:modelValue","query","options"]),i(D,{modelValue:n.start_date,"onUpdate:modelValue":l=>n.start_date=l,type:"date",size:"lg",class:"w-full sm:w-48",ui:{base:"sm:rounded-l-none",input:"rounded-lg sm:rounded-l-none sm:rounded-r-lg"}},null,8,["modelValue","onUpdate:modelValue"])]),r("div",me,[n.executing?(s(),c(O,{key:0,color:"blue",variant:"subtle"},{default:x(()=>[B(Z(_(C).remainingTimeText(n.progressbar.estimated_remaining_seconds)),1)]),_:2},1024)):m("",!0)]),r("div",pe,[n.executing?(s(),c(o,{key:1,size:"sm",variant:"soft",color:"rose",label:"Cancel",icon:"i-heroicons-x-mark",loading:v.value.has(n.id),onClick:l=>w(n.id)},null,8,["loading","onClick"])):(s(),c(o,{key:0,size:"sm",variant:"soft",label:"Import",color:"primary",icon:"i-heroicons-arrow-down-tray",onClick:l=>F(n.id)},null,8,["onClick"])),i(N,{text:"Duplicate"},{default:x(()=>[i(o,{size:"sm",variant:"link",color:"gray",icon:"i-heroicons-document-duplicate",onClick:l=>M(n)},null,8,["onClick"])]),_:2},1024),_(a).forms.length>1?(s(),c(N,{key:2,text:"Delete"},{default:x(()=>[i(o,{size:"sm",variant:"link",color:"rose",icon:"i-heroicons-trash",loading:b.value.has(n.id),onClick:l=>q(n)},null,8,["loading","onClick"])]),_:2},1024)):m("",!0)])]),r("div",null,[n.alert.type==="info"?(s(),c(p,{key:0,class:"mt-4",color:"gray",variant:"soft",icon:"i-heroicons-information-circle",title:n.alert.message},null,8,["title"])):m("",!0),n.waiting?(s(),c(p,{key:1,class:"mt-4",color:"yellow",variant:"soft",icon:"i-heroicons-clock",title:`Queued: Waiting for the current '${n.exchange}' import to finish...`},null,8,["title"])):n.executing?(s(),c(P,{key:2,value:n.progressbar.current,indicator:"",class:"w-full mt-4"},null,8,["value"])):n.exception.error?(s(),c(p,{key:3,class:"mt-4",color:"red",variant:"soft",icon:"i-heroicons-exclamation-triangle",title:n.exception.error},null,8,["title"])):n.alert.type==="success"?(s(),c(p,{key:4,class:"mt-4",color:"green",variant:"soft",icon:"i-heroicons-check-circle",title:n.alert.message},null,8,["title"])):m("",!0)])]))),128)),t[3]||(t[3]=r("div",{class:"h-24 md:h-32"},null,-1))])])}}});export{ve as default};
