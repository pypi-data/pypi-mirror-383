# https://docs.github.com/en/actions/tutorials/build-and-test-code/python
name: Tests ðŸ”¬
# Alt emojis: https://emojidb.org/debug-emojis ðŸ‘€ ðŸ”Ž ðŸ‘· ðŸš§ ðŸ› ï¸ ðŸ”¨ ðŸ‘¾ ðŸ¤– ðŸ‘¨ðŸ»â€ðŸ’» ðŸ§

on:
  push:
    branches: [ main ]
    paths:
      - '**.py'
      - 'pyproject.toml'
  pull_request:
    branches: [ main ]
    # types: [ opened, synchronize, reopened ]  # default values; comments, labels, etc. are ignored
    paths:
      - '**.py'
      - 'pyproject.toml'

permissions:
  contents: read

jobs:
  test:
    # runs-on: ${{ matrix.os }}  # when multi-OS-testing specified below
    runs-on: ubuntu-latest
    timeout-minutes: 5  # Prevent stuck jobs

    strategy:
      matrix:
        # To test on multiple OSes:
        # https://docs.github.com/en/actions/tutorials/build-and-test-code/python#excluding-a-version
        # os: [ubuntu-latest, macos-latest, windows-latest]

        # Python versions to test against:
        python-version:
          # > The version '3.7' with architecture 'x64' was not found for Ubuntu 24.04.
          # - '3.7'  # seems no longer supported by GitHub
          - '3.8'
          - '3.9'
          - '3.10'
          - '3.11'
          - '3.12'
          - '3.13'
          - '3.14'

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python ${{ matrix.python-version }}
        uses: actions/setup-python@v5
        with:
          python-version: ${{ matrix.python-version }}
          cache: 'pip'  # Enable built-in pip caching
          cache-dependency-path: 'pyproject.toml'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          # Just to be safe, in case some pytest plugins need the package itself installed into venv,
          # do the "editable" install... and since we're doing it anyway,
          # let's also install the test dependencies from pyproject.toml, too:
          pip install -e .[test]
          # Alternatively:
          # pip install pytest pytest-cov  # Only test deps, no package, but doesn't use deps from pyproject.toml

      - name: Run tests with pytest
        run: |
          python -m pytest
