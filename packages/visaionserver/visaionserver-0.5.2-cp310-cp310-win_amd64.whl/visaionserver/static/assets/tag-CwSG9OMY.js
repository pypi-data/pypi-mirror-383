import{a5 as s,al as o}from"./index-DKhC6MDA.js";const i={projectTags:"/tags/list",create:"/tags/create",update:"/tags/update",delete:"/tags/delete",batchCreate:"/tags/batch",bindSamples:"/tags/bind_samples",deleteBatch:"/tags/batch_delete",bindSamplesByFilter:"/tags/bind_samples_with_filter",unbindSample:"/tags/unbind_sample"};function d(t){return s.get(i.projectTags,{params:t})}function g(t){return s.post(i.create,t)}function l(t){return s.post(i.batchCreate,t)}function h(t){return s.patch(i.update,t)}function u(t){return s.post(i.delete,t)}function f(t){return s.post(i.bindSamples,t)}function p(t){return s.post(i.deleteBatch,t)}function b(t){return s.post(i.bindSamplesByFilter,t)}function T(t){return s.post(i.unbindSample,t)}const y=o("tag",{state:()=>({tags:[],total:0,loading:!1,lastFetchTime:0,currentProjectId:null,currentParams:{}}),getters:{getTagById:t=>e=>t.tags.find(a=>a.id===e),getTagsByIds:t=>e=>t.tags.filter(a=>e.includes(a.id))},actions:{async fetchTags(t,e={}){const a=Date.now(),r=JSON.stringify({...this.currentParams,...e})===JSON.stringify(this.currentParams);if(this.tags.length>0&&this.currentProjectId===t&&a-this.lastFetchTime<5e3&&r&&!e.forceRefresh)return{tags:this.tags,total:this.total};this.loading=!0;try{const n={project_id:t,...e};delete n.forceRefresh,this.currentParams=n;const c=await d(n);return c.data.code===200&&(this.tags=c.data.data.tags||[],this.total=c.data.data.total||0,this.lastFetchTime=a,this.currentProjectId=t),{tags:this.tags,total:this.total}}catch(n){throw console.error("获取标签列表失败:",n),n}finally{this.loading=!1}},async deleteTag(t){const e=await u(t);return e.data.code===200&&(this.tags=this.tags.filter(a=>a.id!==t.tag_id),this.total>0&&this.total--),e},async updateTag(t){const e=await h(t);if(e.data.code===200){const a=this.tags.findIndex(r=>r.id===t.id);a!==-1&&(this.tags[a]={...this.tags[a],...e.data.data})}return e},async createTag(t){const e=await g(t);return e.data.code===200&&await this.fetchTags(t.project_id,{forceRefresh:!0}),e},async batchCreateTags(t){const e=await l(t);return e.data.code===200&&await this.fetchTags(t.project_id,{forceRefresh:!0}),e},async bindSamplesToTags(t){return await f(t)},async deleteBatchTags(t){const e=await p(t);return e.data.code===200&&(this.tags=this.tags.filter(a=>!t.tag_ids.includes(a.id)),this.total=Math.max(0,this.total-t.tag_ids.length)),e},async unbindSample(t){return await T(t)}}});export{b as a,g as c,d as g,f as t,y as u};
//# sourceMappingURL=tag-CwSG9OMY.js.map
