import{d as re,u as ne,r,V as ie,c as de,b as i,e as s,w as l,g as d,i as N,j as f,aw as ue,a7 as ce,aK as me,$ as pe,E as c,q as m,t as y,B as ge,a3 as ve,m as S,A as T,aL as K,k as fe,l as _e,aM as he,N as be,M as P,aN as q,o as C}from"./index-DKhC6MDA.js";import{_ as we}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ye={class:"user-list-container"},xe={class:"page-header"},Ce={class:"title-section"},ke={class:"action-section"},Fe={class:"search-box"},Ve={class:"main-content"},Ue={class:"user-info"},ze={class:"username"},Be={class:"time-info"},Ae={class:"action-buttons"},Se={class:"table-footer"},$e={class:"dialog-footer"},Ee=re({__name:"UserList",setup(De){const Z=ne(),_=r(""),k=r(!1),h=r(1),F=r(10),V=r(0),$=r([]),p=r(!1),U=r("编辑用户"),u=r(!1),b=r(),z=r(!1),n=r({id:"",username:"",password:""}),R=r({username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:2,max:20,message:"用户名长度应为 2-20 个字符",trigger:"blur"},{pattern:/^[a-zA-Z0-9_-]+$/,message:"用户名只能包含字母、数字、下划线和横杠",trigger:"blur"},{validator:async(a,e,o)=>{if(u.value){if(!e){o(new Error("请输入用户名"));return}try{(await me(e)).data.data.exists?o(new Error("该用户名已存在")):o()}catch{o(new Error("验证用户名时出错"))}}},trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度应为 6-20 个字符",trigger:"blur"},{pattern:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?])[A-Za-z\d!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]{6,20}$/,message:"密码必须包含大小写字母、数字和特殊字符,不能有空格/中文",trigger:"blur"}]}),W=a=>{const e=["#409EFF","#67C23A","#E6A23C","#F56C6C","#909399","#3963BC","#41B883","#B83939","#6957AF","#1E9FFF"];return a.charCodeAt(0)%e.length,""},j=a=>{const e=new Date(a);return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`},I=a=>new Date(a).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}),v=async()=>{k.value=!0;try{let a;_.value&&(a=_.value.split(",").map(o=>o.trim()).filter(o=>o));const e=await pe({skip:h.value,limit:F.value,username:a&&a.length>0?a:void 0});e.data.code===200?($.value=e.data.data.data,V.value=e.data.data.total):c.error(e.data.message||"获取用户列表失败")}catch(a){c.error(a.message||"获取用户列表失败")}finally{k.value=!1}},B=()=>{h.value=1,v()},Q=()=>{_.value="",B()},Y=a=>{h.value=a,v()},G=()=>{p.value=!0,U.value="注册",u.value=!0,A()},H=a=>{p.value=!0,U.value="修改密码",u.value=!1,A(),n.value={id:a.id,username:a.username,password:""}},A=()=>{b.value&&b.value.resetFields(),n.value={id:"",username:"",password:""}},E=async()=>{if(b.value){z.value=!0;try{if(await b.value.validate(),u.value){const a=await he({username:n.value.username.trim(),password:n.value.password});a.data.code===200?(c.success("用户创建成功"),p.value=!1,v()):c.error(a.data.msg||"创建用户失败")}else{const a=await be({username:n.value.username,new_password:n.value.password});a.data.code===200?(c.success("密码修改成功"),p.value=!1,n.value.username==="admin"&&(await Z.logout(),window.location.reload())):c.error(a.data.msg||"修改密码失败")}}catch(a){console.error("创建用户失败:",a),a.message?c.error(a.message):c.error("用户名/密码错误，请检查输入!")}finally{z.value=!1}}},J=a=>{P.confirm("确定禁用么?","Warning",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(e=>{q({id:a.id,is_active:!1}).then(o=>{v()})})},O=a=>{P.confirm("确定激活么?","Warning",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(e=>{q({id:a.id,is_active:!0}).then(o=>{v()})})};return ie(()=>{v()}),(a,e)=>{const o=d("el-tag"),w=d("el-input"),g=d("el-button"),X=d("el-avatar"),x=d("el-table-column"),D=d("el-tooltip"),ee=d("el-table"),ae=d("el-pagination"),te=d("el-card"),L=d("el-form-item"),se=d("el-form"),le=d("el-dialog"),oe=ve("loading");return C(),de("div",ye,[i("div",xe,[i("div",Ce,[e[7]||(e[7]=i("h2",{class:"page-title"},"用户管理中心",-1)),s(o,{type:"success",effect:"dark",class:"user-count",round:""},{default:l(()=>[m(" 共 "+y(V.value)+" 位用户 ",1)]),_:1})]),i("div",ke,[i("div",Fe,[s(w,{modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=t=>_.value=t),placeholder:"输入用户名搜索，多个用逗号分隔",clearable:"",onClear:Q,onKeyup:N(B,["enter"]),class:"search-input"},null,8,["modelValue"]),s(g,{onClick:B,icon:f(ue),style:{"background-color":"#555FFF",color:"white","border-color":"#555FFF"}},{default:l(()=>e[8]||(e[8]=[m("搜索")])),_:1},8,["icon"])]),s(g,{type:"success",icon:f(ce),class:"add-user-btn",onClick:G},{default:l(()=>e[9]||(e[9]=[m("添加用户")])),_:1},8,["icon"])])]),i("div",Ve,[s(te,{class:"table-card",shadow:"hover"},{default:l(()=>[ge((C(),S(ee,{data:$.value,style:{width:"100%"},border:"",stripe:"","highlight-current-row":"",class:"user-table","empty-text":"暂无用户数据",height:"calc(100vh - 260px)","max-height":"calc(100vh - 300px)","scrollbar-always-on":!0},{default:l(()=>[s(x,{prop:"username",label:"用户名","min-width":"120"},{default:l(({row:t})=>[i("div",Ue,[s(X,{size:32,src:W(t.username),class:"user-avatar"},null,8,["src"]),i("span",ze,y(t.username),1)])]),_:1}),s(x,{prop:"role",label:"角色","min-width":"120",align:"center"},{default:l(({row:t})=>[s(o,{type:t.username==="admin"?"danger":"success",effect:"dark",size:"small",class:"role-tag"},{default:l(()=>[m(y(t.username==="admin"?"管理员":"普通用户"),1)]),_:2},1032,["type"])]),_:1}),s(x,{prop:"created_at",label:"注册时间","min-width":"180",align:"center"},{default:l(({row:t})=>[s(D,{content:I(t.created_at),placement:"top"},{default:l(()=>[i("span",Be,y(j(t.created_at)),1)]),_:2},1032,["content"])]),_:1}),s(x,{label:"操作",fixed:"right","min-width":"150",align:"center"},{default:l(({row:t})=>[i("div",Ae,[s(D,{content:"修改密码",placement:"top"},{default:l(()=>[s(g,{type:"warning",icon:f(K),circle:"",size:"small",disabled:t.role==="admin",onClick:M=>H(t)},null,8,["icon","disabled","onClick"])]),_:2},1024),t.is_active?(C(),S(g,{key:0,type:"warning",size:"small",onClick:M=>J(t)},{default:l(()=>e[10]||(e[10]=[m("禁用")])),_:2},1032,["onClick"])):T("",!0),t.is_active?T("",!0):(C(),S(g,{key:1,type:"success",size:"small",onClick:M=>O(t)},{default:l(()=>e[11]||(e[11]=[m("激活")])),_:2},1032,["onClick"]))])]),_:1})]),_:1},8,["data"])),[[oe,k.value]]),i("div",Se,[s(ae,{"current-page":h.value,"onUpdate:currentPage":e[1]||(e[1]=t=>h.value=t),"page-size":F.value,"onUpdate:pageSize":e[2]||(e[2]=t=>F.value=t),background:"",total:V.value,layout:"prev, pager, next",onCurrentChange:Y,class:"pagination"},null,8,["current-page","page-size","total"])])]),_:1})]),s(le,{modelValue:p.value,"onUpdate:modelValue":e[6]||(e[6]=t=>p.value=t),title:U.value,width:"450px","destroy-on-close":"",onClosed:A,class:"user-dialog","close-on-click-modal":!1,"show-close":!1},{footer:l(()=>[i("div",$e,[s(g,{onClick:e[5]||(e[5]=t=>p.value=!1),class:"cancel-btn",size:"large",plain:"",style:{width:"120px"}},{default:l(()=>e[12]||(e[12]=[m("取消")])),_:1}),s(g,{type:"primary",onClick:E,style:{"background-color":"#555FFF","border-color":"#555FFF",width:"120px","margin-bottom":"20px"},size:"large",loading:z.value},{default:l(()=>[m(y(u.value?"创建":"确认"),1)]),_:1},8,["loading"])])]),default:l(()=>[s(se,{ref_key:"formRef",ref:b,model:n.value,rules:R.value,"label-width":"80px",onKeyup:N(E,["enter"]),class:"user-form",size:"large"},{default:l(()=>[s(L,{label:"用户名",prop:"username"},{default:l(()=>[s(w,{modelValue:n.value.username,"onUpdate:modelValue":e[3]||(e[3]=t=>n.value.username=t),placeholder:"请输入用户名","prefix-icon":f(fe),disabled:!u.value},null,8,["modelValue","prefix-icon","disabled"])]),_:1}),s(L,{label:u.value?"密码":"新密码",prop:"password"},{default:l(()=>[s(w,{modelValue:n.value.password,"onUpdate:modelValue":e[4]||(e[4]=t=>n.value.password=t),type:"password",placeholder:u.value?"请输入密码":"请输入新密码","show-password":"","prefix-icon":u.value?f(_e):f(K)},null,8,["modelValue","placeholder","prefix-icon"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}}),Te=we(Ee,[["__scopeId","data-v-4edd54f0"]]);export{Te as default};
//# sourceMappingURL=UserList-YcYB1iFd.js.map
