import{al as n}from"./index-DKhC6MDA.js";import{u as r,b as o,e as c,f as h,h as l,i as f,g as u}from"./dataset-DhRRIr_L.js";const y=n("dataset",{state:()=>({datasets:[],total:0,loading:!1,lastFetchTime:0,currentProjectId:null,currentParams:{}}),getters:{getDatasetById:t=>a=>t.datasets.find(s=>s.id===a)},actions:{async fetchDatasets(t,a={}){const s=Date.now(),e=JSON.stringify({...this.currentParams,...a})===JSON.stringify(this.currentParams);if(this.datasets.length>0&&this.currentProjectId===t&&s-this.lastFetchTime<5e3&&e&&!a.forceRefresh)return{datasets:this.datasets,total:this.total};this.loading=!0;try{const i={project_id:t,...a};delete i.forceRefresh,this.currentParams=i;const d=await u(i);return d.data.code===200&&(this.datasets=d.data.data.datasets||[],this.total=d.data.data.total||0,this.lastFetchTime=s,this.currentProjectId=t),{datasets:this.datasets,total:this.total}}catch(i){throw console.error("获取数据集列表失败:",i),i}finally{this.loading=!1}},async createDataset(t){const a=await f(t);return a.data.code===200&&await this.fetchDatasets(t.project_id,{forceRefresh:!0}),a},async updateDataset(t){const a=await l(t);if(a.data.code===200){const s=this.datasets.findIndex(e=>e.id===t.id);s!==-1&&(this.datasets[s]={...this.datasets[s],...a.data.data})}return a},async deleteDataset(t){const a=await h(t);return a.data.code===200&&(this.datasets=this.datasets.filter(s=>s.id!==t.dataset_id),this.total>0&&this.total--),a},async deleteBatchDatasets(t){const a=await c(t);return a.data.code===200&&(this.datasets=this.datasets.filter(s=>!t.dataset_ids.includes(s.id)),this.total=Math.max(0,this.total-t.dataset_ids.length)),a},async addSamplesToDataset(t){const a=await o(t);if(a.data.code===200){const s=this.datasets.findIndex(e=>e.id===t.dataset_id);s!==-1&&(this.datasets[s].sample_count+=t.sample_ids.length)}return a},async unbindSampleFromDataset(t){const a=await r(t);if(a.data.code===200){const s=this.datasets.findIndex(e=>e.id===t.dataset_id);s!==-1&&this.datasets[s].sample_count>0&&(this.datasets[s].sample_count-=1)}return a}}});export{y as u};
//# sourceMappingURL=dataset-CTDV4P1n.js.map
