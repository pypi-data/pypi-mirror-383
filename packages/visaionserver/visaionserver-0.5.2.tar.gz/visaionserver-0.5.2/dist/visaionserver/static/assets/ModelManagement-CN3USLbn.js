import{d as Y,s as Z,r as M,V as tt,W as et,c as T,b as f,e as o,B as at,a3 as nt,m as b,w as n,g as r,q as p,t as w,P as I,Q as L,A as z,j as u,a4 as ot,h as st,M as U,a2 as lt,o as _}from"./index-DKhC6MDA.js";import{a as it,b as dt,j as rt,d as ut,r as ct}from"./all-DLmPi6KK.js";import{J as g,E as y}from"./const-DgT7xBJS.js";import{u as pt}from"./model-D1sEGZqo.js";import{_ as _t}from"./_plugin-vue_export-helper-DlAUqK2U.js";const mt={class:"model-management-container"},ft={class:"model-management-content"},gt={class:"min-h-screen bg-gray-50 px-6 py-8"},yt={class:"mx-auto max-w-7xl"},bt={class:"flex items-center"},ht={class:"flex flex-wrap gap-2"},vt={class:"flex flex-wrap gap-2"},xt={class:"flex items-center gap-2"},wt={class:"el-dropdown-link"},jt=Y({__name:"ModelManagement",setup(kt){const v=Z(),j=pt(),k=st(),E=M(0),C=M(!1);let B=null;const h=M([]),J=t=>{N(t)},G=t=>({未开始1:"info",已完成1:"success",已终止:"danger",运行中1:""})[t],$=t=>{j.setModel(t),k.push({path:"/sample/modeldetail",query:{jid:t.id}})},F=t=>{j.setModel(t),k.push({path:"/sample/training",query:{from:"clone"}})},V=t=>{j.setModel(t),k.push({path:"/model/updateModel",query:{jid:t.id}})},P=()=>{var l;let t=[],e=h.value;if(!(!e||e.length===0)){for(let m=0;m<e.length;m++){const i=e[m];console.log("element",i.status,typeof i.status),(!i.status||[1,2,3,4,5].includes(i.status))&&(console.log("element-status",i.status),t.push(i.id)),(i.status==="运行中"||i.status==="等待中"||i.isStart)&&t.push(i.id)}t.length!==0&&it({project_id:(l=v.currentProject)==null?void 0:l.id,job_ids:t,job_type:"train"}).then(m=>{var x;let i=[],c=(x=m.data)==null?void 0:x.data;h.value.forEach(d=>{d.status||(d.status=g[1]),c&&c[d.id]!==void 0&&(d.status=g[c[d.id]],y.PENDING==c[d.id]||c[d.id]==y.RUNNING?d.isStart=!0:d.isStart=!1),i.push(d)}),h.value=i})}};let S;const D=t=>{var e;(e=v.currentProject)==null||e.id,t.id,t.param,S=lt.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"}),ct({id:t.id,job_type:"train"}).then(l=>{S.close(),t.isStart=!0}).catch(l=>{S.close()})},q=t=>{t.status==g[y.COMPLETED]?U.confirm("训练完成的任务再次启动会覆盖已有数据,是否继续?","Warning",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{D(t)}):D(t),console.log(t)},A=t=>{var e;rt({project_id:(e=v.currentProject)==null?void 0:e.id,job_id:t.id,job_type:"train"}).then(l=>{t.isStart=!1})},N=t=>{var e;C.value=!0,dt({page:t,size:10,project_id:(e=v.currentProject)==null?void 0:e.id}).then(l=>{h.value=l.data.data,E.value=l.data.total,P()}).finally(()=>{C.value=!1})},O=t=>{U.confirm("确定删除么?","Warning",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{ut(t.id).then(e=>{N(1)})})};return tt(()=>{console.log("mounterd"),N(1),B=setInterval(P,1800)}),et(()=>{clearInterval(B)}),(t,e)=>{const l=r("el-table-column"),m=r("el-tag"),i=r("el-tooltip"),c=r("el-button"),x=r("el-icon"),d=r("el-dropdown-item"),R=r("el-dropdown-menu"),W=r("el-dropdown"),Q=r("el-table"),H=r("el-pagination"),K=r("el-row"),X=nt("loading");return _(),T("div",mt,[f("div",ft,[e[6]||(e[6]=f("h2",{class:"page-title",style:{width:"90px",float:"left"}},"模型管理 ",-1)),f("div",gt,[f("div",yt,[at((_(),b(Q,{data:h.value,class:"w-full","element-loading-text":"加载中..."},{default:n(()=>[o(l,{prop:"name",label:"训练名称","min-width":"180"}),o(l,{prop:"status",label:"训练状态",width:"120"},{default:n(({row:a})=>[f("div",bt,[o(m,{type:G(a.status),effect:"light",size:"small",class:"whitespace-nowrap"},{default:n(()=>[p(w(a.status),1)]),_:2},1032,["type"])])]),_:1}),o(l,{label:"训练集","min-width":"180"},{default:n(({row:a})=>[f("div",ht,[(_(!0),T(I,null,L(a.train_sets,s=>(_(),b(i,{content:s.updated_at>a.finish_time?"样本/标注已更新":s.name},{default:n(()=>[(_(),b(m,{key:s,size:"small",effect:"plain",type:s.updated_at>a.finish_time?"warning":"primary"},{default:n(()=>[p(w(s.name),1)]),_:2},1032,["type"]))]),_:2},1032,["content"]))),256))])]),_:1}),o(l,{label:"验证集","min-width":"180"},{default:n(({row:a})=>[f("div",vt,[(_(!0),T(I,null,L(a.val_sets,s=>(_(),b(i,{content:s.updated_at>a.finish_time?"样本/标注已更新":s.name},{default:n(()=>[(_(),b(m,{key:s,size:"small",effect:"plain",type:s.updated_at>a.finish_time?"warning":"primary"},{default:n(()=>[p(w(s.name),1)]),_:2},1032,["type"]))]),_:2},1032,["content"]))),256))])]),_:1}),o(l,{label:"创建人",width:"120"},{default:n(a=>[p(w(a.row.username),1)]),_:1}),o(l,{prop:"create_time",label:"创建时间",width:"180"}),o(l,{fixed:"right",label:"操作",width:"200"},{default:n(a=>[f("div",xt,[o(c,{text:"",size:"small",type:"primary",style:{padding:"0"},onClick:s=>$(a.row)},{default:n(()=>e[0]||(e[0]=[p(" 详情 ")])),_:2},1032,["onClick"]),o(c,{disabled:a.row.status==u(g)[u(y).PENDING]||a.row.status==u(g)[u(y).RUNNING]||a.row.status==u(g)[u(y).COMPLETED],text:"",size:"small",type:"primary",style:{padding:"0"},onClick:s=>V(a.row)},{default:n(()=>e[1]||(e[1]=[p(" 修改 ")])),_:2},1032,["disabled","onClick"]),a.row.isStart?z("",!0):(_(),b(c,{key:0,disabled:a.row.status==u(g)[u(y).PENDING]||a.row.status==u(g)[u(y).RUNNING],text:"",size:"small",type:"primary",style:{padding:"0"},onClick:s=>q(a.row)},{default:n(()=>e[2]||(e[2]=[p(" 启动 ")])),_:2},1032,["disabled","onClick"])),a.row.isStart?(_(),b(c,{key:1,text:"",size:"small",type:"danger",style:{padding:"0"},onClick:s=>A(a.row)},{default:n(()=>e[3]||(e[3]=[p(" 停止 ")])),_:2},1032,["onClick"])):z("",!0),o(W,{style:{"margin-left":"8px"}},{dropdown:n(()=>[o(R,null,{default:n(()=>[o(d,{onClick:s=>O(a.row)},{default:n(()=>e[4]||(e[4]=[p("删除")])),_:2},1032,["onClick"]),o(d,{onClick:s=>F(a.row)},{default:n(()=>e[5]||(e[5]=[p("克隆")])),_:2},1032,["onClick"])]),_:2},1024)]),default:n(()=>[f("span",wt,[o(x,{style:{color:"blue","margin-top":"6px"}},{default:n(()=>[o(u(ot))]),_:1})])]),_:2},1024)])]),_:1})]),_:1},8,["data"])),[[X,C.value]]),o(H,{style:{"margin-top":"8px"},background:"",layout:"prev, pager, next",total:E.value,onCurrentChange:J},null,8,["total"])])]),o(K)])])}}}),Et=_t(jt,[["__scopeId","data-v-4804283a"]]);export{Et as default};
//# sourceMappingURL=ModelManagement-CN3USLbn.js.map
