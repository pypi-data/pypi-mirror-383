import{d as ge,c as B,b as a,P as me,Q as pe,g as m,o as A,e as s,w as n,A as lt,q as M,t as f,n as U,m as R,j as w,R as Re,S as De,F as Ne,k as Le,T as xe,U as ae,f as Ee,r as p,u as ot,z as it,V as rt,s as dt,W as ct,X as ut,E as r,h as mt,Y as pt,Z as gt,_ as ft,i as vt,$ as _t,a0 as wt,M as de,a1 as yt,a2 as At,D as bt}from"./index-DKhC6MDA.js";import{_ as fe,u as Ct}from"./global-B2lFRN28.js";import{u as Pt,L as kt}from"./LabelManage-BqTi3OIn.js";import{_ as ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{g as Te,c as ht,u as jt,a as St,b as Mt,r as Bt,d as Vt,e as Ie,f as Et,h as Tt,i as It,p as Ft}from"./project-D_Nx9Gzm.js";import{P as ce,a as ue,b as Ut,c as Fe}from"./project-_8X1-NGT.js";import"./label-x0sVxddY.js";import"./tools-xmMdAE4-.js";import"./const-DgT7xBJS.js";const Ue="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAABE9JREFUWEfFV11oHFUU/s5OdjepJEZtWg2JaWlrG6KSmB+qWcXFCvUPjSmiGLABBR8EK+iDoIiI+KBgHnwQWkgeAopkG5X6A1ZWzEZCsjVBDUltS5smRGuqpgk2u5nd+ezdzWxmZzeZWWxwHu89c893zvnOPd8VuPzC/Sz3Eg+B2AeynoIqATar3wlcFOAcIGNX9iO6hs+CbTLv5mhxMhrs5w4axmuEdAhQ5GSfAkTERNjro6er5YCMr/fPmgDC3Sz2lhpvUeSQW8d2RytAPtQXPK8GOyWWD0heAOmoeQzAHjcRu7CZFMj+1naZstvmABjoZyOSPCaCG+3GxdcA11cC120FSkoFPj8gHmA5BlxeIC7NAXPTQPxyLiQSv0OTh+9ukxPW3SwAgyHWGOSQ3bl/E1BdC2yplpRDp+/PWeLsT7lAFAiPJoHWNjljnpEBkKp5GUftaa+oBnY0CDRX9FuFZiSBUyeIizM5cCf1BWkwOZEBEAnxfYCHrOYq6ptrHRtl3YScnyCmJ2wm5HuBA9orajV1euRz1nGZUREUm6abq4DdLf/NuXnWryNMccPyJfTkcm3wieLTaQAhHgb4rGmgan7H/QKP5lRtd/vJBDB6nDZysifQrnVKuJvlRaX8zRr9nr3ADZXO0Q+HAcMA9t7nDOTCFHE6i/9I6B6pkEgfn4Gwxxp9035n58r+gzfSf73wpjMAGsCP3xCxfyy2Ih0SCSUPA5JJf9VuoKbu6gNQbs/+TMyesoJlj0RCxgiAJnO5LgCUb9kYAPN/EOMRCwBiTAZCxpw51dRW84MCX6YX1k9tISVQJ8WXiOhXq2empmgkZNDqpvXx/NEPfQtEv88GtDCf7uPS8uz1lnuBlmAueMWDHz7NcoccAHc9lv+6VYwf/i4XgFopswFoumftzhg8agNgL0HTAwJ/iTOrC+0CZa+G1siXqwDSJegzRiGo/19ICEQlEmI3wIMmgMpdwPbbNqYLpsaJmZPW7MoRiRzl0yB7zWU189U17GbsFtoF0a9t1zHlYOoq9pZxDha9t7MR2FrjnAXVGR5PfsbbWaQ0wuSQpQWJWEKTm1aGUbIbkEwZ1DBq2Fe4BliLukobqGs4WynxSKBdey4FIPxJbKdX86mpnZEdSojc0uycBTf9cnI4W5gosZpI6M3BJ/2/rAqSvuS7EHnZeuCGCRKwK9CuvaR8OUoyJUx2NRauDZQGODOaI0TUK2ZSX8wjycxSFHl8A/lE6fbb3WkEdd3OTRPnJ/KL0oQevzP4VMk5M9MFyXJFTsWNayuATWXpoaUcLseBpUXi7wvAX7PInvkrnlzJchNV+KOlbV6fX82tq/MwUWk3lh9RGtBO2vWfZmV4h+TzVrnmhvWmDYGEkF36ouf1gp5mVifhj+O3er2+F0l2uAWScgz26kn97XxRZ13GbiNK3ZileBSCAMB6AtuynufEDETGruwf1y/hi2Cnu+f5v/n+0uE7M9A1AAAAAElFTkSuQmCC",Rt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAABChJREFUWEe9l11sFFUUx39nt9sP0FANUJpI2goxrVZBkcZiFbf4YEIJqC9qi9JEE9/URB9I9MkYHjSxjyaQbGN31RcVYokv0hEp0PChRattDE1LalIKjZZE6MfuzpG76y4zu9vObKTO29w5c/7/83HP/V/B5xOxtLIUdio8DboZuAdY/e/v0wrjAWTw5vf+OBzpDMuMH9fiZfTFMd2QCNjvgnQAJV725rvCXACNiga6XmqVX5f6Z1ECEUvLS7DfF+RNv8C5QIaIoJ/ECezvDMtcISIFCaSj1l6g3k/EPmxGxJZn2nfIpVzbPAKxPt1ii/YKrMs1vqMC1q+G6rth1QqhvBQCArMLMHNduTIDY1NwvUCsCpcDKm3trXLe6ddFIHZMa+yADuSCryyHB2uhrkpSgF7PxLRy/mI+EUMiZEvLCztkNOMj687UPIT+lJv22ipouk8IBb1g3d+TNpweUS5dyftvJI48nOmJLIGopR+DmobLPibqh2p9hLwEt5/HlV/G3QaKfrQ3HHzHrKa8f9anDyRFzwmUZ0xr1kLL/f8NPOPr5LAyPuUikVAWGvaGyy+mEGKWHlT01YyJqfmuJiEYKC7ti1nHk3D0rOY0p3Z3hIOdYiZcCTrpjP7JRtPt3tEfPgGm1s9v9yY6elkZGHFnIY6skailr4B2O6Pf85g3uLHvPJD+K7Lfm4Ct8M0Z5e/ZW7aCdEjMSh5UJJv+xhrYVHf7CRjYH0eV4QknWe2WHss+K/BoZrl1E1TftTwEJv9S+i64sjUoUcu+6jjVeG6bUFHqndJiS2Dsb8wrX592+Z42BNS51P5U4ei/PA69p9zErl5Lv69Z5V7f3QJ7nsgPwiB9ftwFRx6BF7cXHrem44/0+yPQtm3xnRH7Pp+AqwTPNgsrypanBObQ+uqUi0CqBGb+G4WTev7PJlQ4Z+ZABHRfhkDDenhkw/LsggtjypBDEQhySGKWtisazRC4swLamvwdu8UMIuP/8EDuOJZ9qVEcQk0fZPVecz3cu847C2ZnmPOiUMfndpHRCD8M3Vo1ci2BVKdQolYyApItgzmMdm4tXgMs1rrmvDBj2KmUBD3UHg6+liLQY81tFEqHnVkwQuTxBu8s+Nkv/b+5hYmJXolvfTlcNpRF6LGSHwryttPhcgkS0K6OcPAtg+UpyYwwaa4vXhsYDXDm9zwhYjALS7JMKaD0RCFRumWjP41gxu3YVFqG5apjI0oTzDd3hiuyIq0oWW6as64K1lZC5cr0oWUA5xbg2g1l8k+YmMZ15mdK6kuWZ4wj1mxtiLJvb+fFRFnYZTRgbtMueTULwQFFX3fKNT9d77BJKNqVIPBeUVczJ8in1nxjkNI3bLSjCCIJ0KgS/6BQ1E7/vjd6emKyW6DFRjcL1Dqv58AfIIM3v3+3AEf9Xs//AXh4sjmatjVTAAAAAElFTkSuQmCC",Dt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAABFFJREFUWEe9V2toHFUU/s5s9uFjk3Rp09rGJqXPWNtN2sSiFiRQoahB/2lppBXUmliwAf0hKBRE/KGQCN21tYVGDKj/lFQrWAjiA23SZie1Jq2VNDXGNAlrmvjY5xy5u93J3NlJZgaNF/bH3jn3nO/cc+453yE4XNzfXg5P4GFo2i4mqgWjEoSlueOMKRBfJVAMwNfQkp9QXdu0E9VkJ8QXjq3VsplXCGgGUYmd/M3vCQa6lBKtgzYfvLjQmXkBcM/hgBaqeI2YD7kwbLYlgBxV4hMvU+PhhBUQSwDCa9YypwDa5NBjGzEeIi/vprsOjpgFiwDwQHQ7M04BWFGk1VcGlFYDwdUgfzngvRUgBUj/BU7EgT/HgN8vA+lZK0DjRHiEtraeM36UAPCPR6o4rXxXZNwbBJbXg5ZsyBu08/fGMDD2jRWQcVI8O2nLgZ8LKnQAIuYcWtZfdO3l60GrHgA8Xju78nctA/6lB7hxxXSOhyg+WVfIiTkAarSdgUOStPB6eYM7w2Zz13uB633SLgNvecKtL4nNHAC+eGQzZxQhFdAly9aBqh78V8YLh/naGWD6pzldzJlUFjWB7c9fyQNQo8cZeFqX8AZBG58AFKfP3gZnNg2+/JGUE8zU6alteYpEhWPF/5vkfdVuUNkae+/7ugEtC9zzmK0sx4eA0R7pFohTy4jV6D4GOiXva5ptFeYEjj4ryjDQ8q69PGvgSx8AqRldloiaKatGj5Px+iu2gVbssFfoFoAI9di3wJSq62bmTtLUSC9A9frumiZQsHJxAMyOAsPdRt0x0mLRSb2riWdRsy9f4ZwsNyEQN5D+Axh835AHmCJNjYoozsVla4u16bMfA+c/k7/NTOX/l+a7sr7qmwDxMy+RBxeOSbvFALYcsC63vd2AyHrjmr0JIGgCsO0hYIf1y+CBd0wAzCHY9CTgu91JANy9AqFRNK3B94pC0A+gVt/9X5OQ+4hjkZNMtF8HsDQMWnnfotwAj38PTJyfyzfgBPFAZC8zdem7vlLQxj2O2q6rQiRewWCXVI4J2J8vxeSblGhXZSMo5IAMiZdBHqDBIuNNd8iCI4x8btxNkJa8I9eMsrHISTKGQTSjDY+75wDzBU5wg0sfys0IOOEJtz6TA5A4F1nn82BQugVBRFbvcpYLNlI88oWZmCTSoAZ/uOUHnZBk1eibBLwo6Vo8QtLhCbe2CVv2lEwQkzsb3XMDwQF+/VImIjnv5qFkeihK6CtLUrryfmccQZRbwYwFDStmx+NJLXnvLXVtVws37Y6WC3a8ZD1w2ypQIJRvWqzlK1xqGpi5BswMSz3fEFJ7Wl4Q/ru/vdqv+E7/l4NJKoMmwQHN+brgaIZQxRsMPCfRNTfvgjnDRB1KfOJVV6OZ0UZSfftuH7wvsBhOjax5ISDCMNCVzuJ1K6+NR22n44JwbjxX/I8C2MngWjBVS+M5MErgGBTlDLKJT52O5/8A2k/LXWdP4XoAAAAASUVORK5CYII=",Nt={class:"project-grid"},Lt={class:"custom-row"},xt={key:0,class:"pin-badge"},zt={class:"project-header"},Zt={class:"project-title"},Qt={class:"header-right"},Gt={class:"project-details"},Jt=ge({__name:"ProjectGrid",props:{projects:{}},emits:["project-click","toggle-pin","rename-project","manage-members","manage-labels","delete-project"],setup(_e,{emit:D}){const N=D,E=(v,g)=>{N("project-click",v,g)},k=v=>!1;return(v,g)=>{const _=m("el-tooltip"),c=m("el-icon"),j=m("el-button"),P=m("el-dropdown-item"),y=m("el-dropdown-menu"),L=m("el-dropdown"),V=m("el-card");return A(),B("div",Nt,[a("div",Lt,[(A(!0),B(me,null,pe(v.projects,u=>(A(),B("div",{class:"custom-col",key:u.id},[s(V,{shadow:"hover",class:U(["project-card",{"is-pinned":u.isPinned}]),onClick:b=>E(u,b)},{header:n(()=>[a("div",zt,[s(_,{content:u.name,placement:"top-start","show-after":500,"hide-after":2e3},{default:n(()=>[a("h3",Zt,f(u.name),1)]),_:2},1032,["content"]),a("div",Qt,[a("div",{class:U(["card-tag",{"detection-type":u.class_type==="DET","segmentation-type":u.class_type==="SEG","classification-type":u.class_type==="CLS","instance-type":u.class_type==="INS"}])},f(u.type),3),s(L,{trigger:"click"},{dropdown:n(()=>[s(y,null,{default:n(()=>[s(P,{onClick:b=>v.$emit("toggle-pin",u)},{default:n(()=>[s(c,null,{default:n(()=>[u.isPinned?(A(),R(w(Re),{key:0})):(A(),R(w(De),{key:1}))]),_:2},1024),a("span",null,f(u.isPinned?"取消置顶":"置顶"),1)]),_:2},1032,["onClick"]),s(P,{onClick:b=>v.$emit("rename-project",u),disabled:k(u)},{default:n(()=>[s(c,null,{default:n(()=>[s(w(Ne))]),_:1}),g[1]||(g[1]=a("span",null,"重命名",-1))]),_:2},1032,["onClick","disabled"]),s(P,{onClick:b=>v.$emit("manage-members",u),disabled:k(u)},{default:n(()=>[s(c,null,{default:n(()=>[s(w(Le))]),_:1}),g[2]||(g[2]=a("span",null,"成员管理",-1))]),_:2},1032,["onClick","disabled"]),s(P,{onClick:b=>v.$emit("manage-labels",u,b),disabled:k(u)},{default:n(()=>[s(c,null,{default:n(()=>[s(w(xe))]),_:1}),g[3]||(g[3]=a("span",null,"类别管理",-1))]),_:2},1032,["onClick","disabled"]),s(P,{onClick:b=>v.$emit("delete-project",u),class:"danger",disabled:k(u)},{default:n(()=>[s(c,null,{default:n(()=>[s(w(ae))]),_:1}),g[4]||(g[4]=a("span",null,"删除项目",-1))]),_:2},1032,["onClick","disabled"])]),_:2},1024)]),default:n(()=>[s(j,{class:"more-btn",link:""},{default:n(()=>[s(c,{class:"more-icon"},{default:n(()=>g[0]||(g[0]=[a("img",{src:fe,alt:"更多"},null,-1)])),_:1})]),_:1})]),_:2},1024)])])]),default:n(()=>[u.isPinned?(A(),B("div",xt," 置顶 ")):lt("",!0),a("div",Gt,[a("p",null,[g[5]||(g[5]=a("span",{class:"detail-label"},"创建人：",-1)),M("    "+f(u.creator),1)]),a("p",null,[g[6]||(g[6]=a("span",{class:"detail-label"},"创建时间：",-1)),M(" "+f(u.createTime),1)]),a("p",null,[g[7]||(g[7]=a("span",{class:"detail-label"},"最近访问：",-1)),M(" "+f(u.updatedTime),1)])])]),_:2},1032,["class","onClick"])]))),128))])])}}}),Wt=ve(Jt,[["__scopeId","data-v-0ded9051"]]),Ot={class:"project-list-view"},Xt={class:"project-name-section"},Ht={class:"project-name"},Kt={class:"creator-info centered"},Yt={class:"creator-name"},$t={class:"time-info centered"},qt={class:"time-text"},ea={class:"time-info centered"},ta={class:"time-text"},aa=ge({__name:"ProjectListView",props:{projects:{}},emits:["project-click","toggle-pin","rename-project","manage-members","manage-labels","delete-project"],setup(_e,{emit:D}){const N=D,E=(_,c,j)=>{N("project-click",_,j)},k=({row:_})=>_.isPinned?"pinned-row":"",v=_=>!1,g=_=>{let c=0;for(let j of _)/[\u4e00-\u9fa5]/.test(j)?c+=2:c+=1;return c>20};return(_,c)=>{const j=m("el-tooltip"),P=m("el-table-column"),y=m("el-icon"),L=m("el-button"),V=m("el-dropdown-item"),u=m("el-dropdown-menu"),b=m("el-dropdown"),I=m("el-table");return A(),B("div",Ot,[s(I,{data:_.projects,style:{width:"100%"},"row-class-name":k,onRowClick:E},{default:n(()=>[s(P,{label:"项目名称"},{default:n(({row:i})=>[a("div",Xt,[s(j,{content:i.name,placement:"top-start","show-after":300,"hide-after":100,disabled:!g(i.name)},{default:n(()=>[a("span",Ht,f(i.name),1)]),_:2},1032,["content","disabled"])])]),_:1}),s(P,{label:"项目类型",width:"140",align:"center"},{default:n(({row:i})=>[a("span",{class:U(["type-tag",{"detection-type":i.class_type==="DET","segmentation-type":i.class_type==="SEG","classification-type":i.class_type==="CLS","instance-type":i.class_type==="INS"}])},f(i.type),3)]),_:1}),s(P,{prop:"creator",label:"创建人",width:"140",align:"center"},{default:n(({row:i})=>[a("div",Kt,[a("span",Yt,f(i.creator),1)])]),_:1}),s(P,{label:"创建时间",width:"240",align:"center"},{default:n(({row:i})=>[a("div",$t,[a("span",qt,f(i.createTime),1)])]),_:1}),s(P,{label:"最近访问",width:"240",align:"center"},{default:n(({row:i})=>[a("div",ea,[a("span",ta,f(i.updatedTime),1)])]),_:1}),s(P,{label:"操作",width:"90",align:"center"},{default:n(({row:i})=>[s(b,{trigger:"click",onClick:c[1]||(c[1]=Ee(()=>{},["stop"]))},{dropdown:n(()=>[s(u,null,{default:n(()=>[s(V,{onClick:F=>_.$emit("toggle-pin",i)},{default:n(()=>[s(y,null,{default:n(()=>[i.isPinned?(A(),R(w(Re),{key:0})):(A(),R(w(De),{key:1}))]),_:2},1024),a("span",null,f(i.isPinned?"取消置顶":"置顶"),1)]),_:2},1032,["onClick"]),s(V,{onClick:F=>_.$emit("rename-project",i),disabled:v(i)},{default:n(()=>[s(y,null,{default:n(()=>[s(w(Ne))]),_:1}),c[3]||(c[3]=a("span",null,"重命名",-1))]),_:2},1032,["onClick","disabled"]),s(V,{onClick:F=>_.$emit("manage-members",i),disabled:v(i)},{default:n(()=>[s(y,null,{default:n(()=>[s(w(Le))]),_:1}),c[4]||(c[4]=a("span",null,"成员管理",-1))]),_:2},1032,["onClick","disabled"]),s(V,{onClick:F=>_.$emit("manage-labels",i,F),disabled:v(i)},{default:n(()=>[s(y,null,{default:n(()=>[s(w(xe))]),_:1}),c[5]||(c[5]=a("span",null,"类别管理",-1))]),_:2},1032,["onClick","disabled"]),s(V,{onClick:F=>_.$emit("delete-project",i),class:"danger",disabled:v(i)},{default:n(()=>[s(y,null,{default:n(()=>[s(w(ae))]),_:1}),c[6]||(c[6]=a("span",null,"删除项目",-1))]),_:2},1032,["onClick","disabled"])]),_:2},1024)]),default:n(()=>[s(L,{class:"action-btn",link:"",size:"small",onClick:c[0]||(c[0]=Ee(()=>{},["stop"]))},{default:n(()=>[s(y,{class:"more-icon"},{default:n(()=>c[2]||(c[2]=[a("img",{src:fe,alt:"更多"},null,-1)])),_:1})]),_:1})]),_:2},1024)]),_:1})]),_:1},8,["data"])])}}}),sa=ve(aa,[["__scopeId","data-v-48b9049f"]]),na={class:"project-list-container"},la={class:"create-project"},oa={class:"section-header"},ia={class:"section-actions compact"},ra={class:"project-stats"},da={class:"stats-text"},ca={class:"right-actions"},ua={class:"view-switch-container"},ma={class:"segmented-control"},pa={class:"project-container"},ga={class:"pagination-container"},fa={class:"trash-content"},va={class:"trash-project-list"},_a={class:"custom-row"},wa={class:"project-header"},ya={class:"project-title"},Aa={class:"header-right"},ba={class:"project-details"},Ca={class:"trash-pagination"},Pa={class:"member-dialog-content"},ka={class:"add-member-section"},ha={class:"add-member-input"},ja={class:"user-suggestion-item"},Sa={class:"member-list-section"},Ma={class:"member-list",style:{height:"360px","overflow-y":"auto"}},Ba={class:"member-name"},Va={class:"member-operation"},Ea={class:"rename-dialog-content"},Ta={class:"input-section"},Ia={class:"dialog-footer"},Fa=ge({__name:"ProjectList",setup(_e){const D=Pt(),N=Ct(),E=mt(),k=p([]),v=p(1),g=p(10),_=p(0),c=p(!1),j=ot(),y=p((()=>{const t=localStorage.getItem("projectViewMode");return t||"grid"})());it(y,t=>{localStorage.setItem("projectViewMode",t),V(t)},{immediate:!1});const L=async()=>{try{const t=await ut();if(t.data.code===200){const e=t.data.data.project_view_mode===1?"grid":"list";localStorage.getItem("projectViewMode")||(y.value=e,localStorage.setItem("projectViewMode",e))}}catch(t){console.warn("加载用户视图偏好失败:",t)}},V=u(async t=>{try{await yt({project_view_mode:t==="grid"?1:2})}catch(e){console.warn("同步视图偏好到服务器失败:",e)}},1e3);function u(t,e){let l;return(...d)=>{clearTimeout(l),l=setTimeout(()=>t(...d),e)}}const b=p(!1),I=p(0),i=async()=>{try{c.value=!0;const{data:t}=await Te({page:v.value,size:g.value});t.code===200?(k.value=t.data.projects.map(e=>({id:e.id,name:e.name,class_type:ue[e.type]||"DEF",type:ce[e.type]||"未知",image_type:e.image_type,creator:e.username||"未知",createTime:e.created_at||new Date().toISOString(),updatedTime:e.updated_at||new Date().toISOString(),isPinned:!!e.is_pinned,username:e==null?void 0:e.username})),_.value=t.data.total||0):(console.error("未知的数据结构:",t),r.error("获取项目列表失败：数据结构异常"),k.value=[])}catch(t){console.error("获取项目列表错误:",t),r.error((t==null?void 0:t.message)||"获取项目列表失败"),k.value=[]}finally{c.value=!1}},F=()=>{history.pushState(null,"",window.location.href)},we=t=>{history.pushState(null,"",window.location.href)};rt(()=>{x.clearCurrentProject(),i(),L(),F(),window.addEventListener("popstate",we)}),ct(()=>{window.removeEventListener("popstate",we)});const x=dt(),ye=async(t,e)=>{var Q;const l=e.target;if(l.closest(".more-btn")||l.closest(".el-dropdown-menu")){e.stopPropagation();return}const S=At.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});x.setCurrentProject({id:t.id,name:t.name,type:Fe[t.type]||"未知",type_full:t.type,type_abbreviation:t.class_type,image_type:((Q=t==null?void 0:t.image_type)==null?void 0:Q.toString())||"0",creator:t.creator,createTime:t.createTime,updatedTime:t.updatedTime,username:t.username,has_sample_image:!0}),console.time("going"),await Et({project_id:t.id});const{data:h}=await Tt({project_id:t.id});console.timeEnd("going"),N.sampleListScale=5,h.code===200?h.data.sample_count>0?(x.setHasSampleImage(!0),await E.push("/sample/list")):(x.setHasSampleImage(!1),await E.push("/sample/upload")):await E.push("/sample/upload"),S.close()},Ae=async t=>{try{t.isPinned?(await It({project_id:t.id}),r.success("取消置顶成功")):(await Ft({project_id:t.id}),r.success("置顶成功")),t.isPinned=!t.isPinned,i()}catch(e){console.error("置顶操作失败:",e),r.error("操作失败，请重试")}},G=async t=>{var e;try{const{data:l}=await ht({name:`新建${t}项目`,description:`这是一个${t}项目`,type:Ut[t]});if(l.code===200){r.success("项目创建成功");const d=l.data;if(d){const S=d.type;d.class_type=ue[S]||"DEF",d.type=ce[S]||"未知",x.setCurrentProject({id:d.id,name:d.name,type:Fe[d.type]||"未知",type_full:d.type,type_abbreviation:d.class_type,creator:d.creator,createTime:d.createTime,updatedTime:d.updatedTime,has_sample_image:!1,username:(e=j.userInfo)==null?void 0:e.username})}await i(),E.push("/sample/upload")}else throw new Error(l.msg)}catch(l){r.error((l==null?void 0:l.message)||"创建项目失败")}},be=async t=>{q(t)&&(Z.value=t,z.value=t.name,O.value=!0,bt(()=>{var e;(e=je.value)==null||e.focus()}))},Ce=async()=>{if(!Z.value)return;const t=z.value.trim();if(!t){r.warning("项目名称不能为空");return}if(t.length<2||t.length>100){r.warning("项目名称长度应为 2-100 个字符");return}if(!/^[\u4e00-\u9fa5a-zA-Z0-9_\-]+$/.test(t)){r.warning("项目名称只能包含中文、英文、数字、下划线和横杠");return}if(t.includes(" ")){r.warning("项目名称不能包含空格");return}if(t===Z.value.name){se();return}try{X.value=!0;const{data:l}=await jt({project_id:Z.value.id,name:t});if(l.code===200)r.success("项目名称修改成功"),await i(),se();else throw new Error(l.msg)}catch(l){r.error((l==null?void 0:l.message)||"重命名失败")}finally{X.value=!1}},se=()=>{O.value=!1,Z.value=null,z.value="",X.value=!1},Pe=async t=>{if(q(t))try{await de.confirm("确认删除该项目吗？","删除项目",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await Ie({project_id:t.id}),await i(),r.success("删除成功")}catch(e){e!=="cancel"&&r.error("删除失败")}},ne=p(!1),C=p(null),J=p(""),T=p([]),ke=p(!1),le=p(!1),W=p(!1),oe=p(!1),he=p([]),O=p(!1),z=p(""),Z=p(null),X=p(!1),je=p(),ie=async t=>{C.value=t,ne.value=!0,T.value=[{id:0,username:C.value.creator,permission:0}],await ze()},ze=async()=>{var t,e;if(C.value)try{ke.value=!0;const l=C.value.creator,{data:d}=await Mt(C.value.id);if((d==null?void 0:d.code)===200&&((e=(t=d.data)==null?void 0:t.users)==null?void 0:e.length)>0){const S=d.data.users.filter(h=>h.username!==l).map(h=>({id:h.user_id,username:h.username,permission:h.permission}));T.value=[...T.value,...S]}}catch(l){console.error("获取项目成员失败",l),r.error("获取项目成员失败")}finally{ke.value=!1}},Ze=async(t,e)=>{if(t.trim().length<1){e([]);return}try{oe.value=!0;const{data:l}=await _t({username:[t],skip:0,limit:10});l&&l.data&&Array.isArray(l.data.data)?(he.value=l.data.data,e(l.data.data)):e([])}catch(l){console.error("搜索用户失败",l),e([])}finally{oe.value=!1}},Qe=t=>{t&&t.username&&(J.value=t.username)},Ge=async()=>{const t=J.value.trim();if(!t){r.warning("请输入成员用户名");return}if(!C.value){r.warning("项目信息不完整");return}if(T.value.some(l=>l.username===t)){r.warning("该成员已存在");return}const e=he.value.find(l=>l.username===t);if(!(e!=null&&e.id)){r.warning("无法找到该用户，请从列表中选择");return}try{le.value=!0;const{data:l}=await St({project_id:C.value.id,user_id:e.id});if((l==null?void 0:l.code)!==200)throw new Error((l==null?void 0:l.message)||"添加成员失败");await ie(C.value),r.success("成员添加成功")}catch(l){console.error("添加成员失败",l),r.error(l instanceof Error?l.message:"添加成员失败")}finally{le.value=!1}},Je=async t=>{if(!C.value){r.warning("项目信息不完整");return}if(t===C.value.creator){r.warning("不能移除项目创建者");return}const e=T.value.find(l=>l.username===t);if(!(e!=null&&e.id)){r.warning("无法找到该成员");return}try{W.value=!0;const{data:l}=await Bt({project_id:C.value.id,user_id:e.id});if((l==null?void 0:l.code)!==200)throw new Error((l==null?void 0:l.message)||"移除成员失败");T.value=T.value.filter(d=>d.username!==t),r.success("成员移除成功")}catch(l){console.error("删除成员失败",l),r.error(l instanceof Error?l.message:"删除成员失败")}finally{W.value=!1}},re=p(!1),H=p([]),K=p(1),Y=p(10),Se=p(0),$=t=>{var e;return t.creator!==((e=j.userInfo)==null?void 0:e.username)},q=t=>$(t)?(r.warning("您没有权限操作该项目"),!1):!0,We=()=>{re.value=!0,ee()},ee=async()=>{try{const{data:t}=await Te({page:K.value,size:Y.value,is_recycle:1});t.code===200?(H.value=t.data.projects.map(e=>({id:e.id,name:e.name,username:e==null?void 0:e.username,class_type:ue[e.type]||"DEF",type:ce[e.type]||"未知",image_type:e.image_type,creator:e.username||"未知",createTime:e.created_at||new Date().toISOString(),updatedTime:e.updated_at||new Date().toISOString(),isPinned:!!e.is_pinned})),Se.value=t.data.total||0):(console.error("未知的数据结构:",t),r.error("获取回收站项目列表失败：数据结构异常"),H.value=[])}catch(t){console.error("获取回收站项目列表错误:",t),r.error((t==null?void 0:t.message)||"获取回收站项目列表失败"),H.value=[]}},Oe=t=>{K.value=t,ee()},Xe=async t=>{if(q(t))try{await de.confirm("确定要恢复该项目吗？","恢复项目",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await Vt({project_id:t.id}),await ee(),await i(),r.success("恢复成功")}catch(e){e!=="cancel"&&(console.error("恢复项目失败:",e),r.error("恢复失败"))}},He=async t=>{if(q(t))try{await de.confirm("永久删除后将无法恢复，确定要删除吗？","永久删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await Ie({project_id:t.id,is_recycle:1}),r.success("项目已永久删除"),await ee()}catch(e){e!=="cancel"&&r.error("删除失败")}},Ke=t=>{v.value=t,i()},Ye=async()=>{I.value!==0&&await D.loadProjectLabels(I.value),I.value=0,b.value=!1},Me=t=>{I.value=t.id,b.value=!0};return(t,e)=>{var Be;const l=m("el-icon"),d=m("el-button"),S=m("el-tooltip"),h=m("el-pagination"),Q=m("el-dropdown-item"),$e=m("el-dropdown-menu"),qe=m("el-dropdown"),et=m("el-card"),tt=m("el-option"),at=m("el-select"),te=m("el-dialog"),st=m("el-autocomplete"),nt=m("el-input");return A(),B("div",na,[e[39]||(e[39]=a("div",{class:"page-title"},"创建项目",-1)),a("div",la,[s(d,{class:"detection-btn",onClick:e[0]||(e[0]=o=>G("检测"))},{default:n(()=>[e[16]||(e[16]=a("div",{style:{"font-size":"x-large"}},[a("div",null,"目标检测")],-1)),s(l,{class:"add-icon"},{default:n(()=>e[15]||(e[15]=[a("img",{src:Ue,alt:"添加"},null,-1)])),_:1})]),_:1}),s(d,{class:"segmentation-btn",onClick:e[1]||(e[1]=o=>G("分割"))},{default:n(()=>[e[18]||(e[18]=a("div",{style:{"font-size":"x-large"}},[a("div",null,"语义分割")],-1)),s(l,{class:"add-icon"},{default:n(()=>e[17]||(e[17]=[a("img",{src:Rt,alt:"添加"},null,-1)])),_:1})]),_:1}),s(d,{class:"instance-btn",onClick:e[2]||(e[2]=o=>G("实例"))},{default:n(()=>[e[20]||(e[20]=a("div",{style:{"font-size":"x-large"}},[a("div",null,"实例分割")],-1)),s(l,{class:"add-icon"},{default:n(()=>e[19]||(e[19]=[a("img",{src:Ue,alt:"添加"},null,-1)])),_:1})]),_:1}),s(d,{class:"classification-btn",onClick:e[3]||(e[3]=o=>G("分类"))},{default:n(()=>[e[22]||(e[22]=a("div",{style:{"font-size":"x-large"}},[a("div",null,"图像分类")],-1)),s(l,{class:"add-icon"},{default:n(()=>e[21]||(e[21]=[a("img",{src:Dt,alt:"添加"},null,-1)])),_:1})]),_:1})]),a("div",oa,[e[25]||(e[25]=a("div",{class:"section-title"},[a("span",{class:"page-title"},"已有项目")],-1)),a("div",ia,[a("div",ra,[s(l,{class:"stats-icon"},{default:n(()=>[s(w(pt))]),_:1}),a("span",da,f(_.value)+" 个项目",1)]),a("div",ca,[a("div",ua,[a("div",ma,[s(S,{content:"卡片",placement:"top","show-after":300},{default:n(()=>[a("div",{class:U(["segment-item",{active:y.value==="grid"}]),onClick:e[4]||(e[4]=o=>y.value="grid")},[s(l,null,{default:n(()=>[s(w(gt))]),_:1})],2)]),_:1}),s(S,{content:"列表",placement:"top","show-after":300},{default:n(()=>[a("div",{class:U(["segment-item",{active:y.value==="list"}]),onClick:e[5]||(e[5]=o=>y.value="list")},[s(l,null,{default:n(()=>[s(w(ft))]),_:1})],2)]),_:1})])]),e[24]||(e[24]=a("div",{class:"divider-line"},null,-1)),a("div",{class:"trash-action",onClick:We},[s(l,{class:"trash-icon"},{default:n(()=>[s(w(ae))]),_:1}),e[23]||(e[23]=a("span",{class:"trash-text"},"回收站",-1))])])])]),a("div",pa,[a("div",{class:U(["project-section",{"list-view":y.value==="list"}])},[y.value==="grid"?(A(),R(Wt,{key:0,projects:k.value,onProjectClick:ye,onTogglePin:Ae,onRenameProject:be,onManageMembers:ie,onManageLabels:Me,onDeleteProject:Pe,onCanManageProject:$},null,8,["projects"])):(A(),R(sa,{key:1,projects:k.value,onProjectClick:ye,onTogglePin:Ae,onRenameProject:be,onManageMembers:ie,onManageLabels:Me,onDeleteProject:Pe},null,8,["projects"]))],2),a("div",ga,[s(h,{"current-page":v.value,"onUpdate:currentPage":e[6]||(e[6]=o=>v.value=o),"page-size":g.value,total:_.value,layout:"prev, pager, next",onCurrentChange:Ke,background:""},null,8,["current-page","page-size","total"])])]),s(te,{modelValue:re.value,"onUpdate:modelValue":e[9]||(e[9]=o=>re.value=o),title:"回收站",width:"80%",class:"trash-dialog","close-on-click-modal":!1,top:"10vh"},{default:n(()=>[a("div",fa,[a("div",va,[a("div",_a,[(A(!0),B(me,null,pe(H.value,o=>(A(),B("div",{class:"custom-col",key:o.id},[s(et,{shadow:"hover",class:"project-card"},{header:n(()=>[a("div",wa,[s(S,{content:o.name,placement:"top-start","show-after":500,"hide-after":2e3},{default:n(()=>[a("h3",ya,f(o.name),1)]),_:2},1032,["content"]),a("div",Aa,[a("div",{class:U(["card-tag",{"detection-type":o.class_type==="DET","segmentation-type":o.class_type==="SEG","classification-type":o.class_type==="CLS","instance-type":o.class_type==="INS"}])},f(o.type),3),s(qe,{trigger:"click"},{dropdown:n(()=>[s($e,null,{default:n(()=>[s(Q,{onClick:Ve=>Xe(o),disabled:$(o)},{default:n(()=>[s(l,null,{default:n(()=>[s(w(wt))]),_:1}),e[27]||(e[27]=a("span",null,"恢复",-1))]),_:2},1032,["onClick","disabled"]),s(Q,{onClick:Ve=>He(o),class:"danger",disabled:$(o)},{default:n(()=>[s(l,null,{default:n(()=>[s(w(ae))]),_:1}),e[28]||(e[28]=a("span",null,"永久删除",-1))]),_:2},1032,["onClick","disabled"])]),_:2},1024)]),default:n(()=>[s(d,{class:"more-btn",link:""},{default:n(()=>[s(l,{class:"more-icon"},{default:n(()=>e[26]||(e[26]=[a("img",{src:fe,alt:"更多"},null,-1)])),_:1})]),_:1})]),_:2},1024)])])]),default:n(()=>[a("div",ba,[a("p",null,[e[29]||(e[29]=a("span",{class:"detail-label"},"创建人：",-1)),M("    "+f(o.creator),1)]),a("p",null,[e[30]||(e[30]=a("span",{class:"detail-label"},"创建时间：",-1)),M(" "+f(o.createTime),1)]),a("p",null,[e[31]||(e[31]=a("span",{class:"detail-label"},"最近访问：",-1)),M(" "+f(o.updatedTime),1)])])]),_:2},1024)]))),128))])]),a("div",Ca,[s(at,{modelValue:Y.value,"onUpdate:modelValue":e[7]||(e[7]=o=>Y.value=o),class:"page-size-select",size:"small"},{default:n(()=>[s(tt,{value:10,label:"10条/页"})]),_:1},8,["modelValue"]),s(h,{"current-page":K.value,"onUpdate:currentPage":e[8]||(e[8]=o=>K.value=o),"page-size":Y.value,total:Se.value,layout:"prev, pager, next",onCurrentChange:Oe,background:""},null,8,["current-page","page-size","total"])])])]),_:1},8,["modelValue"]),s(te,{modelValue:ne.value,"onUpdate:modelValue":e[11]||(e[11]=o=>ne.value=o),title:`成员管理 ( ${(Be=C.value)==null?void 0:Be.name} )`,width:"500px","close-on-click-modal":!1,class:"member-dialog","show-close":!0,"destroy-on-close":""},{default:n(()=>[a("div",Pa,[a("div",ka,[e[33]||(e[33]=a("span",null,"添加新成员",-1)),a("div",ha,[s(st,{modelValue:J.value,"onUpdate:modelValue":e[10]||(e[10]=o=>J.value=o),"fetch-suggestions":Ze,placeholder:"请输入成员用户名","trigger-on-focus":!1,loading:oe.value,"value-key":"username",clearable:"",onSelect:Qe},{default:n(({item:o})=>[a("div",ja,[a("span",null,f(o.username),1)])]),_:1},8,["modelValue","loading"]),s(d,{type:"primary",onClick:Ge,loading:le.value},{default:n(()=>e[32]||(e[32]=[M("添加")])),_:1},8,["loading"])])]),a("div",Sa,[e[35]||(e[35]=a("div",{class:"member-list-header"},[a("span",{class:"member-name-header"},"用户名"),a("span",{class:"member-operation-header"},"操作")],-1)),a("div",Ma,[(A(!0),B(me,null,pe(T.value,o=>(A(),B("div",{class:"member-item",key:o.username},[a("span",Ba,f(o.username),1),a("div",Va,[s(d,{type:"danger",size:"small",onClick:Ve=>Je(o.username),disabled:C.value&&o.username===C.value.creator||W.value,loading:W.value},{default:n(()=>e[34]||(e[34]=[M(" 删除成员 ")])),_:2},1032,["onClick","disabled","loading"])])]))),128))])])])]),_:1},8,["modelValue","title"]),s(te,{modelValue:O.value,"onUpdate:modelValue":e[13]||(e[13]=o=>O.value=o),title:"重命名项目",width:"480px","close-on-click-modal":!1,class:"rename-dialog","show-close":!0,"destroy-on-close":""},{footer:n(()=>[a("div",Ia,[s(d,{onClick:se},{default:n(()=>e[37]||(e[37]=[M("取消")])),_:1}),s(d,{style:{"background-color":"#555FFF",color:"#FFFFFF"},onClick:Ce,loading:X.value},{default:n(()=>e[38]||(e[38]=[M("确定")])),_:1},8,["loading"])])]),default:n(()=>[a("div",Ea,[a("div",Ta,[e[36]||(e[36]=a("span",{class:"input-label"},"项目名称",-1)),s(nt,{modelValue:z.value,"onUpdate:modelValue":e[12]||(e[12]=o=>z.value=o),size:"default",class:"rename-input",placeholder:"请输入项目名称",maxlength:100,"show-word-limit":!0,clearable:"",ref_key:"renameInputRef",ref:je,onKeyup:vt(Ce,["enter"])},null,8,["modelValue"])])])]),_:1},8,["modelValue"]),s(te,{modelValue:b.value,"onUpdate:modelValue":e[14]||(e[14]=o=>b.value=o),title:"类别管理",width:"60%","append-to-body":!0,"close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!0,"destroy-on-close":""},{default:n(()=>[s(kt,{"project-id":I.value,from:"projectList",onChangeData:Ye},null,8,["project-id"])]),_:1},8,["modelValue"])])}}}),Ga=ve(Fa,[["__scopeId","data-v-83ddf2ae"]]);export{Ga as default};
//# sourceMappingURL=ProjectList-Dw0ahNS6.js.map
