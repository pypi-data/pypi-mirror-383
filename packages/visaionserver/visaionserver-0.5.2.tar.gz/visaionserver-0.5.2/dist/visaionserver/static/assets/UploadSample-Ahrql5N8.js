import{ab as vt,ac as ht,ad as De,d as gt,s as mt,x as yt,y as ye,v as bt,r as v,ae as _t,af as ue,z as Te,V as wt,c as L,b as h,A as $e,e as V,w as ae,g as ne,t as H,n as Fe,q as ce,m as je,P as xe,Q as Be,D as Ee,h as St,M as Ie,ag as At,j as Ue,ah as Ct,ai as Tt,o as E,aj as $t,ak as Ft}from"./index-DKhC6MDA.js";import{u as jt}from"./tag-CwSG9OMY.js";import{b as xt}from"./label-x0sVxddY.js";import{v as Le}from"./validator-DnHCjo9g.js";import{_ as Bt}from"./_plugin-vue_export-helper-DlAUqK2U.js";var Oe={exports:{}};(function(W,N){(function(F){W.exports=F()})(function(F){var $=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function A(o,r){var t=o[0],e=o[1],n=o[2],a=o[3];t+=(e&n|~e&a)+r[0]-680876936|0,t=(t<<7|t>>>25)+e|0,a+=(t&e|~t&n)+r[1]-389564586|0,a=(a<<12|a>>>20)+t|0,n+=(a&t|~a&e)+r[2]+606105819|0,n=(n<<17|n>>>15)+a|0,e+=(n&a|~n&t)+r[3]-1044525330|0,e=(e<<22|e>>>10)+n|0,t+=(e&n|~e&a)+r[4]-176418897|0,t=(t<<7|t>>>25)+e|0,a+=(t&e|~t&n)+r[5]+1200080426|0,a=(a<<12|a>>>20)+t|0,n+=(a&t|~a&e)+r[6]-1473231341|0,n=(n<<17|n>>>15)+a|0,e+=(n&a|~n&t)+r[7]-45705983|0,e=(e<<22|e>>>10)+n|0,t+=(e&n|~e&a)+r[8]+1770035416|0,t=(t<<7|t>>>25)+e|0,a+=(t&e|~t&n)+r[9]-1958414417|0,a=(a<<12|a>>>20)+t|0,n+=(a&t|~a&e)+r[10]-42063|0,n=(n<<17|n>>>15)+a|0,e+=(n&a|~n&t)+r[11]-1990404162|0,e=(e<<22|e>>>10)+n|0,t+=(e&n|~e&a)+r[12]+1804603682|0,t=(t<<7|t>>>25)+e|0,a+=(t&e|~t&n)+r[13]-40341101|0,a=(a<<12|a>>>20)+t|0,n+=(a&t|~a&e)+r[14]-1502002290|0,n=(n<<17|n>>>15)+a|0,e+=(n&a|~n&t)+r[15]+1236535329|0,e=(e<<22|e>>>10)+n|0,t+=(e&a|n&~a)+r[1]-165796510|0,t=(t<<5|t>>>27)+e|0,a+=(t&n|e&~n)+r[6]-1069501632|0,a=(a<<9|a>>>23)+t|0,n+=(a&e|t&~e)+r[11]+643717713|0,n=(n<<14|n>>>18)+a|0,e+=(n&t|a&~t)+r[0]-373897302|0,e=(e<<20|e>>>12)+n|0,t+=(e&a|n&~a)+r[5]-701558691|0,t=(t<<5|t>>>27)+e|0,a+=(t&n|e&~n)+r[10]+38016083|0,a=(a<<9|a>>>23)+t|0,n+=(a&e|t&~e)+r[15]-660478335|0,n=(n<<14|n>>>18)+a|0,e+=(n&t|a&~t)+r[4]-405537848|0,e=(e<<20|e>>>12)+n|0,t+=(e&a|n&~a)+r[9]+568446438|0,t=(t<<5|t>>>27)+e|0,a+=(t&n|e&~n)+r[14]-1019803690|0,a=(a<<9|a>>>23)+t|0,n+=(a&e|t&~e)+r[3]-187363961|0,n=(n<<14|n>>>18)+a|0,e+=(n&t|a&~t)+r[8]+1163531501|0,e=(e<<20|e>>>12)+n|0,t+=(e&a|n&~a)+r[13]-1444681467|0,t=(t<<5|t>>>27)+e|0,a+=(t&n|e&~n)+r[2]-51403784|0,a=(a<<9|a>>>23)+t|0,n+=(a&e|t&~e)+r[7]+1735328473|0,n=(n<<14|n>>>18)+a|0,e+=(n&t|a&~t)+r[12]-1926607734|0,e=(e<<20|e>>>12)+n|0,t+=(e^n^a)+r[5]-378558|0,t=(t<<4|t>>>28)+e|0,a+=(t^e^n)+r[8]-2022574463|0,a=(a<<11|a>>>21)+t|0,n+=(a^t^e)+r[11]+1839030562|0,n=(n<<16|n>>>16)+a|0,e+=(n^a^t)+r[14]-35309556|0,e=(e<<23|e>>>9)+n|0,t+=(e^n^a)+r[1]-1530992060|0,t=(t<<4|t>>>28)+e|0,a+=(t^e^n)+r[4]+1272893353|0,a=(a<<11|a>>>21)+t|0,n+=(a^t^e)+r[7]-155497632|0,n=(n<<16|n>>>16)+a|0,e+=(n^a^t)+r[10]-1094730640|0,e=(e<<23|e>>>9)+n|0,t+=(e^n^a)+r[13]+681279174|0,t=(t<<4|t>>>28)+e|0,a+=(t^e^n)+r[0]-358537222|0,a=(a<<11|a>>>21)+t|0,n+=(a^t^e)+r[3]-722521979|0,n=(n<<16|n>>>16)+a|0,e+=(n^a^t)+r[6]+76029189|0,e=(e<<23|e>>>9)+n|0,t+=(e^n^a)+r[9]-640364487|0,t=(t<<4|t>>>28)+e|0,a+=(t^e^n)+r[12]-421815835|0,a=(a<<11|a>>>21)+t|0,n+=(a^t^e)+r[15]+530742520|0,n=(n<<16|n>>>16)+a|0,e+=(n^a^t)+r[2]-995338651|0,e=(e<<23|e>>>9)+n|0,t+=(n^(e|~a))+r[0]-198630844|0,t=(t<<6|t>>>26)+e|0,a+=(e^(t|~n))+r[7]+1126891415|0,a=(a<<10|a>>>22)+t|0,n+=(t^(a|~e))+r[14]-1416354905|0,n=(n<<15|n>>>17)+a|0,e+=(a^(n|~t))+r[5]-57434055|0,e=(e<<21|e>>>11)+n|0,t+=(n^(e|~a))+r[12]+1700485571|0,t=(t<<6|t>>>26)+e|0,a+=(e^(t|~n))+r[3]-1894986606|0,a=(a<<10|a>>>22)+t|0,n+=(t^(a|~e))+r[10]-1051523|0,n=(n<<15|n>>>17)+a|0,e+=(a^(n|~t))+r[1]-2054922799|0,e=(e<<21|e>>>11)+n|0,t+=(n^(e|~a))+r[8]+1873313359|0,t=(t<<6|t>>>26)+e|0,a+=(e^(t|~n))+r[15]-30611744|0,a=(a<<10|a>>>22)+t|0,n+=(t^(a|~e))+r[6]-1560198380|0,n=(n<<15|n>>>17)+a|0,e+=(a^(n|~t))+r[13]+1309151649|0,e=(e<<21|e>>>11)+n|0,t+=(n^(e|~a))+r[4]-145523070|0,t=(t<<6|t>>>26)+e|0,a+=(e^(t|~n))+r[11]-1120210379|0,a=(a<<10|a>>>22)+t|0,n+=(t^(a|~e))+r[2]+718787259|0,n=(n<<15|n>>>17)+a|0,e+=(a^(n|~t))+r[9]-343485551|0,e=(e<<21|e>>>11)+n|0,o[0]=t+o[0]|0,o[1]=e+o[1]|0,o[2]=n+o[2]|0,o[3]=a+o[3]|0}function q(o){var r=[],t;for(t=0;t<64;t+=4)r[t>>2]=o.charCodeAt(t)+(o.charCodeAt(t+1)<<8)+(o.charCodeAt(t+2)<<16)+(o.charCodeAt(t+3)<<24);return r}function x(o){var r=[],t;for(t=0;t<64;t+=4)r[t>>2]=o[t]+(o[t+1]<<8)+(o[t+2]<<16)+(o[t+3]<<24);return r}function Q(o){var r=o.length,t=[1732584193,-271733879,-1732584194,271733878],e,n,a,m,y,S;for(e=64;e<=r;e+=64)A(t,q(o.substring(e-64,e)));for(o=o.substring(e-64),n=o.length,a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;e<n;e+=1)a[e>>2]|=o.charCodeAt(e)<<(e%4<<3);if(a[e>>2]|=128<<(e%4<<3),e>55)for(A(t,a),e=0;e<16;e+=1)a[e]=0;return m=r*8,m=m.toString(16).match(/(.*?)(.{0,8})$/),y=parseInt(m[2],16),S=parseInt(m[1],16)||0,a[14]=y,a[15]=S,A(t,a),t}function Z(o){var r=o.length,t=[1732584193,-271733879,-1732584194,271733878],e,n,a,m,y,S;for(e=64;e<=r;e+=64)A(t,x(o.subarray(e-64,e)));for(o=e-64<r?o.subarray(e-64):new Uint8Array(0),n=o.length,a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;e<n;e+=1)a[e>>2]|=o[e]<<(e%4<<3);if(a[e>>2]|=128<<(e%4<<3),e>55)for(A(t,a),e=0;e<16;e+=1)a[e]=0;return m=r*8,m=m.toString(16).match(/(.*?)(.{0,8})$/),y=parseInt(m[2],16),S=parseInt(m[1],16)||0,a[14]=y,a[15]=S,A(t,a),t}function D(o){var r="",t;for(t=0;t<4;t+=1)r+=$[o>>t*8+4&15]+$[o>>t*8&15];return r}function I(o){var r;for(r=0;r<o.length;r+=1)o[r]=D(o[r]);return o.join("")}I(Q("hello")),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&function(){function o(r,t){return r=r|0||0,r<0?Math.max(r+t,0):Math.min(r,t)}ArrayBuffer.prototype.slice=function(r,t){var e=this.byteLength,n=o(r,e),a=e,m,y,S,_;return t!==F&&(a=o(t,e)),n>a?new ArrayBuffer(0):(m=a-n,y=new ArrayBuffer(m),S=new Uint8Array(y),_=new Uint8Array(this,n,m),S.set(_),y)}}();function Y(o){return/[\u0080-\uFFFF]/.test(o)&&(o=unescape(encodeURIComponent(o))),o}function O(o,r){var t=o.length,e=new ArrayBuffer(t),n=new Uint8Array(e),a;for(a=0;a<t;a+=1)n[a]=o.charCodeAt(a);return r?n:e}function k(o){return String.fromCharCode.apply(null,new Uint8Array(o))}function ee(o,r,t){var e=new Uint8Array(o.byteLength+r.byteLength);return e.set(new Uint8Array(o)),e.set(new Uint8Array(r),o.byteLength),e}function U(o){var r=[],t=o.length,e;for(e=0;e<t-1;e+=2)r.push(parseInt(o.substr(e,2),16));return String.fromCharCode.apply(String,r)}function g(){this.reset()}return g.prototype.append=function(o){return this.appendBinary(Y(o)),this},g.prototype.appendBinary=function(o){this._buff+=o,this._length+=o.length;var r=this._buff.length,t;for(t=64;t<=r;t+=64)A(this._hash,q(this._buff.substring(t-64,t)));return this._buff=this._buff.substring(t-64),this},g.prototype.end=function(o){var r=this._buff,t=r.length,e,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],a;for(e=0;e<t;e+=1)n[e>>2]|=r.charCodeAt(e)<<(e%4<<3);return this._finish(n,t),a=I(this._hash),o&&(a=U(a)),this.reset(),a},g.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},g.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},g.prototype.setState=function(o){return this._buff=o.buff,this._length=o.length,this._hash=o.hash,this},g.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},g.prototype._finish=function(o,r){var t=r,e,n,a;if(o[t>>2]|=128<<(t%4<<3),t>55)for(A(this._hash,o),t=0;t<16;t+=1)o[t]=0;e=this._length*8,e=e.toString(16).match(/(.*?)(.{0,8})$/),n=parseInt(e[2],16),a=parseInt(e[1],16)||0,o[14]=n,o[15]=a,A(this._hash,o)},g.hash=function(o,r){return g.hashBinary(Y(o),r)},g.hashBinary=function(o,r){var t=Q(o),e=I(t);return r?U(e):e},g.ArrayBuffer=function(){this.reset()},g.ArrayBuffer.prototype.append=function(o){var r=ee(this._buff.buffer,o),t=r.length,e;for(this._length+=o.byteLength,e=64;e<=t;e+=64)A(this._hash,x(r.subarray(e-64,e)));return this._buff=e-64<t?new Uint8Array(r.buffer.slice(e-64)):new Uint8Array(0),this},g.ArrayBuffer.prototype.end=function(o){var r=this._buff,t=r.length,e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],n,a;for(n=0;n<t;n+=1)e[n>>2]|=r[n]<<(n%4<<3);return this._finish(e,t),a=I(this._hash),o&&(a=U(a)),this.reset(),a},g.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},g.ArrayBuffer.prototype.getState=function(){var o=g.prototype.getState.call(this);return o.buff=k(o.buff),o},g.ArrayBuffer.prototype.setState=function(o){return o.buff=O(o.buff,!0),g.prototype.setState.call(this,o)},g.ArrayBuffer.prototype.destroy=g.prototype.destroy,g.ArrayBuffer.prototype._finish=g.prototype._finish,g.ArrayBuffer.hash=function(o,r){var t=Z(new Uint8Array(o)),e=I(t);return r?U(e):e},g})})(Oe);var Et=Oe.exports;const It=vt(Et);function Ut(...W){const N=[];return W.forEach($=>{if($){const{cleanup:A}=ht($);N.push(A)}}),De(()=>{N.forEach($=>$())}),{cleanup:()=>{N.forEach($=>$())}}}function Ne(W){return Ut(W)}const Lt={class:"upload-page-container"},Nt={class:"main-container"},Mt={class:"upload-content",style:{position:"relative"}},Dt={key:0,class:"simple-loading-overlay"},Ot={class:"loading-content"},Rt={class:"progress-text"},Jt={class:"upload-icon"},Pt={class:"tag-selector-container"},zt={class:"tag-selector-header"},Vt={key:0,class:"tag-hint"},Ht={class:"upload-progress-container"},Wt={class:"stat-item",style:{width:"50%"}},Kt={class:"stat-value"},Gt={class:"stat-item",style:{width:"50%"}},Xt={class:"success-value"},qt={class:"upload-progress"},Qt={key:1,class:"empty-progress"},Zt={class:"upload-actions"},Yt={class:"right-sidebar"},kt=["innerHTML"],ea={key:1},Me="application/json",ta=gt({__name:"UploadSample",setup(W){const N=mt(),{currentProject:F}=yt(N),$=ye(()=>{var s;return(s=F.value)==null?void 0:s.id}),A=ye(()=>{var s;return(s=F.value)==null?void 0:s.type}),q=ye(()=>{var s;return((s=F.value)==null?void 0:s.image_type)||0}),x=bt(),Q=jt(),Z=v([]),D=v([]),I=v(!1),Y=St(),O=v([]),k=v(0),ee=v(0),U=v(0),g=v(0),o=v(0),r=v(0),t=v(0),e=v(0),n=v(0),a=v(0),m=v(),y=v(!1),S=v([]),_=v(!1);let j=null;Ne(y);const{on:be,off:_e}=_t(),se=()=>{_.value=!0,j&&(j.abort(),j=null),p("ç”±äºç™»å½•çŠ¶æ€å¤±æ•ˆï¼Œä¸Šä¼ å·²ä¸­æ–­"),w.value&&(w.value=!1,p("ç”±äºç™»å½•çŠ¶æ€å¤±æ•ˆï¼Œæ–‡ä»¶å¤„ç†å·²ä¸­æ–­"),m.value&&(m.value.value=""),M.value=0,K.value=0,R.value="")};be(ue.TOKEN_EXPIRED,se),be(ue.TOKEN_CONFLICT,se);let re=null;const oe=v("color"),fe=v(!1),Re=v(null),te=v([]),le=v(null),w=v(!1),R=v(""),M=v(0),K=v(0);Ne(w);const J=v(new Map),B=v([]),C=v([]),Je=["image/jpeg","image/jpg","image/png","image/bmp"],G=v(new Map),de=v(null),pe=v(null),Pe=()=>{!w.value&&m.value&&m.value.click()},ze=s=>{s.preventDefault()},Ve=s=>{var i;if(s.preventDefault(),w.value)return;const l=Array.from(((i=s.dataTransfer)==null?void 0:i.files)||[]);l.length>0&&we(l)},He=s=>{const l=s.target,i=Array.from(l.files||[]);i.length>0&&we(i)},we=async s=>{if(_.value){p("ç™»å½•çŠ¶æ€å·²å¤±æ•ˆï¼Œæ— æ³•å¤„ç†æ–‡ä»¶");return}w.value=!0,K.value=s.length,M.value=0,R.value=`å¼€å§‹å¤„ç† ${s.length} ä¸ªæ–‡ä»¶...`,await Ee(),B.value=[],C.value=[],O.value=[],G.value.clear(),J.value.clear(),ee.value=0;const l=10;for(let i=0;i<s.length;i+=l){const u=s.slice(i,i+l);for(const d of u)await We(d),M.value++,R.value=`æ­£åœ¨å¤„ç†æ–‡ä»¶... (${M.value}/${K.value})`;await new Promise(d=>setTimeout(d,10))}if(await ot(),_.value){p(`æ–‡ä»¶å¤„ç†å·²ä¸­æ–­ï¼šå…±å¤„ç† ${M.value} ä¸ªæ–‡ä»¶`),w.value=!1;return}Qe(),k.value=B.value.length,ke(),R.value="æ–‡ä»¶å¤„ç†å®Œæˆï¼",setTimeout(()=>{w.value=!1},500)},We=async s=>{if(!Je.includes(s.type)&&s.type!==Me){p(`ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹: ${s.name}ï¼Œä»…æ”¯æŒjpeg/jpgã€pngã€bmpå’Œjsonæ ¼å¼`);return}if(s.type===Me){if(s.name==="label.json"){de.value=s;return}if(s.name==="background.json"){pe.value=s;return}if(!C.value.some(l=>l.name===s.name)){C.value.push(s);try{const l=await Ke(s),i=JSON.parse(l);s.labelList=Ge(i)}catch{p(`è§£æJSONæ–‡ä»¶ ${s.name} å¤±è´¥`)}}return}try{await Ze(s)}catch{p(`å¤„ç†å›¾ç‰‡ ${s.name} æ—¶å‡ºé”™`)}},Ke=s=>new Promise((l,i)=>{const u=new FileReader;u.onload=d=>{var c;return l((c=d.target)==null?void 0:c.result)},u.onerror=()=>i(new Error("è¯»å–æ–‡ä»¶å¤±è´¥")),u.readAsText(s)}),Ge=s=>{const l=new Set;if(A.value==="åˆ†ç±»")s.classfication&&l.add(s.classfication.labelName);else for(const i of Object.keys(s))Array.isArray(s[i])&&s[i].forEach(u=>{u.labelName&&l.add(u.labelName)});return Array.from(l)},Xe=()=>{w.value=!1,m.value&&(m.value.value=""),B.value=[],C.value=[],O.value=[],k.value=0,G.value.clear(),J.value.clear(),M.value=0,K.value=0,R.value="",p("æ–‡ä»¶å¤„ç†å·²å–æ¶ˆ")},Se=s=>{if(y.value){const l="ä¸Šä¼ æ­£åœ¨è¿›è¡Œä¸­ï¼Œåˆ·æ–°é¡µé¢å°†ä¸­æ–­ä¸Šä¼ è¿›ç¨‹ã€‚æ˜¯å¦ç¡®å®šè¦ç¦»å¼€ï¼Ÿ";return s.preventDefault(),s.returnValue=l,l}},qe=()=>{window.addEventListener("beforeunload",Se)},ve=()=>{window.removeEventListener("beforeunload",Se)},Qe=()=>{if(B.value.length===0)return;const s=new Map,l=new Map,i=new Set;if(C.value.length>0)for(const u of C.value){if(!u)continue;const d=u.name;let c="";if(d.endsWith(".mix.json"))c=d.substring(0,d.lastIndexOf(".mix.json"));else if(d.endsWith(".json"))c=d.substring(0,d.lastIndexOf(".json"));else{console.warn(`æœªçŸ¥çš„JSONæ–‡ä»¶æ ¼å¼: ${d}`);continue}l.set(c,u)}for(const u of B.value){if(!u)continue;const d=u.name.substring(0,u.name.lastIndexOf(".")),c=l.get(d)||null;s.set(d,{image:u,json:c}),c&&i.add(d)}for(const[u,d]of l.entries())i.has(u)||s.has(u)||(s.set(u,{image:null,json:d}),p(`è­¦å‘Šï¼š${u} åªæœ‰JSONæ–‡ä»¶ï¼Œç¼ºå°‘å¯¹åº”çš„å›¾ç‰‡æ–‡ä»¶`));J.value=s},Ze=async s=>{try{const l=await Ae(s);if(Array.from(G.value.keys()).includes(l)){const i=G.value.get(l);p(`å‘ç°é‡å¤å›¾ç‰‡: ${s.name}ï¼Œä¸ ${i} å†…å®¹ç›¸åŒï¼Œå·²ä¸¢å¼ƒ`),o.value++,Ye(s.name);return}B.value.push(s),G.value.set(l,s.name)}catch(l){if(l.message==="MD5è®¡ç®—è¢«ä¸­æ–­")return;console.error(`å¤„ç†å›¾ç‰‡ ${s.name} æ—¶å‡ºé”™:`,l)}},Ye=s=>{const l=s.substring(0,s.lastIndexOf(".")),i=C.value.findIndex(u=>{let d="";const c=u.name;return c.endsWith(".mix.json")?d=c.substring(0,c.lastIndexOf(".mix.json")):c.endsWith(".json")&&(d=c.substring(0,c.lastIndexOf(".json"))),d===l});if(i!==-1){const u=C.value[i];C.value.splice(i,1),p(`åŒæ—¶ç§»é™¤å¯¹åº”çš„JSONæ–‡ä»¶: ${u.name}`);const d=O.value.findIndex(c=>c.name===u.name);d!==-1&&O.value.splice(d,1)}},X=v(new Set),he=()=>{X.value.forEach(s=>{try{s.abort()}catch{}}),X.value.clear()},Ae=s=>new Promise((l,i)=>{const u=File.prototype.slice,d=2097152,c=Math.ceil(s.size/d);let f=0;const b=new It.ArrayBuffer,T=new FileReader;X.value.add(T),T.onload=z=>{if(_.value){X.value.delete(T),i(new Error("MD5è®¡ç®—è¢«ä¸­æ–­"));return}if(b.append(z.target.result),f++,f<c)P();else{const me=b.end();X.value.delete(T),l(me)}},T.onerror=z=>{X.value.delete(T),i(z)};function P(){const z=f*d,me=z+d>=s.size?s.size:z+d;T.readAsArrayBuffer(u.call(s,z,me))}P()}),ke=()=>{if(B.value.length>0){const s=B.value.length===1?`å·²é€‰æ‹© 1 å¼ å›¾ç‰‡: ${B.value[0].name}`:`å·²é€‰æ‹© ${B.value.length} å¼ å›¾ç‰‡`;C.value.length>0?ge(`${s}, ${C.value.length} ä¸ªJSONæ–‡ä»¶`):ge(s)}else C.value.length>0&&ge(`å·²é€‰æ‹© ${C.value.length} ä¸ªJSONæ–‡ä»¶ï¼Œæ²¡æœ‰é€‰æ‹©å›¾ç‰‡`)},ge=s=>{const l=te.value.findIndex(i=>i.startsWith("å·²é€‰æ‹©"));l!==-1?te.value[l]=s:te.value.unshift(s)},et=()=>{const s=[];for(const[l,i]of J.value.entries())i.image&&s.push(i.image);return s},tt=()=>{var l;return Array.from(J.value.values()).some(i=>i.image!==null)?(l=F.value)!=null&&l.id?!0:(p("è¯·å…ˆé€‰æ‹©é¡¹ç›®"),!1):(p("è¯·å…ˆé€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶"),!1)},at=async s=>{if(_.value)return!1;if(!s)return p("æ–‡ä»¶å¯¹è±¡æ— æ•ˆï¼Œè·³è¿‡æ­¤æ–‡ä»¶"),!1;const l=await Ae(s),i=new FormData;i.append("name",s.name),i.append("md5",l),i.append("project_id",String(F.value.id)),i.append("file",s);const u=s.name.substring(0,s.name.lastIndexOf(".")),d=J.value.get(u);if(d!=null&&d.json){const c=d.json,f=c.labelList;i.append("annotation_file",c),f&&Array.isArray(f)&&f.length>0&&i.append("label_names",f.join(","))}if(S.value.length!==0){const{existingTags:c,newTags:f}=await ut(S.value);(c.length>0||f.length>0)&&i.append("tag_names",[...c,...f].join(","))}try{const c=await Ft(i,j==null?void 0:j.signal);if(c.data.code===200)return p(`${s.name} ä¸Šä¼ æˆåŠŸ`),Re.value=c.data.data.id.toString(),N.setHasSampleImage(!0),!0;{const f=c.data.msg||"";return f.includes("å·²å­˜åœ¨")||f.includes("é‡å¤")||f.includes("exist")?(t.value++,p(`${s.name} ä¸Šä¼ å¤±è´¥: æ–‡ä»¶å·²å­˜åœ¨`)):f.includes("æ ¼å¼")||f.includes("format")||f.includes("ç±»å‹")?(n.value++,p(`${s.name} ä¸Šä¼ å¤±è´¥: æ ¼å¼é”™è¯¯ - ${f}`)):(a.value++,p(`${s.name} ä¸Šä¼ å¤±è´¥: ${f}`)),!1}}catch(c){if(c.name==="AbortError"||c.code==="ERR_CANCELED"||_.value)return!1;const f=c.message||"";return f.includes("ç½‘ç»œ")||f.includes("network")||f.includes("timeout")||c.code==="NETWORK_ERROR"?(e.value++,p(`${s.name} ä¸Šä¼ å‡ºé”™: ç½‘ç»œé”™è¯¯`)):(a.value++,p(`${s.name} ä¸Šä¼ å‡ºé”™: ${f}`)),!1}},nt=()=>{re=Y.beforeEach((s,l,i)=>{const u=x.isUploading,d=x.showUploadingTip,c=u&&d||w.value;if(l.path.includes("/sample/upload")&&c&&!_.value){const f=w.value?"å½“å‰æ­£åœ¨å¤„ç†æ–‡ä»¶ï¼Œç¦»å¼€é¡µé¢å°†ä¸­æ–­å¤„ç†ã€‚æ˜¯å¦ç¡®è®¤ç¦»å¼€ï¼Ÿ":"å½“å‰æœ‰ä¸Šä¼ ä»»åŠ¡æ­£åœ¨è¿›è¡Œä¸­ï¼Œç¦»å¼€é¡µé¢å°†ä¸­æ–­ä¸Šä¼ ã€‚æ˜¯å¦ç¡®è®¤ç¦»å¼€ï¼Ÿ";Ie.confirm(f,"æç¤º",{confirmButtonText:"ç¡®è®¤ç¦»å¼€",cancelButtonText:"å–æ¶ˆ",type:"warning"}).then(()=>{_.value=!0,w.value&&(he(),w.value=!1),ie(!1),i()}).catch(()=>{i(!1)})}else _.value&&ie(!1),i()})},st=()=>{re&&(re(),re=null)},ie=(s=!0)=>{y.value=!1,w.value&&(he(),w.value=!1,M.value=0,K.value=0,R.value=""),s&&(_.value=!1),j&&(j=null),x.clearUploadingStatus(),x.clearShowUploadingTip(),U.value=0,B.value=[],C.value=[],G.value.clear(),J.value.clear(),O.value=[],g.value=0,o.value=0,r.value=0,t.value=0,e.value=0,n.value=0,a.value=0,m.value&&(m.value.value=""),p("æ–‡ä»¶åˆ—è¡¨å·²é‡ç½®ï¼Œå¯ä»¥ç»§ç»­ä¸Šä¼ æ–°æ–‡ä»¶")},rt=()=>{_.value=!1},ot=async()=>{try{await At()}catch(s){console.error("æ£€æŸ¥tokençŠ¶æ€æ—¶å‡ºé”™:",s)}},Ce=async()=>{try{const s=await Q.fetchTags($.value);Z.value=s.tags||[],D.value=s.tags||[]}catch(s){console.error("è·å–é¡¹ç›®æ ‡ç­¾å¤±è´¥:",s),Z.value=[],D.value=[]}},lt=async s=>{I.value=!0;try{const l=await Q.fetchTags($.value,{name:s,page:1,page_size:20});D.value=l.tags||[]}catch(l){console.error("æœç´¢æ ‡ç­¾å¤±è´¥:",l),D.value=[]}finally{I.value=!1}},it=s=>{const l=[];s.forEach(i=>{Le(i,()=>{})||l.push(i)}),l.length>0&&(S.value=s.filter(i=>!l.includes(i)),p(`æ ‡ç­¾åç§°ä¸åˆæ³•å·²è‡ªåŠ¨ç§»é™¤: ${l.join(", ")}`))},ut=async s=>{const l=[],i=[];return await Ce(),s.forEach(u=>{Z.value.find(c=>c.name===u)?l.push(u):Le(u.trim(),()=>{})?i.push(u.trim()):p(`è·³è¿‡ä¸åˆæ³•çš„æ ‡ç­¾åç§°: ${u}`)}),{existingTags:l,newTags:i}},ct=async()=>{var s;if(de.value)try{const l=new FileReader,i=await new Promise((f,b)=>{l.onload=T=>{var P;return f((P=T.target)==null?void 0:P.result)},l.onerror=T=>b(T),l.readAsText(de.value)}),u=JSON.parse(i);if(!Array.isArray(u)){p("label.json æ ¼å¼é”™è¯¯ï¼Œåº”ä¸ºæ ‡ç­¾æ•°ç»„");return}const d=u.map(f=>({name:f.name,color:f.color||[255,0,0,255]}));if(d.length===0){p("label.json ä¸­æ²¡æœ‰æœ‰æ•ˆçš„æ ‡ç­¾æ•°æ®");return}const c=await xt({project_id:Number(((s=F.value)==null?void 0:s.id)||0),labels:d});c.data.code===200?p("æˆåŠŸåˆ›å»ºç±»åˆ«"):p(`åˆ›å»ºç±»åˆ«å¤±è´¥: ${c.data.msg}`)}catch(l){p(`å¤„ç† label.json æ–‡ä»¶å¤±è´¥: ${l.message}`)}},ft=async()=>{var l;if(!tt())return;if(S.value.length===0)try{await Ie.confirm('<span style="color: #E6A23C; font-weight: bold;">æœªæ·»åŠ æ ‡ç­¾</span>ï¼Œæ˜¯å¦ç»§ç»­ä¸Šä¼ ï¼Ÿ',"æç¤º",{confirmButtonText:"ç»§ç»­ä¸Šä¼ ",cancelButtonText:"å…ˆæ·»åŠ æ ‡ç­¾",type:"warning",distinguishCancelAndClose:!0,dangerouslyUseHTMLString:!0})}catch(i){if(i==="cancel"){p("å·²å–æ¶ˆä¸Šä¼ ï¼Œè¯·æ·»åŠ æ ‡ç­¾åé‡æ–°ä¸Šä¼ ");return}return}if(_.value){p("ç™»å½•çŠ¶æ€å·²å¤±æ•ˆï¼Œæ— æ³•å¼€å§‹ä¸Šä¼ ï¼Œè¯·é‡æ–°ç™»å½•");return}_.value=!1,j=new AbortController,y.value=!0,x.setUploadingStatus(!0),x.setShowUploadingTip(!0),qe();let s=0;try{await ct();const i=et(),u=i.length;if(u===0){p("å½“å‰æ²¡æœ‰å¯ä¸Šä¼ çš„å›¾åƒ"),y.value=!1,x.clearUploadingStatus(),x.clearShowUploadingTip(),ve();return}p(`å¼€å§‹ä¸Šä¼  ${u} ä¸ªå›¾åƒ`);for(const[f,b]of i.entries()){if(_.value){p(`ä¸Šä¼ å·²ä¸­æ–­ï¼šå…±å¤„ç† ${f} å¼ å›¾ç‰‡ï¼ŒæˆåŠŸ ${s} å¼ `);break}await at(b)&&(s++,ee.value=s);const P=Math.floor((f+1)/u*100);U.value=Math.min(P,100)}if(pe.value&&!_.value){const f=new FormData;f.append("project_id",String(((l=F.value)==null?void 0:l.id)||0)),f.append("file",pe.value),await $t(f,j==null?void 0:j.signal)}s>0&&N.setHasSampleImage(!0);const d=t.value+e.value+n.value+a.value;let c=`ğŸ“Š ä¸Šä¼ ç»Ÿè®¡ï¼šæ€»å…±${u}å¼ ï¼ŒæˆåŠŸ${s}å¼ ï¼Œå¤±è´¥${d}å¼ `;if(d>0){const f=[];t.value>0&&f.push(`å·²å­˜åœ¨${t.value}å¼ `),e.value>0&&f.push(`ç½‘ç»œé”™è¯¯${e.value}å¼ `),n.value>0&&f.push(`æ ¼å¼é”™è¯¯${n.value}å¼ `),a.value>0&&f.push(`å…¶ä»–é”™è¯¯${a.value}å¼ `),f.length>0&&(c+=`ï¼ˆ${f.join("ï¼Œ")}ï¼‰`)}o.value>0&&(c+=`ï¼Œé‡å¤${o.value}å¼ `),g.value>0&&(c+=`ï¼Œè¿‡æ»¤å™¨ä¸åŒ¹é…${g.value}å¼ `),p(c,"statistics")}catch(i){i.name==="AbortError"||i.code==="ERR_CANCELED"?p("ä¸Šä¼ å·²è¢«ä¸­æ–­"):(p(`ä¸Šä¼ è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: ${i.message}`),console.error("Upload error:",i))}finally{y.value&&(ve(),ie())}},dt=s=>{if(typeof s=="object"&&s.type)return s.type;const l=typeof s=="string"?s:s.message;return l.includes("æˆåŠŸ")||l.includes("å·²é€‰æ‹©")?"success":l.includes("è­¦å‘Š")||l.includes("é‡å¤")?"warning":l.includes("å¤±è´¥")||l.includes("é”™è¯¯")||l.includes("ä¸åŒ¹é…")||l.includes("é‡å¤")||l.includes("ä¸æ”¯æŒ")||l.includes("å½“å‰é€‰æ‹©çš„æ˜¯")&&l.includes("å›¾åƒè¿‡æ»¤å™¨")?"error":""},pt=s=>s.replace(/æˆåŠŸ(\d+)å¼ /g,'<span style="color: #67C23A; font-weight: bold;">æˆåŠŸ$1å¼ </span>').replace(/å¤±è´¥(\d+)å¼ /g,'<span style="color: #F56C6C; font-weight: bold;">å¤±è´¥$1å¼ </span>').replace(/å·²å­˜åœ¨(\d+)å¼ /g,'<span style="color: #FF6B35; font-weight: bold;">å·²å­˜åœ¨$1å¼ </span>').replace(/ç½‘ç»œé”™è¯¯(\d+)å¼ /g,'<span style="color: #FF4757; font-weight: bold;">ç½‘ç»œé”™è¯¯$1å¼ </span>').replace(/æ ¼å¼é”™è¯¯(\d+)å¼ /g,'<span style="color: #FF6348; font-weight: bold;">æ ¼å¼é”™è¯¯$1å¼ </span>').replace(/å…¶ä»–é”™è¯¯(\d+)å¼ /g,'<span style="color: #FF5722; font-weight: bold;">å…¶ä»–é”™è¯¯$1å¼ </span>').replace(/é‡å¤(\d+)å¼ /g,'<span style="color: #E6A23C; font-weight: bold;">é‡å¤$1å¼ </span>').replace(/è¿‡æ»¤å™¨ä¸åŒ¹é…(\d+)å¼ /g,'<span style="color: #E6A23C; font-weight: bold;">è¿‡æ»¤å™¨ä¸åŒ¹é…$1å¼ </span>'),p=(s,l)=>{const i=l?{message:s,type:l}:s;te.value.push(i),Ee(()=>{le.value&&(le.value.scrollTop=le.value.scrollHeight)})};return Te(oe,(s,l)=>{s!==l&&p(`å·²åˆ‡æ¢åˆ°${s==="color"?"å½©è‰²":"ç°åº¦"}å›¾åƒæ¨¡å¼`)}),wt(()=>{rt(),oe.value="color",fe.value=!1,Number(q.value)===1?(oe.value="gray",fe.value=!0):Number(q.value)===3&&(oe.value="color",fe.value=!0),$.value&&Ce(),nt()}),De(()=>{st(),ve(),_e(ue.TOKEN_EXPIRED,se),_e(ue.TOKEN_CONFLICT,se),(y.value||w.value)&&(_.value=!0,w.value&&he(),ie(!1))}),Te(()=>Y.currentRoute.value.path,()=>{}),(s,l)=>{const i=ne("el-icon"),u=ne("el-button"),d=ne("el-option"),c=ne("el-select"),f=ne("el-progress");return E(),L("div",Lt,[h("div",Nt,[l[8]||(l[8]=h("div",{class:"tab-title"},[h("div",{class:"title-content"},[h("span",null,"å›¾åƒä¸Šä¼ ")])],-1)),h("div",Mt,[w.value?(E(),L("div",Dt,[h("div",Ot,[V(i,{class:"is-loading",size:"24"},{default:ae(()=>[V(Ue(Ct))]),_:1}),h("p",null,H(R.value),1),h("p",Rt,H(M.value)+"/"+H(K.value),1),V(u,{onClick:Xe,link:"",size:"small",style:{"margin-top":"12px"}},{default:ae(()=>l[1]||(l[1]=[ce(" å–æ¶ˆå¤„ç† ")])),_:1})])])):$e("",!0),h("div",{class:Fe(["upload-area",{processing:w.value}])},[h("div",{class:"upload-drop-area",onClick:Pe,onDrop:Ve,onDragover:ze},[h("input",{ref_key:"fileInputRef",ref:m,type:"file",multiple:"",accept:"image/*,.json",onChange:He,style:{display:"none"}},null,544),h("div",Jt,[V(i,null,{default:ae(()=>[V(Ue(Tt))]),_:1})]),l[2]||(l[2]=h("div",{class:"upload-text"},[h("p",null,[ce("å°†å›¾åƒæ‹–æ‹½åˆ°æ­¤å¤„ï¼Œæˆ–è€…"),h("span",{class:"highlight"},"ç‚¹å‡»æ­¤å¤„"),ce("é€‰æ‹©æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹")]),h("p",{class:"upload-format"},"æ”¯æŒçš„å›¾åƒæ ¼å¼ä¸º: jpeg/jpgã€pngã€bmpï¼Œå•å¼ å›¾åƒå¤§å°ä¸è¶…è¿‡20M"),h("p",{class:"upload-tip"},"ğŸ’¡ æç¤ºï¼šæ— è®ºå½©è‰²æˆ–ç°åº¦å›¾åƒï¼Œç³»ç»Ÿå°†ç»Ÿä¸€æŒ‰å½©è‰²æ¨¡å¼è¿›è¡Œè®­ç»ƒå¤„ç†")],-1))],32),h("div",Pt,[h("div",zt,[l[4]||(l[4]=h("div",{class:"tag-selector-label"},"æ‰“æ ‡ç­¾",-1)),S.value.length===0?(E(),L("div",Vt,l[3]||(l[3]=[h("span",{class:"hint-text"},"è‹¥æœä¸åˆ°æ ‡ç­¾ï¼Œè¾“å…¥æ–°åç§°ä¼šè‡ªåŠ¨åˆ›å»º",-1)]))):$e("",!0)]),V(c,{modelValue:S.value,"onUpdate:modelValue":l[0]||(l[0]=b=>S.value=b),multiple:"",clearable:"",filterable:"",remote:"","remote-method":lt,"reserve-keyword":!1,loading:I.value,"allow-create":"","default-first-option":"","max-collapse-tags":3,"collapse-tags":"",placeholder:"æŸ¥æ‰¾æˆ–åˆ›å»ºæ–°æ ‡ç­¾",class:"tag-selector",onChange:it},{default:ae(()=>[(E(!0),L(xe,null,Be(D.value,b=>(E(),je(d,{key:b.id,label:b.name,value:b.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),h("div",Ht,[h("div",Wt,[l[5]||(l[5]=h("span",{class:"stat-label"},"å½“æ¬¡é€‰ä¸­æ ·æœ¬æ•°",-1)),h("span",Kt,H(k.value),1)]),h("div",Gt,[l[6]||(l[6]=h("span",{class:"stat-label"},"æˆåŠŸä¸Šä¼ æ ·æœ¬æ•°",-1)),h("span",Xt,H(ee.value),1)])]),h("div",qt,[U.value>0?(E(),je(f,{key:0,percentage:U.value,"stroke-width":10,"show-text":!1},null,8,["percentage"])):(E(),L("div",Qt))]),h("div",Zt,[V(u,{type:"primary",class:"upload-button",onClick:ft,loading:y.value,disabled:y.value},{default:ae(()=>[ce(H(y.value?"ä¸Šä¼ ä¸­...":"ä¸Šä¼ "),1)]),_:1},8,["loading","disabled"])])],2)]),h("div",Yt,[l[7]||(l[7]=h("div",{class:"sidebar-header"},"ä¸Šä¼ æ—¥å¿—",-1)),h("div",{class:"log-content",ref_key:"logContent",ref:le},[(E(!0),L(xe,null,Be(te.value,(b,T)=>(E(),L("div",{class:Fe(["log-item",dt(b)]),key:T},[typeof b=="object"&&b.type==="statistics"?(E(),L("span",{key:0,innerHTML:pt(b.message)},null,8,kt)):(E(),L("span",ea,H(typeof b=="string"?b:b.message),1))],2))),128))],512)])])])}}}),la=Bt(ta,[["__scopeId","data-v-6e4e15e3"]]);export{la as default};
//# sourceMappingURL=UploadSample-Ahrql5N8.js.map
