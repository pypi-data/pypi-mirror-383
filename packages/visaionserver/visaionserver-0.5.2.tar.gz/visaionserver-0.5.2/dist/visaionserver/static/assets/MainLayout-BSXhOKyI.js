import{d as se,r as b,u as ve,s as we,v as be,x as he,y as ge,z as E,c as k,b as l,e,A as q,j as i,B as ye,C as je,g as m,w as a,i as ee,n as $,t as d,m as Pe,D as Ce,E as y,F as xe,q as p,G as Se,H as te,I as Ie,J as Ne,K as ke,L as Ve,M as ae,h as Te,N as Fe,O as Re,o as S}from"./index-DKhC6MDA.js";import{_ as Ue}from"./logo@2x-bo-eMEnk.js";import{u as ze}from"./project-D_Nx9Gzm.js";import{v as De,a as Be}from"./validator-DnHCjo9g.js";import{g as Ee}from"./all-DLmPi6KK.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const qe={class:"header"},$e={class:"header-center"},Je={key:0,class:"project-info"},Le={class:"truncate-name"},Oe={key:1,class:"project-name-edit"},Ae={class:"header-right"},Ke={class:"action-buttons-group"},Me={key:1,class:"button-divider"},Ge={class:"user-info"},He={class:"user-name"},Ze={class:"user-avatar"},Qe={class:"version-text"},We={class:"dialog-footer"},Xe={class:"queue-container"},Ye={class:"queue-section"},et={class:"section-header running"},tt={class:"header-content"},at={class:"table-container"},st={class:"text-ellipsis"},ot={class:"text-ellipsis"},lt={class:"queue-section"},nt={class:"section-header pending"},rt={class:"header-content"},it={class:"table-container"},dt={class:"text-ellipsis"},ut={class:"text-ellipsis"},ct=se({__name:"Head",setup(le){var H,Z;const J=b(((H=window.RUNTIME_CONFIG)==null?void 0:H.VERSION)||"v1.0.0"),V=Te(),U=Re(),j=ve(),C=we(),h=be(),{currentProject:n}=he(C),L=b(((Z=j.userInfo)==null?void 0:Z.username)||"未登录"),ne=ge(()=>{const o=L.value;return!o||o==="未登录"?"?":/[\u4e00-\u9fa5]/.test(o)?o.charAt(0):o.charAt(0).toUpperCase()}),I=b(!1),_=b(""),O=b();E(()=>n.value,o=>{o||(I.value=!1,_.value="")},{immediate:!0}),E(()=>U.path,o=>{o==="/user/list"&&n.value&&C.clearCurrentProject()},{immediate:!0});const re=o=>De(o,t=>{_.value=t}),ie=()=>{var r,g;if(((r=j.userInfo)==null?void 0:r.username)==="admin"){y.warning("管理员账号无权访问项目页面");return}const o=h.isUploading,t=h.showUploadingTip;if(o&&t)ae.confirm("当前有上传任务正在进行中，离开页面将中断上传。是否确认离开？","提示",{confirmButtonText:"确认离开",cancelButtonText:"取消",type:"warning"}).then(()=>{var u;h.setShowUploadingTip(!1),h.resetFilterConditions(),h.resetAnalysisFilterConditions();try{const f="sample",v=localStorage.getItem(f);if(v){const x=JSON.parse(v);x.filterConditions&&delete x.filterConditions,x.analysisFilterConditions&&delete x.analysisFilterConditions,localStorage.setItem(f,JSON.stringify(x))}}catch(f){console.warn("清理持久化筛选条件失败:",f)}C.clearCurrentProject(),h.clearProjectSampleState(Number(((u=n.value)==null?void 0:u.id)||"")),V.push("/project")}).catch(()=>{});else{h.resetFilterConditions(),h.resetAnalysisFilterConditions();try{const u="sample",f=localStorage.getItem(u);if(f){const v=JSON.parse(f);v.filterConditions&&delete v.filterConditions,v.analysisFilterConditions&&delete v.analysisFilterConditions,localStorage.setItem(u,JSON.stringify(v))}}catch(u){console.warn("清理持久化筛选条件失败:",u)}C.clearCurrentProject(),h.resetFilterParams(),h.clearProjectSampleState(Number(((g=n.value)==null?void 0:g.id)||"")),V.push("/project")}},de=()=>{var o,t;((o=n.value)==null?void 0:o.username)==((t=j.userInfo)==null?void 0:t.username)&&n.value&&(I.value=!0,_.value=n.value.name,Ce(()=>{var r;(r=O.value)==null||r.focus()}))},A=async()=>{var o;if(!n.value||!_.value.trim()){I.value=!1,_.value=((o=n.value)==null?void 0:o.name)||"";return}if(_.value===n.value.name){I.value=!1;return}if(re(_.value))try{const{data:t}=await ze({project_id:Number(n.value.id),name:_.value.trim()});t.code===200?(C.updateCurrentProject({...n.value,name:_.value.trim()}),y.success("项目名称修改成功")):(y.error(t.msg||"项目名称修改失败"),_.value=n.value.name)}catch(t){y.error((t==null?void 0:t.message)||"项目名称修改失败"),_.value=n.value.name}finally{I.value=!1}},ue=async()=>{try{await ae.confirm("确认退出登录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});try{await j.logout(),C.clearCurrentProject(),V.push("/"),y.success("已退出登录")}catch(o){C.clearCurrentProject(),y.error((o==null?void 0:o.message)||"退出失败，请重试")}}catch{}},N=b(!1),z=b(!1),T=b([]),F=b([]),D=b(),w=b({oldPassword:"",newPassword:"",confirmPassword:""}),ce={oldPassword:[{required:!0,message:"请输入原密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,max:20,message:"密码长度应为 6-20 个字符",trigger:"blur"},{pattern:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?])[A-Za-z\d!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]{6,20}$/,message:"密码必须包含大小写字母、数字和特殊字符,不能有空格/中文",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入密码",trigger:"blur"},{validator:(o,t,r)=>{Be(t,w.value.newPassword,r)},trigger:"blur"}]},pe=()=>{N.value=!0},K=async()=>{D.value&&await D.value.validate(async o=>{var t;if(o)try{const{oldPassword:r,newPassword:g}=w.value;if(!((t=j.userInfo)!=null&&t.id))throw new Error("用户未登录，请先登录");const{data:u}=await Fe({user_id:j.userInfo.id,old_password:r,new_password:g});u.code==200?(y.success("密码修改成功"),N.value=!1,w.value={oldPassword:"",newPassword:"",confirmPassword:""}):y.error(u.msg||"密码修改失败")}catch(r){y.error((r==null?void 0:r.message)||"密码修改失败")}})};E(N,o=>{o||(w.value={oldPassword:"",newPassword:"",confirmPassword:""})});const me=()=>{z.value=!0,Ee().then(o=>{F.value=o.data.data.running,T.value=o.data.data.pending})},M=o=>({train:"模型训练",eval:"模型评估",export:"模型导出"})[o]||o,G=o=>({train:"",eval:"",export:""})[o]||"",R=o=>{if(!o)return!1;let t=0;for(let r of o)/[\u4e00-\u9fa5]/.test(r)?t+=2:t+=1;return t>16};return(o,t)=>{var X,Y;const r=m("el-icon"),g=m("el-tooltip"),u=m("el-input"),f=m("el-button"),v=m("el-dropdown-item"),x=m("el-dropdown-menu"),_e=m("el-dropdown"),B=m("el-form-item"),fe=m("el-form"),Q=m("el-dialog"),P=m("el-tag"),c=m("el-table-column"),W=m("el-table");return S(),k("div",qe,[t[17]||(t[17]=l("div",{class:"header-left"},[l("img",{src:Ue,alt:"Logo",class:"logo"})],-1)),l("div",$e,[i(n)?(S(),k("div",Je,[I.value?(S(),k("div",Oe,[e(u,{disabled:i(n).username!=((Y=i(j).userInfo)==null?void 0:Y.username),modelValue:_.value,"onUpdate:modelValue":t[0]||(t[0]=s=>_.value=s),size:"small",class:"name-edit-input",placeholder:"输入项目名称",onBlur:A,onKeyup:ee(A,["enter"]),maxlength:100,"show-word-limit":!0,ref_key:"nameInputRef",ref:O},null,8,["disabled","modelValue"])])):(S(),k("div",{key:0,class:"project-name",onClick:de},[ye(e(r,{class:"edit-icon"},{default:a(()=>[e(i(xe))]),_:1},512),[[je,i(n).username==((X=i(j).userInfo)==null?void 0:X.username)]]),e(g,{content:i(n).name,placement:"bottom","show-after":500,"hide-after":500},{default:a(()=>[l("span",Le,d(i(n).name),1)]),_:1},8,["content"])])),l("div",{class:$(["project-type",{"detection-type":i(n).type_abbreviation==="DET","segmentation-type":i(n).type_abbreviation==="SEG","classification-type":i(n).type_abbreviation==="CLS","instance-type":i(n).type_abbreviation==="INS"}])},d(i(n).type_full),3)])):q("",!0)]),l("div",Ae,[l("div",Ke,[i(n)?(S(),Pe(f,{key:0,text:"",class:"header-action-btn",onClick:ie},{default:a(()=>[e(r,null,{default:a(()=>[e(i(Se))]),_:1}),t[7]||(t[7]=p(" 返回项目管理 "))]),_:1})):q("",!0),i(n)?(S(),k("div",Me)):q("",!0),e(f,{text:"",class:"header-action-btn",onClick:me},{default:a(()=>[e(r,null,{default:a(()=>[e(i(te))]),_:1}),t[8]||(t[8]=p(" 排队状况 "))]),_:1})]),e(_e,{trigger:"click"},{dropdown:a(()=>[e(x,null,{default:a(()=>[e(v,{onClick:pe},{default:a(()=>[e(r,null,{default:a(()=>[e(i(Ne))]),_:1}),t[9]||(t[9]=p(" 修改密码 "))]),_:1}),e(v,{onClick:ue},{default:a(()=>[e(r,null,{default:a(()=>[e(i(ke))]),_:1}),t[10]||(t[10]=p(" 退出登录 "))]),_:1}),e(v,{divided:"",disabled:""},{default:a(()=>[l("span",Qe,"版本号："+d(J.value),1)]),_:1})]),_:1})]),default:a(()=>[l("div",Ge,[l("span",He,d(L.value),1),l("div",Ze,d(ne.value),1),e(r,{class:"arrow-icon"},{default:a(()=>[e(i(Ie))]),_:1})])]),_:1})]),e(Q,{modelValue:N.value,"onUpdate:modelValue":t[5]||(t[5]=s=>N.value=s),title:"修改密码",width:"450px","close-on-click-modal":!1,class:"password-dialog","destroy-on-close":""},{footer:a(()=>[l("div",We,[e(f,{onClick:t[4]||(t[4]=s=>N.value=!1)},{default:a(()=>t[11]||(t[11]=[p("取消")])),_:1}),e(f,{type:"primary",onClick:K},{default:a(()=>t[12]||(t[12]=[p("确认")])),_:1})])]),default:a(()=>[e(fe,{ref_key:"passwordFormRef",ref:D,model:w.value,rules:ce,"label-width":"100px",onKeyup:ee(K,["enter"])},{default:a(()=>[e(B,{label:"原密码",prop:"oldPassword"},{default:a(()=>[e(u,{modelValue:w.value.oldPassword,"onUpdate:modelValue":t[1]||(t[1]=s=>w.value.oldPassword=s),type:"password",placeholder:"请输入原密码","show-password":""},null,8,["modelValue"])]),_:1}),e(B,{label:"新密码",prop:"newPassword"},{default:a(()=>[e(u,{modelValue:w.value.newPassword,"onUpdate:modelValue":t[2]||(t[2]=s=>w.value.newPassword=s),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),e(B,{label:"确认密码",prop:"confirmPassword"},{default:a(()=>[e(u,{modelValue:w.value.confirmPassword,"onUpdate:modelValue":t[3]||(t[3]=s=>w.value.confirmPassword=s),type:"password",placeholder:"请再次输入新密码","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),e(Q,{title:"任务排队状况",modelValue:z.value,"onUpdate:modelValue":t[6]||(t[6]=s=>z.value=s),width:"1000px","close-on-click-modal":!1,class:"queue-status-dialog"},{default:a(()=>[l("div",Xe,[l("div",Ye,[l("div",et,[l("div",tt,[e(r,{class:"status-icon"},{default:a(()=>[e(i(te))]),_:1}),t[13]||(t[13]=l("span",{class:"section-title"},"运行中",-1)),e(P,{type:"success",size:"small",round:""},{default:a(()=>[p(d(F.value.length),1)]),_:1})])]),l("div",at,[e(W,{data:F.value,"show-header":F.value.length>0,"max-height":"300",class:"queue-table","empty-text":"暂无运行中的任务"},{default:a(()=>[e(c,{prop:"project_id",label:"项目ID",width:"80"},{default:a(({row:s})=>[e(P,{size:"small",effect:"plain"},{default:a(()=>[p(d(s.project_id),1)]),_:2},1024)]),_:1}),e(c,{prop:"job_id",label:"任务ID",width:"80"},{default:a(({row:s})=>[e(P,{size:"small",type:"primary",effect:"plain"},{default:a(()=>[p(d(s.job_id),1)]),_:2},1024)]),_:1}),e(c,{prop:"project_name",label:"项目名"},{default:a(({row:s})=>[e(g,{content:s.project_name,placement:"top-start","show-after":300,"hide-after":100,disabled:!R(s.project_name)},{default:a(()=>[l("span",st,d(s.project_name),1)]),_:2},1032,["content","disabled"])]),_:1}),e(c,{prop:"job_name",label:"任务名"},{default:a(({row:s})=>[e(g,{content:s.job_name,placement:"top-start","show-after":300,"hide-after":100,disabled:!R(s.job_name)},{default:a(()=>[l("span",ot,d(s.job_name),1)]),_:2},1032,["content","disabled"])]),_:1}),e(c,{prop:"user",label:"用户",width:"100"}),e(c,{prop:"job_type",label:"任务类型",width:"80"},{default:a(({row:s})=>[e(P,{size:"small",type:G(s.job_type),effect:"light",class:$(`job-type-${s.job_type}`)},{default:a(()=>[p(d(M(s.job_type)),1)]),_:2},1032,["type","class"])]),_:1}),e(c,{label:"状态",width:"100"},{default:a(()=>t[14]||(t[14]=[l("div",{class:"status-indicator running"},[l("div",{class:"status-dot"}),l("span",null,"运行中")],-1)])),_:1})]),_:1},8,["data","show-header"])])]),l("div",lt,[l("div",nt,[l("div",rt,[e(r,{class:"status-icon"},{default:a(()=>[e(i(Ve))]),_:1}),t[15]||(t[15]=l("span",{class:"section-title"},"等待中",-1)),e(P,{type:"warning",size:"small",round:""},{default:a(()=>[p(d(T.value.length),1)]),_:1})])]),l("div",it,[e(W,{data:T.value,"show-header":T.value.length>0,"max-height":"300",class:"queue-table","empty-text":"暂无等待中的任务"},{default:a(()=>[e(c,{prop:"project_id",label:"项目ID",width:"80"},{default:a(({row:s})=>[e(P,{size:"small",effect:"plain"},{default:a(()=>[p(d(s.project_id),1)]),_:2},1024)]),_:1}),e(c,{prop:"job_id",label:"任务ID",width:"80"},{default:a(({row:s})=>[e(P,{size:"small",type:"primary",effect:"plain"},{default:a(()=>[p(d(s.job_id),1)]),_:2},1024)]),_:1}),e(c,{prop:"project_name",label:"项目名"},{default:a(({row:s})=>[e(g,{content:s.project_name,placement:"top-start","show-after":300,"hide-after":100,disabled:!R(s.project_name)},{default:a(()=>[l("span",dt,d(s.project_name),1)]),_:2},1032,["content","disabled"])]),_:1}),e(c,{prop:"job_name",label:"任务名"},{default:a(({row:s})=>[e(g,{content:s.job_name,placement:"top-start","show-after":300,"hide-after":100,disabled:!R(s.job_name)},{default:a(()=>[l("span",ut,d(s.job_name),1)]),_:2},1032,["content","disabled"])]),_:1}),e(c,{prop:"user",label:"用户",width:"100"}),e(c,{prop:"job_type",label:"任务类型",width:"80"},{default:a(({row:s})=>[e(P,{size:"small",type:G(s.job_type),effect:"light",class:$(`job-type-${s.job_type}`)},{default:a(()=>[p(d(M(s.job_type)),1)]),_:2},1032,["type","class"])]),_:1}),e(c,{label:"状态",width:"100"},{default:a(()=>t[16]||(t[16]=[l("div",{class:"status-indicator pending"},[l("div",{class:"status-dot"}),l("span",null,"等待中")],-1)])),_:1})]),_:1},8,["data","show-header"])])])])]),_:1},8,["modelValue"])])}}}),pt=oe(ct,[["__scopeId","data-v-fbc525d5"]]),mt={class:"main-layout"},_t={class:"main-content"},ft=se({__name:"MainLayout",setup(le){return(J,V)=>{const U=m("router-view");return S(),k("div",mt,[e(pt),l("div",_t,[e(U)])])}}}),Pt=oe(ft,[["__scopeId","data-v-f2df2166"]]);export{Pt as default};
//# sourceMappingURL=MainLayout-BSXhOKyI.js.map
