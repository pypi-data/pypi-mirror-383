import{P as A}from"./const-DgT7xBJS.js";const B=(t,n)=>Math.abs(t[0]-n[0])+Math.abs(t[1]-n[1])+Math.abs(t[2]-n[2])<8,R=(t,n)=>t[0]==n[0]&&t[1]==n[1]&&t[2]==n[2],O=t=>{const n={r:0,g:0,b:0};if(!t)return n;const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:n},$=t=>{const n=[0,0,0];if(!t)return n;const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16),255]:n},z=t=>{if(!t)return"#ffffff";if(Array.isArray(t)){const[n,e,a]=t,r=s=>{const o=s.toString(16);return o.length===1?`0${o}`:o};return`#${r(n)}${r(e)}${r(a)}`}return t},N=t=>{const n=[0,0,0];if(!t)return n;const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16),255]:n},H=t=>{const n={};return Object.entries(t).reduce((e,[a,r])=>(e[r]=a,e),n)},T={map:{Z:"0",N:"1"}},L=H(T.map),j=T.map,P=t=>{if(!t)return t;let n="",e=0,a=0;const r=t.length;for(;a<r;){const s=t[e];for(;a<r&&t[a]==s;)++a;const o=a-e;n+=o+L[s],e=a}return n},W=t=>t&&t.match(/(\d+)(\w|\s)/g).reduce((e,a)=>{const r=j[a.slice(-1)],s=Number(a.slice(0,a.length-1));return`${e}${r.repeat(s)}`},""),F=(t,n)=>{const e={segmentations:[]},a=t.width,r=t.height,o=t.getContext("2d").getImageData(0,0,a,r).data;return n.forEach(h=>{let x=!1;const i=h.color,c={xmin:a,xmax:-1,ymin:r,ymax:-1};for(let d=0;d<r;++d)for(let f=0;f<a;++f){const m=(d*a+f)*4,g=[o[m],o[m+1],o[m+2]];o[m+3]&&B(g,i)&&(x=!0,c.xmin=Math.min(c.xmin,f),c.xmax=Math.max(c.xmax,f),c.ymin=Math.min(c.ymin,d),c.ymax=Math.max(c.ymax,d))}if(!x)return;const{xmin:l,ymin:y,xmax:I,ymax:D}=c,p=I-l+1,b=D-y+1,u=Array(p*b).fill("0");let M=0;for(let d=y;d<=D;++d)for(let f=l;f<=I;++f){const m=(d*a+f)*4,g=[o[m],o[m+1],o[m+2]];o[m+3]&&B(g,i)?u[M++]="1":u[M++]="0"}const C={rangeBox:[l,y,p,b],segmentationMap:P(u),labelName:h.name,labelId:h.id};e.segmentations.push(C)}),e},U=(t,n)=>{const e={instances:[]},a=t.width,r=t.height,o=t.getContext("2d").getImageData(0,0,a,r).data;return n.forEach(h=>{let x=!1;const i=O(h.color)||null;if(!i)return;const c=[i.r,i.g,i.b],l={xmin:a,xmax:-1,ymin:r,ymax:-1};for(let f=0;f<r;++f)for(let m=0;m<a;++m){const g=(f*a+m)*4,w=[o[g],o[g+1],o[g+2]];o[g+3]&&R(w,c)&&(x=!0,l.xmin=Math.min(l.xmin,m),l.xmax=Math.max(l.xmax,m),l.ymin=Math.min(l.ymin,f),l.ymax=Math.max(l.ymax,f))}if(!x)return;const{xmin:y,ymin:I,xmax:D,ymax:p}=l,b=D-y+1,u=p-I+1,M=Array(b*u).fill("0");let C=0;for(let f=I;f<=p;++f)for(let m=y;m<=D;++m){const g=(f*a+m)*4,w=[o[g],o[g+1],o[g+2]];o[g+3]&&R(w,c)?M[C++]="1":M[C++]="0"}const d={rangeBox:[y,I,b,u],segmentationMap:P(M),labelName:h.name.split(" - 实例")[0],boundingBox:[y,I,b,u]};e.instances.push(d)}),e},_=(t,n,e)=>{const a=n;return t.reduce((s,o,h)=>{if(h%2!==0)return s;const x=t[h+1];return{xmin:Math.min(o-a,(s==null?void 0:s.xmin)??1/0),xmax:Math.max(o+a,(s==null?void 0:s.xmax)??0),ymin:Math.min(x-a,(s==null?void 0:s.ymin)??1/0),ymax:Math.max(x+a,(s==null?void 0:s.ymax)??0)}},{})};function E(t,n,e,a){return Math.sqrt((t-e)*(t-e)+(n-a)*(n-a))}const q=(t,{width:n,height:e}={width:0,height:0})=>{if(t){const r=new OffscreenCanvas(n,e).getContext("2d",{desynchronized:!0});r.imageSmoothingEnabled=!1,r.drawImage(t,0,0);let s=r.getImageData(0,0,n,e).data,o=[],h=[],x=!1;for(let i=0;i<s.length;i+=4){let c=s[i+1];c!=0&&(x=!0,h.push([i,c,s[i+2]-1]));let l=s[i];l!=0&&o.push([i,l,s[i+2]-1])}return x?h:o}else return[]};function v(t,n){const e=n.ex-n.sx,a=n.ey-n.sy,r=e*e+a*a;if(r==0)return E(t.x,t.y,n.sx,n.sy);let s=((t.x-n.sx)*e+(t.y-n.sy)*a)/r;return s=Math.max(0,Math.min(1,s)),E(t.x,t.y,n.sx+s*e,n.sy+s*a)}const K=(t,n)=>e=>t.some((a,r)=>{if(r===t.length-3||r%2!==0)return!1;const s=[a,t[r+1]],o=[t[r+2],t[r+3]];return v({x:e[0],y:e[1]},{sx:s[0],sy:s[1],ex:o[0],ey:o[1]})<n}),X=(t,n,e,a=1,r)=>{const{width:s,height:o}=t,{baseWidth:h,baseHeight:x}={baseWidth:s,baseHeight:o},i=s<h?1:s/h,c=o<x?1:o/x,l=Math.floor(s/i),y=Math.floor(o/c),I=typeof e=="string"?O(e):e,D=new OffscreenCanvas(l,y),p=D.getContext("2d",{desynchronized:!0});p.imageSmoothingEnabled=!1;const b=p.createImageData(l,y);for(let u=0;u<y;u++)for(let M=0;M<l;M++){const C={x:M*i,y:u*c,i:Math.floor(u*c)*s+Math.floor(M*i)};if(n(C)){const d=4*(u*l+M),{r:f,g:m,b:g}=typeof e=="function"?e(C):I;b.data[d+0]=f,b.data[d+1]=m,b.data[d+2]=g,b.data[d+3]=255*a}}return p.scale(i,c),p.putImageData(b,0,0),D},Y=t=>n=>{let[e,a]=n;e+=.5,a+=.5;let r=!1;for(let s=0,o=t.length-2;s<t.length;o=s,s+=2){const h=t[s],x=t[s+1],i=t[o],c=t[o+1];x>a!=c>a&&e<(i-h)*(a-x)/(c-x)+h&&(r=!r)}return r},Z=(t,n)=>{const e=document.createElement("a");e.setAttribute("download",n),e.setAttribute("href",t),e.click()},G=t=>(100*t).toFixed(2)+"%",J=t=>t?t.includes("?")?t+"&t="+Date.now():t+"?t="+Date.now():"",Q=t=>t>=0&&t<=A.length?$(A[t]):[Math.floor(Math.random()*255),Math.floor(Math.random()*255),Math.floor(Math.random()*255),255];export{J as a,G as b,Z as c,W as d,_ as e,X as f,Q as g,F as h,q as i,U as j,O as k,Y as l,N as m,$ as n,K as p,z as r};
//# sourceMappingURL=tools-xmMdAE4-.js.map
