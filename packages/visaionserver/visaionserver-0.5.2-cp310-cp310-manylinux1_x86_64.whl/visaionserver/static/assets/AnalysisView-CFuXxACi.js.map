{"version":3,"file":"AnalysisView-CFuXxACi.js","sources":["../../src/views/sample/components/toolbar/AnalysisToolbar.vue","../../src/views/sample/AnalysisView.vue"],"sourcesContent":["<template>\n  <div class=\"analysis-toolbar\">\n    <div class=\"toolbar-header\">\n      <div class=\"title\">\n        <div class=\"nav-group left-section\">\n          <button class=\"back-button\" @click=\"handleReturn\">\n            <i class=\"icon-back\"></i>\n          </button>\n        </div>\n        <span>模型分析</span>\n      </div>\n      <div class=\"evaluation-info\">\n        <div class=\"model-info\">\n          <span>评测ID: {{ evalId }}</span>\n          <span>模型ID: {{ modelId }}</span>\n          <span>数据集: {{ dataset_names }}</span>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { defineProps, defineEmits, computed } from 'vue'\n\nconst props = defineProps({\n  evalId: {\n    type: String,\n    required: true\n  },\n  modelId: {\n    type: String,\n    required: true\n  },\n  datasets: {\n    type: Array,\n    required: true,\n    default: () => []\n  }\n})\n\nconst dataset_names = computed(() => {\n  if (Array.isArray(props.datasets)) {\n    return props.datasets.map((dataset: any) => dataset.name).join(', ')\n  }\n  return ''\n})\n\nconst emit = defineEmits(['return', 'threshold-change', 'metric-change'])\n\n// 方法\nconst handleReturn = () => {\n  emit('return')\n}\n\n</script>\n\n<style scoped>\n.nav-group {\n\n  button {\n    border: none;\n    background: transparent;\n    height: 35px;\n    padding: 0 5px;\n    font-size: 18px;\n    display: flex;\n    align-items: center;\n    cursor: pointer;\n\n    &:hover {\n      background: rgba(0, 0, 0, 0.05);\n    }\n\n    &:focus {\n      outline: none;\n    }\n\n    &:disabled {\n      opacity: 0.5;\n      cursor: not-allowed;\n    }\n  }\n}\n\n.left-section {\n  .back-button {\n    color: #555FFF;\n    font-weight: 500;\n\n    .icon-back {\n      display: inline-block;\n      width: 20px;\n      height: 20px;\n      margin-right: 4px;\n      background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23555FFF'%3E%3Cpath d='M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z'/%3E%3C/svg%3E\");\n      background-size: contain;\n    }\n  }\n}\n\n.analysis-toolbar {\n  width: 100%;\n}\n\n.toolbar-header {\n  margin-top: -20px;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.title {\n  display: flex;\n  align-items: center;\n  font-size: 18px;\n  font-weight: 600;\n  color: #374151;\n}\n\n.title .el-icon {\n  margin-right: 8px;\n  color: #3b82f6;\n}\n\n.evaluation-info {\n  flex: 1;\n  margin: 0 16px;\n}\n\n.model-info {\n  display: flex;\n  gap: 16px;\n  font-size: 14px;\n  color: #6b7280;\n}\n\n</style> ","<template>\n  <div class=\"analysis-view\">\n    <div class=\"sticky-toolbar\">\n      <AnalysisToolbar\n        :evalId=\"evalId\"\n        :modelId=\"modelId\"\n        :datasets=\"datasets\"\n        @return=\"handleReturn\"\n      />\n    </div>\n\n    <div class=\"sample-list-container\">\n      <SampleListComponent \n        mode=\"analysis\"\n        :evalId=\"evalId\"\n        :modelId=\"modelId\"\n        :datasets=\"datasets\"\n        :predictUrl=\"predictUrl\"\n      />\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { onMounted, computed, nextTick, ref, watch } from 'vue'\nimport { useRoute, useRouter } from 'vue-router'\nimport { ElMessage } from 'element-plus'\nimport { storeToRefs } from 'pinia';\nimport { useProjectStore } from '@/stores/project';\nimport { useDatasetStore } from '@/stores/dataset';\nimport { getMediaUrl } from \"@/utils/image\";\n\nimport SampleListComponent from './components/SampleListComponent.vue'\nimport AnalysisToolbar from './components/toolbar/AnalysisToolbar.vue'\n\nconst route = useRoute()\nconst router = useRouter()\n\nconst projectStore = useProjectStore();\nconst datasetStore = useDatasetStore();\nconst { currentProject } = storeToRefs(projectStore);\n\n// 从路由获取参数\nconst evalId = computed(() => route.query.evalId as string)\nconst modelId = computed(() => route.query.modelId as string)\nconst datasetIds = route.query.datasetIds as string[]\n\nconst predictUrl = getMediaUrl(currentProject.value?.id+\"/eval/\"+evalId.value+\"/\")\n\n// 使用响应式数据存储数据集信息\nconst datasets = ref<any[]>([])\nconst isLoadingDatasets = ref(false)\n\n// 获取并同步数据集信息\nconst fetchAndSyncDatasets = async () => {\n  if (!currentProject.value?.id || !datasetIds?.length) {\n    console.warn('缺少项目ID或数据集ID，无法获取数据集信息')\n    return\n  }\n\n  isLoadingDatasets.value = true\n  try {\n    // 从后端获取完整的数据集信息\n    const result = await datasetStore.fetchDatasets(currentProject.value.id as string)\n    \n    // 根据 datasetIds 过滤出相关的数据集\n    const filteredDatasets = result.datasets.filter((dataset: any) => \n      datasetIds.includes(dataset.id.toString())\n    )\n    \n    datasets.value = filteredDatasets\n    console.log('获取到数据集信息:', filteredDatasets)\n  } catch (error) {\n    console.error('获取数据集失败:', error)\n    // 发生错误时设置为空数组\n    datasets.value = []\n  } finally {\n    isLoadingDatasets.value = false\n  }\n}\n\n// 监听项目变化，重新获取数据集\nwatch(currentProject, (newProject) => {\n  if (newProject?.id) {\n    fetchAndSyncDatasets()\n  }\n}, { immediate: true })\n\n\nconsole.log(datasets.value, 'final datasets')\nconsole.log(predictUrl)\n\n// 初始化配置\nonMounted(async () => {\n  if (!evalId.value || !modelId.value) {\n    ElMessage.error('缺少必要的参数')\n    router.push('/sample/model')\n    return\n  }\n  \n  // 多种方式确保页面滚动到顶部\n  await nextTick(() => {\n    window.scrollTo(0, 0)\n    document.body.scrollTop = 0\n    document.documentElement.scrollTop = 0\n  })\n})\n\nconst handleReturn = () => {\n  router.push({\n    path: '/sample/modeldetail',\n    query: {\n      jid: modelId.value\n    }\n  })\n}\n</script>\n\n<style scoped>\n.analysis-view {\n  display: flex;\n  flex-direction: column;\n  height: calc(100vh - 105px); /* 减去Header高度 */\n  background-color: #f5f7fa;\n}\n\n.sticky-toolbar {\n  position: sticky;\n  top: 0;\n  z-index: 100;\n  background-color: #f5f7fa;\n  flex-shrink: 0; /* 防止工具栏被压缩 */\n}\n\n.sample-list-container {\n  flex: 1;\n  overflow: hidden; /* 防止内容溢出 */\n}\n\n/* 覆盖SampleListComponent的样式 */\n:deep(.sample-list-container) {\n  height: 100% !important;\n  min-height: unset !important;\n}\n</style>\n\n"],"names":["props","__props","dataset_names","computed","dataset","emit","__emit","handleReturn","route","useRoute","router","useRouter","projectStore","useProjectStore","datasetStore","useDatasetStore","currentProject","storeToRefs","evalId","modelId","datasetIds","predictUrl","getMediaUrl","_a","datasets","ref","isLoadingDatasets","fetchAndSyncDatasets","filteredDatasets","error","watch","newProject","onMounted","ElMessage","nextTick"],"mappings":"88BAyBA,MAAMA,EAAQC,EAgBRC,EAAgBC,EAAS,IACzB,MAAM,QAAQH,EAAM,QAAQ,EACvBA,EAAM,SAAS,IAAKI,GAAiBA,EAAQ,IAAI,EAAE,KAAK,IAAI,EAE9D,EACR,EAEKC,EAAOC,EAGPC,EAAe,IAAM,CACzBF,EAAK,QAAQ,CACf,kjBClBA,MAAMG,EAAQC,EAAS,EACjBC,EAASC,EAAU,EAEnBC,EAAeC,EAAgB,EAC/BC,EAAeC,EAAgB,EAC/B,CAAE,eAAAC,CAAA,EAAmBC,EAAYL,CAAY,EAG7CM,EAASf,EAAS,IAAMK,EAAM,MAAM,MAAgB,EACpDW,EAAUhB,EAAS,IAAMK,EAAM,MAAM,OAAiB,EACtDY,EAAaZ,EAAM,MAAM,WAEzBa,EAAaC,IAAYC,EAAAP,EAAe,QAAf,YAAAO,EAAsB,IAAG,SAASL,EAAO,MAAM,GAAG,EAG3EM,EAAWC,EAAW,EAAE,EACxBC,EAAoBD,EAAI,EAAK,EAG7BE,EAAuB,SAAY,OACvC,GAAI,GAACJ,EAAAP,EAAe,QAAf,MAAAO,EAAsB,KAAM,EAACH,GAAA,MAAAA,EAAY,QAAQ,CACpD,QAAQ,KAAK,wBAAwB,EACrC,MAAA,CAGFM,EAAkB,MAAQ,GACtB,GAAA,CAKI,MAAAE,GAHS,MAAMd,EAAa,cAAcE,EAAe,MAAM,EAAY,GAGjD,SAAS,OAAQZ,GAC/CgB,EAAW,SAAShB,EAAQ,GAAG,SAAU,CAAA,CAC3C,EAEAoB,EAAS,MAAQI,EACT,QAAA,IAAI,YAAaA,CAAgB,QAClCC,EAAO,CACN,QAAA,MAAM,WAAYA,CAAK,EAE/BL,EAAS,MAAQ,CAAC,CAAA,QAClB,CACAE,EAAkB,MAAQ,EAAA,CAE9B,EAGMI,EAAAd,EAAiBe,GAAe,CAChCA,GAAA,MAAAA,EAAY,IACOJ,EAAA,CACvB,EACC,CAAE,UAAW,GAAM,EAGd,QAAA,IAAIH,EAAS,MAAO,gBAAgB,EAC5C,QAAQ,IAAIH,CAAU,EAGtBW,EAAU,SAAY,CACpB,GAAI,CAACd,EAAO,OAAS,CAACC,EAAQ,MAAO,CACnCc,EAAU,MAAM,SAAS,EACzBvB,EAAO,KAAK,eAAe,EAC3B,MAAA,CAIF,MAAMwB,EAAS,IAAM,CACZ,OAAA,SAAS,EAAG,CAAC,EACpB,SAAS,KAAK,UAAY,EAC1B,SAAS,gBAAgB,UAAY,CAAA,CACtC,CAAA,CACF,EAED,MAAM3B,EAAe,IAAM,CACzBG,EAAO,KAAK,CACV,KAAM,sBACN,MAAO,CACL,IAAKS,EAAQ,KAAA,CACf,CACD,CACH"}