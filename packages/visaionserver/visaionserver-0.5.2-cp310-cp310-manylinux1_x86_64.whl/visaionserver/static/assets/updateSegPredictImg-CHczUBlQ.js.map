{"version":3,"file":"updateSegPredictImg-CHczUBlQ.js","sources":["../src/workers/updateSegPredictImg.ts"],"sourcesContent":["// 参考 https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers\r\n\r\nonmessage = async function (e) {\r\n    let predictionArray = e.data[0]\r\n    let scoreThreshold = e.data[1]\r\n    let imgWidth = e.data[2]\r\n    let imgHeight = e.data[3]\r\n    let mappingLabelArray = e.data[4]\r\n\r\n    const canvas = new OffscreenCanvas(imgWidth, imgHeight);\r\n    const context = canvas.getContext('2d', {\r\n        desynchronized: true,\r\n    })!;\r\n    context.imageSmoothingEnabled = false;\r\n    const imageData = context.getImageData(0, 0, imgWidth, imgHeight);\r\n\r\n    for (let i = 0; i < predictionArray?.length; i ++) {\r\n        let item=predictionArray[i]\r\n        const defectIndex = item[2];\r\n        let index=item[0]\r\n        let score = item[1] ;\r\n        if (defectIndex >= 0&&mappingLabelArray.length>defectIndex) {\r\n            // create new canvas for new identified defect\r\n            if (score >= scoreThreshold) {\r\n                let color = mappingLabelArray[defectIndex]?.color\r\n                if(!color){\r\n                    color = \"#fff\"\r\n                }\r\n                imageData.data[index] = color[0];\r\n                imageData.data[index + 1] = color[1];\r\n                imageData.data[index+ 2] = color[2];\r\n                imageData.data[index + 3] = score;\r\n            } else {\r\n                imageData.data[index + 3] = 0;\r\n            }\r\n        }\r\n    }\r\n    context.putImageData(imageData, 0, 0);\r\n    const blob = await canvas.convertToBlob();\r\n    postMessage(blob);\r\n}"],"names":["e","predictionArray","scoreThreshold","imgWidth","imgHeight","mappingLabelArray","canvas","context","imageData","i","item","defectIndex","index","score","color","_a","blob"],"mappings":"yBAEA,UAAY,eAAgBA,EAAG,OACvB,IAAAC,EAAkBD,EAAE,KAAK,CAAC,EAC1BE,EAAiBF,EAAE,KAAK,CAAC,EACzBG,EAAWH,EAAE,KAAK,CAAC,EACnBI,EAAYJ,EAAE,KAAK,CAAC,EACpBK,EAAoBL,EAAE,KAAK,CAAC,EAEhC,MAAMM,EAAS,IAAI,gBAAgBH,EAAUC,CAAS,EAChDG,EAAUD,EAAO,WAAW,KAAM,CACpC,eAAgB,EAAA,CACnB,EACDC,EAAQ,sBAAwB,GAChC,MAAMC,EAAYD,EAAQ,aAAa,EAAG,EAAGJ,EAAUC,CAAS,EAEhE,QAASK,EAAI,EAAGA,GAAIR,GAAA,YAAAA,EAAiB,QAAQQ,IAAM,CAC3C,IAAAC,EAAKT,EAAgBQ,CAAC,EACpB,MAAAE,EAAcD,EAAK,CAAC,EACtB,IAAAE,EAAMF,EAAK,CAAC,EACZG,EAAQH,EAAK,CAAC,EAClB,GAAIC,GAAe,GAAGN,EAAkB,OAAOM,EAE3C,GAAIE,GAASX,EAAgB,CACrB,IAAAY,GAAQC,EAAAV,EAAkBM,CAAW,IAA7B,YAAAI,EAAgC,MACxCD,IACQA,EAAA,QAEZN,EAAU,KAAKI,CAAK,EAAIE,EAAM,CAAC,EAC/BN,EAAU,KAAKI,EAAQ,CAAC,EAAIE,EAAM,CAAC,EACnCN,EAAU,KAAKI,EAAO,CAAC,EAAIE,EAAM,CAAC,EACxBN,EAAA,KAAKI,EAAQ,CAAC,EAAIC,CAAA,MAElBL,EAAA,KAAKI,EAAQ,CAAC,EAAI,CAEpC,CAEIL,EAAA,aAAaC,EAAW,EAAG,CAAC,EAC9B,MAAAQ,EAAO,MAAMV,EAAO,cAAc,EACxC,YAAYU,CAAI,CACpB"}