import{d as Ue,r as i,V as Se,D as pe,z as Pe,c as O,o as _,b as u,P as W,Q as te,A as we,t as M,n as st,s as Ae,y as qe,a as $e,m as F,g as d,w as l,j as X,e as t,a5 as Ee,W as Be,q as D,a6 as Je,a7 as He,f as rt,E as re,a8 as me,a9 as be,M as Ye,v as it,h as dt,O as ut,B as Re,a3 as ct,C as pt,aa as mt}from"./index-DKhC6MDA.js";import{_ as Le}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{a as Ce}from"./tools-xmMdAE4-.js";import{c as We,e as ft,a as Oe,f as _t,h as gt,i as vt,k as ht,r as yt}from"./all-DLmPi6KK.js";import{a as ne,b as ce,E as Y,J as xt}from"./const-DgT7xBJS.js";import{i as bt}from"./index-u3wYLQ4o.js";import{u as wt}from"./model-D1sEGZqo.js";import Ct from"./TrainingSample-DQgx08j7.js";import{g as St}from"./dataset-DhRRIr_L.js";const Et=Ue({name:"ConsoleLog",setup(){const E=i([]),f=i(null),x=(g,y="")=>{console.log("log-add"),E.value.push({level:y,message:g,timestamp:""}),pe(()=>{f.value&&(f.value.scrollTop=f.value.scrollHeight)})},L=g=>{E.value=g,pe(()=>{f.value&&(console.log("logContainer.value.scrollHeight",f.value.scrollHeight),f.value.scrollTop=f.value.scrollHeight)})},C=()=>{f.value&&(console.log("logContainer.value.scrollHeight",f.value.scrollHeight),f.value.scrollTop=f.value.scrollHeight)};return Se(()=>{pe(()=>{C()})}),Pe(()=>E.value.length,()=>{pe(()=>C())}),{setLogs:L,logs:E,logContainer:f,addLog:x,scroll:C}}}),Lt={class:"console-container"},Dt={ref:"logContainer",class:"log-window"},kt={key:0},Nt={class:"log-timestamp"},jt={class:"log-message"},Tt={key:1},It={class:"log-message"};function Vt(E,f,x,L,C,g){return _(),O("div",Lt,[u("div",Dt,[(_(!0),O(W,null,te(E.logs,(y,q)=>(_(),O("div",{key:q,class:"log-item"},[typeof y=="object"?(_(),O("div",kt,[u("span",Nt,M(y.timestamp),1),u("span",{class:st(`log-level log-level-${y.level}`)},M(y.level.toUpperCase()),3),u("span",jt,M(y.message),1)])):we("",!0),typeof y=="string"?(_(),O("div",Tt,[u("span",It,M(y),1)])):we("",!0)]))),128))],512)])}const Me=Le(Et,[["render",Vt],["__scopeId","data-v-2b736ddd"]]),Ot={key:0,style:{float:"right",position:"relative","z-index":"2",width:"200px"}},Mt=Ue({__name:"Chart",props:["title","xData","yData","type"],setup(E){var Z;const f=Ae(),x=E,L=i([]),C=(Z=f.currentProject)==null?void 0:Z.type,g=qe(()=>x.xData.length==0?"":x.title),y=$e({animation:!1,title:{text:g},tooltip:{trigger:"axis"},grid:{left:"2%",right:"30px",bottom:"3%",containLabel:!0},toolbox:{feature:{}},xAxis:{type:"category",boundaryGap:!1,data:x.xData,axisLabel:{showMaxLabel:!0},splitLine:{show:!1}},legend:{},yAxis:{type:"value",splitLine:{show:!1}},series:[]}),q=i([]),R=i([]),B=h=>{let I;R.value.length>h.length?I=R.value.filter(function(j){return h.indexOf(j)==-1}):I=h.filter(function(j){return R.value.indexOf(j)==-1}),S.dispatchAction({type:"legendToggleSelect",name:I}),R.value=h},G=()=>{if(x.yData.length==0)return;let h=[];C==ce.SEG||C==ce.ABNORMAL?h=["mIoU","aAcc"]:C==ce.DET||C==ce.INS?h=["coco/bbox_mAP_50"]:C==ce.CLS&&(h=["accuracy/top1"]),L.value.forEach(I=>{h.includes(I.label)||S.dispatchAction({type:"legendToggleSelect",name:I.label})}),R.value=q.value=h},J=i(!0);Pe(x,()=>{x.yData.length!=0&&(le(),J.value?(J.value=!1,x.type!=ne.LEARNING&&G()):y.animation=!0)});const b=i();let S;const le=()=>{y.series=[],x.yData.forEach((h,I)=>{let j={type:"line",smooth:!0,name:h.name,data:h.data};if(x.type==ne.LEARNING)j.yAxisIndex=I;else{y.grid.top="60px",y.legend.left="100px",y.legend.data=[];let K={label:h.name};L.value.find(U=>U.label==h.name)||L.value.push(K)}y.series.push(j)}),y.xAxis.data=x.xData,S.setOption(y)};return i(null),Se(()=>{if(console.log("chartprops",x),x.type==ne.LEARNING){let h={color:"#000",fontWeight:"bold",fontSize:"14"};y.yAxis=[{type:"value",name:"lr",position:"left",splitLine:{show:!1},nameTextStyle:h},{type:"value",name:"loss",position:"right",splitLine:{show:!1},nameTextStyle:h}]}else y.yAxis={type:"value",splitLine:{show:!1}};try{S=bt(b.value),window.onresize=()=>{S.resize()},le(),x.type!=ne.LEARNING&&G(),x.yData.length!=0&&(J.value=!1)}catch(h){console.log("======="+h+"=======")}}),(h,I)=>{const j=d("el-option"),K=d("el-select"),T=d("el-card");return _(),F(T,null,{default:l(()=>[x.type!=X(ne).LEARNING?(_(),O("div",Ot,[t(K,{modelValue:q.value,"onUpdate:modelValue":I[0]||(I[0]=U=>q.value=U),"collapse-tags":"",multiple:"",placeholder:"选择",size:"small",onChange:B},{default:l(()=>[(_(!0),O(W,null,te(L.value,U=>(_(),F(j,{key:U.label,value:U.label},null,8,["value"]))),128))]),_:1},8,["modelValue"])])):we("",!0),u("div",{ref_key:"chartDom",ref:b,class:"chart"},null,512)]),_:1})}}}),Ge=Le(Mt,[["__scopeId","data-v-f4edba40"]]),De={exportOnnxCreate:"/export/onnx_create",exportOnnxList:"/export/onnx_list",updateExportOnnxStatus:"/export/update_onnx_status",exportOnnxDelete:"/export/onnx_delete"},Ut=E=>Ee.post(De.exportOnnxCreate,E),Pt=E=>Ee.get(De.exportOnnxList,{params:E}),At=E=>Ee.post(De.updateExportOnnxStatus,E),$t=E=>Ee.delete(De.exportOnnxDelete,{params:E}),Ft={class:"dialog-footer",style:{"margin-right":"4px"}},Rt={class:"d-flex align-items-center justify-left w-100",style:{padding:"0 20px"}},Gt={style:{padding:"16px 20px"}},zt={class:"text-gray-700"},qt={class:"flex gap-4"},ze=3e3,Bt={__name:"ExportOnnx",props:{job_id:{type:[String,Number],required:!0}},setup(E,{expose:f}){const x=wt(),L=Ae(),C=i([]),g={PENDING:1,PROCESSING:2,SUCCESS:3,FAILED:4,TIMEOUT:5,CANCELLED:6},y=n=>({[g.PENDING]:"primary",[g.PROCESSING]:"warning",[g.SUCCESS]:"primary",[g.FAILED]:"danger",[g.TIMEOUT]:"danger",[g.CANCELLED]:"primary"})[n]||"info",q=n=>({[g.PENDING]:"待处理",[g.PROCESSING]:"处理中",[g.SUCCESS]:"成功",[g.FAILED]:"失败",[g.TIMEOUT]:"超时",[g.CANCELLED]:"已取消"})[n]||"未知",R=E,B=i([]),G=i(!1),J=i(null);i([{label:"model_v1.pth",value:"model_v1.pth"},{label:"model_v2.pth",value:"model_v2.pth"}]);const b=$e({channels:1,batchSize:1,version:"11",pthFile:"",height:256,width:256}),S={batchSize:[{required:!0,message:"请输入批次大小",trigger:"blur"}],channels:[{required:!0,message:"请输入通道数",trigger:"blur"}],version:[{required:!0,message:"请选择版本",trigger:"change"}],pthFile:[{required:!0,message:"请选择pth文件",trigger:"change"}]},le=n=>{J.value.resetFields(),n()},Z=async()=>{if(J.value){if(b.width%32!=0||b.height%32!=0){re.warning("宽高必须是32的倍数");return}try{await J.value.validate();const n={model_id:R.job_id,opset_version:b.version,param:{batch:b.batchSize,height:b.height,width:b.width,pth_path:b.pthFile}},r=await Ut(n);console.log(r),r.status===200?(re.success("开始导出ONNX模型"),G.value=!1,w()):re.error("导出失败")}catch(n){console.error("表单验证失败:",n)}}};function h(n,r){const v=document.createElement("a");v.href=encodeURIComponent(n),v.download=r||"downloaded-file",document.body.appendChild(v),v.click(),document.body.removeChild(v)}function I(){const n=new Date,r=n.getFullYear(),v=String(n.getMonth()+1).padStart(2,"0"),A=String(n.getDate()).padStart(2,"0"),$=String(n.getHours()).padStart(2,"0"),Q=String(n.getMinutes()).padStart(2,"0"),ee=String(n.getSeconds()).padStart(2,"0");return`${r}-${v}-${A}-${$}-${Q}-${ee}`}const j=n=>{var v;console.log("下载1:",n),(v=L.currentProject)==null||v.id;let r=Ce(me("projects"+n.download_url));h(r,x.getModel().name+"_"+I()+"1111_.visaion")},K=n=>{Ye.confirm("确认要删除该记录吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{const{data:r}=await $t({export_id:n.id});r.code===200?(re.success("删除成功"),w()):re.error("删除失败")}).catch(()=>{})},T=new Map,U=async n=>{if(T.has(n))return;const r=async()=>{try{const{data:v}=await At({export_id:n});if(v.code===200){const A=B.value.findIndex($=>$.id===n);if(A!==-1){if(B.value[A].status=v.data.status,v.data.status==g.SUCCESS&&w(),v.data.status!==g.PROCESSING){clearTimeout(T.get(n)),T.delete(n);return}T.set(n,setTimeout(()=>r(),ze))}}}catch(v){console.error(`更新任务 ${n} 状态失败:`,v),clearTimeout(T.get(n)),T.delete(n)}};T.set(n,setTimeout(()=>r(),ze))},w=async()=>{const{data:n}=await Pt({model_id:R.job_id});n.code===200&&(B.value=n.data.items,n.data.items.filter(v=>v.status===g.PROCESSING).forEach(v=>{U(v.id)}))},ae=i(!1),ie=i();let de;const fe=n=>{var $;n!=null&&n.id&&(de=n);let r=de.id,v=($=L.currentProject)==null?void 0:$.id,A=me("projects/"+v+"/export/"+r+"/visaion.log");console.log("logurl",A),be.get(Ce(`${A}`)).then(Q=>{var z;let ee=Q.data.split(`
`);(z=ie.value)==null||z.setLogs(ee)}),ae.value=!0},_e=n=>{G.value=!0};return f({exportFunc:_e}),Be(()=>{for(const n of T.values())clearTimeout(n);T.clear()}),Se(()=>{w(),We({model_id:R.job_id}).then(n=>{C.value=n.data.data})}),(n,r)=>{const v=d("el-input-number"),A=d("el-form-item"),$=d("el-option"),Q=d("el-select"),ee=d("el-form"),z=d("el-button"),ge=d("el-dialog"),ve=d("el-icon"),se=d("el-link"),he=d("el-row"),ye=d("el-tooltip"),H=d("el-table-column"),ke=d("el-tag"),xe=d("el-table"),Ne=d("el-collapse-item");return _(),O(W,null,[t(he,null,{default:l(()=>[t(ge,{modelValue:G.value,"onUpdate:modelValue":r[4]||(r[4]=m=>G.value=m),title:"模型导出",width:"600px","before-close":le},{footer:l(()=>[u("div",Ft,[t(z,{onClick:r[3]||(r[3]=m=>G.value=!1)},{default:l(()=>r[6]||(r[6]=[D("取消")])),_:1}),t(z,{type:"primary",onClick:Z},{default:l(()=>r[7]||(r[7]=[D(" 确认 ")])),_:1})])]),default:l(()=>[t(ee,{model:b,"label-width":"100px",rules:S,ref_key:"formRef",ref:J},{default:l(()=>[t(A,{label:"批次大小",prop:"batchSize"},{default:l(()=>[t(v,{modelValue:b.batchSize,"onUpdate:modelValue":r[0]||(r[0]=m=>b.batchSize=m),min:0,max:64},null,8,["modelValue"])]),_:1}),t(A,{label:"版本",prop:"version"},{default:l(()=>[t(Q,{modelValue:b.version,"onUpdate:modelValue":r[1]||(r[1]=m=>b.version=m),placeholder:"请选择版本"},{default:l(()=>[t($,{label:"9",value:"9"}),t($,{label:"11",value:"11"})]),_:1},8,["modelValue"])]),_:1}),t(A,{label:"checkpoint",prop:"pthFile"},{default:l(()=>[t(Q,{modelValue:b.pthFile,"onUpdate:modelValue":r[2]||(r[2]=m=>b.pthFile=m),placeholder:"请选择checkpoint文件"},{default:l(()=>[(_(!0),O(W,null,te(C.value,m=>(_(),F($,{label:m,value:m},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(ge,{modelValue:ae.value,"onUpdate:modelValue":r[5]||(r[5]=m=>ae.value=m),title:"日志信息"},{header:l(()=>[r[8]||(r[8]=D(" 日志信息 ")),t(se,{onClick:fe},{default:l(()=>[t(ve,{style:{"font-size":"18px","margin-bottom":"2px"}},{default:l(()=>[t(X(Je))]),_:1})]),_:1})]),default:l(()=>[t(Me,{ref_key:"evalConsoleLog",ref:ie},null,512)]),_:1},8,["modelValue"])]),_:1}),t(Ne,{name:"2",class:"exportItem"},{title:l(()=>[u("div",Rt,[r[9]||(r[9]=u("span",{class:"text-base font-medium",style:{"font-size":"16px"}},"模型导出",-1)),t(ye,{content:"添加模型",placement:"top"},{default:l(()=>[t(z,{onClick:rt(_e,["stop"]),type:"primary",style:{color:"white","background-color":"#555fff",width:"20px",height:"20px","font-size":"12px","margin-left":"6px"},icon:X(He),circle:""},null,8,["icon"])]),_:1})])]),default:l(()=>[u("div",Gt,[t(xe,{data:B.value,style:{width:"100%"},class:"mt-4"},{default:l(()=>[t(H,{prop:"id",label:"编号",width:"100"}),t(H,{label:"验证集","min-width":"200"},{default:l(m=>[u("div",zt,[u("div",null,"尺寸：["+M(m.row.param.batch)+", "+M(m.row.param.channels)+", "+M(m.row.param.height)+", "+M(m.row.param.width)+"]",1),u("div",null,"版本："+M(m.row.param.onnx_opset),1)])]),_:1}),t(H,{prop:"status",label:"状态"},{default:l(m=>[t(ke,{type:y(m.row.status)},{default:l(()=>[D(M(q(m.row.status)),1)]),_:2},1032,["type"])]),_:1}),t(H,{prop:"username",label:"创建人"}),t(H,{prop:"create_time",label:"创建时间"}),t(H,{label:"操作",fixed:"right"},{default:l(m=>[u("div",qt,[t(z,{type:"primary",link:"",onClick:ue=>fe(m.row)},{default:l(()=>r[10]||(r[10]=[D(" 日志 ")])),_:2},1032,["onClick"]),m.row.status===3?(_(),F(z,{key:0,type:"primary",link:"",onClick:ue=>j(m.row),class:"!text-[#409EFF]"},{default:l(()=>r[11]||(r[11]=[D(" 下载 ")])),_:2},1032,["onClick"])):we("",!0),t(z,{type:"danger",link:"",onClick:ue=>K(m.row)},{default:l(()=>r[12]||(r[12]=[D(" 删除 ")])),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"])])]),_:1})],64)}}},Jt=Le(Bt,[["__scopeId","data-v-a138330a"]]),Ht={class:"min-h-screen bg-gray-100 p-8"},Yt={class:"mx-auto max-w-7xl"},Wt={style:{position:"relative"}},Qt={class:"flex items-center justify-between"},Xt={class:"flex items-center gap-2"},Zt={class:"flex items-center"},Kt={class:"flex gap-4"},el={class:"eval-modal-content"},tl={class:"dialog-footer"},ll={class:"metrics-modal-content"},al={class:"log-modal-header"},ol={class:"log-modal-content"},nl=Ue({__name:"ModelDetail",setup(E){const f=ut(),x=dt(),L=Ae();it();const C=i([1]),g=i(!1),y=i(),q=i("default"),R=i([]),B=i(!1),G=i(),J=qe(()=>{const o={large:"32px",default:"28px",small:"24px"};return{marginTop:o[q.value]||o.default}}),b=i(!1),S=$e({pth:"",datasets:[],VISAION_NEED_GPUS:1});let le,Z=new Worker(new URL("/assets/parseLog-eA-qE9Go.js",import.meta.url),{type:"module"});const h=i(new Date),I=i(new Date),j=i(),K=i(["detail","1","2"]),T=i("first");Pe(T,o=>{o==="second"&&pe(()=>{var e;(e=j.value)==null||e.scroll()})});const U=i([]);i([{id:"001",modelInfo:`分辨率: 640x640
批大小: 32
训练轮次: 300
验证精度: 91.2%`,creator:"David Chen",createTime:"2025-10-10 12:30:00"},{id:"002",modelInfo:`分辨率: 1024x1024
批大小: 16
训练轮次: 200
验证精度: 89.5%`,creator:"Sarah Johnson",createTime:"2025-10-09 15:45:00"},{id:"003",modelInfo:`分辨率: 512x512
批大小: 64
训练轮次: 400
验证精度: 93.4%`,creator:"Michael Zhang",createTime:"2025-10-08 09:20:00"}]);const w=i({logContent:[],nowStep:0,logMetrics:{xList:[],xOtherList:[],yListData:[],yOtherData:[]}}),ae=i(!1),ie=i({});let de=null;const fe=o=>{let e=o.datasets.map(s=>s.id);x.push({path:"/sample/analysis",query:{evalId:o.id,modelId:f.query.jid,datasetIds:JSON.stringify(e)}})},_e=o=>{var p;ae.value=!0;let e=(p=L.currentProject)==null?void 0:p.id,s=o.id,c=me("projects/"+e+"/eval/"+s+"/metrics.json");_t({job_id:s,project_id:e,job_type:"eval"}).then(N=>{be.get(c).then(k=>{ie.value=k.data})})},n=o=>{Ye.confirm("确定删除么?","Warning",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{gt(o.id).then(e=>{se(ue.value)})})},r=o=>{var p;let e=(p=L.currentProject)==null?void 0:p.id,s=f.query.jid,c=me("projects/"+e+"/train/"+s+"/visaion.log");be.get(Ce(`${c}`)).then(N=>{var P;let k=N.data.split(`
`);w.value.logRow=k.length,w.value.logContent=k,(P=j.value)==null||P.setLogs(k),Q(k),o!=Y.TERMINATED&&o!=Y.COMPLETED&&A()})},v=()=>{var e;let o={project_id:(e=L.currentProject)==null?void 0:e.id,job_id:f.query.jid,start_row:w.value.logRow,job_type:"train"};vt(o).then(s=>{var c,p,N;try{"data"in s&&s.data!=null&&s.data.data&&((p=(c=s.data)==null?void 0:c.data)==null||p.forEach(k=>{var P;(P=j.value)==null||P.addLog(k),w.value.logRow++}),Q((N=s.data)==null?void 0:N.data))}catch(k){console.log("fetchlog-err",k)}})},A=()=>{le=setInterval(function(){v()},2e3)},$=(o,e,s)=>{let c=o.find(p=>p.name==e);c?c.data=c.data.concat(s):o.push({name:e,data:s})},Q=o=>{Z.postMessage([o,w.value.nowStep]),Z.onmessage=e=>{var s,c,p;w.value.logMetrics.xList=(s=w.value.logMetrics.xList)==null?void 0:s.concat(e.data.xList),w.value.logMetrics.xOtherList=(c=w.value.logMetrics.xOtherList)==null?void 0:c.concat(e.data.xOtherList);for(let N in e.data.yList)$(w.value.logMetrics.yListData,N,e.data.yList[N]);for(let N in e.data.yOtherList)$(w.value.logMetrics.yOtherData,N,e.data.yOtherList[N]);w.value.nowStep=e.data.step,e.data.xList&&((p=e.data.xList)==null?void 0:p.length)>0&&(g.value=!1),e.data.eta}},ee=i([]),z=o=>{var e;o.stopPropagation(),b.value=!0,We({model_id:f.query.jid}).then(s=>{R.value=s.data.data}),St({project_id:(e=L.currentProject)==null?void 0:e.id,page:1,size:1e3}).then(s=>{ee.value=s.data.data.datasets}),ht().then(s=>{C.value=[];let c=s.data.data.gpuNum;for(let p=0;p<c;p++)C.value.push(p+1)})},ge=()=>{if(S.datasets==null||S.datasets.length==0){re.warning("请选择评测集");return}let o={id:f.query.jid,job_type:"eval",eval_param:{pth:S.pth,datasets:S.datasets,VISAION_NEED_GPUS:S.VISAION_NEED_GPUS}};yt(o).then(e=>{b.value=!1,se()})},ve=()=>{var s;let o=[],e=U.value;if(!(!e||e.length===0)){for(let c=0;c<e.length;c++){const p=e[c];o.push(p.id)}Oe({project_id:(s=L.currentProject)==null?void 0:s.id,job_ids:o,job_type:"eval"}).then(c=>{var k;let p=[],N=(k=c.data)==null?void 0:k.data;U.value.forEach(P=>{P.status=xt[N[P.id]],p.push(P)}),U.value=p})}},se=(o=1)=>{var e;ft({page:o,size:10,job_id:(e=f.query)==null?void 0:e.jid}).then(s=>{m.value=s.data.total,U.value=s.data.data,ve(),he=setInterval(ve,2e3)})};let he,ye;const H=i(!0),ke=()=>{var o;H.value&&Oe({project_id:(o=L.currentProject)==null?void 0:o.id,job_ids:[f.query.jid],job_type:"train"}).then(e=>{var p;let c=((p=e.data)==null?void 0:p.data)[f.query.jid];c==Y.RUNNING||c==Y.PENDING?H.value=!0:H.value=!1,c==Y.TERMINATED&&(g.value=!1)})},xe=o=>{var p;o!=null&&o.id&&(de=o);let e=de.id,s=(p=L.currentProject)==null?void 0:p.id,c=me("projects/"+s+"/eval/"+e+"/visaion.log");be.get(Ce(`${c}`)).then(N=>{var P;let k=N.data.split(`
`);(P=G.value)==null||P.setLogs(k)}),B.value=!0},Ne=()=>{var o;Oe({project_id:(o=L.currentProject)==null?void 0:o.id,job_ids:[f.query.jid],job_type:"train"}).then(e=>{let s=e.data.data[f.query.jid];s!=Y.READY&&s!=Y.PENDING&&setTimeout(()=>{r(s)},900),(s==Y.RUNNING||s==Y.COMPLETED||s==Y.PENDING)&&(g.value=!0)})},m=i(0),ue=i(1),Qe=o=>{ue.value=o,se(o)},Xe=o=>({已完成:"primary",已终止:"danger"})[o];return Se(()=>{var o;(o=j.value)==null||o.setLogs(["None"]),Ne(),se(),ye=setInterval(ke,2e3)}),Be(()=>{console.log("clearInterval-modeldetail"),clearInterval(le),clearInterval(he),clearInterval(ye),Z.terminate()}),(o,e)=>{const s=d("el-button"),c=d("el-collapse-item"),p=d("el-col"),N=d("el-row"),k=d("el-tab-pane"),P=d("el-tabs"),oe=d("el-table-column"),Fe=d("el-tag"),Ze=d("el-tooltip"),Ke=d("el-table"),et=d("el-pagination"),tt=d("el-collapse"),je=d("el-option"),Te=d("el-select"),Ie=d("el-form-item"),lt=d("el-form"),Ve=d("el-dialog"),at=d("el-descriptions-item"),ot=d("el-descriptions"),nt=ct("loading");return _(),O(W,null,[u("div",Ht,[u("div",Yt,[t(s,{type:"primary",style:{"margin-bottom":"8px",color:"white"},onClick:e[0]||(e[0]=a=>X(x).push("/sample/model"))},{default:l(()=>e[10]||(e[10]=[D("返回")])),_:1}),t(tt,{modelValue:K.value,"onUpdate:modelValue":e[2]||(e[2]=a=>K.value=a)},{default:l(()=>[t(c,{name:"config",style:{"margin-bottom":"14px"}},{title:l(()=>e[11]||(e[11]=[u("div",{style:{"border-bottom":"0px solid lightgray"}},[u("div",null,[u("span",{class:""},"模型配置")])],-1)])),default:l(()=>[u("div",Wt,[t(Ct,{mode:"show"}),e[12]||(e[12]=u("div",{id:"disableDiv","aria-disabled":!0,style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"}},null,-1))])]),_:1}),t(c,{name:"detail",style:{"margin-bottom":"14px"}},{title:l(()=>e[13]||(e[13]=[u("div",{style:{"border-bottom":"0px solid lightgray"}},[u("div",null,[u("span",{class:""},"训练详情")])],-1)])),default:l(()=>[u("div",null,[t(P,{modelValue:T.value,"onUpdate:modelValue":e[1]||(e[1]=a=>T.value=a),class:"demo-tabs",onTabClick:o.handleClick},{default:l(()=>[Re((_(),F(k,{label:"训练报表",name:"first",id:"detailChart","element-loading-background":"rgba(122, 122, 122, 0.8)"},{default:l(()=>[t(N,{gutter:20,class:"conts_modle"},{default:l(()=>[t(p,{span:24,class:"cn_item",style:{width:"100%"}},{default:l(()=>{var a;return[(_(),F(Ge,{title:"学习率和损失函数",type:X(ne).LEARNING,xData:(a=w.value)==null?void 0:a.logMetrics.xList,yData:w.value.logMetrics.yListData,key:h.value},null,8,["type","xData","yData"]))]}),_:1}),t(p,{span:24,class:"cn_item",style:{width:"100%"}},{default:l(()=>{var a,V;return[(_(),F(Ge,{title:"训练指标",type:X(ne).TRAIN,xData:(a=w.value)==null?void 0:a.logMetrics.xOtherList,yData:(V=w.value)==null?void 0:V.logMetrics.yOtherData,key:I.value},null,8,["type","xData","yData"]))]}),_:1})]),_:1})]),_:1})),[[nt,g.value]]),t(k,{label:"训练详情",name:"second"},{default:l(()=>[t(Me,{ref_key:"consoleLog",ref:j},null,512)]),_:1})]),_:1},8,["modelValue","onTabClick"])])]),_:1}),t(c,{name:"1",style:{"margin-bottom":"14px"}},{title:l(()=>[u("div",Qt,[u("div",Xt,[e[14]||(e[14]=u("span",{class:"text-lg font-semibold text-gray-900"},"模型评测",-1)),t(s,{onClick:z,type:"primary",style:{color:"white","background-color":"#555fff",width:"20px",height:"20px","font-size":"12px","margin-left":"6px"},icon:X(He),circle:""},null,8,["icon"])])])]),default:l(()=>[t(Ke,{data:U.value,stripe:"",class:"w-full"},{default:l(()=>[t(oe,{prop:"id",label:"编号",width:"100"}),t(oe,{prop:"status",label:"状态",width:"100"},{default:l(({row:a})=>[u("div",Zt,[t(Fe,{type:Xe(a.status),effect:"light",class:"whitespace-nowrap"},{default:l(()=>[D(M(a.status),1)]),_:2},1032,["type"])])]),_:1}),t(oe,{prop:"pth",label:"checkpoint",width:"300"}),t(oe,{prop:"datasets",label:"评测集"},{default:l(a=>[(_(!0),O(W,null,te(a.row.datasets,V=>(_(),F(Ze,{content:V.updated_at>a.row.finish_time?"样本/标注已更新":V.name},{default:l(()=>[(_(),F(Fe,{key:V,size:"small",effect:"plain",type:V.updated_at>a.row.finish_time?"warning":"primary"},{default:l(()=>[D(M(V.name),1)]),_:2},1032,["type"]))]),_:2},1032,["content"]))),256))]),_:1}),t(oe,{prop:"user_id",label:"创建人",width:"200"},{default:l(a=>[D(M(a.row.user.username),1)]),_:1}),t(oe,{prop:"create_time",label:"创建时间",width:"230"},{default:l(({row:a})=>[D(M(a.create_time.replace("T"," ")),1)]),_:1}),t(oe,{label:"操作",width:"200"},{default:l(({row:a})=>[u("div",Kt,[t(s,{style:{"margin-left":"0",color:"#555FFF"},type:"primary",link:"",class:"!rounded-button whitespace-nowrap",onClick:V=>fe(a)},{default:l(()=>e[15]||(e[15]=[D(" 分析 ")])),_:2},1032,["onClick"]),t(s,{style:{color:"#555fff"},link:"",class:"!rounded-button whitespace-nowrap",onClick:V=>_e(a)},{default:l(()=>e[16]||(e[16]=[D(" 指标 ")])),_:2},1032,["onClick"]),t(s,{style:{"margin-left":"0",color:"#555FFF"},type:"primary",link:"",class:"!rounded-button whitespace-nowrap",onClick:V=>xe(a)},{default:l(()=>e[17]||(e[17]=[D(" 日志 ")])),_:2},1032,["onClick"]),t(s,{type:"danger",link:"",class:"!rounded-button whitespace-nowrap",onClick:V=>n(a)},{default:l(()=>e[18]||(e[18]=[D(" 删除 ")])),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"]),t(et,{style:{"margin-top":"8px"},background:"",layout:"prev, pager, next",total:m.value,"default-page-size":10,onCurrentChange:Qe},null,8,["total"])]),_:1}),t(Jt,{job_id:X(f).query.jid,ref_key:"exportRef",ref:y},null,8,["job_id"])]),_:1},8,["modelValue"])])]),t(Ve,{modelValue:b.value,"onUpdate:modelValue":e[7]||(e[7]=a=>b.value=a),title:"评测任务",width:"600px","close-on-click-modal":!1,"show-close":!0,class:"eval-modal"},{footer:l(()=>[u("div",tl,[t(s,{onClick:e[6]||(e[6]=a=>b.value=!1)},{default:l(()=>e[19]||(e[19]=[D("取消")])),_:1}),t(s,{style:{"background-color":"#555FFF",color:"#fff"},onClick:ge},{default:l(()=>e[20]||(e[20]=[D("运行")])),_:1})])]),default:l(()=>[u("div",el,[t(lt,{model:S,"label-width":"100px"},{default:l(()=>[Re(t(Ie,{label:"GPU数量"},{default:l(()=>[t(Te,{modelValue:S.VISAION_NEED_GPUS,"onUpdate:modelValue":e[3]||(e[3]=a=>S.VISAION_NEED_GPUS=a),class:"form-select"},{default:l(()=>[(_(!0),O(W,null,te(C.value,a=>(_(),F(je,{label:a,value:a},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1},512),[[pt,C.value.length>0&&C.value[0]>1||C.value.length>1]]),t(Ie,{label:"Checkpoint"},{default:l(()=>[t(Te,{modelValue:S.pth,"onUpdate:modelValue":e[4]||(e[4]=a=>S.pth=a),class:"form-select",placeholder:"选择Checkpoint"},{default:l(()=>[(_(!0),O(W,null,te(R.value,a=>(_(),F(je,{label:a,value:a},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),t(Ie,{label:"评测集",prop:"datasets",required:""},{default:l(()=>[t(Te,{modelValue:S.datasets,"onUpdate:modelValue":e[5]||(e[5]=a=>S.datasets=a),onChange:o.FnChange,onClear:o.clearSelectEval,class:"form-select",clearable:"",multiple:"",filterable:"",remote:"","reserve-keyword":"",placeholder:"选择数据集"},{default:l(()=>[(_(!0),O(W,null,te(ee.value,a=>(_(),F(je,{key:a.id,disabled:a.has_raw_status,label:a.has_raw_status?a.name+"-不可使用未处理的样本作为训练集或验证集":a.name,value:a.id},null,8,["disabled","label","value"]))),128))]),_:1},8,["modelValue","onChange","onClear"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["modelValue"]),t(Ve,{modelValue:ae.value,"onUpdate:modelValue":e[8]||(e[8]=a=>ae.value=a),title:"指标查看",width:"600px","close-on-click-modal":!1,"show-close":!0,class:"metrics-modal"},{default:l(()=>[u("div",ll,[t(ot,{title:"",column:3,size:"default",direction:"vertical",style:mt(J.value),border:""},{default:l(()=>[(_(!0),O(W,null,te(ie.value,(a,V)=>(_(),F(at,{key:V,label:V},{default:l(()=>[D(M(parseFloat(a).toFixed(3)),1)]),_:2},1032,["label"]))),128))]),_:1},8,["style"])])]),_:1},8,["modelValue"]),t(Ve,{modelValue:B.value,"onUpdate:modelValue":e[9]||(e[9]=a=>B.value=a),title:"日志信息",width:"800px","close-on-click-modal":!1,"show-close":!0,class:"log-modal"},{header:l(()=>[u("div",al,[e[21]||(e[21]=u("span",{class:"modal-title"},"日志信息",-1)),t(s,{onClick:xe,type:"text",class:"refresh-btn",icon:X(Je)},null,8,["icon"])])]),default:l(()=>[u("div",ol,[t(Me,{ref_key:"evalConsoleLog",ref:G},null,512)])]),_:1},8,["modelValue"])],64)}}}),_l=Le(nl,[["__scopeId","data-v-8fd095dc"]]);export{_l as default};
//# sourceMappingURL=ModelDetail-_ymetKXs.js.map
