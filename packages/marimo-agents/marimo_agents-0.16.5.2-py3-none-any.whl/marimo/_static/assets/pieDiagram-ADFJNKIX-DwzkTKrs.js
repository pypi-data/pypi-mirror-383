import"./_Uint8Array-CPNtPV0k.js";import"./_baseIsEqual-Colb33IN.js";import"./_arrayReduce-BnF2698I.js";import"./toNumber-D8Yr4jg3.js";import"./toInteger-HqbAY1oN.js";import"./isArrayLikeObject-VZQcF0wU.js";import"./_getTag-DAtegGfi.js";import"./_baseUniq-C9yRQ2gm.js";import"./chunk-4KMFLZZN-CY26YA_6.js";import"./_toKey-ySt2z-83.js";import"./memoize-Dkaig2Zu.js";import"./get-DpPiA0nD.js";import"./_baseFlatten-fXFruJ9c.js";import"./_basePickBy-ZofuMBT_.js";import"./merge-BK4jEs5n.js";import"./_baseSlice-Uxm09S3C.js";import"./clone-LWFvUGYK.js";import"./_baseEach-D9MoMllW.js";import"./hasIn-B8CzC4pq.js";import"./_baseProperty-DbWSe5Dg.js";import"./_createAggregator-DXVrFTZa.js";import"./min-DOP7dRSW.js";import"./_baseMap-DpEJo8vx.js";import"./isEmpty-CgS1RHPI.js";import"./_baseSet-DydOhF3e.js";import"./preload-helper-VwE_myu3.js";import"./main-Bhvb2Udf.js";import{n as W}from"./ordinal-WQ-aX1ha.js";import"./timer-BQp7kwGJ.js";import"./src-BxsaLGej.js";import{r as h}from"./path-DinqECSb.js";import{p as k}from"./math-CJPGrKXj.js";import{t as F}from"./arc-C21mLlLg.js";import{t as _}from"./array-RG72wiOX.js";import"./step-CU2Y1mmF.js";import{i as B,p as P}from"./chunk-S3R3BYOJ-DkagUBh0.js";import"./init-o6-p_brG.js";import{n as s,r as M}from"./src-BYP9eq-z.js";import{B as L,C as V,U as j,_ as U,a as q,b as G,c as H,d as I,v as J,z as K}from"./chunk-ABZYJK2D-CHn8e59f.js";import{t as Q}from"./chunk-EXTU4WIE-BZKh82b1.js";import"./dist-DB8I7jQZ.js";import"./chunk-JEIROHC2-BY2EU-rF.js";import"./chunk-BN7GFLIU-DO5HMFB8.js";import"./chunk-T44TD3VJ-C0KWOLbc.js";import"./chunk-KMC2YHZD-Cj5sqkCw.js";import"./chunk-WFWHJNB7-ssq6vNBh.js";import"./chunk-WFRQ32O7-Dhkf3nPa.js";import"./chunk-XRWGC2XP-DOkbSHfa.js";import{t as X}from"./chunk-4BX2VUAB-CLo-a5yO.js";import{t as Y}from"./mermaid-parser.core-BmfVzo1e.js";function Z(t,r){return r<t?-1:r>t?1:r>=t?0:NaN}function tt(t){return t}function et(){var t=tt,r=Z,c=null,n=h(0),p=h(k),x=h(0);function l(e){var o,i=(e=_(e)).length,d,b,$=0,y=Array(i),m=Array(i),v=+n.apply(this,arguments),A=Math.min(k,Math.max(-k,p.apply(this,arguments)-v)),f,T=Math.min(Math.abs(A)/i,x.apply(this,arguments)),w=T*(A<0?-1:1),u;for(o=0;o<i;++o)(u=m[y[o]=o]=+t(e[o],o,e))>0&&($+=u);for(r==null?c!=null&&y.sort(function(g,S){return c(e[g],e[S])}):y.sort(function(g,S){return r(m[g],m[S])}),o=0,b=$?(A-i*w)/$:0;o<i;++o,v=f)d=y[o],u=m[d],f=v+(u>0?u*b:0)+w,m[d]={data:e[d],index:o,value:u,startAngle:v,endAngle:f,padAngle:T};return m}return l.value=function(e){return arguments.length?(t=typeof e=="function"?e:h(+e),l):t},l.sortValues=function(e){return arguments.length?(r=e,c=null,l):r},l.sort=function(e){return arguments.length?(c=e,r=null,l):c},l.startAngle=function(e){return arguments.length?(n=typeof e=="function"?e:h(+e),l):n},l.endAngle=function(e){return arguments.length?(p=typeof e=="function"?e:h(+e),l):p},l.padAngle=function(e){return arguments.length?(x=typeof e=="function"?e:h(+e),l):x},l}var R=I.pie,O={sections:new Map,showData:!1,config:R},C=O.sections,z=O.showData,rt=structuredClone(R),E={getConfig:s(()=>structuredClone(rt),"getConfig"),clear:s(()=>{C=new Map,z=O.showData,q()},"clear"),setDiagramTitle:j,getDiagramTitle:V,setAccTitle:L,getAccTitle:J,setAccDescription:K,getAccDescription:U,addSection:s(({label:t,value:r})=>{if(r<0)throw Error(`"${t}" has invalid value: ${r}. Negative values are not allowed in pie charts. All slice values must be >= 0.`);C.has(t)||(C.set(t,r),M.debug(`added new section: ${t}, with value: ${r}`))},"addSection"),getSections:s(()=>C,"getSections"),setShowData:s(t=>{z=t},"setShowData"),getShowData:s(()=>z,"getShowData")},at=s((t,r)=>{X(t,r),r.setShowData(t.showData),t.sections.map(r.addSection)},"populateDb"),it={parse:s(async t=>{let r=await Y("pie",t);M.debug(r),at(r,E)},"parse")},ot=s(t=>`
  .pieCircle{
    stroke: ${t.pieStrokeColor};
    stroke-width : ${t.pieStrokeWidth};
    opacity : ${t.pieOpacity};
  }
  .pieOuterCircle{
    stroke: ${t.pieOuterStrokeColor};
    stroke-width: ${t.pieOuterStrokeWidth};
    fill: none;
  }
  .pieTitleText {
    text-anchor: middle;
    font-size: ${t.pieTitleTextSize};
    fill: ${t.pieTitleTextColor};
    font-family: ${t.fontFamily};
  }
  .slice {
    font-family: ${t.fontFamily};
    fill: ${t.pieSectionTextColor};
    font-size:${t.pieSectionTextSize};
    // fill: white;
  }
  .legend text {
    fill: ${t.pieLegendTextColor};
    font-family: ${t.fontFamily};
    font-size: ${t.pieLegendTextSize};
  }
`,"getStyles"),lt=s(t=>{let r=[...t.values()].reduce((n,p)=>n+p,0),c=[...t.entries()].map(([n,p])=>({label:n,value:p})).filter(n=>n.value/r*100>=1).sort((n,p)=>p.value-n.value);return et().value(n=>n.value)(c)},"createPieArcs"),nt={parser:it,db:E,renderer:{draw:s((t,r,c,n)=>{M.debug(`rendering pie chart
`+t);let p=n.db,x=G(),l=B(p.getConfig(),x.pie),e=Q(r),o=e.append("g");o.attr("transform","translate(225,225)");let{themeVariables:i}=x,[d]=P(i.pieOuterStrokeWidth);d??(d=2);let b=l.textPosition,$=F().innerRadius(0).outerRadius(185),y=F().innerRadius(185*b).outerRadius(185*b);o.append("circle").attr("cx",0).attr("cy",0).attr("r",185+d/2).attr("class","pieOuterCircle");let m=p.getSections(),v=lt(m),A=[i.pie1,i.pie2,i.pie3,i.pie4,i.pie5,i.pie6,i.pie7,i.pie8,i.pie9,i.pie10,i.pie11,i.pie12],f=0;m.forEach(a=>{f+=a});let T=v.filter(a=>(a.data.value/f*100).toFixed(0)!=="0"),w=W(A);o.selectAll("mySlices").data(T).enter().append("path").attr("d",$).attr("fill",a=>w(a.data.label)).attr("class","pieCircle"),o.selectAll("mySlices").data(T).enter().append("text").text(a=>(a.data.value/f*100).toFixed(0)+"%").attr("transform",a=>"translate("+y.centroid(a)+")").style("text-anchor","middle").attr("class","slice"),o.append("text").text(p.getDiagramTitle()).attr("x",0).attr("y",-400/2).attr("class","pieTitleText");let u=[...m.entries()].map(([a,D])=>({label:a,value:D})),g=o.selectAll(".legend").data(u).enter().append("g").attr("class","legend").attr("transform",(a,D)=>{let N=22*u.length/2;return"translate(216,"+(D*22-N)+")"});g.append("rect").attr("width",18).attr("height",18).style("fill",a=>w(a.label)).style("stroke",a=>w(a.label)),g.append("text").attr("x",22).attr("y",14).text(a=>p.getShowData()?`${a.label} [${a.value}]`:a.label);let S=512+Math.max(...g.selectAll("text").nodes().map(a=>(a==null?void 0:a.getBoundingClientRect().width)??0));e.attr("viewBox",`0 0 ${S} 450`),H(e,450,S,l.useMaxWidth)},"draw")},styles:ot};export{nt as diagram};
