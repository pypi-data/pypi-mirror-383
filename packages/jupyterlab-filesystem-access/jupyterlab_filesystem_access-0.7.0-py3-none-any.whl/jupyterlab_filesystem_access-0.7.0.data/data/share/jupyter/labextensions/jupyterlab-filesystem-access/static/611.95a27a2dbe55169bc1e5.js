"use strict";(self.webpackChunkjupyterlab_filesystem_access=self.webpackChunkjupyterlab_filesystem_access||[]).push([[611],{611:(e,t,a)=>{a.r(t),a.d(t,{default:()=>m});var i=a(729),n=a(25),o=a(903),r=a(344),s=a(805),l=a(736),c=a(374),d=a(901);const h="FileSystemAccess",w=`${h}:`;async function y(e){const t=[];for await(const a of e)t.push(a);return t}class p{get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,d.Signal.clearData(this))}get name(){return h}get serverSettings(){return l.ServerConnection.makeSettings()}get fileChanged(){return this._fileChanged}get rootHandle(){return this._rootHandle}set rootHandle(e){this._rootHandle=e}async get(e,t){if(e=this.cleanPath(e),!this._rootHandle)return{name:"",path:"",created:(new Date).toISOString(),last_modified:(new Date).toISOString(),format:null,mimetype:"",content:null,writable:!0,type:"directory"};const a=await this.getParentHandle(e),i=c.PathExt.dirname(e),n=c.PathExt.basename(e);let o;if(o=n?await this.getHandle(a,n):a,"file"===o.kind)return this.getFileModel(o,i,!0);{const e=[];for await(const t of o.values())"file"===t.kind?e.push(await this.getFileModel(t,c.PathExt.join(i,n))):e.push({name:t.name,path:c.PathExt.join(i,n,t.name),created:"",last_modified:"",format:null,mimetype:"",content:null,writable:!0,type:"directory"});return{name:n,path:c.PathExt.join(i,n),last_modified:"",created:"",format:null,mimetype:"",content:e,size:void 0,writable:!0,type:"directory"}}}async getDownloadUrl(e){throw new Error("Method not implemented.")}async newUntitled(e){let t="";e&&e.path&&(t=this.cleanPath(e.path));const a=e?.type||"directory",i=c.PathExt.join(t,"directory"===a?"Untitled Folder":"untitled"),n="notebook"===a?"ipynb":e?.ext||"txt",o=await this.getParentHandle(i);let r=c.PathExt.basename(i);const s=r;let l;if("directory"===a){let e=1;for(;await this.hasHandle(o,r);)r=`${s} ${e++}`;await o.getDirectoryHandle(r,{create:!0}),l=await this.get(c.PathExt.join(t,r))}else{let e=1;for(;await this.hasHandle(o,`${r}.${n}`);)r=`${s}${e++}`;const a=`${r}.${n}`;await o.getFileHandle(a,{create:!0}),l=await this.get(c.PathExt.join(t,a))}return this._fileChanged.emit({type:"new",oldValue:null,newValue:l}),l}async delete(e){e=this.cleanPath(e);const t=await this.getParentHandle(e);await t.removeEntry(c.PathExt.basename(e),{recursive:!0}),this._fileChanged.emit({type:"delete",oldValue:{path:e},newValue:null})}async rename(e,t){e=this.cleanPath(e),t=this.cleanPath(t),await this.doCopy(e,t),await this.delete(e);const a=this.get(t);return a.then((t=>{this._fileChanged.emit({type:"rename",oldValue:{path:e},newValue:t})})),a}async save(e,t){e=this.cleanPath(e);const a=await this.getParentHandle(e);if("directory"===t?.type)return await a.getDirectoryHandle(c.PathExt.basename(e),{create:!0}),this.get(e);const i=await a.getFileHandle(c.PathExt.basename(e),{create:!0}),n=await i.createWritable({}),o=t?.format,r=t?.content;if("json"===o){const e=JSON.stringify(r,null,2);await n.write(e)}else if("base64"===o){const e=await function(e,t="text/plain;charset=UTF-8"){return fetch(`data:${t};base64,`+e).then((e=>e.blob()))}(r);await n.write(e)}else await n.write(r);return await n.close(),this.get(e)}async copy(e,t){e=this.cleanPath(e);const a=await this.get(e),i=c.PathExt.dirname(e);let n=a.name;if(i===t){const e=c.PathExt.extname(a.name);n=e?`${n.slice(0,n.length-e.length)} (Copy)${e}`:`${n} (Copy)`}const o=c.PathExt.join(t,n);return await this.doCopy(e,o),this.get(o)}async createCheckpoint(e){return{id:"test",last_modified:(new Date).toISOString()}}async listCheckpoints(e){return[{id:"test",last_modified:(new Date).toISOString()}]}restoreCheckpoint(e,t){return Promise.resolve(void 0)}deleteCheckpoint(e,t){return Promise.resolve(void 0)}async getParentHandle(e){const t=this._rootHandle;if(!t)throw new Error("No root file handle");let a=t;for(const t of e.split("/").slice(0,-1))a=await a.getDirectoryHandle(t);return a}async getHandle(e,t){const a=(await y(e.values())).filter((e=>e.name===t));if(a.length)return a[0];throw new Error(`${t} does not exist.`)}async hasHandle(e,t){const a=(await y(e.values())).filter((e=>e.name===t));return Boolean(a.length)}async getFileModel(e,t,a){const i=await e.getFile();let n,o=null;return n=i.type&&(i.type.split("/")&&["image","audio","video"].includes(i.type.split("/")[0])||["application/zip","application/pdf","application/octet-stream"].includes(i.type))?"base64":"text",a&&(o="base64"===n?function(e){let t="";const a=new Uint8Array(e);for(let e=0;e<a.byteLength;e++)t+=String.fromCharCode(a[e]);return window.btoa(t)}(await i.arrayBuffer()):await i.text()),{name:i.name,path:c.PathExt.join(t,i.name),created:new Date(i.lastModified).toISOString(),last_modified:new Date(i.lastModified).toISOString(),format:n,content:o,writable:!0,type:"file",mimetype:i.type}}async doCopy(e,t){const a=await this.getParentHandle(e),i=c.PathExt.basename(e);let n;n=i?await this.getHandle(a,i):a;const o=await this.getParentHandle(t),r=c.PathExt.basename(t);if("directory"===n.kind){await o.getDirectoryHandle(r,{create:!0});for await(const a of n.values())await this.doCopy(c.PathExt.join(e,a.name),c.PathExt.join(t,a.name))}else{const e=await o.getFileHandle(r,{create:!0}),t=await e.createWritable({}),a=await n.getFile(),i=await a.arrayBuffer();t.write(i),await t.close()}}cleanPath(e){return e.includes(w)?e.replace(w,""):e}_isDisposed=!1;_fileChanged=new d.Signal(this);_rootHandle=null}const u={id:"jupyterlab-filesystem-access:plugin",requires:[n.IFileBrowserFactory,r.ITranslator],optional:[o.ISettingRegistry,i.IToolbarWidgetRegistry],autoStart:!0,activate:(e,t,a,o,l)=>{const c=window.showDirectoryPicker;if(!c)return void console.warn("The File System Access API is not supported in this browser.");const{serviceManager:d}=e,{createFileBrowser:w}=t,y=a.load("jupyterlab-filesystem-access"),m=new p;d.contents.addDrive(m);const f=w("jp-filesystem-browser",{driveName:m.name,restore:!1});f.title.caption=y.__("Local File System"),f.title.icon=s.listIcon,f.showFileCheckboxes=!1;const g=f.toolbar;g.id="jp-filesystem-toolbar",l&&o&&((0,i.setToolbar)(g,(0,i.createToolbarFactory)(l,o,h,u.id,a??r.nullTranslator),g),l.addFactory(h,"open-folder",(e=>new i.ToolbarButton({icon:s.folderIcon,onClick:async()=>{const e=await c();e&&(m.rootHandle=e,f.model.cd("/"))},tooltip:y.__("Open a new folder")}))),l.addFactory(h,"open-opfs",(e=>new i.ToolbarButton({icon:s.trustedIcon,onClick:async()=>{const e=await navigator.storage.getDirectory();e&&(m.rootHandle=e,f.model.cd("/"))},tooltip:y.__("Open the Origin Private File System")}))),l.addFactory(h,"uploader",(e=>new n.Uploader({model:f.model,translator:a}))),l.addFactory(h,"filename-searcher",(e=>{const t=(0,s.FilenameSearcher)({updateFilter:(e,t)=>{f.model.setFilter((t=>e(t.name.toLowerCase())))},useFuzzyFilter:!0,placeholder:y.__("Filter files by name"),forceRefresh:!1});return t.addClass("jp-FileBrowser-filterBox"),t}))),e.shell.add(f,"left",{type:"FileSystemAccess"})}},m=u}}]);