
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Tutorial: Writing Builders &#8212; WAVES 1.0.1 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css?v=cb027bf8" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css?v=cb027bf8" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=423d4ce3"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=e639491b"></script>
    <script src="_static/custom.js?v=070b234d"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'tutorial_writing_builders';</script>
    <link rel="icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Tutorial: Simulation via SSH" href="tutorial_remote_execution.html" />
    <link rel="prev" title="Work-in-progress Lessons" href="tutorial_wip.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
    <meta name="docbuild:last-update" content="Oct 10, 2025"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/waves_logo_brandmark_smaller.png" class="logo__image only-light" alt=""/>
    <script>document.write(`<img src="_static/waves_logo_brandmark_smaller.png" class="logo__image only-dark" alt=""/>`);</script>
  
  
    <p class="title logo__title">1.0.1</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Computational Practices</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="computational_practices_introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="computational_practices_version_control.html">Version Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="computational_practices_documentation.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="computational_practices_build_system.html">Build System</a></li>
<li class="toctree-l1"><a class="reference internal" href="computational_practices_compute_environment.html">Compute Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="computational_practices_regression_testing.html">Regression Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="computational_practices_archival.html">Data Archival</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">User Manual</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="abstract.html">Why WAVES?</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="tutorial_quickstart.html">Quickstart</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="waves_quickstart.html">Quickstart: Abaqus</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_gmsh_calculix.html">Quickstart: Gmsh+CalculiX</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_introduction.html">Tutorial Introduction</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="tutorial_core.html">Core Lessons</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="tutorial_00_scons.html">Tutorial 00: SConstruct</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_01_geometry.html">Tutorial 01: Geometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_02_partition_mesh.html">Tutorial 02: Partition and Mesh</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_03_solverprep.html">Tutorial 03: SolverPrep</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_04_simulation.html">Tutorial 04: Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_05_parameter_substitution.html">Tutorial 05: Parameter Substitution</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_06_include_files.html">Tutorial 06: Include Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_07_cartesian_product.html">Tutorial 07: Cartesian Product</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_08_data_extraction.html">Tutorial 08: Data Extraction</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_09_post_processing.html">Tutorial 09: Post-Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_10_unit_testing.html">Tutorial 10: Unit Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_11_regression_testing.html">Tutorial 11: Regression Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_12_archival.html">Tutorial 12: Data Archival</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="tutorial_supplemental.html">Supplemental Lessons</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="scons_quickstart.html">SCons Quickstart</a></li>
<li class="toctree-l2"><a class="reference internal" href="scons_multiactiontask.html">SCons Multi-Action Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_argparse_types.html">Tutorial: Input Verification</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_cubit_abaqus.html">Tutorial: Cubit+Abaqus</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_cubit_sierra.html">Tutorial: Cubit+Sierra</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_cubit_fierro.html">Tutorial: Cubit+Fierro</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_escape_sequences.html">Tutorial: Escape Sequences</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_07_latin_hypercube.html">Tutorial 07: Latin Hypercube</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_07_sobol_sequence.html">Tutorial 07: Sobol Sequence</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_07_one_at_a_time.html">Tutorial 07: One-at-a-Time</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_mesh_convergence.html">Tutorial: Mesh Convergence</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_part_image.html">Tutorial: Part Image</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_sensitivity_study.html">Tutorial: Sensitivity Study</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_abaqus_cae.html">Tutorial: Abaqus CAE</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="tutorial_wip.html">Work-in-progress Lessons</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Tutorial: Writing Builders</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_remote_execution.html">Tutorial: Simulation via SSH</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_sbatch.html">Tutorial: Simulation via SLURM</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_extend_study.html">Automatically Extending a Parameter Study</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_task_reuse.html">Tutorial: Task Definition Reuse</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_setuptools_scm.html">Tutorial: setuptools_scm</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_quinoa.html">Tutorial: Quinoa</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="templates.html">ModSim Templates</a></li>

<li class="toctree-l1"><a class="reference internal" href="api.html">External API</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Command-Line Utilities</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Help and Reference</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="license.html">LICENSE</a></li>
<li class="toctree-l1"><a class="reference internal" href="citation.html">Citation</a></li>
<li class="toctree-l1"><a class="reference internal" href="internal_api.html">Internal API</a></li>
<li class="toctree-l1"><a class="reference internal" href="devops.html">Developer Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="release_philosophy.html">Release Philosophy</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="zreferences.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendices</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="tutorial_api.html">WAVES-TUTORIAL API</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_cli.html">WAVES-TUTORIAL CLI</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="tutorial_wip.html" class="nav-link">Work-in-progress Lessons</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">Tutorial:...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/lanl-aea/waves" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/lanl-aea/waves/blob/main/docs/tutorial_writing_builders.rst?plain=1" target="_blank"
   class="btn btn-sm btn-source-file-button dropdown-item"
   title="Show source"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-code"></i>
  </span>
<span class="btn__text-container">Show source</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/tutorial_writing_builders.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Tutorial: Writing Builders</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#environment">Environment</a><ul class="simple visible nav section-nav flex-column">
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#directory-structure">Directory Structure</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#solver">Solver</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#solver-documentation">Solver documentation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#builder">Builder</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sconscript">SConscript</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sconstruct">SConstruct</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#building-targets">Building targets</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="tutorial-writing-builders">
<span id="id1"></span><h1>Tutorial: Writing Builders<a class="headerlink" href="#tutorial-writing-builders" title="Link to this heading">#</a></h1>
<p>This tutorial will introduce WAVES style builders using the
<a class="reference internal" href="api.html#waves.scons_extensions.first_target_builder_factory" title="waves.scons_extensions.first_target_builder_factory"><code class="xref py py-meth docutils literal notranslate"><span class="pre">waves.scons_extensions.first_target_builder_factory()</span></code></a> with considerations for handling some representative types
of numeric solver behavior. For an example of writing more generic <cite>SCons Builders</cite>, see the <a class="reference external" href="https://scons.org/">SCons</a> user manual
<span id="id2">[<a class="reference internal" href="zreferences.html#id6" title="The SCons Development Team. SCons 4.7.0: User Guide. The SCons Foundation, 4.7.0 edition, 2023.">32</a>]</span>. For a quickstart with simple builders that mimic the WAVES builder directory change operations,
see the <a class="reference internal" href="scons_quickstart.html#scons-quickstart"><span class="std std-ref">SCons Quickstart</span></a>.</p>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="scons_quickstart.html#scons-quickstart"><span class="std std-ref">SCons Quickstart</span></a></p></li>
<li><p><a class="reference external" href="https://scons.org/doc/production/HTML/scons-user/ch17.html">SCons Builders</a> <span id="id3">[<a class="reference internal" href="zreferences.html#id6" title="The SCons Development Team. SCons 4.7.0: User Guide. The SCons Foundation, 4.7.0 edition, 2023.">32</a>]</span></p></li>
<li><p><a class="reference external" href="https://scons.org/doc/production/HTML/scons-user.html#f-AddPostAction">SCons AddPostAction</a> and <a class="reference external" href="https://scons.org/doc/production/HTML/scons-user.html#f-AddPreAction">SCons AddPreAction</a> <span id="id4">[<a class="reference internal" href="zreferences.html#id6" title="The SCons Development Team. SCons 4.7.0: User Guide. The SCons Foundation, 4.7.0 edition, 2023.">32</a>]</span></p></li>
</ul>
</section>
<section id="environment">
<h2>Environment<a class="headerlink" href="#environment" title="Link to this heading">#</a></h2>
<p><a class="reference external" href="https://scons.org/">SCons</a> and <a class="reference external" href="https://lanl-aea.github.io/waves/index.html">WAVES</a> can be installed in a <a class="reference external" href="https://docs.conda.io/en/latest/">Conda</a> environment with the <a class="reference external" href="https://docs.conda.io/en/latest/">Conda</a> package manager. See the <a class="reference external" href="https://docs.conda.io/projects/conda/en/latest/user-guide/install/index.html">Conda
installation</a> and <a class="reference external" href="https://docs.conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html">Conda environment management</a> documentation for more details about using <a class="reference external" href="https://docs.conda.io/en/latest/">Conda</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The SALib and numpy versions may not need to be this strict for most tutorials. However,
<a class="reference internal" href="tutorial_sensitivity_study.html#tutorial-sensitivity-study"><span class="std std-ref">Tutorial: Sensitivity Study</span></a> uncovered some undocumented SALib version sensitivity to numpy surrounding the
numpy v2 rollout.</p>
</div>
<ol class="arabic">
<li><p>Create the tutorials environment if it doesn’t exist</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-0" name="sd-tab-set-0" type="radio">
<label class="sd-tab-label" data-sync-group="OS" data-sync-id="bash" for="sd-tab-item-0">
Linux/MacOS</label><div class="sd-tab-content docutils">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ conda create --name waves-tutorial-env --channel conda-forge waves &#39;scons&gt;=4.6&#39; matplotlib pandas pyyaml xarray seaborn &#39;numpy&gt;=2&#39; &#39;salib&gt;=1.5.1&#39; pytest
</pre></div>
</div>
</div>
<input id="sd-tab-item-1" name="sd-tab-set-0" type="radio">
<label class="sd-tab-label" data-sync-group="OS" data-sync-id="powershell" for="sd-tab-item-1">
Windows</label><div class="sd-tab-content docutils">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PS</span> <span class="o">&gt;</span> <span class="n">conda</span> <span class="n">create</span> <span class="o">--</span><span class="n">name</span> <span class="n">waves</span><span class="o">-</span><span class="n">tutorial</span><span class="o">-</span><span class="n">env</span> <span class="o">--</span><span class="n">channel</span> <span class="n">conda</span><span class="o">-</span><span class="n">forge</span> <span class="n">waves</span> <span class="n">scons</span> <span class="n">matplotlib</span> <span class="n">pandas</span> <span class="n">pyyaml</span> <span class="n">xarray</span> <span class="n">seaborn</span> <span class="n">numpy</span> <span class="n">salib</span> <span class="n">pytest</span>
</pre></div>
</div>
</div>
</div>
</li>
<li><p>Activate the environment</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-2" name="sd-tab-set-1" type="radio">
<label class="sd-tab-label" data-sync-group="OS" data-sync-id="bash" for="sd-tab-item-2">
Linux/MacOS</label><div class="sd-tab-content docutils">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ conda activate waves-tutorial-env
</pre></div>
</div>
</div>
<input id="sd-tab-item-3" name="sd-tab-set-1" type="radio">
<label class="sd-tab-label" data-sync-group="OS" data-sync-id="powershell" for="sd-tab-item-3">
Windows</label><div class="sd-tab-content docutils">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PS</span> <span class="o">&gt;</span> <span class="n">conda</span> <span class="n">activate</span> <span class="n">waves</span><span class="o">-</span><span class="n">tutorial</span><span class="o">-</span><span class="n">env</span>
</pre></div>
</div>
</div>
</div>
</li>
</ol>
<p>Some tutorials require additional third-party software that is not available for the <a class="reference external" href="https://docs.conda.io/en/latest/">Conda</a> package manager. This
software must be installed separately and either made available to SConstruct by modifying your system’s <code class="docutils literal notranslate"><span class="pre">PATH</span></code> or by
modifying the SConstruct search paths provided to the <a class="reference internal" href="api.html#waves.scons_extensions.add_program" title="waves.scons_extensions.add_program"><code class="xref py py-meth docutils literal notranslate"><span class="pre">waves.scons_extensions.add_program()</span></code></a> method.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>STOP! Before continuing, check that the documentation version matches your installed package version.</p>
<ol class="arabic simple">
<li><p>You can find the documentation version in the upper-left corner of the webpage.</p></li>
<li><p>You can find the installed WAVES version with <code class="docutils literal notranslate"><span class="pre">waves</span> <span class="pre">--version</span></code>.</p></li>
</ol>
<p>If they don’t match, you can launch identically matched documentation with the <a class="reference internal" href="cli.html#waves-cli"><span class="std std-ref">WAVES Command-Line Utility</span></a>
<a class="reference internal" href="cli.html#waves-docs-cli"><span class="std std-ref">docs</span></a> subcommand as <code class="docutils literal notranslate"><span class="pre">waves</span> <span class="pre">docs</span></code>.</p>
</div>
</section>
<section id="directory-structure">
<h2>Directory Structure<a class="headerlink" href="#directory-structure" title="Link to this heading">#</a></h2>
<ol class="arabic simple" start="3">
<li><p>Create a new <code class="docutils literal notranslate"><span class="pre">tutorial_writing_builders</span></code> directory with the <code class="docutils literal notranslate"><span class="pre">waves</span> <span class="pre">fetch</span></code> command below</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">pwd</span>
/home/roppenheimer/waves-tutorials
$<span class="w"> </span>waves<span class="w"> </span>fetch<span class="w"> </span>--destination<span class="w"> </span>tutorial_writing_builders<span class="w"> </span>tutorials/tutorial_writing_builders
$<span class="w"> </span>ls<span class="w"> </span>tutorial_writing_builders
SConstruct<span class="w"> </span>implicit.yaml<span class="w"> </span>implicit_workflow<span class="w"> </span>pyproject.toml<span class="w"> </span>scons_extensions.py<span class="w"> </span>solver<span class="w"> </span>test_scons_extensions.py
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>Make the new <code class="docutils literal notranslate"><span class="pre">tutorial_writing_builders</span></code> directory the current working directory</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">pwd</span>
/home/roppenheimer/waves-tutorials
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>tutorial_writing_builders
$<span class="w"> </span><span class="nb">pwd</span>
/home/roppenheimer/waves-tutorials/tutorial_writing_builders
$<span class="w"> </span>ls<span class="w"> </span>tutorial_writing_builders
SConstruct<span class="w"> </span>implicit.yaml<span class="w"> </span>implicit_workflow<span class="w"> </span>pyproject.toml<span class="w"> </span>scons_extensions.py<span class="w"> </span>solver<span class="w"> </span>test_scons_extensions.py
</pre></div>
</div>
<ol class="arabic" start="5">
<li><p>(Linux and MacOS only) Make the <code class="docutils literal notranslate"><span class="pre">solver.py</span></code> file executable. In a shell, use the command</p>
<p>$ chmod +x solver.py</p>
</li>
</ol>
</section>
<section id="solver">
<h2>Solver<a class="headerlink" href="#solver" title="Link to this heading">#</a></h2>
<p>Before writing a builder, it is important to understand the solver’s file handling behaviors, exit behaviors, and
command line interface options. The specific nature of the numeric algorithms and solution procedures are important
considerations when choosing a solver, but when writing a builder only the interfaces with the file system and shell are
important. To write a robust builder, you need four things from the solver</p>
<ol class="arabic simple">
<li><p>Deterministic output file paths <em>at workflow configure time</em></p></li>
<li><p>Well defined exit criteria</p></li>
<li><p>Command line options for non-interactive behavior control</p></li>
<li><p>Non-interactive output file overwrite control options</p></li>
</ol>
<p>It is also helpful for the solver to provide</p>
<ol class="arabic simple" start="5">
<li><p>Complete control over all output file paths and file base names, including logs</p></li>
</ol>
<p>Deterministic output file paths are necessary to allow builder users to define targets for downstream task consumption.
While it is possible to write a builder based on <a class="reference internal" href="api.html#waves.scons_extensions.first_target_emitter" title="waves.scons_extensions.first_target_emitter"><code class="xref py py-meth docutils literal notranslate"><span class="pre">waves.scons_extensions.first_target_emitter()</span></code></a> that does not track
any solver owned output files, such a builder is difficult to robustly integrate in a workflow. If solver output file
paths are non-deterministic <em>at workflow configure time</em> or difficult to control from the CLI, it is still possible to
write a builder by tracking the STDOUT and STDERR messages and redirecting them to a task-specific <code class="docutils literal notranslate"><span class="pre">*.stdout</span></code> file.
However, this pushes more effort of workflow configuration onto end users of the builder. If all or some output file
paths can be determined at configure time it is possible to write an associated <a class="reference external" href="https://scons.org/doc/production/HTML/scons-user.html#sect-builders-emitter">SCons Emitters</a> to automatically
populate known builder targets.</p>
<p>Well defined exit criteria is necessary to return reliable task states on solver failures and successes. Most builders
should avoid modifying the default solver behavior to provide users with the documented, and therfore expected,
behavior. However, when solvers under report non-zero exit codes for fatal errors, false positives, it may be necessary
to do extra work, such as log file inspection, to return more reliable exit codes and avoid attempting downstream tasks
when the solver task is known to have failed. This is especially important when the solver writes partial output results
that may propagate false positives further down the workflow. False negatives can be equally frustrating when the solver
results files are sufficiently complete for the user’s workflow and should not be considered fatal. Because desirable
task outcome behavior is often project or even workflow specific, it is usually best to maintain the documented solver
behavior when writing builders for general distribution.</p>
<p>Command line options for non-interactive behavior control are necessary to provide automatic execution of large
workflows and parametric studies. A large benefit of using build systems is providing consistent, reproducible behavior.
This is much more difficult when when interactive controls allow workflow behavioral changes. Additionally, interactive
controls do not scale well. Finally, when using the <a class="reference internal" href="api.html#waves.scons_extensions.first_target_builder_factory" title="waves.scons_extensions.first_target_builder_factory"><code class="xref py py-meth docutils literal notranslate"><span class="pre">waves.scons_extensions.first_target_builder_factory()</span></code></a> and
associated <a class="reference internal" href="api.html#waves.scons_extensions.first_target_emitter" title="waves.scons_extensions.first_target_emitter"><code class="xref py py-meth docutils literal notranslate"><span class="pre">waves.scons_extensions.first_target_emitter()</span></code></a>, the solver STDOUT and STDERR are redirected to a
task-specific log file to provide at least one target file and make task-specific trouble-shooting less cumbersome. It
is possible to modify the builder factory’s redirection operation to simultaneously stream to STDOUT/STDERR and a
redirected task log file; however, the commands implementing such behavior are not common to all operating systems and
shells and is therefore best left to the end user and project specific needs. As a default, a less cluttered STDOUT is
often more useful for end users tracking workflow execution, too.</p>
<p>Output overwrite controls are important when writing builders. If the solver increments output file names, workflow
re-execution will create file system state dependent targets. Technically these may be deterministic at configure time.
However, as a practical matter these are difficult to predict and functionally non-deterministic from the perspective of
the builder author because they may depend on the end user’s task construction. If the solver provides an option to
overwrite a deterministic output file name, the builder and any associated emitter are much easier to write and test for
completeness.</p>
<p>If the output files are controllable and deterministic, then it is possible to work around a missing overwrite feature
by adding a pre-solver action that performs file system cleanup as part of the builder. Writing a multi-action builder
is outside the scope of the current tutorial, but there are examples in <a class="reference internal" href="scons_multiactiontask.html#scons-multiactiontask"><span class="std std-ref">SCons Multi-Action Tasks</span></a> and the
<a class="reference internal" href="api.html#waves.scons_extensions.action_list_strings" title="waves.scons_extensions.action_list_strings"><code class="xref py py-meth docutils literal notranslate"><span class="pre">waves.scons_extensions.action_list_strings()</span></code></a> and <a class="reference internal" href="api.html#waves.scons_extensions.action_list_scons" title="waves.scons_extensions.action_list_scons"><code class="xref py py-meth docutils literal notranslate"><span class="pre">waves.scons_extensions.action_list_scons()</span></code></a> functions can
help advanced users pull apart existing builders to augment the action list.</p>
<p>The placeholder solver used in this tutorial does no real work, but provides some common output handling use cases as
examples for considerations in builder design. As seen in the solver documentation below, the solver writes a log file
with no path controls and no overwrite behavior. The solver builder can not reliably manage this file, except to change
to the target parent directory prior to solver execution to ensure that the log is co-located with other task output
files. The output file names are deterministic, but require task specific knowledge of the solver options. As a first
draft, the builder will make no attempt to predict output file names and instead rely on the user’s knowledge of solver
behavior and task options to write complete target lists. There is an overwrite option, which the builder will require
to make task behavior more predictable. There is no interactive behavior to work around and also no CLI option to force
non-interactive behavior.</p>
<p>Normally the internal implementation and API are not accessible to solver users. Here, the full internal API is produced
as an example of Python command line utility and to allow users to play with solver behavior to more closely match
solvers of interest. While the Python implementation is written to WAVES style and functional programming best
practices, the file handling behavior itself is undesirable when users have direct control over command line utility
behavior.</p>
<section id="solver-documentation">
<h3>Solver documentation<a class="headerlink" href="#solver-documentation" title="Link to this heading">#</a></h3>
<p>Example for common commercial and research solver behavior and handling.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The solver I/O handling and CLI are <em>NOT</em> good behaviors for authors and developers of command line utilities. They
are intended to be examples of representative types of challenging behaviors to consider when writing SCons builders.</p>
</div>
<p>Solver I/O behaviors:</p>
<ol class="arabic simple">
<li><p>Log files are written to the current working directory. Log files are never overwritten and must be cleaned manually.
Log files are automatically incremented from <code class="docutils literal notranslate"><span class="pre">solver.log</span></code> to <code class="docutils literal notranslate"><span class="pre">solver.log10</span></code>. If no free log file number is found
and the maximum number of 10 is found, the solver exits with a non-zero exit code.</p></li>
<li><p>The output file name is built in preferred order: CLI <code class="docutils literal notranslate"><span class="pre">--output-file</span></code> argument or the <code class="docutils literal notranslate"><span class="pre">--input-file</span></code> argument
with the replacement extension <code class="docutils literal notranslate"><span class="pre">.out</span></code>.</p></li>
<li><p>The implicit and explicit routines write output file(s) based on the requested number of threads. If only one thread
is requested, the output file name is used. If more than one thread, N, is requested, each thread writes to a
separately numbered output file 0 to (N-1) as <code class="docutils literal notranslate"><span class="pre">output_file.out{number}</span></code>.</p></li>
<li><p>If any output file exists and the overwrite behavior is not requested, the solver exits with a non-zero exit code.</p></li>
</ol>
<p>Runtime errors are returned as non-zero exit codes. Internal errors are returned as the appropriate exception.</p>
<p>Exit codes:</p>
<ol class="arabic simple">
<li><p>error loading YAML input file</p></li>
<li><p>mismatched subcommand and input file routine request</p></li>
<li><p>output file exists and no overwrite was requested</p></li>
<li><p>reached max log file integer before finding a free file name</p></li>
</ol>
<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">solver.</span></span><span class="sig-name descname"><span class="pre">configure</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Namespace</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="reference internal" href="_modules/solver.html#configure"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>Return the configuration with appended executable information.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>args</strong> – The command line argument namespace</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>RuntimeError</strong> – if the subcommand doesn’t match the input file routine</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">solver.</span></span><span class="sig-name descname"><span class="pre">explicit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Namespace</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="_modules/solver.html#explicit"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>Run the explicit ‘solve’ routine.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>args</strong> – The command line argument namespace</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">solver.</span></span><span class="sig-name descname"><span class="pre">get_parser</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">ArgumentParser</span></span></span><a class="reference internal" href="_modules/solver.html#get_parser"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>Return the argparse CLI parser.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">solver.</span></span><span class="sig-name descname"><span class="pre">implicit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Namespace</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="_modules/solver.html#implicit"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>Run the implicit ‘solve’ routine.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>args</strong> – The command line argument namespace</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">solver.</span></span><span class="sig-name descname"><span class="pre">main</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="_modules/solver.html#main"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>Run the solver command line interface and program flow.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">solver.</span></span><span class="sig-name descname"><span class="pre">name_log_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">log_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_iterations</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">10</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Path</span></span></span><a class="reference internal" href="_modules/solver.html#name_log_file"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>Return the first free log file name.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>log_file</strong> – Log file base name</p></li>
<li><p><strong>max_iterations</strong> – Maximum number of allowable log files</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>RuntimeError</strong> – if no log file name is free within the max iterations</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">solver.</span></span><span class="sig-name descname"><span class="pre">name_output_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Path</span></span></span><a class="reference internal" href="_modules/solver.html#name_output_file"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>Create the output file name from the input file if not specified.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">solver.</span></span><span class="sig-name descname"><span class="pre">positive_nonzero_int</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">argument</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">int</span></span></span><a class="reference internal" href="_modules/solver.html#positive_nonzero_int"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>Type function for argparse - positive, non-zero integers.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>argument</strong> (<em>str</em>) – string argument from argparse</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>argument</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – <ul class="simple">
<li><p>The argument can’t be cast to int</p></li>
<li><p>The argument is less than 1</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">solver.</span></span><span class="sig-name descname"><span class="pre">read_input</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="reference internal" href="_modules/solver.html#read_input"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>Return the configuration by reading the input file and handling common errors.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>input_file</strong> – The input YAML file absolute or relative path</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>RuntimeError</strong> – if the YAML file can not be read</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">solver.</span></span><span class="sig-name descname"><span class="pre">solve</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">configuration</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="_modules/solver.html#solve"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>Run the solver ‘simulation’ and create output files.</p>
<p>Common solve logic because we do not really have separate routines.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>configuration</strong> – The solver configuration</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>RuntimeError</strong> – if any output file already exists and overwrite is not requested.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">solver.</span></span><span class="sig-name descname"><span class="pre">solve_output_files</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">output_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">solve_cpus</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">Path</span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/solver.html#solve_output_files"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>Return the solve output file list to match the number of solve cpus.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>output_file</strong> – base name for the output file</p></li>
<li><p><strong>solve_cpus</strong> – integer number of solve cpus</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
</section>
<section id="builder">
<h2>Builder<a class="headerlink" href="#builder" title="Link to this heading">#</a></h2>
<p>The tutorial’s builder factory is written as a project specific Python module such that it could be documented and
packaged for distribution. It is also possible to write builder factories and builders directly into SCons configuration
files.</p>
<p>The builder itself is largely boilerplate documentation and a pass-through to the
<a class="reference internal" href="api.html#waves.scons_extensions.first_target_builder_factory" title="waves.scons_extensions.first_target_builder_factory"><code class="xref py py-meth docutils literal notranslate"><span class="pre">waves.scons_extensions.first_target_builder_factory()</span></code></a>. Strictly speaking, the builder factory could be written
much more compactly by passing unchanged arguments through as <code class="docutils literal notranslate"><span class="pre">*kwargs</span></code>. Hear, they are kept in the builder factory
definition to make documentation of the factory defaults easier and to explicitly set the defaults independently from
the WAVES function.</p>
<p>Writing the entire builder from scratch would not require many extra lines of code. The use of the WAVES function is
primarily to provide consistency with WAVES builder factories. Builder factory authors are encouraged to read the
<a class="reference external" href="https://scons.org/doc/production/HTML/scons-user/ch17.html">SCons Builders</a> documentation when their solver needs are not met by the WAVES template builder factories.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="sd">&quot;&quot;&quot;Provide project specific extensions to SCons.&quot;&quot;&quot;</span>
<span class="linenos">  2</span>
<span class="linenos">  3</span><span class="kn">import</span><span class="w"> </span><span class="nn">collections</span>
<span class="linenos">  4</span><span class="kn">import</span><span class="w"> </span><span class="nn">typing</span>
<span class="linenos">  5</span>
<span class="linenos">  6</span><span class="kn">import</span><span class="w"> </span><span class="nn">SCons.Builder</span>
<span class="linenos">  7</span><span class="kn">import</span><span class="w"> </span><span class="nn">waves</span>
<span class="linenos">  8</span>
<span class="linenos">  9</span>
<span class="linenos"> 10</span><span class="c1"># Write an example custom builder using the WAVES builder factory template</span>
<span class="linenos"> 11</span><span class="k">def</span><span class="w"> </span><span class="nf">solver_builder_factory</span><span class="p">(</span>
<span class="linenos"> 12</span>    <span class="n">environment</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="linenos"> 13</span>    <span class="n">action_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;cd $</span><span class="si">{TARGET.dir.abspath}</span><span class="s2"> &amp;&amp;&quot;</span><span class="p">,</span>
<span class="linenos"> 14</span>    <span class="n">program</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;solver.py&quot;</span><span class="p">,</span>
<span class="linenos"> 15</span>    <span class="n">program_required</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="linenos"> 16</span>    <span class="n">program_options</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="linenos"> 17</span>    <span class="n">subcommand</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;implicit&quot;</span><span class="p">,</span>
<span class="linenos"> 18</span>    <span class="n">subcommand_required</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;--input-file $</span><span class="si">{SOURCES[0].abspath}</span><span class="s2"> --output-file=$</span><span class="si">{TARGETS[0].abspath}</span><span class="s2"> --overwrite&quot;</span><span class="p">,</span>
<span class="linenos"> 19</span>    <span class="n">subcommand_options</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="linenos"> 20</span>    <span class="n">action_suffix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&gt; $</span><span class="si">{TARGETS[-1].abspath}</span><span class="s2"> 2&gt;&amp;1&quot;</span><span class="p">,</span>
<span class="linenos"> 21</span>    <span class="n">emitter</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Callable</span><span class="p">[</span>
<span class="linenos"> 22</span>        <span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Environment</span><span class="o">.</span><span class="n">Environment</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span>
<span class="linenos"> 23</span>    <span class="p">]</span> <span class="o">=</span> <span class="n">waves</span><span class="o">.</span><span class="n">scons_extensions</span><span class="o">.</span><span class="n">first_target_emitter</span><span class="p">,</span>
<span class="linenos"> 24</span>    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">],</span>
<span class="linenos"> 25</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Builder</span><span class="o">.</span><span class="n">Builder</span><span class="p">:</span>
<span class="linenos"> 26</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Define the SCons builder for the solver module&#39;s command-line interface.</span>
<span class="linenos"> 27</span>
<span class="linenos"> 28</span><span class="sd">    This builder factory extends :meth:`waves.scons_extensions.first_target_builder_factory`. This builder factory uses</span>
<span class="linenos"> 29</span><span class="sd">    the :meth:`waves.scons_extensions.first_target_emitter`. At least one task target must be specified in the task</span>
<span class="linenos"> 30</span><span class="sd">    definition and the last target will always be the expected STDOUT and STDERR redirection output file,</span>
<span class="linenos"> 31</span><span class="sd">    ``TARGETS[-1]`` ending in ``*.stdout``.</span>
<span class="linenos"> 32</span>
<span class="linenos"> 33</span><span class="sd">    .. warning::</span>
<span class="linenos"> 34</span>
<span class="linenos"> 35</span><span class="sd">       Users overriding the ``emitter`` keyword argument are responsible for providing an emitter with equivalent STDOUT</span>
<span class="linenos"> 36</span><span class="sd">       file handling behavior as :meth:`waves.scons_extensions.first_target_emitter` or updating the ``action_suffix``</span>
<span class="linenos"> 37</span><span class="sd">       option to match their emitter&#39;s behavior.</span>
<span class="linenos"> 38</span>
<span class="linenos"> 39</span><span class="sd">    With the default options this builder requires the following sources file provided in the order:</span>
<span class="linenos"> 40</span>
<span class="linenos"> 41</span><span class="sd">    1. solver program&#39;s routine subcommand input file: ``*.yaml``</span>
<span class="linenos"> 42</span>
<span class="linenos"> 43</span><span class="sd">    .. code-block::</span>
<span class="linenos"> 44</span><span class="sd">       :caption: action string construction</span>
<span class="linenos"> 45</span>
<span class="linenos"> 46</span><span class="sd">       ${environment} ${action_prefix} ${program} ${program_required} ${program_options} ${subcommand} ${subcommand_required} ${subcommand_options} ${action_suffix}</span>
<span class="linenos"> 47</span>
<span class="linenos"> 48</span><span class="sd">    .. code-block::</span>
<span class="linenos"> 49</span><span class="sd">       :caption: action string default expansion</span>
<span class="linenos"> 50</span>
<span class="linenos"> 51</span><span class="sd">       ${environment} cd ${TARGET.dir.abspath} &amp;&amp; solver.py ${program_required} ${program_optional} implicit --input-file ${SOURCE.abspath} --output-file ${TARGETS[0].abspath} ${subcommand_options} &gt; ${TARGETS[-1].abspath} 2&gt;&amp;1</span>
<span class="linenos"> 52</span>
<span class="linenos"> 53</span><span class="sd">    .. code-block::</span>
<span class="linenos"> 54</span><span class="sd">       :caption: SConstruct</span>
<span class="linenos"> 55</span>
<span class="linenos"> 56</span><span class="sd">       import waves</span>
<span class="linenos"> 57</span><span class="sd">       env = waves.scons_extensions.WAVESEnvironment()</span>
<span class="linenos"> 58</span><span class="sd">       env.AddMethod(waves.scons_extensions.add_program, &quot;AddProgram&quot;)</span>
<span class="linenos"> 59</span><span class="sd">       env[&quot;solver&quot;] = env.AddProgram([&quot;solver&quot;])</span>
<span class="linenos"> 60</span><span class="sd">       env.Append(BUILDERS={&quot;Solver&quot;: solver_explicit_builder_factory()})</span>
<span class="linenos"> 61</span><span class="sd">       env.Solver(</span>
<span class="linenos"> 62</span><span class="sd">           target=[&quot;target.out&quot;],</span>
<span class="linenos"> 63</span><span class="sd">           source=[&quot;source.yaml&quot;],</span>
<span class="linenos"> 64</span><span class="sd">       )</span>
<span class="linenos"> 65</span>
<span class="linenos"> 66</span><span class="sd">    The builder returned by this factory accepts all SCons Builder arguments. The arguments of this function are also</span>
<span class="linenos"> 67</span><span class="sd">    available as keyword arguments of the builder. When provided during task definition, the task keyword arguments</span>
<span class="linenos"> 68</span><span class="sd">    override the builder keyword arguments.</span>
<span class="linenos"> 69</span>
<span class="linenos"> 70</span><span class="sd">    :param environment: This variable is intended primarily for use with builders and tasks that can not execute from an</span>
<span class="linenos"> 71</span><span class="sd">        SCons construction environment. For instance, when tasks execute on a remote server with SSH wrapped actions</span>
<span class="linenos"> 72</span><span class="sd">        using :meth:`waves.scons_extensions.ssh_builder_actions` and therefore must initialize the remote environment as</span>
<span class="linenos"> 73</span><span class="sd">        part of the builder action.</span>
<span class="linenos"> 74</span><span class="sd">    :param action_prefix: This variable is intended to perform directory change operations prior to program execution</span>
<span class="linenos"> 75</span><span class="sd">    :param program: The solver program absolute or relative path</span>
<span class="linenos"> 76</span><span class="sd">    :param program_required: Space delimited string of required solver program options and arguments that are crucial to</span>
<span class="linenos"> 77</span><span class="sd">        builder behavior and should not be modified except by advanced users</span>
<span class="linenos"> 78</span><span class="sd">    :param program_options: Space delimited string of optional solver program options and arguments that can be freely</span>
<span class="linenos"> 79</span><span class="sd">        modified by the user</span>
<span class="linenos"> 80</span><span class="sd">    :param subcommand: The solver program&#39;s routine subcommand absolute or relative path</span>
<span class="linenos"> 81</span><span class="sd">    :param subcommand_required: Space delimited string of required solver program&#39;s routine subcommand options and</span>
<span class="linenos"> 82</span><span class="sd">        arguments that are crucial to builder behavior and should not be modified except by advanced users.</span>
<span class="linenos"> 83</span><span class="sd">    :param subcommand_options: Space delimited string of optional solver program&#39;s routine subcommand options and</span>
<span class="linenos"> 84</span><span class="sd">        arguments that can be freely modified by the user</span>
<span class="linenos"> 85</span><span class="sd">    :param action_suffix: This variable is intended to perform program STDOUT and STDERR redirection operations.</span>
<span class="linenos"> 86</span><span class="sd">    :param emitter: An SCons emitter function. This is not a keyword argument in the action string.</span>
<span class="linenos"> 87</span><span class="sd">    :param kwargs: Any additional keyword arguments are passed directly to the SCons builder object.</span>
<span class="linenos"> 88</span>
<span class="linenos"> 89</span><span class="sd">    :return: Solver journal builder</span>
<span class="linenos"> 90</span><span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa: E501</span>
<span class="linenos"> 91</span>    <span class="n">builder</span> <span class="o">=</span> <span class="n">waves</span><span class="o">.</span><span class="n">scons_extensions</span><span class="o">.</span><span class="n">first_target_builder_factory</span><span class="p">(</span>
<span class="linenos"> 92</span>        <span class="n">environment</span><span class="o">=</span><span class="n">environment</span><span class="p">,</span>
<span class="linenos"> 93</span>        <span class="n">action_prefix</span><span class="o">=</span><span class="n">action_prefix</span><span class="p">,</span>
<span class="linenos"> 94</span>        <span class="n">program</span><span class="o">=</span><span class="n">program</span><span class="p">,</span>
<span class="linenos"> 95</span>        <span class="n">program_required</span><span class="o">=</span><span class="n">program_required</span><span class="p">,</span>
<span class="linenos"> 96</span>        <span class="n">program_options</span><span class="o">=</span><span class="n">program_options</span><span class="p">,</span>
<span class="linenos"> 97</span>        <span class="n">subcommand</span><span class="o">=</span><span class="n">subcommand</span><span class="p">,</span>
<span class="linenos"> 98</span>        <span class="n">subcommand_required</span><span class="o">=</span><span class="n">subcommand_required</span><span class="p">,</span>
<span class="linenos"> 99</span>        <span class="n">subcommand_options</span><span class="o">=</span><span class="n">subcommand_options</span><span class="p">,</span>
<span class="linenos">100</span>        <span class="n">action_suffix</span><span class="o">=</span><span class="n">action_suffix</span><span class="p">,</span>
<span class="linenos">101</span>        <span class="n">emitter</span><span class="o">=</span><span class="n">emitter</span><span class="p">,</span>
<span class="linenos">102</span>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="linenos">103</span>    <span class="p">)</span>
<span class="linenos">104</span>    <span class="k">return</span> <span class="n">builder</span>
</pre></div>
</div>
<p>Example unit tests to verify the builder action string, keywords, emitter, and node count are also provided. These are
similar to the WAVES unit test verification suite for builder facotories based on
<a class="reference internal" href="api.html#waves.scons_extensions.first_target_builder_factory" title="waves.scons_extensions.first_target_builder_factory"><code class="xref py py-meth docutils literal notranslate"><span class="pre">waves.scons_extensions.first_target_builder_factory()</span></code></a> and should be the minimum verification implemented for
similar builders.</p>
<p>Unit tests are not sufficient to verify desired solver behavior. System tests that run a real, but minimal, example
problem should also be implemented to ensure that the builder action string, task re-execution, file handling
expecations, and command line options are appropriate for workflow use. The system tests should be complete enough to
verify that the third-party solver behavior still matches the assumptions in the buider design. For WAVES, the
tutorials serve as system tests for builder design. For a project specific builder, a minimal working example should be
included in the project as an inexpensive verification check and easy-to-use troubleshooting task.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="sd">&quot;&quot;&quot;Test the project SCons extensions module.&quot;&quot;&quot;</span>
<span class="linenos">  2</span>
<span class="linenos">  3</span><span class="kn">import</span><span class="w"> </span><span class="nn">collections</span>
<span class="linenos">  4</span>
<span class="linenos">  5</span><span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="linenos">  6</span><span class="kn">import</span><span class="w"> </span><span class="nn">SCons.Environment</span>
<span class="linenos">  7</span><span class="kn">import</span><span class="w"> </span><span class="nn">scons_extensions</span>
<span class="linenos">  8</span><span class="kn">import</span><span class="w"> </span><span class="nn">waves</span>
<span class="linenos">  9</span>
<span class="linenos"> 10</span>
<span class="linenos"> 11</span><span class="k">def</span><span class="w"> </span><span class="nf">dummy_emitter_for_testing</span><span class="p">(</span>
<span class="linenos"> 12</span>    <span class="n">target</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
<span class="linenos"> 13</span>    <span class="n">source</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
<span class="linenos"> 14</span>    <span class="n">env</span><span class="p">:</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Environment</span><span class="o">.</span><span class="n">Environment</span><span class="p">,</span>  <span class="c1"># noqa: ARG001</span>
<span class="linenos"> 15</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">list</span><span class="p">]:</span>
<span class="linenos"> 16</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the SCons task&#39;s target and source node lists.</span>
<span class="linenos"> 17</span>
<span class="linenos"> 18</span><span class="sd">    :param target: The target file list of strings</span>
<span class="linenos"> 19</span><span class="sd">    :param source: The source file list of SCons.Node.FS.File objects</span>
<span class="linenos"> 20</span><span class="sd">    :param env: The builder&#39;s SCons construction environment object</span>
<span class="linenos"> 21</span>
<span class="linenos"> 22</span><span class="sd">    :returns: target, source</span>
<span class="linenos"> 23</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 24</span>    <span class="k">return</span> <span class="n">target</span><span class="p">,</span> <span class="n">source</span>
<span class="linenos"> 25</span>
<span class="linenos"> 26</span>
<span class="linenos"> 27</span><span class="n">solver_builder_factory_tests</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos"> 28</span>    <span class="s2">&quot;default behavior&quot;</span><span class="p">:</span> <span class="p">({},</span> <span class="p">{},</span> <span class="p">[</span><span class="s2">&quot;solver_builder_factory.out0&quot;</span><span class="p">],</span> <span class="kc">False</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<span class="linenos"> 29</span>    <span class="s2">&quot;different emitter&quot;</span><span class="p">:</span> <span class="p">({},</span> <span class="p">{},</span> <span class="p">[</span><span class="s2">&quot;solver_builder_factory.out1&quot;</span><span class="p">],</span> <span class="n">dummy_emitter_for_testing</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<span class="linenos"> 30</span>    <span class="s2">&quot;builder kwargs overrides&quot;</span><span class="p">:</span> <span class="p">(</span>
<span class="linenos"> 31</span>        <span class="p">{</span>
<span class="linenos"> 32</span>            <span class="s2">&quot;environment&quot;</span><span class="p">:</span> <span class="s2">&quot;different environment&quot;</span><span class="p">,</span>
<span class="linenos"> 33</span>            <span class="s2">&quot;action_prefix&quot;</span><span class="p">:</span> <span class="s2">&quot;different action prefix&quot;</span><span class="p">,</span>
<span class="linenos"> 34</span>            <span class="s2">&quot;program&quot;</span><span class="p">:</span> <span class="s2">&quot;different program&quot;</span><span class="p">,</span>
<span class="linenos"> 35</span>            <span class="s2">&quot;program_required&quot;</span><span class="p">:</span> <span class="s2">&quot;different program required&quot;</span><span class="p">,</span>
<span class="linenos"> 36</span>            <span class="s2">&quot;program_options&quot;</span><span class="p">:</span> <span class="s2">&quot;different program options&quot;</span><span class="p">,</span>
<span class="linenos"> 37</span>            <span class="s2">&quot;subcommand&quot;</span><span class="p">:</span> <span class="s2">&quot;different subcommand&quot;</span><span class="p">,</span>
<span class="linenos"> 38</span>            <span class="s2">&quot;subcommand_required&quot;</span><span class="p">:</span> <span class="s2">&quot;different subcommand required&quot;</span><span class="p">,</span>
<span class="linenos"> 39</span>            <span class="s2">&quot;subcommand_options&quot;</span><span class="p">:</span> <span class="s2">&quot;different subcommand options&quot;</span><span class="p">,</span>
<span class="linenos"> 40</span>            <span class="s2">&quot;action_suffix&quot;</span><span class="p">:</span> <span class="s2">&quot;different action suffix&quot;</span><span class="p">,</span>
<span class="linenos"> 41</span>        <span class="p">},</span>
<span class="linenos"> 42</span>        <span class="p">{},</span>
<span class="linenos"> 43</span>        <span class="p">[</span><span class="s2">&quot;solver_builder_factory.out2&quot;</span><span class="p">],</span>
<span class="linenos"> 44</span>        <span class="kc">False</span><span class="p">,</span>
<span class="linenos"> 45</span>        <span class="mi">2</span><span class="p">,</span>
<span class="linenos"> 46</span>        <span class="mi">1</span><span class="p">,</span>
<span class="linenos"> 47</span>    <span class="p">),</span>
<span class="linenos"> 48</span>    <span class="s2">&quot;task kwargs overrides&quot;</span><span class="p">:</span> <span class="p">(</span>
<span class="linenos"> 49</span>        <span class="p">{},</span>
<span class="linenos"> 50</span>        <span class="p">{</span>
<span class="linenos"> 51</span>            <span class="s2">&quot;environment&quot;</span><span class="p">:</span> <span class="s2">&quot;different environment&quot;</span><span class="p">,</span>
<span class="linenos"> 52</span>            <span class="s2">&quot;action_prefix&quot;</span><span class="p">:</span> <span class="s2">&quot;different action prefix&quot;</span><span class="p">,</span>
<span class="linenos"> 53</span>            <span class="s2">&quot;program&quot;</span><span class="p">:</span> <span class="s2">&quot;different program&quot;</span><span class="p">,</span>
<span class="linenos"> 54</span>            <span class="s2">&quot;program_required&quot;</span><span class="p">:</span> <span class="s2">&quot;different program required&quot;</span><span class="p">,</span>
<span class="linenos"> 55</span>            <span class="s2">&quot;program_options&quot;</span><span class="p">:</span> <span class="s2">&quot;different program options&quot;</span><span class="p">,</span>
<span class="linenos"> 56</span>            <span class="s2">&quot;subcommand&quot;</span><span class="p">:</span> <span class="s2">&quot;different subcommand&quot;</span><span class="p">,</span>
<span class="linenos"> 57</span>            <span class="s2">&quot;subcommand_required&quot;</span><span class="p">:</span> <span class="s2">&quot;different subcommand required&quot;</span><span class="p">,</span>
<span class="linenos"> 58</span>            <span class="s2">&quot;subcommand_options&quot;</span><span class="p">:</span> <span class="s2">&quot;different subcommand options&quot;</span><span class="p">,</span>
<span class="linenos"> 59</span>            <span class="s2">&quot;action_suffix&quot;</span><span class="p">:</span> <span class="s2">&quot;different action suffix&quot;</span><span class="p">,</span>
<span class="linenos"> 60</span>        <span class="p">},</span>
<span class="linenos"> 61</span>        <span class="p">[</span><span class="s2">&quot;solver_builder_factory.out3&quot;</span><span class="p">],</span>
<span class="linenos"> 62</span>        <span class="kc">False</span><span class="p">,</span>
<span class="linenos"> 63</span>        <span class="mi">2</span><span class="p">,</span>
<span class="linenos"> 64</span>        <span class="mi">1</span><span class="p">,</span>
<span class="linenos"> 65</span>    <span class="p">),</span>
<span class="linenos"> 66</span><span class="p">}</span>
<span class="linenos"> 67</span>
<span class="linenos"> 68</span>
<span class="linenos"> 69</span><span class="c1"># TODO: Expose WAVES builder factory test functions for end users</span>
<span class="linenos"> 70</span><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span>
<span class="linenos"> 71</span>    <span class="p">(</span><span class="s2">&quot;builder_kwargs&quot;</span><span class="p">,</span> <span class="s2">&quot;task_kwargs&quot;</span><span class="p">,</span> <span class="s2">&quot;target&quot;</span><span class="p">,</span> <span class="s2">&quot;emitter&quot;</span><span class="p">,</span> <span class="s2">&quot;expected_node_count&quot;</span><span class="p">,</span> <span class="s2">&quot;expected_action_count&quot;</span><span class="p">),</span>
<span class="linenos"> 72</span>    <span class="n">solver_builder_factory_tests</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span>
<span class="linenos"> 73</span>    <span class="n">ids</span><span class="o">=</span><span class="n">solver_builder_factory_tests</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
<span class="linenos"> 74</span><span class="p">)</span>
<span class="linenos"> 75</span><span class="k">def</span><span class="w"> </span><span class="nf">test_solver_builder_factory</span><span class="p">(</span>
<span class="linenos"> 76</span>    <span class="n">builder_kwargs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
<span class="linenos"> 77</span>    <span class="n">task_kwargs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
<span class="linenos"> 78</span>    <span class="n">target</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
<span class="linenos"> 79</span>    <span class="n">emitter</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Environment</span><span class="o">.</span><span class="n">Environment</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">list</span><span class="p">]],</span>
<span class="linenos"> 80</span>    <span class="n">expected_node_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span class="linenos"> 81</span>    <span class="n">expected_action_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span class="linenos"> 82</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 83</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Test builder factories based on :meth:`waves.scons_extensions.builder_factory`.</span>
<span class="linenos"> 84</span>
<span class="linenos"> 85</span><span class="sd">    :param builder_kwargs: Keyword arguments unpacked at the builder instantiation</span>
<span class="linenos"> 86</span><span class="sd">    :param task_kwargs: Keyword arguments unpacked at the task instantiation</span>
<span class="linenos"> 87</span><span class="sd">    :param target: Explicit list of targets provided at the task instantiation</span>
<span class="linenos"> 88</span><span class="sd">    :param emitter: A custom factory emitter. Mostly intended as a pass-through check. Set to ``False`` to avoid</span>
<span class="linenos"> 89</span><span class="sd">        providing an emitter argument to the builder factory.</span>
<span class="linenos"> 90</span><span class="sd">    :param expected_node_count: The expected number of target nodes.</span>
<span class="linenos"> 91</span><span class="sd">    :param expected_action_count: The expected number of target node actions.</span>
<span class="linenos"> 92</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 93</span>    <span class="c1"># Set default expectations to match default argument values</span>
<span class="linenos"> 94</span>    <span class="n">expected_kwargs</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos"> 95</span>        <span class="s2">&quot;environment&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="linenos"> 96</span>        <span class="s2">&quot;action_prefix&quot;</span><span class="p">:</span> <span class="s2">&quot;cd $</span><span class="si">{TARGET.dir.abspath}</span><span class="s2"> &amp;&amp;&quot;</span><span class="p">,</span>
<span class="linenos"> 97</span>        <span class="s2">&quot;program&quot;</span><span class="p">:</span> <span class="s2">&quot;solver.py&quot;</span><span class="p">,</span>
<span class="linenos"> 98</span>        <span class="s2">&quot;program_required&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="linenos"> 99</span>        <span class="s2">&quot;program_options&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="linenos">100</span>        <span class="s2">&quot;subcommand&quot;</span><span class="p">:</span> <span class="s2">&quot;implicit&quot;</span><span class="p">,</span>
<span class="linenos">101</span>        <span class="s2">&quot;subcommand_required&quot;</span><span class="p">:</span> <span class="s2">&quot;--input-file $</span><span class="si">{SOURCES[0].abspath}</span><span class="s2"> --output-file=$</span><span class="si">{TARGETS[0].abspath}</span><span class="s2"> --overwrite&quot;</span><span class="p">,</span>
<span class="linenos">102</span>        <span class="s2">&quot;subcommand_options&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="linenos">103</span>        <span class="s2">&quot;action_suffix&quot;</span><span class="p">:</span> <span class="s2">&quot;&gt; $</span><span class="si">{TARGETS[-1].abspath}</span><span class="s2"> 2&gt;&amp;1&quot;</span><span class="p">,</span>
<span class="linenos">104</span>    <span class="p">}</span>
<span class="linenos">105</span>
<span class="linenos">106</span>    <span class="c1"># Update expected arguments to match test case</span>
<span class="linenos">107</span>    <span class="n">expected_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">builder_kwargs</span><span class="p">)</span>
<span class="linenos">108</span>    <span class="n">expected_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">task_kwargs</span><span class="p">)</span>
<span class="linenos">109</span>    <span class="c1"># Expected action matches the pre-SCons-substitution string with newline delimiter</span>
<span class="linenos">110</span>    <span class="n">expected_action</span> <span class="o">=</span> <span class="p">(</span>
<span class="linenos">111</span>        <span class="s2">&quot;$</span><span class="si">{environment}</span><span class="s2"> $</span><span class="si">{action_prefix}</span><span class="s2"> $</span><span class="si">{program}</span><span class="s2"> $</span><span class="si">{program_required}</span><span class="s2"> $</span><span class="si">{program_options}</span><span class="s2"> &quot;</span>
<span class="linenos">112</span>        <span class="s2">&quot;$</span><span class="si">{subcommand}</span><span class="s2"> $</span><span class="si">{subcommand_required}</span><span class="s2"> $</span><span class="si">{subcommand_options}</span><span class="s2"> $</span><span class="si">{action_suffix}</span><span class="s2">&quot;</span>
<span class="linenos">113</span>    <span class="p">)</span>
<span class="linenos">114</span>
<span class="linenos">115</span>    <span class="c1"># Handle additional builder kwargs without changing default behavior</span>
<span class="linenos">116</span>    <span class="n">expected_emitter</span> <span class="o">=</span> <span class="n">waves</span><span class="o">.</span><span class="n">scons_extensions</span><span class="o">.</span><span class="n">first_target_emitter</span>
<span class="linenos">117</span>    <span class="n">emitter_handling</span> <span class="o">=</span> <span class="p">{}</span>
<span class="linenos">118</span>    <span class="k">if</span> <span class="n">emitter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
<span class="linenos">119</span>        <span class="n">expected_emitter</span> <span class="o">=</span> <span class="n">emitter</span>
<span class="linenos">120</span>        <span class="n">emitter_handling</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;emitter&quot;</span><span class="p">:</span> <span class="n">emitter</span><span class="p">})</span>
<span class="linenos">121</span>
<span class="linenos">122</span>    <span class="c1"># Test builder object attributes</span>
<span class="linenos">123</span>    <span class="n">factory</span> <span class="o">=</span> <span class="n">scons_extensions</span><span class="o">.</span><span class="n">solver_builder_factory</span>
<span class="linenos">124</span>    <span class="n">builder</span> <span class="o">=</span> <span class="n">factory</span><span class="p">(</span><span class="o">**</span><span class="n">builder_kwargs</span><span class="p">,</span> <span class="o">**</span><span class="n">emitter_handling</span><span class="p">)</span>
<span class="linenos">125</span>    <span class="k">assert</span> <span class="n">builder</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">cmd_list</span> <span class="o">==</span> <span class="n">expected_action</span>
<span class="linenos">126</span>    <span class="k">assert</span> <span class="n">builder</span><span class="o">.</span><span class="n">emitter</span> <span class="o">==</span> <span class="n">expected_emitter</span>
<span class="linenos">127</span>
<span class="linenos">128</span>    <span class="c1"># Assemble the builder and a task to interrogate</span>
<span class="linenos">129</span>    <span class="n">env</span> <span class="o">=</span> <span class="n">SCons</span><span class="o">.</span><span class="n">Environment</span><span class="o">.</span><span class="n">Environment</span><span class="p">()</span>
<span class="linenos">130</span>    <span class="n">env</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">BUILDERS</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Builder&quot;</span><span class="p">:</span> <span class="n">builder</span><span class="p">})</span>
<span class="linenos">131</span>    <span class="n">nodes</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">Builder</span><span class="p">(</span>
<span class="linenos">132</span>        <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span>
<span class="linenos">133</span>        <span class="n">source</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;check_builder_factory.in&quot;</span><span class="p">],</span>
<span class="linenos">134</span>        <span class="o">**</span><span class="n">task_kwargs</span><span class="p">,</span>
<span class="linenos">135</span>    <span class="p">)</span>
<span class="linenos">136</span>
<span class="linenos">137</span>    <span class="c1"># Test task definition node counts, action(s), and task keyword arguments</span>
<span class="linenos">138</span>    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span> <span class="o">==</span> <span class="n">expected_node_count</span>
<span class="linenos">139</span>    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
<span class="linenos">140</span>        <span class="n">node</span><span class="o">.</span><span class="n">get_executor</span><span class="p">()</span>
<span class="linenos">141</span>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">executor</span><span class="o">.</span><span class="n">action_list</span><span class="p">)</span> <span class="o">==</span> <span class="n">expected_action_count</span>
<span class="linenos">142</span>        <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">executor</span><span class="o">.</span><span class="n">action_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="n">expected_action</span>
<span class="linenos">143</span>    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
<span class="linenos">144</span>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">expected_value</span> <span class="ow">in</span> <span class="n">expected_kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="linenos">145</span>            <span class="k">assert</span> <span class="n">node</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">==</span> <span class="n">expected_value</span>
</pre></div>
</div>
</section>
<section id="sconscript">
<h2>SConscript<a class="headerlink" href="#sconscript" title="Link to this heading">#</a></h2>
<p>The task target list depends on the solver options. The builder is not written to manage or inspect the solver command
line options and does not include an emitter to match the builder target expectations to the solver command line
options. Instead, the end user is expected to manage the target list directly.</p>
<p>As in many of the tutorials, the number of solve cpus is accepted from the project specific command line arguments. The
SConscript file implementing an implicit solver workflow inspects the construction environment solve cpus option prior
to configuring the task to determine the expected target list. Since the solver overrides the output file extension, no
special handling of the <code class="docutils literal notranslate"><span class="pre">--output-file</span></code> option is required to truncate or correct the provided extension when the
target list changes.</p>
<p>Since the solver does not provide any overwrite behavior for the log file, a user owned clean options is provided to
clean the entire workflow build directory in addition to the known target list. This is necessary to help workflow users
purge log files and to avoid solver task failures when the maximum number of log files is reached. More advanced
builder authors might choose to implement a log file clean action prior to the solver action. More advanced end users
might prefer to use an <a class="reference external" href="https://scons.org/doc/production/HTML/scons-user.html#f-AddPreAction">SCons AddPreAction</a> to perform log file cleaning even when the builder does not. Without either
implementation, users must remember to clean their build directory regularly to avoid solver exits from accumulated log
files.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="ch">#! /usr/bin/env python</span>
<span class="linenos"> 2</span><span class="sd">&quot;&quot;&quot;Configure the project&#39;s implicit solve workflow.&quot;&quot;&quot;</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="kn">import</span><span class="w"> </span><span class="nn">pathlib</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span><span class="n">Import</span><span class="p">(</span><span class="s2">&quot;env&quot;</span><span class="p">)</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="n">build_directory</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">Dir</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">abspath</span><span class="p">)</span>
<span class="linenos"> 9</span><span class="n">workflow_name</span> <span class="o">=</span> <span class="n">build_directory</span><span class="o">.</span><span class="n">name</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="n">output_file</span> <span class="o">=</span> <span class="s2">&quot;implicit.out&quot;</span>
<span class="linenos">12</span><span class="k">if</span> <span class="n">env</span><span class="p">[</span><span class="s2">&quot;solve_cpus&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<span class="linenos">13</span>    <span class="n">target</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_file</span><span class="si">}{</span><span class="n">number</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">number</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s2">&quot;solve_cpus&quot;</span><span class="p">])]</span>
<span class="linenos">14</span><span class="k">else</span><span class="p">:</span>
<span class="linenos">15</span>    <span class="n">target</span> <span class="o">=</span> <span class="p">[</span><span class="n">output_file</span><span class="p">]</span>
<span class="linenos">16</span><span class="n">workflow</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">Solver</span><span class="p">(</span>
<span class="linenos">17</span>    <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span>
<span class="linenos">18</span>    <span class="n">source</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;implicit.yaml&quot;</span><span class="p">],</span>
<span class="linenos">19</span>    <span class="n">solve_cpus</span><span class="o">=</span><span class="n">env</span><span class="p">[</span><span class="s2">&quot;solve_cpus&quot;</span><span class="p">],</span>
<span class="linenos">20</span><span class="p">)</span>
<span class="linenos">21</span><span class="n">env</span><span class="o">.</span><span class="n">Clean</span><span class="p">(</span><span class="n">workflow</span><span class="p">,</span> <span class="p">[</span><span class="n">Dir</span><span class="p">(</span><span class="n">build_directory</span><span class="p">)])</span>
<span class="linenos">22</span><span class="n">env</span><span class="o">.</span><span class="n">Alias</span><span class="p">(</span><span class="n">workflow_name</span><span class="p">,</span> <span class="n">workflow</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="sconstruct">
<h2>SConstruct<a class="headerlink" href="#sconstruct" title="Link to this heading">#</a></h2>
<p>The SConstruct file of this tutorial is a stripped down example of the core tutorials. All features of the project
configuration should look familiar to the core tutorials. It implements a variant build directory, solve cpus control,
and environment recovery from the launching shell. Since the solver behaves like a project specific file, the solver
executable is found by absolute path from the tutorial/project directory and the parent directory is added to the
environment <code class="docutils literal notranslate"><span class="pre">PATH</span></code>. Besides the default action construction, the project adds a project-specific solver option and the
<code class="docutils literal notranslate"><span class="pre">solve_cpus</span></code> task keyword argument.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="ch">#! /usr/bin/env python</span>
<span class="linenos"> 2</span><span class="sd">&quot;&quot;&quot;Configure the WAVES writing builders tutorial.&quot;&quot;&quot;</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="linenos"> 5</span><span class="kn">import</span><span class="w"> </span><span class="nn">pathlib</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="kn">import</span><span class="w"> </span><span class="nn">scons_extensions</span>
<span class="linenos"> 8</span><span class="kn">import</span><span class="w"> </span><span class="nn">waves</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span><span class="n">AddOption</span><span class="p">(</span>
<span class="linenos">11</span>    <span class="s2">&quot;--build-dir&quot;</span><span class="p">,</span>
<span class="linenos">12</span>    <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;variant_dir_base&quot;</span><span class="p">,</span>
<span class="linenos">13</span>    <span class="n">default</span><span class="o">=</span><span class="s2">&quot;build&quot;</span><span class="p">,</span>
<span class="linenos">14</span>    <span class="n">nargs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="linenos">15</span>    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
<span class="linenos">16</span>    <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
<span class="linenos">17</span>    <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;DIR&quot;</span><span class="p">,</span>
<span class="linenos">18</span>    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;SCons build (variant) root directory. Relative or absolute path. (default: &#39;</span><span class="si">%d</span><span class="s2">efault&#39;)&quot;</span><span class="p">,</span>
<span class="linenos">19</span><span class="p">)</span>
<span class="linenos">20</span><span class="n">AddOption</span><span class="p">(</span>
<span class="linenos">21</span>    <span class="s2">&quot;--solve-cpus&quot;</span><span class="p">,</span>
<span class="linenos">22</span>    <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;solve_cpus&quot;</span><span class="p">,</span>
<span class="linenos">23</span>    <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="linenos">24</span>    <span class="n">nargs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="linenos">25</span>    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;int&quot;</span><span class="p">,</span>
<span class="linenos">26</span>    <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
<span class="linenos">27</span>    <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;N&quot;</span><span class="p">,</span>
<span class="linenos">28</span>    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Run the solver task using N CPUs. (default: &#39;</span><span class="si">%d</span><span class="s2">efault&#39;)&quot;</span><span class="p">,</span>
<span class="linenos">29</span><span class="p">)</span>
<span class="linenos">30</span>
<span class="linenos">31</span><span class="n">env</span> <span class="o">=</span> <span class="n">waves</span><span class="o">.</span><span class="n">scons_extensions</span><span class="o">.</span><span class="n">WAVESEnvironment</span><span class="p">(</span>
<span class="linenos">32</span>    <span class="n">ENV</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
<span class="linenos">33</span>    <span class="n">variant_dir_base</span><span class="o">=</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">GetOption</span><span class="p">(</span><span class="s2">&quot;variant_dir_base&quot;</span><span class="p">)),</span>
<span class="linenos">34</span>    <span class="n">solve_cpus</span><span class="o">=</span><span class="n">GetOption</span><span class="p">(</span><span class="s2">&quot;solve_cpus&quot;</span><span class="p">),</span>
<span class="linenos">35</span><span class="p">)</span>
<span class="linenos">36</span><span class="n">env</span><span class="p">[</span><span class="s2">&quot;ENV&quot;</span><span class="p">][</span><span class="s2">&quot;PYTHONDONTWRITEBYTECODE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="linenos">37</span>
<span class="linenos">38</span><span class="c1"># Print failed task *.stdout files</span>
<span class="linenos">39</span><span class="n">env</span><span class="o">.</span><span class="n">PrintBuildFailures</span><span class="p">()</span>
<span class="linenos">40</span>
<span class="linenos">41</span><span class="c1"># Empty defaults list to avoid building all simulation targets by default</span>
<span class="linenos">42</span><span class="n">env</span><span class="o">.</span><span class="n">Default</span><span class="p">()</span>
<span class="linenos">43</span>
<span class="linenos">44</span><span class="c1"># Add project builders and scanners</span>
<span class="linenos">45</span><span class="n">solver_executable</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;solver.py&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
<span class="linenos">46</span><span class="n">env</span><span class="p">[</span><span class="s2">&quot;solver&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">AddProgram</span><span class="p">([</span><span class="n">solver_executable</span><span class="p">])</span>
<span class="linenos">47</span>
<span class="linenos">48</span><span class="c1"># Users should typically rely on AddProgram behavior for third-party software as above, which checks for execute</span>
<span class="linenos">49</span><span class="c1"># permissions and PATH resolution. If a tutorial user forgets to change the execute permissions on Linux, or is running</span>
<span class="linenos">50</span><span class="c1"># on Windows, force execution with the Python interpretter and absolute path.</span>
<span class="linenos">51</span><span class="c1">#</span>
<span class="linenos">52</span><span class="c1"># VVV Code specific to making tutorial execution more robust VVV</span>
<span class="linenos">53</span><span class="k">if</span> <span class="n">env</span><span class="p">[</span><span class="s2">&quot;solver&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">54</span>    <span class="n">env</span><span class="p">[</span><span class="s2">&quot;solver&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;python </span><span class="si">{</span><span class="n">solver_executable</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="linenos">55</span><span class="c1"># ^^^ Code specific to making tutorial execution more robust ^^^</span>
<span class="linenos">56</span>
<span class="linenos">57</span><span class="n">env</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span>
<span class="linenos">58</span>    <span class="n">BUILDERS</span><span class="o">=</span><span class="p">{</span>
<span class="linenos">59</span>        <span class="s2">&quot;Solver&quot;</span><span class="p">:</span> <span class="n">scons_extensions</span><span class="o">.</span><span class="n">solver_builder_factory</span><span class="p">(</span>
<span class="linenos">60</span>            <span class="n">program</span><span class="o">=</span><span class="n">env</span><span class="p">[</span><span class="s2">&quot;solver&quot;</span><span class="p">],</span> <span class="n">subcommand_options</span><span class="o">=</span><span class="s2">&quot;$(--solve-cpus=$</span><span class="si">{solve_cpus}</span><span class="s2">$)&quot;</span>
<span class="linenos">61</span>        <span class="p">),</span>
<span class="linenos">62</span>    <span class="p">}</span>
<span class="linenos">63</span><span class="p">)</span>
<span class="linenos">64</span>
<span class="linenos">65</span><span class="c1"># Add simulation targets</span>
<span class="linenos">66</span><span class="n">workflow_configurations</span> <span class="o">=</span> <span class="p">[</span>
<span class="linenos">67</span>    <span class="s2">&quot;pytest.scons&quot;</span><span class="p">,</span>
<span class="linenos">68</span>    <span class="s2">&quot;implicit_workflow.scons&quot;</span><span class="p">,</span>
<span class="linenos">69</span><span class="p">]</span>
<span class="linenos">70</span><span class="k">for</span> <span class="n">workflow</span> <span class="ow">in</span> <span class="n">workflow_configurations</span><span class="p">:</span>
<span class="linenos">71</span>    <span class="n">build_dir</span> <span class="o">=</span> <span class="n">env</span><span class="p">[</span><span class="s2">&quot;variant_dir_base&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">workflow</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span>
<span class="linenos">72</span>    <span class="n">SConscript</span><span class="p">(</span><span class="n">workflow</span><span class="p">,</span> <span class="n">variant_dir</span><span class="o">=</span><span class="n">build_dir</span><span class="p">,</span> <span class="n">exports</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;env&quot;</span><span class="p">:</span> <span class="n">env</span><span class="p">},</span> <span class="n">duplicate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="linenos">73</span>
<span class="linenos">74</span><span class="c1"># Print project local help</span>
<span class="linenos">75</span><span class="n">env</span><span class="o">.</span><span class="n">ProjectHelp</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="building-targets">
<h2>Building targets<a class="headerlink" href="#building-targets" title="Link to this heading">#</a></h2>
<p>First, run the workflow with the default number of solve cpus and observe the output directory.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ scons implicit_workflow
scons: Reading SConscript files ...
Checking whether /home/roppenheimer/waves-tutorials/tutorial_writing_builders/solver.py program exists.../home/roppenheimer/waves-tutorials/tutorial_writing_builders/solver.py
scons: done reading SConscript files.
scons: Building targets ...
cd /home/roppenheimer/waves-tutorials/tutorial_writing_builders/build/implicit_workflow &amp;&amp; solver.py implicit --input-file /home/roppenheimer/waves-tutorials/tutorial_writing_builders/implicit.yaml --output-file=/home/roppenheimer/waves-tutorials/tutorial_writing_builders/build/implicit_workflow/implicit.out --overwrite --solve-cpus=1 &gt; /home/roppenheimer/waves-tutorials/tutorial_writing_builders/build/implicit_workflow/implicit.out.stdout 2&gt;&amp;1
scons: done building targets.
$ find build -type f
build/implicit_workflow/implicit.out
build/implicit_workflow/implicit.out.stdout
build/implicit_workflow/solver.log
</pre></div>
</div>
<p>Re-run the workflow with two solve cpus. The task re-runs because the target list has changed. With the target list
change, the original, single cpu solve output file is left around and not overwritten. A more advanced builder or user
task definition is required to clean up previous files when the expected target file list changes. If the solver or
builder factory provided an option to merge the multiple cpu output files, it could be possible for the user to write a
task that does not re-execute when the number of solve cpus changes. In this tutorial, the user would need to write the
merge operation as an <a class="reference external" href="https://scons.org/doc/production/HTML/scons-user.html#f-AddPostAction">SCons AddPostAction</a> to get similar behavior when the requested solver cpus changed.</p>
<p>Observe that the previous log file still exists and a new log file with extension <code class="docutils literal notranslate"><span class="pre">*.log1</span></code> is found in the build
output. Cleaning log files to produce deterministic output for task log file tracking and cleaning would require a more
advanced user task definition. It would be tempting to write a builder action that always purges log files prior to
execution; however, if the end user were running multiple solver tasks in this build directory, all log files of
previous tasks would also be removed. In this case, it is probably better to leave log file handling to the end user.</p>
<p>Finally, the user target list construction combined with the builder <code class="docutils literal notranslate"><span class="pre">--output-file</span></code> option handling results in the
<code class="docutils literal notranslate"><span class="pre">*.stdout</span></code> file name change from <code class="docutils literal notranslate"><span class="pre">implicit.out.stdout</span></code> to <code class="docutils literal notranslate"><span class="pre">implicit.out0.stdout</span></code>. A builder factory emitter could
be written to look for the <code class="docutils literal notranslate"><span class="pre">solve_cpus</span></code> environment varible to match emitted solver output targets to solver output
handling. Changing the <code class="docutils literal notranslate"><span class="pre">*.stdout</span></code> naming convention for greater consistency is possible to handle in the builder
factory, but would be more difficult to implement robustly and document clearly, so matching the extension of the first
expected target is probably best.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ scons implicit_workflow --solve-cpus=2
scons: Reading SConscript files ...
Checking whether /home/roppenheimer/waves-tutorials/tutorial_writing_builders/solver.py program exists.../home/roppenheimer/waves-tutorials/tutorial_writing_builders/solver.py
scons: done reading SConscript files.
scons: Building targets ...
cd /home/roppenheimer/waves-tutorials/tutorial_writing_builders/build/implicit_workflow &amp;&amp; solver.py implicit --input-file /home/roppenheimer/waves-tutorials/tutorial_writing_builders/implicit.yaml --output-file=/home/roppenheimer/waves-tutorials/tutorial_writing_builders/build/implicit_workflow/implicit.out0 --overwrite --solve-cpus=2 &gt; /home/roppenheimer/waves-tutorials/tutorial_writing_builders/build/implicit_workflow/implicit.out0.stdout 2&gt;&amp;1
scons: done building targets.
$ find build -type f
build/implicit_workflow/implicit.out0
build/implicit_workflow/implicit.out
build/implicit_workflow/solver.log1
build/implicit_workflow/implicit.out1
build/implicit_workflow/implicit.out.stdout
build/implicit_workflow/implicit.out0.stdout
build/implicit_workflow/solver.log
</pre></div>
</div>
<p>Run the clean operation with the two solve cpus option and observe that the entire builder directory is removed. This is
necessary for the end user to have consistent log file purging behavior without resorting to shell remove commands.
Removing build directory artifacts by shell command is not necessarily a bad practices, but can build up muscle memory
for commands that are unnecessarily destructive, such as removing the entire build directory with <code class="docutils literal notranslate"><span class="pre">rm</span> <span class="pre">-r</span> <span class="pre">build</span></code>. In a
single workflow project like this tutorial this achieves the same result. But in a project with many or computationally
expensive workflows this muscle memory may result in expensive data loss and <code class="docutils literal notranslate"><span class="pre">scons</span> <span class="pre">workflow</span> <span class="pre">--clean</span></code> operations
should be preferred, but not relied upon, for better data retention habits.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ scons implicit_workflow --solve-cpus=2 --clean
scons: Reading SConscript files ...
Checking whether /home/roppenheimer/waves-tutorials/tutorial_writing_builders/solver.py program exists.../home/roppenheimer/waves-tutorials/tutorial_writing_builders/solver.py
scons: done reading SConscript files.
scons: Cleaning targets ...
Removed build/implicit_workflow/implicit.out0
Removed build/implicit_workflow/implicit.out1
Removed build/implicit_workflow/implicit.out0.stdout
Removed build/implicit_workflow/implicit.out
Removed build/implicit_workflow/implicit.out.stdout
Removed build/implicit_workflow/solver.log
Removed build/implicit_workflow/solver.log1
Removed directory build/implicit_workflow
scons: done cleaning targets.
$ find build -type f
$
</pre></div>
</div>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="tutorial_wip.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Work-in-progress Lessons</p>
      </div>
    </a>
    <a class="right-next"
       href="tutorial_remote_execution.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Tutorial: Simulation via SSH</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#environment">Environment</a><ul class="simple visible nav section-nav flex-column">
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#directory-structure">Directory Structure</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#solver">Solver</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#solver-documentation">Solver documentation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#builder">Builder</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sconscript">SConscript</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sconstruct">SConstruct</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#building-targets">Building targets</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Kyle Brindley, Prabhu S. Khalsa, Thomas Roberts, Sergio Cordova, Matthew Fister, Chris Johnson, and Scott Ouellette
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022-2025 Triad National Security, LLC. All Rights Reserved.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    <p class="last-updated">
  Last updated on Oct 10, 2025.
  <br/>
</p>
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>