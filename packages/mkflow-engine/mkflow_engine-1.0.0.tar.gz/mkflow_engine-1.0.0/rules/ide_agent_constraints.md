# IDE Agent工作流引擎 - AI使用指南和约束语句

## 项目概述

本约束文件定义了IDE Agent工作流引擎的安装和使用规则，确保在不同客户端环境中正确运行。同时为AI助手提供使用指南，帮助AI适配工作流引擎的规则输出。

## AI助手使用指南

### 1. AI可执行的命令
AI助手可以在IDE AI输入框中直接使用以下命令来操作工作流引擎：

#### 基础命令
- `/init` - 初始化工作流引擎，创建基础工作流结构
- `/run <workflow-file>` - 运行指定的工作流文件
- `/parse <mermaid-file>` - 解析Mermaid文件并生成工作流JSON
- `/list` - 列出所有可用命令和工作流
- `/help` - 显示帮助信息

#### 工作流控制命令
- `/stage <stage-name>` - 进入特定工作流阶段
- `/step <step-name>` - 执行特定工作流步骤
- `/feedback` - 查看当前工作流反馈信息
- `/pointer` - 查看当前工作流指针位置
- `/end` - 结束当前工作流

### 2. AI需要学习的工作流引擎文件
为了帮助AI适配工作流引擎的规则输出，AI需要学习以下核心文件：

#### 核心引擎文件
- `workflow_engine/core/workflow_engine.py` - 工作流引擎主类，包含工作流执行逻辑
- `workflow_engine/core/workflow_schema.json` - 工作流JSON Schema定义，用于验证工作流结构

#### 解析器文件
- `workflow_engine/parser/mermaid_parser.py` - Mermaid解析器，将Mermaid语法转换为工作流JSON

#### 命令系统文件
- `workflow_engine/commands/command_registry.py` - 命令注册系统，管理所有可用命令
- `workflow_engine/cli.py` - 命令行接口，处理用户输入和命令执行

#### 模板文件
- `workflow_engine/templates/official_flowchart.mermaid` - 官方流程图模板，展示标准工作流结构

### 3. AI适配规则输出指南
AI在生成工作流相关内容时，应遵循以下规则：

#### 工作流结构规则
- 工作流必须遵循：**阶段 (Stage)** → **步骤 (Step)** → **工作节点 (Work Node)** → **反馈 (Feedback)** → **结束 (End)** + **指针 (Point)** 的六大原则
- 每个阶段必须有明确的开始和结束条件
- 步骤之间必须有清晰的依赖关系
- 工作节点应包含具体的执行逻辑

#### Mermaid语法规则
- 使用标准的Mermaid流程图语法
- 节点类型必须符合工作流引擎支持的类型
- 连接关系必须明确且符合逻辑
- 支持流程图和序列图语法

#### JSON输出规则
- 生成的JSON必须通过workflow_schema.json的验证
- 必须包含完整的元数据信息
- 错误处理机制必须完善
- 状态管理必须清晰

## 项目概述

本约束文件定义了IDE Agent工作流引擎的安装和使用规则，确保在不同客户端环境中正确运行。

## 安装约束

### 1. 目录结构要求
- 工作流引擎必须安装在`.moke-core`目录下
- 约束文件必须放置在对应客户端的rules目录中
- 支持的客户端类型：
  - Trae客户端：`./trae/rules/`
  - Cursor客户端：`.cursor/rules/`  
  - Claude客户端：`.claude/rules/`

### 2. 环境要求
- Python 3.8+ 环境
- uv包管理器（推荐）
- 足够的磁盘空间用于工作流文件存储

## 工作流引擎约束

### 1. 核心原则约束
工作流引擎必须遵循六大原则：
- **阶段 (Stage)** → **步骤 (Step)** → **工作节点 (Work Node)** → **反馈 (Feedback)** → **结束 (End)** + **指针 (Point)**

### 2. 命令系统约束
- 所有命令必须以`/`开头
- 命令执行必须提供实时反馈
- 工作流状态必须持久化保存

### 3. Mermaid解析约束
- 支持流程图和序列图语法
- 自动识别节点类型和连接关系
- 生成标准的工作流JSON结构

## 客户端适配规则

### Trae客户端适配
```yaml
# .trae/rules/project_rules.md
工作流引擎规则:
  安装目录: ./.moke-core/
  约束文件: ./trae/rules/ide_agent_constraints.md
  命令前缀: /
```

### Cursor客户端适配  
```yaml
# .cursor/rules/project_rules.md
工作流引擎规则:
  安装目录: ./.moke-core/
  约束文件: .cursor/rules/ide_agent_constraints.md
  命令前缀: /
```

### Claude客户端适配
```yaml
# .claude/rules/project_rules.md  
工作流引擎规则:
  安装目录: ./.moke-core/
  约束文件: .claude/rules/ide_agent_constraints.md
  命令前缀: /
```

## 使用约束

### 1. 初始化约束
```bash
# 必须使用uv安装
uv pip install mkflow_engine

# 必须指定安装目录
uv pip install --target ./.moke-core mkflow_engine
```

### 2. 工作流执行约束
- 工作流文件必须符合JSON Schema验证
- 每个阶段必须有明确的开始和结束条件
- 反馈信息必须实时更新

### 3. 错误处理约束
- 所有错误必须提供详细的错误信息
- 工作流中断时必须保存当前状态
- 支持工作流的恢复和重试

## 扩展开发约束

### 1. 自定义节点约束
- 新节点类型必须继承基础节点类
- 必须提供完整的文档和示例
- 必须通过JSON Schema验证

### 2. 自定义命令约束
- 新命令必须注册到命令系统中
- 必须提供帮助文档
- 必须支持别名和快捷方式

## 版本管理约束

### 1. 依赖管理
- 使用uv进行依赖管理
- 依赖版本必须明确指定
- 定期更新依赖以确保安全性

### 2. 版本兼容性
- 主要版本变更必须保持向后兼容
- 次要版本可以添加新功能
- 修订版本只修复bug

## 安全约束

### 1. 文件权限
- 工作流文件必须设置适当的权限
- 敏感信息必须加密存储
- 日志文件必须定期清理

### 2. 网络访问
- 外部API调用必须支持代理配置
- 网络请求必须设置超时时间
- 必须支持HTTPS加密连接

## 性能约束

### 1. 内存使用
- 单个工作流内存使用不超过100MB
- 支持大工作流的分块处理
- 必须提供内存使用监控

### 2. 执行效率
- 工作流解析时间不超过5秒
- 命令响应时间不超过2秒
- 支持并发工作流执行

## 日志和监控约束

### 1. 日志记录
- 必须记录所有重要操作
- 日志级别必须可配置
- 支持日志轮转和归档

### 2. 监控指标
- 必须提供工作流执行统计
- 支持性能指标监控
- 必须提供健康检查接口

## 故障排除约束

### 1. 诊断信息
- 必须提供详细的错误诊断信息
- 支持工作流状态导出
- 必须提供恢复指南

### 2. 技术支持
- 必须提供完整的文档
- 支持社区问题反馈
- 定期发布安全更新

---

**最后更新**: 2024年
**版本**: 1.0.0
**适用客户端**: Trae, Cursor, Claude