import{_ as e,i as l,c as a,j as t,h as n,ag as r,a as s,g as o,d as u,b as i,n as c,F as v,s as d,e as g,v as p,t as m,f as h,ak as x,o as f,q as y,N as w,af as b}from"./index-BYpUSHcb.js";import{u as k}from"./experiment-DrOVOkyq.js";import{_ as j}from"./SLLoading-Bl5PCBHz.js";import{F as S}from"./FuncBar-DDbr9ns6.js";const _={class:"w-full h-full px-7 py-6 relative overflow-hidden"},q={key:0},T={key:1,class:"text-negative-default"},H={key:0,class:"w-full py-10 flex justify-center items-center gap-2 font-semibold"},L={class:"text-base"},C={key:1,class:"flex h-full items-center justify-center"},F=e({__name:"LogPage",setup(e){const F=k().id,N=l(),$=a(()=>{var e;const l=null==(e=N.value)?void 0:e.map((e,l)=>{const a=e,t=""!==E.value&&a.toLowerCase().includes(E.value);return{isTarget:t,index:l+1,value:t?z(a,E.value):a}}),a=M(l);return B.value.map((e,t)=>l.push({index:a+t+1,value:e,error:!0})),l}),I=a(()=>{var e;let l=1;const a=null==(e=$.value)?void 0:e.length;return a&&(l=""===$.value[a-1].index?$.value[a-2].index:$.value[a-1].index),l?8*l.length+"px":"0px"}),M=e=>{const l=null==e?void 0:e.reduce((e,l)=>l.index&&Number(l.index)>Number(e)?l.index:e,0);return Number(l)},P=a(()=>{var e;return(null==(e=N.value)?void 0:e.join("\n"))+B.value.join("\n")}),z=(e,l)=>{let a=e.split(new RegExp(`(${l})`,"i"));return a=a.filter(e=>""!==e),a},B=l([]),E=l(""),R=e=>{E.value=e.toLowerCase()},V=l([0,0]),A=l(16),D=a(()=>{var e;return(null==(e=$.value)?void 0:e.length)*A.value}),G=x(e=>{const l=e.target;J(l)},100),J=e=>{const l=A.value,a=Math.ceil(e.clientHeight/l),t=Math.floor(e.scrollTop/l),n=t+a;e.scrollTop<=30*l?V.value[0]=0:V.value[0]=t-30,e.scrollTop+e.clientHeight>=e.scrollHeight-30*l?V.value[1]=$.value.length-1:V.value[1]=n+30},K=a(()=>V.value[0]*A.value);return t(async()=>{const{data:e}=await n.get(`/experiment/${F}/recent_log`).catch(e=>{3404===e.data.code&&(N.value=[])});N.value=e.logs||[],e.error&&(B.value=e.error),r(()=>{J(document.querySelector(".log-container")),(()=>{const e=document.querySelector(".log-line");if(!e)return 0;const l=window.getComputedStyle(e);A.value=parseFloat(l.getPropertyValue("line-height"))})(),document.querySelector(".log-container").scrollHeight>document.querySelector(".log-container").clientHeight&&(document.querySelector(".log-container").scrollTop=document.querySelector(".log-container").scrollHeight)})}),(e,l)=>{const a=p;return f(),s("div",_,[N.value?(f(),o(S,{key:0,class:"pb-6",onInput:R,content:P.value,placeholder:e.$t("experiment.func-bar.placeholder.log"),filename:"print.log"},null,8,["content","placeholder"])):u("",!0),i("section",{class:"log-container",onScroll:l[0]||(l[0]=(...e)=>h(G)&&h(G)(...e))},[N.value?(f(),s("div",{key:0,class:"log-area",style:c({height:D.value+"px"})},[i("div",{class:"log-board",style:c({top:K.value+"px"})},[(f(!0),s(v,null,d($.value.slice(V.value[0],V.value[1]+1),(e,l)=>(f(),s("div",{class:"log-line",key:e.value+V.value[0]+l},[i("span",{class:y(["w-8 text-right flex-shrink-0 text-dimmest select-none",{"text-negative-default":e.error}]),style:c({width:I.value})},m(e.index),7),e.error?(f(),s("div",T,m(e.value),1)):(f(),s("div",q,[w(i("span",null,m(e.value),513),[[b,!e.isTarget]]),w(i("span",null,[(f(!0),s(v,null,d(e.value,e=>(f(),s("span",{key:e,class:y({"bg-warning-dimmest":e.toLowerCase()===E.value})},m(e),3))),128))],512),[[b,e.isTarget]])]))]))),128))],4),0===N.value.length&&0===B.value.length?(f(),s("div",H,[g(a,{class:"size-5",icon:"search"}),i("span",L,m(e.$t("experiment.empty_log")),1)])):u("",!0)],4)):(f(),s("div",C,[g(j)]))],32)])}}},[["__scopeId","data-v-0942f820"]]);export{F as default};
