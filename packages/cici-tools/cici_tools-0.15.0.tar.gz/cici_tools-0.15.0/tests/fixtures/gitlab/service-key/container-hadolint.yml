#
# This file is generated by cici-tools with the following command:
#
#     cici bundle
#
stages:
  - test
  - build
  - deploy

workflow:
  rules:
    - if: $CI_PIPELINE_SOURCE == "push" && $CI_OPEN_MERGE_REQUESTS
      when: never
    - when: always

variables:
  CONTAINER_BUILD_OPTS:
    description: |-
      Extra options to pass to container build command.
    value: ""
  CONTAINER_COMMIT_SHA:
    description: |-
      Commit SHA for the container release.
    value: "${CI_COMMIT_SHA}"
  CONTAINER_COMMIT_SHORT_SHA:
    description: |-
      First 8 characters of the commit SHA.
    value: "${CI_COMMIT_SHORT_SHA}"
  CONTAINER_CONTEXT:
    description: |-
      Directory to use as container context.
    value: "${CI_PROJECT_DIR}"
  CONTAINER_DOCKERFILE:
    description: |-
      Full path to the target Dockerfile.
    value: "${CONTAINER_CONTEXT}/Dockerfile"
  CONTAINER_IMAGE:
    description: |-
      Fully qualified container image URL.
    value: "${CONTAINER_NAME}:${CONTAINER_VERSION}"
  CONTAINER_NAME:
    description: |-
      Name component of the image URL.
    value: "${CONTAINER_REGISTRY}${CONTAINER_NAME_SUFFIX}"
  CONTAINER_NAME_SUFFIX:
    description: |-
      Suffix to add to container name.
    value: ""
  CONTAINER_PROXY:
    description: |-
      URL prefix for pull-through registry cache.
    value: "${CI_DEPENDENCY_PROXY_DIRECT_GROUP_IMAGE_PREFIX}/"
  CONTAINER_REGISTRY:
    description: |-
      Container registry URL.
    value: "${CI_REGISTRY_IMAGE}"
  CONTAINER_REGISTRY_USER:
    description: |-
      Container registry username.
    value: "${CI_REGISTRY_USER}"
  CONTAINER_REGISTRY_PASSWORD:
    description: |-
      Container registry password.
    value: "${CI_REGISTRY_PASSWORD}"
  CONTAINER_VERSION:
    description: |-
      Container image version.
    value: "${CONTAINER_VERSION_PREFIX}${CI_COMMIT_REF_NAME}${CONTAINER_VERSION_SUFFIX}"
  CONTAINER_VERSION_PREFIX:
    description: |-
      Prefix to add to the container image version.
    value: ""
  CONTAINER_VERSION_SUFFIX:
    description: |-
      Suffix to add to the container image version.
    value: ""

container-hadolint:
  stage: test
  image: "ghcr.io/hadolint/hadolint:latest-debian"
  script:
    - hadolint --ignore DL3059 "${CONTAINER_DOCKERFILE}"
  cache: {}
  dependencies: []
