#
# This file is generated by cici-tools with the following command:
#
#     cici bundle
#
stages:
  - test
  - build
  - deploy

workflow:
  rules:
    - if: $CI_PIPELINE_SOURCE == "push" && $CI_OPEN_MERGE_REQUESTS
      when: never
    - when: always

variables:
  HELM_CHART_PATH: "."
  HELM_CHART_VERSION: "$CI_COMMIT_TAG"
  HELM_REPOSITORY_USERNAME: "gitlab-ci-token"
  HELM_REPOSITORY_PASSWORD: "$CI_JOB_TOKEN"
  HELM_REPOSITORY_URL: "$CI_API_V4_URL/projects/$CI_PROJECT_ID/packages/helm/production"

helm-docs:
  stage: test
  image: "${CONTAINER_PROXY}alpine"
  before_script:
    - apk add --no-cache curl
    - >-
      curl -sSL -o - https://github.com/norwoodj/helm-docs/releases/download/v1.7.0/helm-docs_1.7.0_Linux_x86_64.tar.gz | tar

      xzf - helm-docs
    - install helm-docs /usr/local/bin/
    - rm -f helm-docs
    - helm-docs --version
  script:
    - helm-docs
  artifacts:
    paths:
      - ${HELM_CHART_PATH}/README.md
