
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Usage Guide &#8212; dogpile.cache 1.5.0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/changelog.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx_paramlinks.css" />
    <link rel="stylesheet" type="text/css" href="_static/site_custom_css.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=40912020"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'usage';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Recipes" href="recipes.html" />
    <link rel="prev" title="Front Matter" href="front.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
  
    <p class="title logo__title">dogpile.cache 1.5.0 documentation</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="front.html">Front Matter</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Usage Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipes.html">Recipes</a></li>
<li class="toctree-l1"><a class="reference internal" href="core_usage.html">dogpile Core</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/usage.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Usage Guide</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rudimentary-usage">Rudimentary Usage</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#region-configuration">Region Configuration</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-a-region">Using a Region</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-backends">Creating Backends</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#changing-backend-behavior">Changing Backend Behavior</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configuring-logging">Configuring Logging</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="usage-guide">
<h1>Usage Guide<a class="headerlink" href="#usage-guide" title="Link to this heading">#</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">#</a></h2>
<p>At the time of this writing, popular key/value servers include
<a class="reference external" href="http://memcached.org">Memcached</a>,  <a class="reference external" href="http://redis.io/">Redis</a> and many others.
While these tools all have different usage focuses, they all have in common that the storage model
is based on the retrieval of a value based on a key; as such, they are all potentially
suitable for caching, particularly Memcached which is first and foremost designed for
caching.</p>
<p>With a caching system in mind, dogpile.cache provides an interface to a particular Python API
targeted at that system.</p>
<p>A dogpile.cache configuration consists of the following components:</p>
<ul class="simple">
<li><p>A <em>region</em>, which is an instance of <a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion" title="dogpile.cache.region.CacheRegion"><code class="xref py py-class docutils literal notranslate"><span class="pre">CacheRegion</span></code></a>, and defines the configuration
details for a particular cache backend.  The <a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion" title="dogpile.cache.region.CacheRegion"><code class="xref py py-class docutils literal notranslate"><span class="pre">CacheRegion</span></code></a> can be considered
the “front end” used by applications.</p></li>
<li><p>A <em>backend</em>, which is an instance of <a class="reference internal" href="api.html#dogpile.cache.api.CacheBackend" title="dogpile.cache.api.CacheBackend"><code class="xref py py-class docutils literal notranslate"><span class="pre">CacheBackend</span></code></a>, describing how values
are stored and retrieved from a backend.  This interface specifies only
<a class="reference internal" href="api.html#dogpile.cache.api.CacheBackend.get" title="dogpile.cache.api.CacheBackend.get"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get()</span></code></a>, <a class="reference internal" href="api.html#dogpile.cache.api.CacheBackend.set" title="dogpile.cache.api.CacheBackend.set"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set()</span></code></a> and <a class="reference internal" href="api.html#dogpile.cache.api.CacheBackend.delete" title="dogpile.cache.api.CacheBackend.delete"><code class="xref py py-meth docutils literal notranslate"><span class="pre">delete()</span></code></a>.
The actual kind of <a class="reference internal" href="api.html#dogpile.cache.api.CacheBackend" title="dogpile.cache.api.CacheBackend"><code class="xref py py-class docutils literal notranslate"><span class="pre">CacheBackend</span></code></a> in use for a particular <a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion" title="dogpile.cache.region.CacheRegion"><code class="xref py py-class docutils literal notranslate"><span class="pre">CacheRegion</span></code></a>
is determined by the underlying Python API being used to talk to the cache, such
as Pylibmc.  The <a class="reference internal" href="api.html#dogpile.cache.api.CacheBackend" title="dogpile.cache.api.CacheBackend"><code class="xref py py-class docutils literal notranslate"><span class="pre">CacheBackend</span></code></a> is instantiated behind the scenes and
not directly accessed by applications under normal circumstances.</p></li>
<li><p>Value generation functions.   These are user-defined functions that generate
new values to be placed in the cache.   While dogpile.cache offers the usual
“set” approach of placing data into the cache, the usual mode of usage is to only instruct
it to “get” a value, passing it a <em>creation function</em> which will be used to
generate a new value if and only if one is needed.   This “get-or-create” pattern
is the entire key to the “Dogpile” system, which coordinates a single value creation
operation among many concurrent get operations for a particular key, eliminating
the issue of an expired value being redundantly re-generated by many workers simultaneously.</p></li>
</ul>
</section>
<section id="rudimentary-usage">
<h2>Rudimentary Usage<a class="headerlink" href="#rudimentary-usage" title="Link to this heading">#</a></h2>
<p>dogpile.cache includes a Pylibmc backend.  A basic configuration looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">dogpile.cache</span><span class="w"> </span><span class="kn">import</span> <span class="n">make_region</span>

<span class="n">region</span> <span class="o">=</span> <span class="n">make_region</span><span class="p">()</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
    <span class="s1">&#39;dogpile.cache.pylibmc&#39;</span><span class="p">,</span>
    <span class="n">expiration_time</span> <span class="o">=</span> <span class="mi">3600</span><span class="p">,</span>
    <span class="n">arguments</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;127.0.0.1&quot;</span><span class="p">],</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="nd">@region</span><span class="o">.</span><span class="n">cache_on_arguments</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">load_user_info</span><span class="p">(</span><span class="n">user_id</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">some_database</span><span class="o">.</span><span class="n">lookup_user_by_id</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
</pre></div>
</div>
<aside class="sidebar">
<p class="sidebar-title">pylibmc</p>
<p>In this section, we’re illustrating Memcached usage
using the <a class="reference external" href="http://pypi.python.org/pypi/pylibmc">pylibmc</a> backend, which is a high performing
Python library for Memcached.  It can be compared to the <a class="reference external" href="http://pypi.python.org/pypi/python-memcached">python-memcached</a>
client, which is also an excellent product.  Pylibmc is written against Memcached’s native API
so is markedly faster, though might be considered to have rougher edges.   The API is actually a bit
more verbose to allow for correct multithreaded usage.</p>
</aside>
<p>Above, we create a <a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion" title="dogpile.cache.region.CacheRegion"><code class="xref py py-class docutils literal notranslate"><span class="pre">CacheRegion</span></code></a> using the <a class="reference internal" href="api.html#dogpile.cache.region.make_region" title="dogpile.cache.region.make_region"><code class="xref py py-func docutils literal notranslate"><span class="pre">make_region()</span></code></a> function, then
apply the backend configuration via the <a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion.configure" title="dogpile.cache.region.CacheRegion.configure"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CacheRegion.configure()</span></code></a> method, which returns the
region.  The name of the backend is the only argument required by <a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion.configure" title="dogpile.cache.region.CacheRegion.configure"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CacheRegion.configure()</span></code></a>
itself, in this case <code class="docutils literal notranslate"><span class="pre">dogpile.cache.pylibmc</span></code>.  However, in this specific case, the <code class="docutils literal notranslate"><span class="pre">pylibmc</span></code>
backend also requires that the URL of the memcached server be passed within the <code class="docutils literal notranslate"><span class="pre">arguments</span></code> dictionary.</p>
<p>The configuration is separated into two sections.  Upon construction via <a class="reference internal" href="api.html#dogpile.cache.region.make_region" title="dogpile.cache.region.make_region"><code class="xref py py-func docutils literal notranslate"><span class="pre">make_region()</span></code></a>,
the <a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion" title="dogpile.cache.region.CacheRegion"><code class="xref py py-class docutils literal notranslate"><span class="pre">CacheRegion</span></code></a> object is available, typically at module
import time, for usage in decorating functions.   Additional configuration details passed to
<a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion.configure" title="dogpile.cache.region.CacheRegion.configure"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CacheRegion.configure()</span></code></a> are typically loaded from a configuration file and therefore
not necessarily available until runtime, hence the two-step configurational process.</p>
<p>Key arguments passed to <a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion.configure" title="dogpile.cache.region.CacheRegion.configure"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CacheRegion.configure()</span></code></a> include <em>expiration_time</em>, which is the expiration
time passed to the Dogpile lock, and <em>arguments</em>, which are arguments used directly
by the backend - in this case we are using arguments that are passed directly
to the pylibmc module.</p>
</section>
<section id="region-configuration">
<h2>Region Configuration<a class="headerlink" href="#region-configuration" title="Link to this heading">#</a></h2>
<p>The <a class="reference internal" href="api.html#dogpile.cache.region.make_region" title="dogpile.cache.region.make_region"><code class="xref py py-func docutils literal notranslate"><span class="pre">make_region()</span></code></a> function currently calls the <a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion" title="dogpile.cache.region.CacheRegion"><code class="xref py py-class docutils literal notranslate"><span class="pre">CacheRegion</span></code></a> constructor directly.</p>
<dl class="py class">
<dt class="sig sig-object py">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dogpile.cache.region.</span></span><span class="sig-name descname"><span class="pre">CacheRegion</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">name:</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None,</span> <span class="pre">function_key_generator:</span> <span class="pre">~collections.abc.Callable[[...],</span> <span class="pre">~collections.abc.Callable[[...],</span> <span class="pre">str]]</span> <span class="pre">=</span> <span class="pre">&lt;function</span> <span class="pre">function_key_generator&gt;,</span> <span class="pre">function_multi_key_generator:</span> <span class="pre">~collections.abc.Callable[[...],</span> <span class="pre">~collections.abc.Callable[[...],</span> <span class="pre">~collections.abc.Sequence[str]]]</span> <span class="pre">=</span> <span class="pre">&lt;function</span> <span class="pre">function_multi_key_generator&gt;,</span> <span class="pre">key_mangler:</span> <span class="pre">~collections.abc.Callable[[str],</span> <span class="pre">str]</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None,</span> <span class="pre">serializer:</span> <span class="pre">~collections.abc.Callable[[~typing.Any],</span> <span class="pre">bytes]</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None,</span> <span class="pre">deserializer:</span> <span class="pre">~collections.abc.Callable[[bytes],</span> <span class="pre">~typing.Any]</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None,</span> <span class="pre">async_creation_runner:</span> <span class="pre">~collections.abc.Callable[[~dogpile.cache.region.CacheRegion,</span> <span class="pre">str,</span> <span class="pre">~collections.abc.Callable[[],</span> <span class="pre">~typing.Any],</span> <span class="pre">~dogpile.cache.api.CacheMutex],</span> <span class="pre">None]</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></em><span class="sig-paren">)</span></dt>
<dd><p>A front end to a particular cache backend.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="dogpile.cache.region.CacheRegion.params.name"></span><strong>name</strong><a class="paramlink headerlink reference internal" href="#dogpile.cache.region.CacheRegion.params.name">¶</a> – Optional, a string name for the region.
This isn’t used internally
but can be accessed via the <code class="docutils literal notranslate"><span class="pre">.name</span></code> parameter, helpful
for configuring a region from a config file.</p></li>
<li><p><span class="target" id="dogpile.cache.region.CacheRegion.params.function_key_generator"></span><strong>function_key_generator</strong><a class="paramlink headerlink reference internal" href="#dogpile.cache.region.CacheRegion.params.function_key_generator">¶</a> – <p>Optional.  A
function that will produce a “cache key” given
a data creation function and arguments, when using
the <a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion.cache_on_arguments" title="dogpile.cache.region.CacheRegion.cache_on_arguments"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CacheRegion.cache_on_arguments()</span></code></a> method.
The structure of this function
should be two levels: given the data creation function,
return a new function that generates the key based on
the given arguments.  Such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">my_key_generator</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="n">fname</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">generate_key</span><span class="p">(</span><span class="o">*</span><span class="n">arg</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">namespace</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">fname</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">arg</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">generate_key</span>


<span class="n">region</span> <span class="o">=</span> <span class="n">make_region</span><span class="p">(</span>
    <span class="n">function_key_generator</span> <span class="o">=</span> <span class="n">my_key_generator</span>
<span class="p">)</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
    <span class="s2">&quot;dogpile.cache.dbm&quot;</span><span class="p">,</span>
    <span class="n">expiration_time</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
    <span class="n">arguments</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;filename&quot;</span><span class="p">:</span><span class="s2">&quot;file.dbm&quot;</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">namespace</span></code> is that passed to
<a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion.cache_on_arguments" title="dogpile.cache.region.CacheRegion.cache_on_arguments"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CacheRegion.cache_on_arguments()</span></code></a>.  It’s not consulted
outside this function, so in fact can be of any form.
For example, it can be passed as a tuple, used to specify
arguments to pluck from **kw:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">my_key_generator</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">fn</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">generate_key</span><span class="p">(</span><span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;:&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="n">kw</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">namespace</span><span class="p">]</span> <span class="o">+</span>
                <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">arg</span><span class="p">]</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">generate_key</span>
</pre></div>
</div>
<p>Where the decorator might be used as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@my_region</span><span class="o">.</span><span class="n">cache_on_arguments</span><span class="p">(</span><span class="n">namespace</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">my_function</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">my_data</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="api.html#dogpile.cache.util.function_key_generator" title="dogpile.cache.util.function_key_generator"><code class="xref py py-func docutils literal notranslate"><span class="pre">function_key_generator()</span></code></a> - default key generator</p>
<p><a class="reference internal" href="api.html#dogpile.cache.util.kwarg_function_key_generator" title="dogpile.cache.util.kwarg_function_key_generator"><code class="xref py py-func docutils literal notranslate"><span class="pre">kwarg_function_key_generator()</span></code></a> - optional gen that also
uses keyword arguments</p>
</div>
</p></li>
<li><p><span class="target" id="dogpile.cache.region.CacheRegion.params.function_multi_key_generator"></span><strong>function_multi_key_generator</strong><a class="paramlink headerlink reference internal" href="#dogpile.cache.region.CacheRegion.params.function_multi_key_generator">¶</a> – <p>Optional.
Similar to <code class="docutils literal notranslate"><span class="pre">function_key_generator</span></code> parameter, but it’s used in
<a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion.cache_multi_on_arguments" title="dogpile.cache.region.CacheRegion.cache_multi_on_arguments"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CacheRegion.cache_multi_on_arguments()</span></code></a>. Generated function
should return list of keys. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">my_multi_key_generator</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="n">namespace</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="p">(</span><span class="n">namespace</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_keys</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">namespace</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">args</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">generate_keys</span>
</pre></div>
</div>
</p></li>
<li><p><span class="target" id="dogpile.cache.region.CacheRegion.params.key_mangler"></span><strong>key_mangler</strong><a class="paramlink headerlink reference internal" href="#dogpile.cache.region.CacheRegion.params.key_mangler">¶</a> – Function which will be used on all incoming
keys before passing to the backend.  Defaults to <code class="docutils literal notranslate"><span class="pre">None</span></code>,
in which case the key mangling function recommended by
the cache backend will be used.    A typical mangler
is the SHA1 mangler found at <a class="reference internal" href="api.html#dogpile.cache.util.sha1_mangle_key" title="dogpile.cache.util.sha1_mangle_key"><code class="xref py py-func docutils literal notranslate"><span class="pre">sha1_mangle_key()</span></code></a>
which coerces keys into a SHA1
hash, so that the string length is fixed.  To
disable all key mangling, set to <code class="docutils literal notranslate"><span class="pre">False</span></code>.   Another typical
mangler is the built-in Python function <code class="docutils literal notranslate"><span class="pre">str</span></code>, which can be used
to convert non-string or Unicode keys to bytestrings, which is
needed when using a backend such as bsddb or dbm under Python 2.x
in conjunction with Unicode keys.</p></li>
<li><p><span class="target" id="dogpile.cache.region.CacheRegion.params.serializer"></span><strong>serializer</strong><a class="paramlink headerlink reference internal" href="#dogpile.cache.region.CacheRegion.params.serializer">¶</a> – <p>function which will be applied to all values before
passing to the backend.  Defaults to <code class="docutils literal notranslate"><span class="pre">None</span></code>, in which case the
serializer recommended by the backend will be used.   Typical
serializers include <code class="docutils literal notranslate"><span class="pre">pickle.dumps</span></code> and <code class="docutils literal notranslate"><span class="pre">json.dumps</span></code>.</p>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 1.1.0.</span></p>
</div>
</p></li>
<li><p><span class="target" id="dogpile.cache.region.CacheRegion.params.deserializer"></span><strong>deserializer</strong><a class="paramlink headerlink reference internal" href="#dogpile.cache.region.CacheRegion.params.deserializer">¶</a> – <p>function which will be applied to all values returned
by the backend.  Defaults to <code class="docutils literal notranslate"><span class="pre">None</span></code>, in which case the
deserializer recommended by the backend will be used.   Typical
deserializers include <code class="docutils literal notranslate"><span class="pre">pickle.dumps</span></code> and <code class="docutils literal notranslate"><span class="pre">json.dumps</span></code>.</p>
<p>Deserializers can raise a <a class="reference internal" href="api.html#dogpile.cache.api.CantDeserializeException" title="dogpile.cache.api.CantDeserializeException"><code class="xref py py-class docutils literal notranslate"><span class="pre">api.CantDeserializeException</span></code></a> if they
are unable to deserialize the value from the backend, indicating
deserialization failed and that caching should proceed to re-generate
a value.  This allows an application that has been updated to gracefully
re-cache old items which were persisted by a previous version of the
application and can no longer be successfully deserialized.</p>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 1.1.0: </span>added “deserializer” parameter</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 1.2.0: </span>added support for
<a class="reference internal" href="api.html#dogpile.cache.api.CantDeserializeException" title="dogpile.cache.api.CantDeserializeException"><code class="xref py py-class docutils literal notranslate"><span class="pre">api.CantDeserializeException</span></code></a></p>
</div>
</p></li>
<li><p><span class="target" id="dogpile.cache.region.CacheRegion.params.async_creation_runner"></span><strong>async_creation_runner</strong><a class="paramlink headerlink reference internal" href="#dogpile.cache.region.CacheRegion.params.async_creation_runner">¶</a> – <p>A callable that, when specified,
will be passed to and called by dogpile.lock when
there is a stale value present in the cache.  It will be passed the
mutex and is responsible releasing that mutex when finished.
This can be used to defer the computation of expensive creator
functions to later points in the future by way of, for example, a
background thread, a long-running queue, or a task manager system
like Celery.</p>
<p>For a specific example using async_creation_runner, new values can
be created in a background thread like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">threading</span>

<span class="k">def</span><span class="w"> </span><span class="nf">async_creation_runner</span><span class="p">(</span><span class="n">cache</span><span class="p">,</span> <span class="n">somekey</span><span class="p">,</span> <span class="n">creator</span><span class="p">,</span> <span class="n">mutex</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; Used by dogpile.core:Lock when appropriate  &#39;&#39;&#39;</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">runner</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">creator</span><span class="p">()</span>
            <span class="n">cache</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">somekey</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">mutex</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>

    <span class="n">thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">runner</span><span class="p">)</span>
    <span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>


<span class="n">region</span> <span class="o">=</span> <span class="n">make_region</span><span class="p">(</span>
    <span class="n">async_creation_runner</span><span class="o">=</span><span class="n">async_creation_runner</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
    <span class="s1">&#39;dogpile.cache.memcached&#39;</span><span class="p">,</span>
    <span class="n">expiration_time</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">arguments</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="s1">&#39;127.0.0.1:11211&#39;</span><span class="p">,</span>
        <span class="s1">&#39;distributed_lock&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Remember that the first request for a key with no associated
value will always block; async_creator will not be invoked.
However, subsequent requests for cached-but-expired values will
still return promptly.  They will be refreshed by whatever
asynchronous means the provided async_creation_runner callable
implements.</p>
<p>By default the async_creation_runner is disabled and is set
to <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 0.4.2: </span>added the async_creation_runner
feature.</p>
</div>
</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<p>One you have a <a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion" title="dogpile.cache.region.CacheRegion"><code class="xref py py-class docutils literal notranslate"><span class="pre">CacheRegion</span></code></a>, the <a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion.cache_on_arguments" title="dogpile.cache.region.CacheRegion.cache_on_arguments"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CacheRegion.cache_on_arguments()</span></code></a> method can
be used to decorate functions, but the cache itself can’t be used until
<a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion.configure" title="dogpile.cache.region.CacheRegion.configure"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CacheRegion.configure()</span></code></a> is called.  The interface for that method is as follows:</p>
<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">CacheRegion.</span></span><span class="sig-name descname"><span class="pre">configure</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">backend</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">expiration_time</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">timedelta</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">arguments</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Mapping</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_config_argument_dict</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Mapping</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_config_prefix</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wrap</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="api.html#dogpile.cache.proxy.ProxyBackend" title="dogpile.cache.proxy.ProxyBackend"><span class="pre">ProxyBackend</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Type</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="api.html#dogpile.cache.proxy.ProxyBackend" title="dogpile.cache.proxy.ProxyBackend"><span class="pre">ProxyBackend</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">()</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">replace_existing_backend</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">region_invalidator</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="api.html#dogpile.cache.region.RegionInvalidationStrategy" title="dogpile.cache.region.RegionInvalidationStrategy"><span class="pre">RegionInvalidationStrategy</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Self</span></span></span></dt>
<dd><p>Configure a <a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion" title="dogpile.cache.region.CacheRegion"><code class="xref py py-class docutils literal notranslate"><span class="pre">CacheRegion</span></code></a>.</p>
<p>The <a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion" title="dogpile.cache.region.CacheRegion"><code class="xref py py-class docutils literal notranslate"><span class="pre">CacheRegion</span></code></a> itself
is returned.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="dogpile.cache.region.CacheRegion.configure.params.backend"></span><strong>backend</strong><a class="paramlink headerlink reference internal" href="#dogpile.cache.region.CacheRegion.configure.params.backend">¶</a> – Required.  This is the name of the
<a class="reference internal" href="api.html#dogpile.cache.api.CacheBackend" title="dogpile.cache.api.CacheBackend"><code class="xref py py-class docutils literal notranslate"><span class="pre">CacheBackend</span></code></a> to use, and is resolved by loading
the class from the <code class="docutils literal notranslate"><span class="pre">dogpile.cache</span></code> entrypoint.</p></li>
<li><p><span class="target" id="dogpile.cache.region.CacheRegion.configure.params.expiration_time"></span><strong>expiration_time</strong><a class="paramlink headerlink reference internal" href="#dogpile.cache.region.CacheRegion.configure.params.expiration_time">¶</a> – <p>Optional.  The expiration time passed
to the dogpile system.  May be passed as an integer number
of seconds, or as a <code class="docutils literal notranslate"><span class="pre">datetime.timedelta</span></code> value.</p>
<p>The <a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion.get_or_create" title="dogpile.cache.region.CacheRegion.get_or_create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CacheRegion.get_or_create()</span></code></a>
method as well as the <a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion.cache_on_arguments" title="dogpile.cache.region.CacheRegion.cache_on_arguments"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CacheRegion.cache_on_arguments()</span></code></a>
decorator (though note:  <strong>not</strong> the <a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion.get" title="dogpile.cache.region.CacheRegion.get"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CacheRegion.get()</span></code></a>
method) will call upon the value creation function after this
time period has passed since the last generation.</p>
</p></li>
<li><p><span class="target" id="dogpile.cache.region.CacheRegion.configure.params.arguments"></span><strong>arguments</strong><a class="paramlink headerlink reference internal" href="#dogpile.cache.region.CacheRegion.configure.params.arguments">¶</a> – Optional.  The structure here is passed
directly to the constructor of the <a class="reference internal" href="api.html#dogpile.cache.api.CacheBackend" title="dogpile.cache.api.CacheBackend"><code class="xref py py-class docutils literal notranslate"><span class="pre">CacheBackend</span></code></a>
in use, though is typically a dictionary.</p></li>
<li><p><span class="target" id="dogpile.cache.region.CacheRegion.configure.params.wrap"></span><strong>wrap</strong><a class="paramlink headerlink reference internal" href="#dogpile.cache.region.CacheRegion.configure.params.wrap">¶</a> – <p>Optional.  A list of <a class="reference internal" href="api.html#dogpile.cache.proxy.ProxyBackend" title="dogpile.cache.proxy.ProxyBackend"><code class="xref py py-class docutils literal notranslate"><span class="pre">ProxyBackend</span></code></a>
classes and/or instances, each of which will be applied
in a chain to ultimately wrap the original backend,
so that custom functionality augmentation can be applied.</p>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 0.5.0.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#changing-backend-behavior"><span class="std std-ref">Changing Backend Behavior</span></a></p>
</div>
</p></li>
<li><p><span class="target" id="dogpile.cache.region.CacheRegion.configure.params.replace_existing_backend"></span><strong>replace_existing_backend</strong><a class="paramlink headerlink reference internal" href="#dogpile.cache.region.CacheRegion.configure.params.replace_existing_backend">¶</a> – <p>if True, the existing cache backend
will be replaced.  Without this flag, an exception is raised if
a backend is already configured.</p>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 0.5.7.</span></p>
</div>
</p></li>
<li><p><span class="target" id="dogpile.cache.region.CacheRegion.configure.params.region_invalidator"></span><strong>region_invalidator</strong><a class="paramlink headerlink reference internal" href="#dogpile.cache.region.CacheRegion.configure.params.region_invalidator">¶</a> – <p>Optional. Override default invalidation
strategy with custom implementation of
<a class="reference internal" href="api.html#dogpile.cache.region.RegionInvalidationStrategy" title="dogpile.cache.region.RegionInvalidationStrategy"><code class="xref py py-class docutils literal notranslate"><span class="pre">RegionInvalidationStrategy</span></code></a>.</p>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 0.6.2.</span></p>
</div>
</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<p>The <a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion" title="dogpile.cache.region.CacheRegion"><code class="xref py py-class docutils literal notranslate"><span class="pre">CacheRegion</span></code></a> can also be configured from a dictionary, using the <a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion.configure_from_config" title="dogpile.cache.region.CacheRegion.configure_from_config"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CacheRegion.configure_from_config()</span></code></a>
method:</p>
<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">CacheRegion.</span></span><span class="sig-name descname"><span class="pre">configure_from_config</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config_dict</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prefix</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Self</span></span></span></dt>
<dd><p>Configure from a configuration dictionary
and a prefix.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">local_region</span> <span class="o">=</span> <span class="n">make_region</span><span class="p">()</span>
<span class="n">memcached_region</span> <span class="o">=</span> <span class="n">make_region</span><span class="p">()</span>

<span class="c1"># regions are ready to use for function</span>
<span class="c1"># decorators, but not yet for actual caching</span>

<span class="c1"># later, when config is available</span>
<span class="n">myconfig</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;cache.local.backend&quot;</span><span class="p">:</span><span class="s2">&quot;dogpile.cache.dbm&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cache.local.arguments.filename&quot;</span><span class="p">:</span><span class="s2">&quot;/path/to/dbmfile.dbm&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cache.memcached.backend&quot;</span><span class="p">:</span><span class="s2">&quot;dogpile.cache.pylibmc&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cache.memcached.arguments.url&quot;</span><span class="p">:</span><span class="s2">&quot;127.0.0.1, 10.0.0.1&quot;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">local_region</span><span class="o">.</span><span class="n">configure_from_config</span><span class="p">(</span><span class="n">myconfig</span><span class="p">,</span> <span class="s2">&quot;cache.local.&quot;</span><span class="p">)</span>
<span class="n">memcached_region</span><span class="o">.</span><span class="n">configure_from_config</span><span class="p">(</span><span class="n">myconfig</span><span class="p">,</span>
                                    <span class="s2">&quot;cache.memcached.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="using-a-region">
<h2>Using a Region<a class="headerlink" href="#using-a-region" title="Link to this heading">#</a></h2>
<p>The <a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion" title="dogpile.cache.region.CacheRegion"><code class="xref py py-class docutils literal notranslate"><span class="pre">CacheRegion</span></code></a> object is our front-end interface to a cache.  It includes
the following methods:</p>
<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">CacheRegion.</span></span><span class="sig-name descname"><span class="pre">get</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">expiration_time</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ignore_expiration</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Any</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="pre">NoValue.NO_VALUE</span><span class="p"><span class="pre">]</span></span></span></span></dt>
<dd><p>Return a value from the cache, based on the given key.</p>
<p>If the value is not present, the method returns the token
<a class="reference internal" href="api.html#dogpile.cache.api.NO_VALUE" title="dogpile.cache.api.NO_VALUE"><code class="xref py py-data docutils literal notranslate"><span class="pre">api.NO_VALUE</span></code></a>. <a class="reference internal" href="api.html#dogpile.cache.api.NO_VALUE" title="dogpile.cache.api.NO_VALUE"><code class="xref py py-data docutils literal notranslate"><span class="pre">api.NO_VALUE</span></code></a> evaluates to False, but is
separate from <code class="docutils literal notranslate"><span class="pre">None</span></code> to distinguish between a cached value of
<code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<p>By default, the configured expiration time of the
<a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion" title="dogpile.cache.region.CacheRegion"><code class="xref py py-class docutils literal notranslate"><span class="pre">CacheRegion</span></code></a>, or alternatively the expiration
time supplied by the <code class="docutils literal notranslate"><span class="pre">expiration_time</span></code> argument,
is tested against the creation time of the retrieved
value versus the current time (as reported by <code class="docutils literal notranslate"><span class="pre">time.time()</span></code>).
If stale, the cached value is ignored and the <a class="reference internal" href="api.html#dogpile.cache.api.NO_VALUE" title="dogpile.cache.api.NO_VALUE"><code class="xref py py-data docutils literal notranslate"><span class="pre">api.NO_VALUE</span></code></a>
token is returned.  Passing the flag <code class="docutils literal notranslate"><span class="pre">ignore_expiration=True</span></code>
bypasses the expiration time check.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.3.0: </span><a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion.get" title="dogpile.cache.region.CacheRegion.get"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CacheRegion.get()</span></code></a> now checks the value’s creation time
against the expiration time, rather than returning
the value unconditionally.</p>
</div>
<p>The method also interprets the cached value in terms
of the current “invalidation” time as set by
the <a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion.invalidate" title="dogpile.cache.region.CacheRegion.invalidate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">invalidate()</span></code></a> method.   If a value is present,
but its creation time is older than the current
invalidation time, the <a class="reference internal" href="api.html#dogpile.cache.api.NO_VALUE" title="dogpile.cache.api.NO_VALUE"><code class="xref py py-data docutils literal notranslate"><span class="pre">api.NO_VALUE</span></code></a> token is returned.
Passing the flag <code class="docutils literal notranslate"><span class="pre">ignore_expiration=True</span></code> bypasses
the invalidation time check.</p>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 0.3.0: </span>Support for the <a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion.invalidate" title="dogpile.cache.region.CacheRegion.invalidate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CacheRegion.invalidate()</span></code></a>
method.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="dogpile.cache.region.CacheRegion.get.params.key"></span><strong>key</strong><a class="paramlink headerlink reference internal" href="#dogpile.cache.region.CacheRegion.get.params.key">¶</a> – Key to be retrieved. While it’s typical for a key to be a
string, it is ultimately passed directly down to the cache backend,
before being optionally processed by the key_mangler function, so can
be of any type recognized by the backend or by the key_mangler
function, if present.</p></li>
<li><p><span class="target" id="dogpile.cache.region.CacheRegion.get.params.expiration_time"></span><strong>expiration_time</strong><a class="paramlink headerlink reference internal" href="#dogpile.cache.region.CacheRegion.get.params.expiration_time">¶</a> – <p>Optional expiration time value
which will supersede that configured on the <a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion" title="dogpile.cache.region.CacheRegion"><code class="xref py py-class docutils literal notranslate"><span class="pre">CacheRegion</span></code></a>
itself.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion.get.params.expiration_time" title="dogpile.cache.region.CacheRegion.get"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">CacheRegion.get.expiration_time</span></code></a>
argument is <strong>not persisted in the cache</strong> and is relevant
only to <strong>this specific cache retrieval operation</strong>, relative to
the creation time stored with the existing cached value.
Subsequent calls to <a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion.get" title="dogpile.cache.region.CacheRegion.get"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CacheRegion.get()</span></code></a> are <strong>not</strong> affected
by this value.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 0.3.0.</span></p>
</div>
</p></li>
<li><p><span class="target" id="dogpile.cache.region.CacheRegion.get.params.ignore_expiration"></span><strong>ignore_expiration</strong><a class="paramlink headerlink reference internal" href="#dogpile.cache.region.CacheRegion.get.params.ignore_expiration">¶</a> – <p>if <code class="docutils literal notranslate"><span class="pre">True</span></code>, the value is returned
from the cache if present, regardless of configured
expiration times or whether or not <a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion.invalidate" title="dogpile.cache.region.CacheRegion.invalidate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">invalidate()</span></code></a>
was called.</p>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 0.3.0.</span></p>
</div>
</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion.get_multi" title="dogpile.cache.region.CacheRegion.get_multi"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CacheRegion.get_multi()</span></code></a></p>
<p><a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion.get_or_create" title="dogpile.cache.region.CacheRegion.get_or_create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CacheRegion.get_or_create()</span></code></a></p>
<p><a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion.set" title="dogpile.cache.region.CacheRegion.set"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CacheRegion.set()</span></code></a></p>
<p><a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion.delete" title="dogpile.cache.region.CacheRegion.delete"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CacheRegion.delete()</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">CacheRegion.</span></span><span class="sig-name descname"><span class="pre">get_or_create</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">creator</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">expiration_time</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">should_cache_fn</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">creator_args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Mapping</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Any</span></span></span></dt>
<dd><p>Return a cached value based on the given key.</p>
<p>If the value does not exist or is considered to be expired
based on its creation time, the given
creation function may or may not be used to recreate the value
and persist the newly generated value in the cache.</p>
<p>Whether or not the function is used depends on if the
<em>dogpile lock</em> can be acquired or not.  If it can’t, it means
a different thread or process is already running a creation
function for this key against the cache.  When the dogpile
lock cannot be acquired, the method will block if no
previous value is available, until the lock is released and
a new value available.  If a previous value
is available, that value is returned immediately without blocking.</p>
<p>If the <a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion.invalidate" title="dogpile.cache.region.CacheRegion.invalidate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">invalidate()</span></code></a> method has been called, and
the retrieved value’s timestamp is older than the invalidation
timestamp, the value is unconditionally prevented from
being returned.  The method will attempt to acquire the dogpile
lock to generate a new value, or will wait
until the lock is released to return the new value.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.3.0: </span>The value is unconditionally regenerated if the creation
time is older than the last call to <a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion.invalidate" title="dogpile.cache.region.CacheRegion.invalidate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">invalidate()</span></code></a>.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="dogpile.cache.region.CacheRegion.get_or_create.params.key"></span><strong>key</strong><a class="paramlink headerlink reference internal" href="#dogpile.cache.region.CacheRegion.get_or_create.params.key">¶</a> – Key to be retrieved. While it’s typical for a key to be a
string, it is ultimately passed directly down to the cache backend,
before being optionally processed by the key_mangler function, so can
be of any type recognized by the backend or by the key_mangler
function, if present.</p></li>
<li><p><span class="target" id="dogpile.cache.region.CacheRegion.get_or_create.params.creator"></span><strong>creator</strong><a class="paramlink headerlink reference internal" href="#dogpile.cache.region.CacheRegion.get_or_create.params.creator">¶</a> – function which creates a new value.</p></li>
<li><p><span class="target" id="dogpile.cache.region.CacheRegion.get_or_create.params.creator_args"></span><strong>creator_args</strong><a class="paramlink headerlink reference internal" href="#dogpile.cache.region.CacheRegion.get_or_create.params.creator_args">¶</a> – <p>optional tuple of (args, kwargs) that will be
passed to the creator function if present.</p>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 0.7.0.</span></p>
</div>
</p></li>
<li><p><span class="target" id="dogpile.cache.region.CacheRegion.get_or_create.params.expiration_time"></span><strong>expiration_time</strong><a class="paramlink headerlink reference internal" href="#dogpile.cache.region.CacheRegion.get_or_create.params.expiration_time">¶</a> – <p>optional expiration time which will override
the expiration time already configured on this <a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion" title="dogpile.cache.region.CacheRegion"><code class="xref py py-class docutils literal notranslate"><span class="pre">CacheRegion</span></code></a>
if not None.   To set no expiration, use the value -1.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion.get_or_create.params.expiration_time" title="dogpile.cache.region.CacheRegion.get_or_create"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">CacheRegion.get_or_create.expiration_time</span></code></a>
argument is <strong>not persisted in the cache</strong> and is relevant
only to <strong>this specific cache retrieval operation</strong>, relative to
the creation time stored with the existing cached value.
Subsequent calls to <a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion.get_or_create" title="dogpile.cache.region.CacheRegion.get_or_create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CacheRegion.get_or_create()</span></code></a> are <strong>not</strong>
affected by this value.</p>
</div>
</p></li>
<li><p><span class="target" id="dogpile.cache.region.CacheRegion.get_or_create.params.should_cache_fn"></span><strong>should_cache_fn</strong><a class="paramlink headerlink reference internal" href="#dogpile.cache.region.CacheRegion.get_or_create.params.should_cache_fn">¶</a> – <p>optional callable function which will receive
the value returned by the “creator”, and will then return True or
False, indicating if the value should actually be cached or not.  If
it returns False, the value is still returned, but isn’t cached.
E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">dont_cache_none</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

<span class="n">value</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="s2">&quot;some key&quot;</span><span class="p">,</span>
                    <span class="n">create_value</span><span class="p">,</span>
                    <span class="n">should_cache_fn</span><span class="o">=</span><span class="n">dont_cache_none</span><span class="p">)</span>
</pre></div>
</div>
<p>Above, the function returns the value of create_value() if
the cache is invalid, however if the return value is None,
it won’t be cached.</p>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 0.4.3.</span></p>
</div>
</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion.get" title="dogpile.cache.region.CacheRegion.get"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CacheRegion.get()</span></code></a></p>
<p><a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion.cache_on_arguments" title="dogpile.cache.region.CacheRegion.cache_on_arguments"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CacheRegion.cache_on_arguments()</span></code></a> - applies
<a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion.get_or_create" title="dogpile.cache.region.CacheRegion.get_or_create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_or_create()</span></code></a> to any function using a decorator.</p>
<p><a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion.get_or_create_multi" title="dogpile.cache.region.CacheRegion.get_or_create_multi"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CacheRegion.get_or_create_multi()</span></code></a> - multiple key/value
version</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">CacheRegion.</span></span><span class="sig-name descname"><span class="pre">set</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span></dt>
<dd><p>Place a new value in the cache under the given key.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">CacheRegion.</span></span><span class="sig-name descname"><span class="pre">delete</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span></dt>
<dd><p>Remove a value from the cache.</p>
<p>This operation is idempotent (can be called multiple times, or on a
non-existent key, safely)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">CacheRegion.</span></span><span class="sig-name descname"><span class="pre">cache_on_arguments</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">namespace:</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None,</span> <span class="pre">expiration_time:</span> <span class="pre">float</span> <span class="pre">|</span> <span class="pre">~collections.abc.Callable[[],</span> <span class="pre">float</span> <span class="pre">|</span> <span class="pre">None]</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None,</span> <span class="pre">should_cache_fn:</span> <span class="pre">~collections.abc.Callable[[~typing.Any],</span> <span class="pre">bool]</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None,</span> <span class="pre">to_str:</span> <span class="pre">~collections.abc.Callable[[~typing.Any],</span> <span class="pre">str]</span> <span class="pre">=</span> <span class="pre">&lt;class</span> <span class="pre">'str'&gt;,</span> <span class="pre">function_key_generator:</span> <span class="pre">~collections.abc.Callable[[...],</span> <span class="pre">~collections.abc.Callable[[...],</span> <span class="pre">str]]</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span></dt>
<dd><p>A function decorator that will cache the return
value of the function using a key derived from the
function itself and its arguments.</p>
<p>The decorator internally makes use of the
<a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion.get_or_create" title="dogpile.cache.region.CacheRegion.get_or_create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CacheRegion.get_or_create()</span></code></a> method to access the
cache and conditionally call the function.  See that
method for additional behavioral details.</p>
<p>E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@someregion</span><span class="o">.</span><span class="n">cache_on_arguments</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">generate_something</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">somedatabase</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<p>The decorated function can then be called normally, where
data will be pulled from the cache region unless a new
value is needed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">generate_something</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
<p>The function is also given an attribute <code class="docutils literal notranslate"><span class="pre">invalidate()</span></code>, which
provides for invalidation of the value.  Pass to <code class="docutils literal notranslate"><span class="pre">invalidate()</span></code>
the same arguments you’d pass to the function itself to represent
a particular value:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">generate_something</span><span class="o">.</span><span class="n">invalidate</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
<p>Another attribute <code class="docutils literal notranslate"><span class="pre">set()</span></code> is added to provide extra caching
possibilities relative to the function.   This is a convenience
method for <a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion.set" title="dogpile.cache.region.CacheRegion.set"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CacheRegion.set()</span></code></a> which will store a given
value directly without calling the decorated function.
The value to be cached is passed as the first argument, and the
arguments which would normally be passed to the function
should follow:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">generate_something</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
<p>The above example is equivalent to calling
<code class="docutils literal notranslate"><span class="pre">generate_something(5,</span> <span class="pre">6)</span></code>, if the function were to produce
the value <code class="docutils literal notranslate"><span class="pre">3</span></code> as the value to be cached.</p>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 0.4.1: </span>Added <code class="docutils literal notranslate"><span class="pre">set()</span></code> method to decorated function.</p>
</div>
<p>Similar to <code class="docutils literal notranslate"><span class="pre">set()</span></code> is <code class="docutils literal notranslate"><span class="pre">refresh()</span></code>.   This attribute will
invoke the decorated function and populate a new value into
the cache with the new value, as well as returning that value:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">newvalue</span> <span class="o">=</span> <span class="n">generate_something</span><span class="o">.</span><span class="n">refresh</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 0.5.0: </span>Added <code class="docutils literal notranslate"><span class="pre">refresh()</span></code> method to decorated
function.</p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">original()</span></code> on other hand will invoke the decorated function
without any caching:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">newvalue</span> <span class="o">=</span> <span class="n">generate_something</span><span class="o">.</span><span class="n">original</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 0.6.0: </span>Added <code class="docutils literal notranslate"><span class="pre">original()</span></code> method to decorated
function.</p>
</div>
<p>Lastly, the <code class="docutils literal notranslate"><span class="pre">get()</span></code> method returns either the value cached
for the given key, or the token <code class="docutils literal notranslate"><span class="pre">NO_VALUE</span></code> if no such key
exists:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="o">=</span> <span class="n">generate_something</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 0.5.3: </span>Added <code class="docutils literal notranslate"><span class="pre">get()</span></code> method to decorated
function.</p>
</div>
<p>The default key generation will use the name
of the function, the module name for the function,
the arguments passed, as well as an optional “namespace”
parameter in order to generate a cache key.</p>
<p>Given a function <code class="docutils literal notranslate"><span class="pre">one</span></code> inside the module
<code class="docutils literal notranslate"><span class="pre">myapp.tools</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@region</span><span class="o">.</span><span class="n">cache_on_arguments</span><span class="p">(</span><span class="n">namespace</span><span class="o">=</span><span class="s2">&quot;foo&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">one</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
</pre></div>
</div>
<p>Above, calling <code class="docutils literal notranslate"><span class="pre">one(3,</span> <span class="pre">4)</span></code> will produce a
cache key as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">myapp</span><span class="o">.</span><span class="n">tools</span><span class="p">:</span><span class="n">one</span><span class="o">|</span><span class="n">foo</span><span class="o">|</span><span class="mi">3</span> <span class="mi">4</span>
</pre></div>
</div>
<p>The key generator will ignore an initial argument
of <code class="docutils literal notranslate"><span class="pre">self</span></code> or <code class="docutils literal notranslate"><span class="pre">cls</span></code>, making the decorator suitable
(with caveats) for use with instance or class methods.
Given the example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">MyClass</span><span class="p">:</span>
    <span class="nd">@region</span><span class="o">.</span><span class="n">cache_on_arguments</span><span class="p">(</span><span class="n">namespace</span><span class="o">=</span><span class="s2">&quot;foo&quot;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">one</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
</pre></div>
</div>
<p>The cache key above for <code class="docutils literal notranslate"><span class="pre">MyClass().one(3,</span> <span class="pre">4)</span></code> will
again produce the same cache key of <code class="docutils literal notranslate"><span class="pre">myapp.tools:one|foo|3</span> <span class="pre">4</span></code> -
the name <code class="docutils literal notranslate"><span class="pre">self</span></code> is skipped.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">namespace</span></code> parameter is optional, and is used
normally to disambiguate two functions of the same
name within the same module, as can occur when decorating
instance or class methods as below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">MyClass</span><span class="p">:</span>
    <span class="nd">@region</span><span class="o">.</span><span class="n">cache_on_arguments</span><span class="p">(</span><span class="n">namespace</span><span class="o">=</span><span class="s1">&#39;MC&#39;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">somemethod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="s2">&quot;&quot;</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MyOtherClass</span><span class="p">:</span>
    <span class="nd">@region</span><span class="o">.</span><span class="n">cache_on_arguments</span><span class="p">(</span><span class="n">namespace</span><span class="o">=</span><span class="s1">&#39;MOC&#39;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">somemethod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="s2">&quot;&quot;</span>
</pre></div>
</div>
<p>Above, the <code class="docutils literal notranslate"><span class="pre">namespace</span></code> parameter disambiguates
between <code class="docutils literal notranslate"><span class="pre">somemethod</span></code> on <code class="docutils literal notranslate"><span class="pre">MyClass</span></code> and <code class="docutils literal notranslate"><span class="pre">MyOtherClass</span></code>.
Python class declaration mechanics otherwise prevent
the decorator from having awareness of the <code class="docutils literal notranslate"><span class="pre">MyClass</span></code>
and <code class="docutils literal notranslate"><span class="pre">MyOtherClass</span></code> names, as the function is received
by the decorator before it becomes an instance method.</p>
<p>The function key generation can be entirely replaced
on a per-region basis using the <code class="docutils literal notranslate"><span class="pre">function_key_generator</span></code>
argument present on <a class="reference internal" href="api.html#dogpile.cache.region.make_region" title="dogpile.cache.region.make_region"><code class="xref py py-func docutils literal notranslate"><span class="pre">make_region()</span></code></a> and
<a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion" title="dogpile.cache.region.CacheRegion"><code class="xref py py-class docutils literal notranslate"><span class="pre">CacheRegion</span></code></a>. If defaults to
<a class="reference internal" href="api.html#dogpile.cache.util.function_key_generator" title="dogpile.cache.util.function_key_generator"><code class="xref py py-func docutils literal notranslate"><span class="pre">function_key_generator()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="dogpile.cache.region.CacheRegion.cache_on_arguments.params.namespace"></span><strong>namespace</strong><a class="paramlink headerlink reference internal" href="#dogpile.cache.region.CacheRegion.cache_on_arguments.params.namespace">¶</a> – optional string argument which will be
established as part of the cache key.   This may be needed
to disambiguate functions of the same name within the same
source file, such as those
associated with classes - note that the decorator itself
can’t see the parent class on a function as the class is
being declared.</p></li>
<li><p><span class="target" id="dogpile.cache.region.CacheRegion.cache_on_arguments.params.expiration_time"></span><strong>expiration_time</strong><a class="paramlink headerlink reference internal" href="#dogpile.cache.region.CacheRegion.cache_on_arguments.params.expiration_time">¶</a> – <p>if not None, will override the normal
expiration time.</p>
<p>May be specified as a callable, taking no arguments, that
returns a value to be used as the <code class="docutils literal notranslate"><span class="pre">expiration_time</span></code>. This callable
will be called whenever the decorated function itself is called, in
caching or retrieving. Thus, this can be used to
determine a <em>dynamic</em> expiration time for the cached function
result.  Example use cases include “cache the result until the
end of the day, week or time period” and “cache until a certain date
or time passes”.</p>
</p></li>
<li><p><span class="target" id="dogpile.cache.region.CacheRegion.cache_on_arguments.params.should_cache_fn"></span><strong>should_cache_fn</strong><a class="paramlink headerlink reference internal" href="#dogpile.cache.region.CacheRegion.cache_on_arguments.params.should_cache_fn">¶</a> – passed to <a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion.get_or_create" title="dogpile.cache.region.CacheRegion.get_or_create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CacheRegion.get_or_create()</span></code></a>.</p></li>
<li><p><span class="target" id="dogpile.cache.region.CacheRegion.cache_on_arguments.params.to_str"></span><strong>to_str</strong><a class="paramlink headerlink reference internal" href="#dogpile.cache.region.CacheRegion.cache_on_arguments.params.to_str">¶</a> – callable, will be called on each function argument
in order to convert to a string.  Defaults to <code class="docutils literal notranslate"><span class="pre">str()</span></code>.  If the
function accepts non-ascii unicode arguments on Python 2.x, the
<code class="docutils literal notranslate"><span class="pre">unicode()</span></code> builtin can be substituted, but note this will
produce unicode cache keys which may require key mangling before
reaching the cache.</p></li>
<li><p><span class="target" id="dogpile.cache.region.CacheRegion.cache_on_arguments.params.function_key_generator"></span><strong>function_key_generator</strong><a class="paramlink headerlink reference internal" href="#dogpile.cache.region.CacheRegion.cache_on_arguments.params.function_key_generator">¶</a> – a function that will produce a
“cache key”. This function will supersede the one configured on the
<a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion" title="dogpile.cache.region.CacheRegion"><code class="xref py py-class docutils literal notranslate"><span class="pre">CacheRegion</span></code></a> itself.</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion.cache_multi_on_arguments" title="dogpile.cache.region.CacheRegion.cache_multi_on_arguments"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CacheRegion.cache_multi_on_arguments()</span></code></a></p>
<p><a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion.get_or_create" title="dogpile.cache.region.CacheRegion.get_or_create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CacheRegion.get_or_create()</span></code></a></p>
</div>
</dd></dl>

</section>
<section id="creating-backends">
<span id="id1"></span><h2>Creating Backends<a class="headerlink" href="#creating-backends" title="Link to this heading">#</a></h2>
<p>Backends are located using the setuptools entrypoint system.  To make life easier
for writers of ad-hoc backends, a helper function is included which registers any
backend in the same way as if it were part of the existing sys.path.</p>
<p>For example, to create a backend called <code class="docutils literal notranslate"><span class="pre">DictionaryBackend</span></code>, we subclass
<a class="reference internal" href="api.html#dogpile.cache.api.CacheBackend" title="dogpile.cache.api.CacheBackend"><code class="xref py py-class docutils literal notranslate"><span class="pre">CacheBackend</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">dogpile.cache.api</span><span class="w"> </span><span class="kn">import</span> <span class="n">CacheBackend</span><span class="p">,</span> <span class="n">NO_VALUE</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DictionaryBackend</span><span class="p">(</span><span class="n">CacheBackend</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">NO_VALUE</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</pre></div>
</div>
<p>Then make sure the class is available underneath the entrypoint
<code class="docutils literal notranslate"><span class="pre">dogpile.cache</span></code>.  If we did this in a <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> file, it would be
in <code class="docutils literal notranslate"><span class="pre">setup()</span></code> as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">entry_points</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">  [dogpile.cache]</span>
<span class="s2">  dictionary = mypackage.mybackend:DictionaryBackend</span>
<span class="s2">  &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Alternatively, if we want to register the plugin in the same process
space without bothering to install anything, we can use <code class="docutils literal notranslate"><span class="pre">register_backend</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">dogpile.cache</span><span class="w"> </span><span class="kn">import</span> <span class="n">register_backend</span>

<span class="n">register_backend</span><span class="p">(</span><span class="s2">&quot;dictionary&quot;</span><span class="p">,</span> <span class="s2">&quot;mypackage.mybackend&quot;</span><span class="p">,</span> <span class="s2">&quot;DictionaryBackend&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Our new backend would be usable in a region like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">dogpile.cache</span><span class="w"> </span><span class="kn">import</span> <span class="n">make_region</span>

<span class="n">region</span> <span class="o">=</span> <span class="n">make_region</span><span class="p">(</span><span class="s2">&quot;myregion&quot;</span><span class="p">)</span>

<span class="n">region</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s2">&quot;dictionary&quot;</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;somekey&quot;</span><span class="p">,</span> <span class="s2">&quot;somevalue&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The values we receive for the backend here are instances of
<code class="docutils literal notranslate"><span class="pre">CachedValue</span></code>.  This is a tuple subclass of length two, of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
</pre></div>
</div>
<p>Where “payload” is the thing being cached, and “metadata” is information
we store in the cache - a dictionary which currently has just the “creation time”
and a “version identifier” as key/values.  If the cache backend requires serialization,
pickle or similar can be used on the tuple - the “metadata” portion will always
be a small and easily serializable Python structure.</p>
</section>
<section id="changing-backend-behavior">
<span id="id2"></span><h2>Changing Backend Behavior<a class="headerlink" href="#changing-backend-behavior" title="Link to this heading">#</a></h2>
<p>The <a class="reference internal" href="api.html#dogpile.cache.proxy.ProxyBackend" title="dogpile.cache.proxy.ProxyBackend"><code class="xref py py-class docutils literal notranslate"><span class="pre">ProxyBackend</span></code></a> is a decorator class provided to easily augment existing
backend behavior without having to extend the original class. Using a decorator
class is also adventageous as it allows us to share the altered behavior between
different backends.</p>
<p>Proxies are added to the <a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion" title="dogpile.cache.region.CacheRegion"><code class="xref py py-class docutils literal notranslate"><span class="pre">CacheRegion</span></code></a> object using the <a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion.configure" title="dogpile.cache.region.CacheRegion.configure"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CacheRegion.configure()</span></code></a>
method.  Only the overridden methods need to be specified and the real backend can
be accessed with the <code class="docutils literal notranslate"><span class="pre">self.proxied</span></code> object from inside the <a class="reference internal" href="api.html#dogpile.cache.proxy.ProxyBackend" title="dogpile.cache.proxy.ProxyBackend"><code class="xref py py-class docutils literal notranslate"><span class="pre">ProxyBackend</span></code></a>.</p>
<p>For example, a simple class to log all calls to <code class="docutils literal notranslate"><span class="pre">.set()</span></code> would look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">dogpile.cache.proxy</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProxyBackend</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">LoggingProxy</span><span class="p">(</span><span class="n">ProxyBackend</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Setting Cache Key: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proxied</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference internal" href="api.html#dogpile.cache.proxy.ProxyBackend" title="dogpile.cache.proxy.ProxyBackend"><code class="xref py py-class docutils literal notranslate"><span class="pre">ProxyBackend</span></code></a> can be be configured to optionally take arguments (as long as the
<code class="xref py py-meth docutils literal notranslate"><span class="pre">ProxyBackend.__init__()</span></code> method is called properly, either directly
or via <code class="docutils literal notranslate"><span class="pre">super()</span></code>.  In the example
below, the <code class="docutils literal notranslate"><span class="pre">RetryDeleteProxy</span></code> class accepts a <code class="docutils literal notranslate"><span class="pre">retry_count</span></code> parameter
on initialization.  In the event of an exception on delete(), it will retry
this many times before returning:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">dogpile.cache.proxy</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProxyBackend</span>

<span class="k">class</span><span class="w"> </span><span class="nc">RetryDeleteProxy</span><span class="p">(</span><span class="n">ProxyBackend</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">retry_count</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">RetryDeleteProxy</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">retry_count</span> <span class="o">=</span> <span class="n">retry_count</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="n">retries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">retry_count</span>
        <span class="k">while</span> <span class="n">retries</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">retries</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">proxied</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">wrap</span></code> parameter of the <a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion.configure" title="dogpile.cache.region.CacheRegion.configure"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CacheRegion.configure()</span></code></a> accepts a list
which can contain any combination of instantiated proxy objects
as well as uninstantiated proxy classes.
Putting the two examples above together would look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">dogpile.cache</span><span class="w"> </span><span class="kn">import</span> <span class="n">make_region</span>

<span class="n">retry_proxy</span> <span class="o">=</span> <span class="n">RetryDeleteProxy</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="n">region</span> <span class="o">=</span> <span class="n">make_region</span><span class="p">()</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
    <span class="s1">&#39;dogpile.cache.pylibmc&#39;</span><span class="p">,</span>
    <span class="n">expiration_time</span> <span class="o">=</span> <span class="mi">3600</span><span class="p">,</span>
    <span class="n">arguments</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;url&#39;</span><span class="p">:[</span><span class="s2">&quot;127.0.0.1&quot;</span><span class="p">],</span>
    <span class="p">},</span>
    <span class="n">wrap</span> <span class="o">=</span> <span class="p">[</span> <span class="n">LoggingProxy</span><span class="p">,</span> <span class="n">retry_proxy</span> <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>In the above example, the <code class="docutils literal notranslate"><span class="pre">LoggingProxy</span></code> object would be instantated by the
<a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion" title="dogpile.cache.region.CacheRegion"><code class="xref py py-class docutils literal notranslate"><span class="pre">CacheRegion</span></code></a> and applied to wrap requests on behalf of
the <code class="docutils literal notranslate"><span class="pre">retry_proxy</span></code> instance; that proxy in turn wraps
requests on behalf of the original dogpile.cache.pylibmc backend.</p>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 0.4.4: </span>Added support for the <a class="reference internal" href="api.html#dogpile.cache.proxy.ProxyBackend" title="dogpile.cache.proxy.ProxyBackend"><code class="xref py py-class docutils literal notranslate"><span class="pre">ProxyBackend</span></code></a> class.</p>
</div>
</section>
<section id="configuring-logging">
<h2>Configuring Logging<a class="headerlink" href="#configuring-logging" title="Link to this heading">#</a></h2>
<div class="versionadded">
<p><span class="versionmodified added">Added in version 0.9.0.</span></p>
</div>
<p><a class="reference internal" href="api.html#dogpile.cache.region.CacheRegion" title="dogpile.cache.region.CacheRegion"><code class="xref py py-class docutils literal notranslate"><span class="pre">CacheRegion</span></code></a> includes logging facilities that will emit debug log
messages when key cache events occur, including when keys are regenerated as
well as when hard invalidations occur.   Using the <a class="reference external" href="https://docs.python.org/3/library/logging.html">Python logging</a> module, set the log level to
<code class="docutils literal notranslate"><span class="pre">dogpile.cache</span></code> to <code class="docutils literal notranslate"><span class="pre">logging.DEBUG</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">()</span>
<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;dogpile.cache&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
</pre></div>
</div>
<p>Debug logging will indicate time spent regenerating keys as well as when
keys are missing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DEBUG</span><span class="p">:</span><span class="n">dogpile</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">region</span><span class="p">:</span><span class="n">No</span> <span class="n">value</span> <span class="n">present</span> <span class="k">for</span> <span class="n">key</span><span class="p">:</span> <span class="s1">&#39;__main__:load_user_info|2&#39;</span>
<span class="n">DEBUG</span><span class="p">:</span><span class="n">dogpile</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">region</span><span class="p">:</span><span class="n">No</span> <span class="n">value</span> <span class="n">present</span> <span class="k">for</span> <span class="n">key</span><span class="p">:</span> <span class="s1">&#39;__main__:load_user_info|1&#39;</span>
<span class="n">DEBUG</span><span class="p">:</span><span class="n">dogpile</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">region</span><span class="p">:</span><span class="n">Cache</span> <span class="n">value</span> <span class="n">generated</span> <span class="ow">in</span> <span class="mf">0.501</span> <span class="n">seconds</span> <span class="k">for</span> <span class="n">keys</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;__main__:load_user_info|2&#39;</span><span class="p">,</span> <span class="s1">&#39;__main__:load_user_info|3&#39;</span><span class="p">,</span> <span class="s1">&#39;__main__:load_user_info|4&#39;</span><span class="p">,</span> <span class="s1">&#39;__main__:load_user_info|5&#39;</span><span class="p">]</span>
<span class="n">DEBUG</span><span class="p">:</span><span class="n">dogpile</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">region</span><span class="p">:</span><span class="n">Hard</span> <span class="n">invalidation</span> <span class="n">detected</span> <span class="k">for</span> <span class="n">key</span><span class="p">:</span> <span class="s1">&#39;__main__:load_user_info|3&#39;</span>
<span class="n">DEBUG</span><span class="p">:</span><span class="n">dogpile</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">region</span><span class="p">:</span><span class="n">Hard</span> <span class="n">invalidation</span> <span class="n">detected</span> <span class="k">for</span> <span class="n">key</span><span class="p">:</span> <span class="s1">&#39;__main__:load_user_info|2&#39;</span>
</pre></div>
</div>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="front.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Front Matter</p>
      </div>
    </a>
    <a class="right-next"
       href="recipes.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Recipes</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rudimentary-usage">Rudimentary Usage</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#region-configuration">Region Configuration</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-a-region">Using a Region</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-backends">Creating Backends</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#changing-backend-behavior">Changing Backend Behavior</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configuring-logging">Configuring Logging</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Author name not set
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2011-2025 Mike Bayer.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>