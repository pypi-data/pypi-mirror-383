# Modern Python Project Configuration for Heterodyne Analysis
# =========================================================
# Revolutionary test suite configuration with latest pytest features,
# CI/CD integration, containerization support, and modern tooling ecosystem
# Last updated: v1.0.0 (2025-10-01)

[build-system]
requires = ["setuptools>=80.9.0", "setuptools-scm>=8.1.0", "wheel>=0.45.1"]
build-backend = "setuptools.build_meta"

[project]
name = "heterodyne-analysis"
dynamic = ["version"]
description = "High-performance Python package for analyzing heterodyne scattering in X-ray Photon Correlation Spectroscopy (XPCS) with 14-parameter two-component model, automatic migration from legacy configs, and comprehensive parameter validation (v1.0.0)"
readme = "README.md"
license = {file = "LICENSE"}
authors = [
    {name = "Wei Chen", email = "wchen@anl.gov"},
    {name = "Hongrui He"},
]
maintainers = [
    {name = "Wei Chen", email = "wchen@anl.gov"},
]
keywords = [
    "xpcs", "heterodyne", "scattering", "correlation", "spectroscopy",
    "scientific-computing", "physics", "materials-science"
]
classifiers = [
    "Development Status :: 5 - Production/Stable",
    "Intended Audience :: Science/Research",
    "License :: OSI Approved :: MIT License",
    "Operating System :: OS Independent",
    "Programming Language :: Python :: 3",
    "Programming Language :: Python :: 3.12",
    "Programming Language :: Python :: 3.13",
    "Programming Language :: Python :: 3.14",
    "Topic :: Scientific/Engineering :: Physics",
    "Topic :: Scientific/Engineering :: Information Analysis",
    "Typing :: Typed",
]
requires-python = ">=3.12"
dependencies = [
    "numpy>=2.3.3",
    "scipy>=1.16.2",
    "matplotlib>=3.10.6",
    "h5py>=3.14.0",
    "pydantic>=2.12.0",
    "typer>=0.19.2",
    "rich>=14.1.0",
    "typing-extensions>=4.12.0; python_version<'3.13'",
]

[project.optional-dependencies]
# Core optional dependencies
performance = [
    "numba>=0.62.1",
    "psutil>=7.1.0",
    "numexpr>=2.13.1",
    "bottleneck>=1.4.0",
    "threadpoolctl>=3.5.0",
    "py-cpuinfo>=9.0.0",
    "cachetools>=5.5.0",
    "joblib>=1.4.0",
]
robust = [
    "cvxpy>=1.7.3",
    "gurobipy>=12.0.3",
    "mosek>=10.2.0",
]
# GPU dependencies removed for CPU-only optimization
# Uncomment if GPU support is needed in the future
# gpu = [
#     "cupy>=12.0.0",
#     "jax[cpu]>=0.4.25",  # CPU-only JAX if needed
# ]

# Modern testing ecosystem with latest features
test = [
    # Core pytest framework with latest features
    "pytest>=8.4.2",
    "pytest-cov>=7.0.0",
    "pytest-xdist>=3.8.0",          # Parallel test execution
    "pytest-benchmark>=5.1.0",       # Performance benchmarking
    "pytest-timeout>=2.3.0",         # Test timeout handling
    "pytest-mock>=3.15.1",           # Advanced mocking
    "pytest-html>=4.1.1",            # Rich HTML reports
    "pytest-json-report>=1.5.0",     # JSON reports for CI
    "pytest-metadata>=3.1.0",        # Test metadata collection
    "pytest-randomly>=3.16.0",       # Randomized test execution
    "pytest-repeat>=0.9.3",          # Test repetition for reliability
    "pytest-picked>=0.5.0",          # Run tests based on git changes
    "pytest-clarity>=1.0.1",         # Better assertion diffs
    "pytest-sugar>=1.0.0",           # Better progress reporting
    "pytest-instafail>=0.5.0",       # Instant failure reporting

    # Advanced testing capabilities
    "hypothesis>=6.112.0",           # Property-based testing
    "faker>=30.0.0",                 # Realistic test data generation
    "factory-boy>=3.3.0",            # Test fixture factories
    "freezegun>=1.5.0",              # Time mocking
    "responses>=0.25.0",             # HTTP request mocking

    # Performance and monitoring
    "memory-profiler>=0.61.0",       # Memory usage profiling
    "py-spy>=0.3.14",                # Python profiler
    "scalene>=1.5.0",                # Advanced performance profiler

    # Notebook testing
    "nbval>=0.10.0",                 # Jupyter notebook validation
    "jupyter>=1.0.0",

    # Data validation
    "pydantic>=2.5.0",               # Data validation
]

# Modern code quality and linting ecosystem
quality = [
    "ruff>=0.13.3",                  # Fast Python linter and formatter
    "black>=25.9.0",                 # Code formatting (matches pre-commit)
    "isort>=6.1.0",                  # Import sorting (matches pre-commit)
    "mypy>=1.18.2",                  # Static type checking
    "bandit>=1.8.6",                 # Security linting
    "safety>=3.6.2",                 # Dependency vulnerability scanning
    "pip-audit>=2.7.0",              # Advanced security auditing
    "pre-commit>=4.0.0",             # Git hook management
    "vulture>=2.13",                 # Dead code detection
    "interrogate>=1.7.0",            # Documentation coverage
    "flake8>=7.3.0",                 # Traditional linting (matches pre-commit)
]

# Development dependencies
dev = [
    "heterodyne-analysis[test,docs,quality,performance]",
    "pre-commit>=3.5.0",
    "build>=1.0.0",
    "twine>=4.0.0",
    "pip-tools>=7.0.0",
    "tox>=4.11.0",                   # Multi-environment testing
    "nox>=2023.4.22",               # Modern task automation
]

# Documentation
docs = [
    "sphinx>=8.2.3",
    "sphinx-rtd-theme>=3.0.2",
    "sphinx-autodoc-typehints>=3.2.0",
    "myst-parser>=4.0.0",
    "sphinx-copybutton>=0.5.2",  # Max available version is 0.5.2
    "sphinx-design>=0.6.0",
    "sphinx-autoapi>=3.4.0",
    "numpydoc>=1.9.0",
    "sphinx-gallery>=0.18.0",
    "linkify-it-py>=2.0.0",  # Required for myst-parser linkify extension
]

# Complete development environment (CPU-only)
all = [
    "heterodyne-analysis[dev,test,docs,quality,performance,robust]",
]

# CPU-optimized performance stack
cpu_optimized = [
    "heterodyne-analysis[performance]",
    "cachetools>=5.3.0",
    "joblib>=1.3.0",
    "multiprocessing-logging>=0.3.4",
]

[project.urls]
Homepage = "https://github.com/imewei/heterodyne-analysis"
Documentation = "https://heterodyne-analysis.readthedocs.io"
Repository = "https://github.com/imewei/heterodyne-analysis"
Issues = "https://github.com/imewei/heterodyne-analysis/issues"
Changelog = "https://github.com/imewei/heterodyne-analysis/blob/main/CHANGELOG.md"

[project.scripts]
heterodyne = "heterodyne.cli.run_heterodyne:main"
heterodyne-config = "heterodyne.cli.create_config:main"

# =============================================================================
# Tool Configuration - Modern Python Toolchain
# =============================================================================

[tool.setuptools]
packages = ["heterodyne"]
include-package-data = true

[tool.setuptools.package-data]
heterodyne = [
    "config/*.json",
    "typings/*.pyi",
    "tests/data/*",
    "py.typed",
]

[tool.setuptools_scm]
write_to = "heterodyne/_version.py"
version_scheme = "post-release"
local_scheme = "dirty-tag"

# =============================================================================
# Modern Pytest Configuration - Revolutionary Testing Framework
# =============================================================================

[tool.pytest.ini_options]
minversion = "8.0"
testpaths = ["heterodyne/tests"]
python_files = ["test_*.py", "*_test.py"]
python_classes = ["Test*", "*Tests"]
python_functions = ["test_*"]

# Robust pytest configuration compatible with basic installations
addopts = [
    # Basic configuration and strictness
    "--strict-config",
    "--strict-markers",
    "--verbose",
    "--tb=short",
    "--durations=10",
    # "--maxfail=5",  # Removed to enable full test discovery
    "--continue-on-collection-errors",
]

# Additional coverage options (uncomment if pytest-cov is installed):
# "--cov=heterodyne",
# "--cov-report=term-missing:skip-covered",
# "--cov-report=html:reports/htmlcov",
# "--cov-report=xml:reports/coverage.xml",
# "--cov-fail-under=80",

# Comprehensive test markers for categorization
markers = [
    # Execution speed markers
    "slow: marks tests as slow (deselect with '-m \"not slow\"')",
    "fast: marks tests as fast",
    "smoke: marks tests as smoke tests for basic functionality",

    # Test type markers
    "unit: marks tests as unit tests",
    "integration: marks tests as integration tests",
    "e2e: marks tests as end-to-end tests",
    "regression: marks tests as regression tests",
    "flaky: marks tests as flaky (may fail intermittently)",

    # Feature area markers
    "performance: marks tests as performance benchmarks",
    "security: marks tests as security tests",
    "scientific: marks tests as scientific validation tests",
    "cli: marks tests as CLI tests",
    "api: marks tests as API tests",

    # Technology markers
    "gpu: marks tests that require GPU acceleration",
    "distributed: marks tests for distributed computing",
    "numba: marks tests that require Numba JIT compilation",
    "cvxpy: marks tests that require CVXPY optimization",

    # Quality markers
    "benchmark: marks tests as benchmarks",
    "critical: marks tests as critical path tests",
    "experimental: marks tests as experimental features",
    "deprecated: marks tests for deprecated functionality",

    # CI/CD markers
    "ci_only: marks tests that only run in CI environment",
    "local_only: marks tests that only run locally",
    "nightly: marks tests for nightly builds",

    # Parallel execution markers
    "serial: marks tests that must run serially (not in parallel)",
]

# Advanced filtering and warnings management
filterwarnings = [
    "error",
    "ignore::UserWarning",
    "ignore::DeprecationWarning",
    "ignore::PendingDeprecationWarning",
    "ignore::ImportWarning",
    "ignore::ResourceWarning",
    "ignore::RuntimeWarning:numba.*",
    "ignore::FutureWarning:scipy.*",
    "ignore::FutureWarning:numpy.*",
    "ignore::FutureWarning:pandas.*",
    "ignore::pytest.PytestUnraisableExceptionWarning",
]

# Advanced logging configuration
log_cli = true
log_cli_level = "INFO"
log_cli_format = "%(asctime)s [%(levelname)8s] %(name)s: %(message)s (%(filename)s:%(lineno)d)"
log_cli_date_format = "%Y-%m-%d %H:%M:%S"

log_file = "reports/pytest.log"
log_file_level = "DEBUG"
log_file_format = "%(asctime)s [%(levelname)8s] %(filename)s:%(lineno)d %(name)s: %(message)s"
log_file_date_format = "%Y-%m-%d %H:%M:%S"

# Performance and execution configuration (requires pytest-timeout plugin)
# timeout = 300
# timeout_method = "thread"

# Test collection and execution
norecursedirs = [
    ".*", "build", "dist", "*.egg", "venv", ".venv",
    "node_modules", "__pycache__", ".pytest_cache"
]

# =============================================================================
# Advanced Coverage Configuration
# =============================================================================

[tool.coverage.run]
source = ["heterodyne"]
parallel = true
branch = true
# context = "${CONTEXT}"  # Disabled: no contexts being measured
data_file = "reports/.coverage"
omit = [
    "*/tests/*",
    "*/test_*",
    "*/__pycache__/*",
    "*/setup.py",
    "*/conftest.py",
    "heterodyne/_version.py",
    "heterodyne/typings/*",
    "heterodyne/tests/data/*",
]

[tool.coverage.paths]
source = [
    "heterodyne/",
    "/workspace/heterodyne/",
    "C:\\*\\heterodyne\\",
]

[tool.coverage.report]
show_missing = true
skip_covered = false
skip_empty = true
sort = "cover"
precision = 2
exclude_lines = [
    "pragma: no cover",
    "def __repr__",
    "def __str__",
    "raise AssertionError",
    "raise NotImplementedError",
    "if __name__ == .__main__.:",
    "if TYPE_CHECKING:",
    "if 0:",
    "class .*\\bProtocol\\):",
    "@(abc\\.)?abstractmethod",
    "@overload",
    "\\.\\.\\.",
]

[tool.coverage.html]
directory = "reports/htmlcov"
# show_contexts = true  # Disabled: no contexts being measured
title = "Heterodyne Analysis Test Coverage Report"

[tool.coverage.xml]
output = "reports/coverage.xml"

[tool.coverage.json]
output = "reports/coverage.json"
# show_contexts = true  # Disabled: no contexts being measured

# =============================================================================
# Modern Code Quality Tools Configuration
# =============================================================================

[tool.ruff]
target-version = "py312"
line-length = 88
extend-exclude = [
    "__pycache__",
    ".git",
    ".mypy_cache",
    ".pytest_cache",
    ".ruff_cache",
    ".venv",
    "_build",
    "build",
    "dist",
    "venv",
    "reports",
]

[tool.ruff.lint]
select = [
    "E",    # pycodestyle errors
    "W",    # pycodestyle warnings
    "F",    # Pyflakes
    "I",    # isort
    "B",    # flake8-bugbear
    "C4",   # flake8-comprehensions
    "UP",   # pyupgrade
    "ARG",  # flake8-unused-arguments
    "SIM",  # flake8-simplify
    "TCH",  # flake8-type-checking
    "PTH",  # flake8-use-pathlib
    "ERA",  # eradicate
    "PL",   # Pylint
    "RUF",  # Ruff-specific rules
    "S",    # flake8-bandit
    "T20",  # flake8-print
    "PIE",  # flake8-pie (unnecessary code)
    "TID",  # flake8-tidy-imports
    "ICN",  # flake8-import-conventions
    "RET",  # flake8-return
    "SLF",  # flake8-self
    "Q",    # flake8-quotes
    "RSE",  # flake8-raise
    "FLY",  # flynt (string formatting)
    "PERF", # perflint (performance)
    "FURB", # refurb (code modernization)
    "LOG",  # flake8-logging
]
ignore = [
    "E501",    # line too long, handled by black
    "B008",    # do not perform function calls in argument defaults
    "B023",    # function definition does not bind loop variable
    "B904",    # raise from err (not always needed)
    "C901",    # too complex
    "PLR0913", # too many arguments
    "PLR0915", # too many statements
    "PLW0603", # global statement (singleton patterns)
    "RET505",  # unnecessary else after return (clarity)
    "RET503",  # missing explicit return (implicit None)
    "S101",    # use of assert for tests
    "S102",    # exec usage (trusted code in tests)
    "S103",    # os.chmod (trusted usage)
    "S108",    # hardcoded /tmp (tests)
    "S301",    # pickle usage (trusted data)
    "S306",    # mktemp usage (tests)
    "S324",    # md5 usage (non-security contexts)
    "S603",    # subprocess without shell=True (trusted)
    "S607",    # start process with partial path (trusted)
    "T201",    # print statements (allowed in CLI)
    "PLR0912", # too many branches
    "PLR0911", # too many return statements
    "PLR1722", # use sys.exit (stylistic)
    "SLF001",  # private member access (needed for internal testing)
    "PLC0415", # import outside top-level (intentional for lazy loading)
    "PTH113",  # os.path.isfile (compatibility)
    "PTH116",  # os.stat (compatibility)
    "PTH119",  # os.path.basename (compatibility)
    "PTH120",  # os.path.dirname (compatibility)
    "PTH123",  # use Path.open instead of builtin open (stylistic)
    "PTH202",  # os.path.getsize (compatibility)
    "PLR2004", # magic value comparison (scientific constants)
    "RUF002",  # ambiguous unicode in docstring (Greek letters intentional)
    "RUF003",  # ambiguous unicode in comment (Greek letters intentional)
    "RUF001",  # ambiguous unicode in string (Greek letters intentional)
    "RUF005",  # consider unpacking instead of concatenation (clarity)
    "TID252",  # relative imports (standard practice)
    "E731",    # lambda assignment (used in lazy loaders)
    "E402",    # module import not at top (conditional imports)
    "ERA001",  # commented out code (intentional for reference)
    "B028",    # no explicit stacklevel in warning
    "ARG002",  # unused method argument (API compatibility)
    "ARG001",  # unused function argument (API compatibility)
    "ARG004",  # unused static method argument (API compatibility)
    "ARG005",  # unused lambda argument (API compatibility)
    "RET504",  # unnecessary assignment before return (clarity)
    "SIM102",  # collapsible if (clarity over brevity)
    "SIM105",  # suppressible exception (explicit error handling)
    "SIM115",  # context manager for files (intentional for tests)
    "SIM118",  # in-dict-keys (clarity)
    "SIM401",  # use dict.get (clarity over brevity)
    "PERF401", # manual list comprehension (readability)
    "PERF102", # incorrect dict iterator (intentional)
    "PERF403", # manual dict update (readability)
    "S110",    # try-except-pass (intentional error suppression)
    "S112",    # try-except-continue (intentional error handling)
    "PTH118",  # os.path.join (compatibility)
    "PTH108",  # os.unlink (compatibility)
    "PTH110",  # os.path.exists (compatibility)
    "PTH103",  # os.makedirs (compatibility)
    "PTH101",  # os.chmod (compatibility)
    "PLW2901", # loop variable overwritten (intentional reassignment)
    "LOG015",  # root logger calls (tests and scripts)
    "B007",    # unused loop variable (intentional in some cases)
    "RUF059",  # unused unpacked variable (intentional)
    "SIM108",  # if-else-block (clarity over brevity)
    "SIM103",  # needless-bool (clarity)
    "SIM117",  # multiple-with (readability)
    "UP046",   # use type params (Python 3.12+ compatibility)
    "TC003",   # type checking block (runtime needed)
    "ICN001",  # import conventions (intentional local imports)
    "F401",    # unused import in try/except (availability check)
]

# Additional configuration for dead code prevention
[tool.ruff.lint.flake8-unused-arguments]
ignore-variadic-names = true


[tool.ruff.lint.pylint]
max-args = 12  # Allow up to 12 arguments for scientific functions
max-branches = 15  # Allow complex scientific logic
max-returns = 8   # Allow multiple return paths for error handling
max-statements = 60  # Allow longer functions for scientific computations

[tool.ruff.lint.mccabe]
max-complexity = 15  # Reasonable complexity for scientific code

[tool.ruff.lint.per-file-ignores]
"__init__.py" = ["F401", "F403", "F405", "E731"]  # Allow unused imports and lambda in lazy loaders
"tests/**/*" = ["PLR2004", "S101", "S311", "ARG001", "T201", "E722", "B007", "F841", "F821", "F811"]
"heterodyne/tests/**/*" = ["PLR2004", "S101", "S311", "ARG001", "T201", "E722", "B007", "F841", "F821", "F811"]
"**/test_*.py" = ["PLR2004", "S101", "S311", "ARG001", "T201", "E722", "B007", "F841", "F821", "F811"]
"docs/**/*" = ["S603", "S607", "S108", "PTH", "T201"]  # Deployment scripts need subprocess
"scripts/**/*" = ["S603", "S607", "S108", "PTH", "T201"]  # Deployment scripts need subprocess
"heterodyne/core/caching.py" = ["E722"]  # Intentional bare except for robustness
"heterodyne/core/result_memoization.py" = ["E722"]  # Intentional bare except for robustness
"heterodyne/statistics/chi_squared.py" = ["E722", "F401"]  # Bare except + unused scipy imports (optimized paths)
"heterodyne/core/cpu_optimization.py" = ["F821"]  # Conditional imports
"heterodyne/core/composition.py" = ["E731"]  # Lambda assignments for functional patterns
"heterodyne/core/kernels.py" = ["F811"]  # Numba fallback redefinitions
"heterodyne/analysis/core.py" = ["F811"]  # Function redefinition for compatibility layers
"heterodyne/optimization/blas_optimization.py" = ["F821"]  # Conditional imports
"heterodyne/validation/performance_validation.py" = ["F821", "F401"]  # Conditional imports, benchmarking
"heterodyne/performance/regression_prevention.py" = ["F401"]  # Unused imports for benchmarking
"heterodyne/performance/baseline.py" = ["RUF100"]  # Unused noqa directives (optional checks)
"heterodyne/data/xpcs_loader.py" = ["F841"]  # Unused variables in data loading (future use)
"heterodyne/_version.py" = ["RUF022", "UP035", "UP006", "UP007", "Q000"]  # Generated file, allow all style issues
"heterodyne/cli/visualization.py" = ["RUF100"]  # Unused noqa directives
"heterodyne/core/blas_kernels.py" = ["B018"]  # Useless expressions for documentation/reference
"heterodyne/core/lazy_imports.py" = ["PLW0602"]  # Global without assignment (read-only)
"heterodyne/core/mathematical_optimization.py" = ["E741"]  # Single-letter variable names (math notation)
"heterodyne/core/optimization_utils.py" = ["RUF100"]  # Unused noqa directives
"heterodyne/optimization/__init__.py" = ["PLE0605"]  # __all__ format (dynamic generation)
"heterodyne/tests/test_algorithm_optimization.py" = ["RUF034"]  # Useless if-else (intentional for testing)

[tool.ruff.lint.isort]
known-first-party = ["heterodyne"]
force-single-line = true

[tool.black]
target-version = ["py312", "py313"]
line-length = 88
extend-exclude = '''
/(
    \.git
  | \.mypy_cache
  | \.pytest_cache
  | \.ruff_cache
  | \.venv
  | _build
  | build
  | dist
  | venv
  | reports
)/
'''

[tool.isort]
profile = "black"
multi_line_output = 3
line_length = 88
known_first_party = ["heterodyne"]
force_single_line = true

[tool.mypy]
python_version = "3.12"
warn_return_any = true
warn_unused_configs = true
warn_redundant_casts = true
warn_unused_ignores = true
warn_no_return = true
warn_unreachable = true
strict_equality = true
disallow_untyped_defs = false  # Scientific code often has complex signatures
disallow_incomplete_defs = false
check_untyped_defs = true
disallow_untyped_decorators = false
no_implicit_optional = true
show_error_codes = true
show_column_numbers = true

[[tool.mypy.overrides]]
module = [
    "numba.*",
    "scipy.*",
    "matplotlib.*",
    "h5py.*",
    "cupy.*",
    "jax.*",
    "cvxpy.*",
    "gurobipy.*",
]
ignore_missing_imports = true

[tool.bandit]
exclude_dirs = ["tests", "test_*", "heterodyne/tests"]
# B101: assert_used (test assertions are intentional)
# B102: exec_used (used only for controlled import timing benchmarks)
# B103: set_bad_file_permissions (chmod 0o755 for executable scripts is intentional)
# B110: try_except_pass (used for graceful degradation in optional features)
# B112: try_except_continue (used for robust iteration over fallible operations)
# B301: pickle.loads (used for internal cache only, not untrusted data)
# B303: MD5 insecure hash (used for cache keys, not security)
# B324: hashlib (MD5 used for non-security cache keys only)
# B403: pickle import (used for internal caching only)
# B404: subprocess import (used for controlled test execution)
# B601: paramiko calls (not applicable)
# B603: subprocess_without_shell_equals_true (no shell=True, safe usage)
skips = ["B101", "B102", "B103", "B110", "B112", "B301", "B303", "B324", "B403", "B404", "B601", "B603"]

# =============================================================================
# Performance and Benchmarking Configuration
# =============================================================================

[tool.pytest.benchmark]
min_rounds = 5
max_time = 2.0
min_time = 0.000005
warmup = false
warmup_iterations = 100000
disable_gc = false
sort = "mean"
group_by = "func"
save = "reports/benchmarks/.benchmarks"
save_data = true
autosave = true
compare = "reports/benchmarks/.benchmarks/*"

# =============================================================================
# Modern Development Tools Configuration
# =============================================================================

[tool.pip-tools]
generate-hashes = true
allow-unsafe = true
upgrade = true
resolver = "backtracking"
strip-extras = true

[tool.vulture]
exclude = ["tests/", "build/", "dist/"]
ignore_decorators = ["@pytest.fixture", "@pytest.mark.*"]
min_confidence = 60

[tool.interrogate]
ignore-init-method = true
ignore-init-module = false
ignore-magic = false
ignore-semiprivate = false
ignore-private = false
ignore-property-decorators = false
ignore-module = false
ignore-nested-functions = false
ignore-nested-classes = true
ignore-setters = false
fail-under = 80
exclude = ["setup.py", "docs", "build", "tests"]
verbose = 0
quiet = false
whitelist-regex = []
color = true
omit-covered-files = false

# =============================================================================
# CI/CD and Build Configuration
# =============================================================================

[tool.tox]
legacy_tox_ini = """
[tox]
isolated_build = true
envlist = py{312,313}, coverage, docs, lint, security

[testenv]
deps =
    heterodyne-analysis[test]
commands =
    pytest heterodyne/tests {posargs}

[testenv:coverage]
deps =
    heterodyne-analysis[test]
commands =
    pytest --cov=heterodyne --cov-report=xml --cov-report=html

[testenv:docs]
deps =
    heterodyne-analysis[docs]
commands =
    sphinx-build -W -b html docs docs/_build/html

[testenv:lint]
deps =
    heterodyne-analysis[quality]
commands =
    ruff check heterodyne
    black --check heterodyne
    mypy heterodyne

[testenv:security]
deps =
    heterodyne-analysis[quality]
commands =
    bandit -r heterodyne
    safety check
    pip-audit
"""

[tool.cibuildwheel]
build = "cp312-* cp313-*"
skip = "*-win32 *-manylinux_i686"
test-command = "python -m pytest {project}/heterodyne/tests -x"
test-extras = ["test"]

[tool.cibuildwheel.linux]
before-all = "yum install -y gcc gcc-c++ make"

[tool.cibuildwheel.macos]
before-all = "brew install gcc"

[tool.cibuildwheel.windows]
before-all = "choco install mingw"
