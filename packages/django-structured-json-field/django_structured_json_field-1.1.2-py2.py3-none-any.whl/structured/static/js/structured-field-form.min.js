!function(){"use strict";function e(e){const t=JSON.parse(e.dataset.schema);console.log("🧱 schema",t),JSON.parse(e.dataset.uischema);const i=JSON.parse(e.dataset.formdata);console.log("🫐 formData",i);const s=document.getElementById(`id_${e.dataset.name}`),r=new JSONEditor(e,{schema:t,startval:i,max_depth:10,show_errors:"always"});r.on("change",(()=>{s.innerHTML=JSON.stringify(r.getValue())}))}document.addEventListener("DOMContentLoaded",(()=>{JSONEditor.defaults.options.theme="html",JSONEditor.defaults.options.iconlib="fontawesome5",window.JSONEditor.defaults.callbacks={select2:{createQueryParams:function(e,t){return{_q:t.term,page:t.page||1}},processResultData:function(e,t,i){return i.page=i.page||1,{results:t.items.map((e=>({id:btoa(JSON.stringify(e)),text:e.name}))),pagination:{more:t.more}}}}},window.JSONEditor.defaults.editors.select2=class extends window.JSONEditor.defaults.editors.select2{titleFieldsPriority=["__str__","name","title","label","id"];preBuild(){"relation"===this.schema.type&&(this.schema.enum=[]),super.preBuild()}forceAddOption(e,t){this.enum_values.includes(e)||(this.schema.enum.push(e),this.enum_values.push(e),this.enum_options.push(e),this.enum_display.push(t),this.theme.setSelectOptions(this.input,this.enum_options,this.enum_display))}isRelation(){return"relation"===this.schema.type}isManyRelation(e=[]){return this.isRelation()&&this.schema.multiple&&Array.isArray(e)}isClearable(e=null){return this.isRelation()&&this.schema.options.select2.allowClear&&null===e}isObject(e){return"object"==typeof e&&!Array.isArray(e)&&null!==e}isString(e){return"string"==typeof e}isArray(e){return Array.isArray(e)}isNumber(e){return"number"==typeof e||!isNaN(e)}isRelationObject(e){return this.isObject(e)&&e.id&&e.model}isB64Encoded(e){return this.isString(e)&&e.match(/^[a-zA-Z0-9-_]+={0,2}$/)}isJSONString(e){try{return this.isString(e)&&this.isObject(JSON.parse(e))}catch(e){return!1}}isb64RelationObject(e){if(this.isB64Encoded(e)){var t=atob(e);return this.isJSONString(t)&&this.isRelationObject(JSON.parse(t))}return!1}decodeB64Object(e){return this.isb64RelationObject(e)?JSON.parse(atob(e)):e}deserializeRelValue(e){return this.isManyRelation(e)?e&&e.map((e=>this.deserializeRelValue(e))):this.isRelationObject(e)?e:this.isJSONString(e)?JSON.parse(e):this.isb64RelationObject(e)?this.decodeB64Object(e):e}serializeRelValue(e){if(this.isManyRelation(e))return e.map((e=>this.serializeRelValue(e)));if(this.isRelationObject(e)){let t=e[this.titleFieldsPriority.find((t=>e[t]))],i=JSON.stringify(e);return this.forceAddOption(i,t),i}return this.isJSONString(e)?this.serializeRelValue(JSON.parse(e)):(this.isb64RelationObject(e),e)}typecast(e){if(this.isRelation()){if(this.isManyRelation(e))return e.map((e=>e&&this.serializeRelValue(e)));if(this.isClearable(e))return null}return super.typecast(e)}updateValue(e){return this.isRelation()?this.isClearable(e)?(this.value=null,this.value):(this.value=this.serializeRelValue(e),this.value):super.updateValue(e)}getValue(){return this.isRelation()?this.deserializeRelValue(this.value):super.getValue()}async setValue(e,t){if(this.isRelation())for(e=this.updateValue(e);!this.select2_instance;)await new Promise((e=>setTimeout(e,100)));return super.setValue(e,t)}afterInputReady(){super.afterInputReady(),this.isRelation()&&(this.newEnumAllowed=!0,this.control?.querySelector(".select2-container")?.removeAttribute("style"))}},window.JSONEditor.defaults.resolvers.unshift((function(e){if("relation"===e.type&&"select2"===e.format)return"select2"}));const t=document.querySelectorAll(".structured-field-editor");for(let i=0;i<t.length;i++)e(t[i])}))}();
