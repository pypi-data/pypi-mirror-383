(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,66027,e=>{"use strict";e.s(["useQuery",()=>es],66027);var t,s,i,a,r,n,l,o,h,u,d,c,p,f,_,v,b,g,w,m,y,k,S,x,C=e.i(39946),R=e.i(70292),E=e.i(62351),M=e.i(37696),O=e.i(88245),W=e.i(75555),j=e.i(40143),T=e.i(86491),Q=e.i(15823),F=e.i(93803),q=e.i(19273),D=e.i(80166),U=(t=new WeakMap,s=new WeakMap,i=new WeakMap,a=new WeakMap,r=new WeakMap,n=new WeakMap,l=new WeakMap,o=new WeakMap,h=new WeakMap,u=new WeakMap,d=new WeakMap,c=new WeakMap,p=new WeakMap,f=new WeakMap,_=new WeakMap,v=new WeakSet,b=new WeakSet,g=new WeakSet,w=new WeakSet,m=new WeakSet,y=new WeakSet,k=new WeakSet,S=new WeakSet,x=new WeakSet,class extends Q.Subscribable{bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){1===this.listeners.size&&((0,C._)(this,s).addObserver(this),N((0,C._)(this,s),this.options)?(0,M._)(this,v,L).call(this):this.updateResult(),(0,M._)(this,m,z).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return P((0,C._)(this,s),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return P((0,C._)(this,s),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,(0,M._)(this,y,V).call(this),(0,M._)(this,k,X).call(this),(0,C._)(this,s).removeObserver(this)}setOptions(e){let i=this.options,a=(0,C._)(this,s);if(this.options=(0,C._)(this,t).defaultQueryOptions(e),void 0!==this.options.enabled&&"boolean"!=typeof this.options.enabled&&"function"!=typeof this.options.enabled&&"boolean"!=typeof(0,q.resolveEnabled)(this.options.enabled,(0,C._)(this,s)))throw Error("Expected enabled to be a boolean or a callback that returns a boolean");(0,M._)(this,S,Y).call(this),(0,C._)(this,s).setOptions(this.options),i._defaulted&&!(0,q.shallowEqualObjects)(this.options,i)&&(0,C._)(this,t).getQueryCache().notify({type:"observerOptionsUpdated",query:(0,C._)(this,s),observer:this});let r=this.hasListeners();r&&I((0,C._)(this,s),a,this.options,i)&&(0,M._)(this,v,L).call(this),this.updateResult(),r&&((0,C._)(this,s)!==a||(0,q.resolveEnabled)(this.options.enabled,(0,C._)(this,s))!==(0,q.resolveEnabled)(i.enabled,(0,C._)(this,s))||(0,q.resolveStaleTime)(this.options.staleTime,(0,C._)(this,s))!==(0,q.resolveStaleTime)(i.staleTime,(0,C._)(this,s)))&&(0,M._)(this,b,K).call(this);let n=(0,M._)(this,g,H).call(this);r&&((0,C._)(this,s)!==a||(0,q.resolveEnabled)(this.options.enabled,(0,C._)(this,s))!==(0,q.resolveEnabled)(i.enabled,(0,C._)(this,s))||n!==(0,C._)(this,f))&&(0,M._)(this,w,B).call(this,n)}getOptimisticResult(e){var i,l;let o=(0,C._)(this,t).getQueryCache().build((0,C._)(this,t),e),h=this.createResult(o,e);return i=this,l=h,(0,q.shallowEqualObjects)(i.getCurrentResult(),l)||((0,E._)(this,a,h),(0,E._)(this,n,this.options),(0,E._)(this,r,(0,C._)(this,s).state)),h}getCurrentResult(){return(0,C._)(this,a)}trackResult(e,t){return new Proxy(e,{get:(e,s)=>(this.trackProp(s),null==t||t(s),"promise"!==s||this.options.experimental_prefetchInRender||"pending"!==(0,C._)(this,l).status||(0,C._)(this,l).reject(Error("experimental_prefetchInRender feature flag is not enabled")),Reflect.get(e,s))})}trackProp(e){(0,C._)(this,_).add(e)}getCurrentQuery(){return(0,C._)(this,s)}refetch(){let{...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.fetch({...e})}fetchOptimistic(e){let s=(0,C._)(this,t).defaultQueryOptions(e),i=(0,C._)(this,t).getQueryCache().build((0,C._)(this,t),s);return i.fetch().then(()=>this.createResult(i,s))}fetch(e){var t;return(0,M._)(this,v,L).call(this,{...e,cancelRefetch:null==(t=e.cancelRefetch)||t}).then(()=>(this.updateResult(),(0,C._)(this,a)))}createResult(e,t){let c,p=(0,C._)(this,s),f=this.options,_=(0,C._)(this,a),v=(0,C._)(this,r),b=(0,C._)(this,n),g=e!==p?e.state:(0,C._)(this,i),{state:w}=e,m={...w},y=!1;if(t._optimisticResults){let s=this.hasListeners(),i=!s&&N(e,t),a=s&&I(e,p,t,f);(i||a)&&(m={...m,...(0,T.fetchState)(w.data,e.options)}),"isRestoring"===t._optimisticResults&&(m.fetchStatus="idle")}let{error:k,errorUpdatedAt:S,status:x}=m;c=m.data;let R=!1;if(void 0!==t.placeholderData&&void 0===c&&"pending"===x){let e;if((null==_?void 0:_.isPlaceholderData)&&t.placeholderData===(null==b?void 0:b.placeholderData))e=_.data,R=!0;else{var M;e="function"==typeof t.placeholderData?t.placeholderData(null==(M=(0,C._)(this,d))?void 0:M.state.data,(0,C._)(this,d)):t.placeholderData}void 0!==e&&(x="success",c=(0,q.replaceData)(null==_?void 0:_.data,e,t),y=!0)}if(t.select&&void 0!==c&&!R)if(_&&c===(null==v?void 0:v.data)&&t.select===(0,C._)(this,h))c=(0,C._)(this,u);else try{(0,E._)(this,h,t.select),c=t.select(c),c=(0,q.replaceData)(null==_?void 0:_.data,c,t),(0,E._)(this,u,c),(0,E._)(this,o,null)}catch(e){(0,E._)(this,o,e)}(0,C._)(this,o)&&(k=(0,C._)(this,o),c=(0,C._)(this,u),S=Date.now(),x="error");let O="fetching"===m.fetchStatus,W="pending"===x,j="error"===x,Q=W&&O,D=void 0!==c,U={status:x,fetchStatus:m.fetchStatus,isPending:W,isSuccess:"success"===x,isError:j,isInitialLoading:Q,isLoading:Q,data:c,dataUpdatedAt:m.dataUpdatedAt,error:k,errorUpdatedAt:S,failureCount:m.fetchFailureCount,failureReason:m.fetchFailureReason,errorUpdateCount:m.errorUpdateCount,isFetched:m.dataUpdateCount>0||m.errorUpdateCount>0,isFetchedAfterMount:m.dataUpdateCount>g.dataUpdateCount||m.errorUpdateCount>g.errorUpdateCount,isFetching:O,isRefetching:O&&!W,isLoadingError:j&&!D,isPaused:"paused"===m.fetchStatus,isPlaceholderData:y,isRefetchError:j&&D,isStale:A(e,t),refetch:this.refetch,promise:(0,C._)(this,l),isEnabled:!1!==(0,q.resolveEnabled)(t.enabled,e)};if(this.options.experimental_prefetchInRender){let t=e=>{"error"===U.status?e.reject(U.error):void 0!==U.data&&e.resolve(U.data)},s=()=>{t((0,E._)(this,l,U.promise=(0,F.pendingThenable)()))},i=(0,C._)(this,l);switch(i.status){case"pending":e.queryHash===p.queryHash&&t(i);break;case"fulfilled":("error"===U.status||U.data!==i.value)&&s();break;case"rejected":("error"!==U.status||U.error!==i.reason)&&s()}}return U}updateResult(){let e=(0,C._)(this,a),t=this.createResult((0,C._)(this,s),this.options);if((0,E._)(this,r,(0,C._)(this,s).state),(0,E._)(this,n,this.options),void 0!==(0,C._)(this,r).data&&(0,E._)(this,d,(0,C._)(this,s)),(0,q.shallowEqualObjects)(t,e))return;(0,E._)(this,a,t);let i=()=>{if(!e)return!0;let{notifyOnChangeProps:t}=this.options,s="function"==typeof t?t():t;if("all"===s||!s&&!(0,C._)(this,_).size)return!0;let i=new Set(null!=s?s:(0,C._)(this,_));return this.options.throwOnError&&i.add("error"),Object.keys((0,C._)(this,a)).some(t=>(0,C._)(this,a)[t]!==e[t]&&i.has(t))};(0,M._)(this,x,G).call(this,{listeners:i()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&(0,M._)(this,m,z).call(this)}constructor(e,C){super(),(0,O._)(this,v),(0,O._)(this,b),(0,O._)(this,g),(0,O._)(this,w),(0,O._)(this,m),(0,O._)(this,y),(0,O._)(this,k),(0,O._)(this,S),(0,O._)(this,x),(0,R._)(this,t,{writable:!0,value:void 0}),(0,R._)(this,s,{writable:!0,value:void 0}),(0,R._)(this,i,{writable:!0,value:void 0}),(0,R._)(this,a,{writable:!0,value:void 0}),(0,R._)(this,r,{writable:!0,value:void 0}),(0,R._)(this,n,{writable:!0,value:void 0}),(0,R._)(this,l,{writable:!0,value:void 0}),(0,R._)(this,o,{writable:!0,value:void 0}),(0,R._)(this,h,{writable:!0,value:void 0}),(0,R._)(this,u,{writable:!0,value:void 0}),(0,R._)(this,d,{writable:!0,value:void 0}),(0,R._)(this,c,{writable:!0,value:void 0}),(0,R._)(this,p,{writable:!0,value:void 0}),(0,R._)(this,f,{writable:!0,value:void 0}),(0,R._)(this,_,{writable:!0,value:new Set}),this.options=C,(0,E._)(this,t,e),(0,E._)(this,o,null),(0,E._)(this,l,(0,F.pendingThenable)()),this.bindMethods(),this.setOptions(C)}});function N(e,t){return!1!==(0,q.resolveEnabled)(t.enabled,e)&&void 0===e.state.data&&("error"!==e.state.status||!1!==t.retryOnMount)||void 0!==e.state.data&&P(e,t,t.refetchOnMount)}function P(e,t,s){if(!1!==(0,q.resolveEnabled)(t.enabled,e)&&"static"!==(0,q.resolveStaleTime)(t.staleTime,e)){let i="function"==typeof s?s(e):s;return"always"===i||!1!==i&&A(e,t)}return!1}function I(e,t,s,i){return(e!==t||!1===(0,q.resolveEnabled)(i.enabled,e))&&(!s.suspense||"error"!==e.state.status)&&A(e,s)}function A(e,t){return!1!==(0,q.resolveEnabled)(t.enabled,e)&&e.isStaleByTime((0,q.resolveStaleTime)(t.staleTime,e))}function L(e){(0,M._)(this,S,Y).call(this);let t=(0,C._)(this,s).fetch(this.options,e);return(null==e?void 0:e.throwOnError)||(t=t.catch(q.noop)),t}function K(){(0,M._)(this,y,V).call(this);let e=(0,q.resolveStaleTime)(this.options.staleTime,(0,C._)(this,s));if(q.isServer||(0,C._)(this,a).isStale||!(0,q.isValidTimeout)(e))return;let t=(0,q.timeUntilStale)((0,C._)(this,a).dataUpdatedAt,e);(0,E._)(this,c,D.timeoutManager.setTimeout(()=>{(0,C._)(this,a).isStale||this.updateResult()},t+1))}function H(){var e;return null!=(e="function"==typeof this.options.refetchInterval?this.options.refetchInterval((0,C._)(this,s)):this.options.refetchInterval)&&e}function B(e){(0,M._)(this,k,X).call(this),(0,E._)(this,f,e),!q.isServer&&!1!==(0,q.resolveEnabled)(this.options.enabled,(0,C._)(this,s))&&(0,q.isValidTimeout)((0,C._)(this,f))&&0!==(0,C._)(this,f)&&(0,E._)(this,p,D.timeoutManager.setInterval(()=>{(this.options.refetchIntervalInBackground||W.focusManager.isFocused())&&(0,M._)(this,v,L).call(this)},(0,C._)(this,f)))}function z(){(0,M._)(this,b,K).call(this),(0,M._)(this,w,B).call(this,(0,M._)(this,g,H).call(this))}function V(){(0,C._)(this,c)&&(D.timeoutManager.clearTimeout((0,C._)(this,c)),(0,E._)(this,c,void 0))}function X(){(0,C._)(this,p)&&(D.timeoutManager.clearInterval((0,C._)(this,p)),(0,E._)(this,p,void 0))}function Y(){let e=(0,C._)(this,t).getQueryCache().build((0,C._)(this,t),this.options);if(e===(0,C._)(this,s))return;let a=(0,C._)(this,s);(0,E._)(this,s,e),(0,E._)(this,i,e.state),this.hasListeners()&&(null==a||a.removeObserver(this),e.addObserver(this))}function G(e){j.notifyManager.batch(()=>{e.listeners&&this.listeners.forEach(e=>{e((0,C._)(this,a))}),(0,C._)(this,t).getQueryCache().notify({query:(0,C._)(this,s),type:"observerResultsUpdated"})})}e.i(47167);var J=e.i(71645),Z=e.i(12598);e.i(18050);var $=J.createContext(function(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}()),ee=J.createContext(!1);ee.Provider;var et=(e,t,s)=>t.fetchOptimistic(e).catch(()=>{s.clearReset()});function es(e,t){return function(e,t,s){var i,a,r,n,l;let o=J.useContext(ee),h=J.useContext($),u=(0,Z.useQueryClient)(s),d=u.defaultQueryOptions(e);if(null==(a=u.getDefaultOptions().queries)||null==(i=a._experimental_beforeQuery)||i.call(a,d),d._optimisticResults=o?"isRestoring":"optimistic",d.suspense){let e=e=>"static"===e?e:Math.max(null!=e?e:1e3,1e3),t=d.staleTime;d.staleTime="function"==typeof t?function(){for(var s=arguments.length,i=Array(s),a=0;a<s;a++)i[a]=arguments[a];return e(t(...i))}:e(t),"number"==typeof d.gcTime&&(d.gcTime=Math.max(d.gcTime,1e3))}(d.suspense||d.throwOnError||d.experimental_prefetchInRender)&&!h.isReset()&&(d.retryOnMount=!1),J.useEffect(()=>{h.clearReset()},[h]);let c=!u.getQueryCache().get(d.queryHash),[p]=J.useState(()=>new t(u,d)),f=p.getOptimisticResult(d),_=!o&&!1!==e.subscribed;if(J.useSyncExternalStore(J.useCallback(e=>{let t=_?p.subscribe(j.notifyManager.batchCalls(e)):q.noop;return p.updateResult(),t},[p,_]),()=>p.getCurrentResult(),()=>p.getCurrentResult()),J.useEffect(()=>{p.setOptions(d)},[d,p]),(null==d?void 0:d.suspense)&&f.isPending)throw et(d,p,h);if((e=>{let{result:t,errorResetBoundary:s,throwOnError:i,query:a,suspense:r}=e;return t.isError&&!s.isReset()&&!t.isFetching&&a&&(r&&void 0===t.data||(0,q.shouldThrowError)(i,[t.error,a]))})({result:f,errorResetBoundary:h,throwOnError:d.throwOnError,query:u.getQueryCache().get(d.queryHash),suspense:d.suspense}))throw f.error;if(null==(n=u.getDefaultOptions().queries)||null==(r=n._experimental_afterQuery)||r.call(n,d,f),d.experimental_prefetchInRender&&!q.isServer&&f.isLoading&&f.isFetching&&!o){let e=c?et(d,p,h):null==(l=u.getQueryCache().get(d.queryHash))?void 0:l.promise;null==e||e.catch(q.noop).finally(()=>{p.updateResult()})}return d.notifyOnChangeProps?f:p.trackResult(f)}(e,U,t)}},54616,e=>{"use strict";e.s(["useMutation",()=>y],54616);var t,s,i,a,r,n,l=e.i(71645),o=e.i(39946),h=e.i(70292),u=e.i(62351),d=e.i(37696),c=e.i(88245),p=e.i(14272),f=e.i(40143),_=e.i(15823),v=e.i(19273),b=(t=new WeakMap,s=new WeakMap,i=new WeakMap,a=new WeakMap,r=new WeakSet,n=new WeakSet,class extends _.Subscribable{bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){var s;let a=this.options;this.options=(0,o._)(this,t).defaultMutationOptions(e),(0,v.shallowEqualObjects)(this.options,a)||(0,o._)(this,t).getMutationCache().notify({type:"observerOptionsUpdated",mutation:(0,o._)(this,i),observer:this}),(null==a?void 0:a.mutationKey)&&this.options.mutationKey&&(0,v.hashKey)(a.mutationKey)!==(0,v.hashKey)(this.options.mutationKey)?this.reset():(null==(s=(0,o._)(this,i))?void 0:s.state.status)==="pending"&&(0,o._)(this,i).setOptions(this.options)}onUnsubscribe(){if(!this.hasListeners()){var e;null==(e=(0,o._)(this,i))||e.removeObserver(this)}}onMutationUpdate(e){(0,d._)(this,r,g).call(this),(0,d._)(this,n,w).call(this,e)}getCurrentResult(){return(0,o._)(this,s)}reset(){var e;null==(e=(0,o._)(this,i))||e.removeObserver(this),(0,u._)(this,i,void 0),(0,d._)(this,r,g).call(this),(0,d._)(this,n,w).call(this)}mutate(e,s){var r;return(0,u._)(this,a,s),null==(r=(0,o._)(this,i))||r.removeObserver(this),(0,u._)(this,i,(0,o._)(this,t).getMutationCache().build((0,o._)(this,t),this.options)),(0,o._)(this,i).addObserver(this),(0,o._)(this,i).execute(e)}constructor(e,l){super(),(0,c._)(this,r),(0,c._)(this,n),(0,h._)(this,t,{writable:!0,value:void 0}),(0,h._)(this,s,{writable:!0,value:void 0}),(0,h._)(this,i,{writable:!0,value:void 0}),(0,h._)(this,a,{writable:!0,value:void 0}),(0,u._)(this,t,e),this.setOptions(l),this.bindMethods(),(0,d._)(this,r,g).call(this)}});function g(){var e,t;let a=null!=(t=null==(e=(0,o._)(this,i))?void 0:e.state)?t:(0,p.getDefaultState)();(0,u._)(this,s,{...a,isPending:"pending"===a.status,isSuccess:"success"===a.status,isError:"error"===a.status,isIdle:"idle"===a.status,mutate:this.mutate,reset:this.reset})}function w(e){f.notifyManager.batch(()=>{if((0,o._)(this,a)&&this.hasListeners()){var t,i,r,n,l,h,u,d;let c=(0,o._)(this,s).variables,p=(0,o._)(this,s).context;(null==e?void 0:e.type)==="success"?(null==(t=(i=(0,o._)(this,a)).onSuccess)||t.call(i,e.data,c,p),null==(r=(n=(0,o._)(this,a)).onSettled)||r.call(n,e.data,null,c,p)):(null==e?void 0:e.type)==="error"&&(null==(l=(h=(0,o._)(this,a)).onError)||l.call(h,e.error,c,p),null==(u=(d=(0,o._)(this,a)).onSettled)||u.call(d,void 0,e.error,c,p))}this.listeners.forEach(e=>{e((0,o._)(this,s))})})}var m=e.i(12598);function y(e,t){let s=(0,m.useQueryClient)(t),[i]=l.useState(()=>new b(s,e));l.useEffect(()=>{i.setOptions(e)},[i,e]);let a=l.useSyncExternalStore(l.useCallback(e=>i.subscribe(f.notifyManager.batchCalls(e)),[i]),()=>i.getCurrentResult(),()=>i.getCurrentResult()),r=l.useCallback((e,t)=>{i.mutate(e,t).catch(v.noop)},[i]);if(a.error&&(0,v.shouldThrowError)(i.options.throwOnError,[a.error]))throw a.error;return{...a,mutate:r,mutateAsync:a.mutate}}},95238,e=>{"use strict";e.s(["default",()=>S]);var t=e.i(18050),s=e.i(71645),i=e.i(66027),a=e.i(54616),r=e.i(12598),n=e.i(54548),l=e.i(30590),o=e.i(46696),h=e.i(20892);e.i(84628);var u=e.i(69906),d=e.i(31404),c=e.i(71948),p=e.i(50181),f=e.i(74366),_=e.i(41452),v=e.i(3605),b=e.i(72772),g=e.i(51251),w=e.i(89427),m=e.i(24448),y=e.i(89995),k=e.i(99203);function S(){let e=(0,r.useQueryClient)(),[S,x]=(0,s.useState)(null),C=(0,s.useRef)(null),[R,E]=(0,s.useState)(null),[M,O]=(0,s.useState)([]),[W,j]=(0,s.useState)([]),T=(0,i.useQuery)({queryKey:["workflows"],queryFn:async()=>{var e;return null!=(e=await (0,h.getWorkflows)())?e:[]}}),Q=(0,i.useQuery)({queryKey:["assistants"],queryFn:async()=>{var e;return null!=(e=await (0,h.getAssistantsConfig)())?e:[]}}),F=T.data||[],q=Q.data||[];(0,s.useEffect)(()=>{if(S){var e,t;let s=structuredClone(null!=(e=S.nodes)?e:[]),i=!1,a=s.map(e=>{var t,s;return"start"===e.type||(null==(t=e.data)?void 0:t.isStart)?(i=!0,{...e,type:"assistant",data:{...e.data||{},isStart:!0}}):{...e,type:"assistant",data:{...e.data||{},isStart:(null==(s=e.data)?void 0:s.isStart)===!0}}});!i&&a.length>0&&(a[0].data.isStart=!0),O(a),j(structuredClone(null!=(t=S.edges)?t:[]))}else O([]),j([])},[S]);let D=(0,a.useMutation)({mutationFn:e=>{let{name:t,description:s}=e;return(0,h.createWorkflow)(t,s)},onSuccess:t=>{o.toast.success("Workflow created"),e.invalidateQueries({queryKey:["workflows"]}),x(t)},onError:e=>o.toast.error("Failed to create workflow: ".concat(e.message))}),U=(0,a.useMutation)({mutationFn:h.saveWorkflow,onSuccess:()=>{o.toast.success("Workflow saved"),e.invalidateQueries({queryKey:["workflows"]})},onError:e=>o.toast.error("Failed to save workflow: ".concat(e.message))}),N=(0,s.useCallback)(e=>{O(t=>{if(t.some(t=>t.id===e.id))return o.toast.warning("Assistant is already in the workflow."),t;let s=0===t.length;return[...t,{...e,type:"assistant",data:{...e.data||{},isStart:s}}]})},[]),P=(0,s.useCallback)(e=>{O(t=>t.some(t=>t.id===e)?t.map(t=>({...t,data:{...t.data||{},isStart:t.id===e}})):t)},[]),I=(0,s.useCallback)((e,t)=>{e.preventDefault(),E({id:t.id,x:e.clientX,y:e.clientY})},[]),A=e=>{var t;let s=M.find(t=>t.id===e);if(null==s||null==(t=s.data)?void 0:t.isStart){o.toast.warning("The Start node cannot be deleted."),E(null);return}O(t=>t.filter(t=>t.id!==e)),j(t=>t.filter(t=>t.source!==e&&t.target!==e)),E(null)},L=(0,s.useCallback)(()=>E(null),[]),K=(0,a.useMutation)({mutationFn:h.deleteWorkflow,onSuccess:()=>{o.toast.success("Workflow deleted"),e.invalidateQueries({queryKey:["workflows"]}),x(null)},onError:e=>o.toast.error("Failed to delete workflow: ".concat(e.message))}),H=(0,s.useCallback)(e=>{if(e.filter(e=>{var t,s;return"remove"===e.type&&(null==(s=M.find(t=>t.id===e.id))||null==(t=s.data)?void 0:t.isStart)}).length>0)return void o.toast.warning("The Start node cannot be deleted.");O(t=>(0,n.applyNodeChanges)(e,t))},[M]),B=(0,s.useCallback)(e=>{console.log("onEdgesChange triggered. Changes:",e),j(t=>{console.log("Edges before applying changes:",t);let s=(0,n.applyEdgeChanges)(e,t);return console.log("Edges after applying changes:",s),s})},[j]),z=(0,s.useCallback)(e=>{let{source:t,target:s}=e;t&&s&&t!==s&&j(i=>{var a,r;let n=i.find(e=>e.source===t&&e.target===s||e.source===s&&e.target===t);if(!n){let a={id:"e-".concat(t,"->").concat(s),source:t,target:s,sourceHandle:e.sourceHandle,targetHandle:e.targetHandle,type:"directional",data:{mode:"single"}};return(0,l.addEdge)(a,i)}return n.source===t&&n.target===s?((null==(r=n.data)?void 0:r.mode)==="bidirectional"?o.toast.warning("This pair is already bidirectional."):o.toast.warning("A connection in this direction already exists."),i):(null==(a=n.data)?void 0:a.mode)!=="bidirectional"?i.map(e=>e.id===n.id?{...e,data:{...e.data||{},mode:"bidirectional"}}:e):i})},[M,W]),V=(0,s.useMemo)(()=>{let e=new Set(M.map(e=>{var t;return null==(t=e.data)?void 0:t.assistantId}).filter(Boolean));return q.filter(t=>!e.has(t.id))},[q,M]),X=(0,s.useMemo)(()=>{var e;if(!R)return[];let t=M.find(e=>e.id===R.id),s=null==t||null==(e=t.data)?void 0:e.isStart;return[{key:"set-start",label:s?"Already Start Node":"Set as Start Node",disabled:!!s,onClick:e=>P(e)},{key:"delete",label:"Delete Node",danger:!0,disabled:s,onClick:A}]},[R,M,P]);return T.isLoading||Q.isLoading?(0,t.jsx)(f.LoadingSkeleton,{lines:5}):T.error||Q.error?(0,t.jsx)("div",{className:"text-red-600",children:"Failed to load data."}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(c.Header,{children:[(0,t.jsx)(v.Search,{}),(0,t.jsxs)("div",{className:"ms-auto flex items-center gap-4",children:[(0,t.jsx)(b.ThemeSwitch,{}),(0,t.jsx)(u.ConfigDrawer,{}),(0,t.jsx)(_.ProfileDropdown,{})]})]}),(0,t.jsx)(p.Main,{children:(0,t.jsxs)(n.ReactFlowProvider,{children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold tracking-tight",children:"Workflows"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Design and manage task handoff workflows between assistants"})]}),(0,t.jsxs)("div",{className:"mt-4 flex min-h-0 w-full flex-1 gap-8 px-4 md:px-8",children:[(0,t.jsxs)("aside",{className:"flex w-full max-w-3xs flex-shrink-0 flex-col gap-6",children:[(0,t.jsx)(m.NewWorkflowDialog,{onCreateWorkflow:D.mutate}),(0,t.jsx)(k.WorkflowList,{workflows:F,selectedWorkflow:S,onSelect:x,onDelete:K.mutate}),(0,t.jsx)(g.AssistantsPalette,{assistants:V})]}),(0,t.jsx)("main",{className:"min-h-0 flex-1",children:S?(0,t.jsxs)("div",{className:"flex h-full flex-col gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl font-semibold",children:S.name}),S.description&&(0,t.jsx)("p",{className:"text-muted-foreground",children:S.description})]}),(0,t.jsx)("div",{ref:C,className:"min-h-0 flex-1",children:(0,t.jsx)(y.WorkflowEditor,{nodes:M,edges:W,onNodesChange:H,onEdgesChange:B,onConnect:z,onNodeAdd:N,onSave:()=>{S&&U.mutate({...S,nodes:M,edges:W})},isSaving:U.isPending,onPaneClick:L,onNodeContextMenu:I},S.id)})]}):(0,t.jsx)(d.EmptyState,{title:"No workflow selected",description:"Select a workflow from the list or create a new one to start designing"})})]}),R&&(0,t.jsx)(w.ContextMenu,{anchor:R,onDelete:A,onClose:()=>E(null),items:X})]})})]})}}]);