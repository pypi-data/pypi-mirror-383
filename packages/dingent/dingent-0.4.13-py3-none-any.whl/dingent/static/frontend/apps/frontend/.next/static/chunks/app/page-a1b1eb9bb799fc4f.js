(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{57279:(e,t,r)=>{Promise.resolve().then(r.bind(r,64126))},64126:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>g});var n=r(95155),l=r(37440),a=r(12115),i=r(88244),s=r(56234);function o(){let{threads:e,activeThreadId:t,setActiveThreadId:r,deleteAllThreads:l}=(0,i.xH)();return(0,n.jsxs)("div",{className:"flex flex-col h-screen w-64 bg-indigo-800 text-white p-4",children:[(0,n.jsx)("div",{className:"mb-4",children:(0,n.jsx)("button",{onClick:()=>{r((0,s.A)())},className:"w-full px-4 py-2 border border-white/50 rounded-md hover:bg-indigo-700 transition-colors duration-200",children:"+ New Chat"})}),(0,n.jsxs)("div",{className:"flex-grow overflow-y-auto",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold mb-2 px-2",children:"History"}),(0,n.jsx)("ul",{className:"space-y-1",children:e.map(e=>(0,n.jsx)("li",{children:(0,n.jsxs)("button",{onClick:()=>r(e.id),className:"w-full text-left px-3 py-2 rounded-md truncate text-sm transition-colors duration-200 ".concat(e.id===t?"bg-indigo-600 font-semibold":"hover:bg-indigo-700/50"),children:[e.title," "]})},e.id))})]}),(0,n.jsx)("button",{onClick:()=>{window.confirm("Are you sure you want to delete all conversations? This action cannot be undone.")&&l()},className:"w-full flex items-center justify-center gap-2 px-4 py-2 border border-red-500/50 text-red-300 rounded-md hover:bg-red-500 hover:text-white transition-colors duration-200",children:"Clear All Chats"})]})}var c=r(62036),u=r(73448);let d={createWidget:(e,t,r)=>{let n={id:"".concat(t,"::").concat(r),metadata:e.metadata};return"table"===e.type?{...n,type:"table",payload:{type:"table",title:e.title,columns:Array.isArray(e.columns)?e.columns:[],rows:Array.isArray(e.rows)?e.rows:[]}}:{...n,type:"markdown",payload:{type:"markdown",content:e.content||"",title:""+(e.title||"Display")}}}};var f=r(35951),h=r(2748),m=r(1808);function g(){let[e]=(0,a.useState)("#6366f1"),{widgets:t}=function(){let{state:e}=(0,u.Z9)({name:"dingent"});return function(e){let{clearOnEmptyIds:t=!0,autoFetch:r=!0,keepOrphanWidgets:n=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},[l,i]=(0,a.useState)({}),[s,o]=(0,a.useState)([]),[c,u]=(0,a.useState)({}),f=(0,a.useRef)(new Set),h=(0,a.useRef)({}),m=(0,a.useRef)(!1),g=(0,a.useMemo)(()=>{if(e)return Array.from(new Set(e.filter(Boolean)))},[e]),p=(0,a.useCallback)(()=>{!n&&g&&i(e=>{let t={};for(let r of g)e[r]&&(t[r]=e[r]);return t})},[g,n]),b=(0,a.useCallback)((e,t)=>{if(!Array.isArray(e.display))throw Error("Invalid response: 'display' must be an array");return e.display.map((e,r)=>d.createWidget(e,t,r))},[]),y=(0,a.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!t&&f.current.has(e))return;h.current[e]&&h.current[e].abort();let r=new AbortController;h.current[e]=r,o(t=>t.includes(e)?t:[...t,e]),u(t=>{let{[e]:r,...n}=t;return n});try{let t=await fetch("/api/resource/".concat(e),{signal:r.signal});if(!t.ok)throw Error("HTTP ".concat(t.status));let n=await t.json(),l=b(n,e);i(t=>({...t,[e]:l})),f.current.add(e),m.current=!0}catch(r){if(r instanceof Error&&"AbortError"===r.name)return;let t="Unknown fetch error";r instanceof Error&&(t=r.message),u(r=>({...r,[e]:t}))}finally{o(t=>t.filter(t=>t!==e)),delete h.current[e]}},[b]),w=(0,a.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all";if(!g||0===g.length)return;let t="all"===e?g:e.filter(e=>g.includes(e));for(let e of t)f.current.delete(e);t.forEach(e=>{y(e,!0)})},[g,y]);return(0,a.useEffect)(()=>{if(void 0!==g){if(0===g.length){t&&(i(e=>0===Object.keys(e).length?e:{}),f.current.clear());return}if(p(),r)for(let e of g)f.current.has(e)||y(e)}},[g,r,t,p,y]),(0,a.useEffect)(()=>()=>{Object.values(h.current).forEach(e=>e.abort())},[]),{widgets:(0,a.useMemo)(()=>{if(void 0===g)return Object.values(l).flat();let e=[];for(let t of g){let r=l[t];r&&e.push(...r)}return e},[l,g]),loadingIds:s,errorById:c,refresh:w,hasFetched:m.current}}(e&&Object.prototype.hasOwnProperty.call(e,"artifact_ids")?e.artifact_ids:void 0)}();return!function(){let{messages:e,setMessages:t}=(0,f.B)(),{threadId:r,agentSession:n,runtimeClient:l}=(0,h.F)(),{threads:s,updateThreadTitle:o}=(0,i.xH)(),{setState:c}=(0,u.Z9)({name:"dingent"}),d=(0,a.useRef)(""),g=(0,a.useRef)(""),p=(0,a.useRef)(""),b=(0,a.useMemo)(()=>s.find(e=>e.id===r),[s,r]),y=(0,a.useRef)(b);(0,a.useEffect)(()=>{y.current=b},[b,t]),(0,a.useEffect)(()=>{let e=null==n?void 0:n.agentName;if(!r||!e||r===d.current&&e===g.current)return;let a=!1;return(async()=>{var n,i,s,o,u,f;let h=await l.loadAgentState({threadId:r,agentName:e});if(a)return;if(h.error){console.error("Failed to load agent state:",h.error),d.current=r,g.current=e;return}let b=null==(i=h.data)||null==(n=i.loadAgentState)?void 0:n.messages,y=null==(o=h.data)||null==(s=o.loadAgentState)?void 0:s.threadExists,w=null==(f=h.data)||null==(u=f.loadAgentState)?void 0:u.state;if(y){p.current=b||"",d.current=r,g.current=e;try{let e=(0,m.iD)(JSON.parse(b||"[]")),r=JSON.parse(w||"{}").artifact_ids||[];t(e),c({artifact_ids:r})}catch(e){console.error("Error parsing messages JSON:",e),t([]),c({artifact_ids:[]})}}else t([]),c({artifact_ids:[]}),d.current=r,g.current=e})(),()=>{a=!0}},[r,null==n?void 0:n.agentName,l,t,c]),(0,a.useEffect)(()=>{if(!(null==e?void 0:e.length)||!y.current)return;let t=y.current;if(t&&"New Chat"===t.title){let r=e.find(e=>"role"in e&&"user"===e.role);if(null==r?void 0:r.content){let e=r.content.substring(0,50).trim();e&&o(t.id,e)}}},[e,o])}(),(0,n.jsx)("main",{style:{"--copilot-kit-primary-color":e},children:(0,n.jsxs)("div",{className:"flex flex-row w-full h-screen",children:[(0,n.jsx)(o,{})," ",(0,n.jsxs)("div",{className:"relative flex-grow flex",children:[(0,n.jsx)(c.D,{widgets:t}),(0,n.jsx)(l.R,{clickOutsideToClose:!1,defaultOpen:!0,labels:{title:"Popup Assistant",initial:"\uD83D\uDC4B Select a conversation or start a new one!"}})]})]})})}}},e=>{e.O(0,[152,383,249,145,174,36,441,964,358],()=>e(e.s=57279)),_N_E=e.O()}]);