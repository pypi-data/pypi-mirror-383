-- ============================================
-- PostgreSQL Schema for Confiture
-- ============================================
--
-- Environment: test
-- Generated: 2025-10-11T14:23:39.416394
-- Schema Hash: b9379af0c84576a9af540dc458dfe985afd1b00e8261ee84f5fa7dc4c1ff25d1
-- Files Included: 4
--
-- This file was generated by Confiture (confiture build)
-- DO NOT EDIT MANUALLY - Edit source files in db/schema/
--
-- ============================================


-- ============================================
-- File: 00_common/extensions.sql
-- ============================================

-- PostgreSQL Extensions
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
CREATE EXTENSION IF NOT EXISTS "pg_trgm";

-- ============================================
-- File: 10_tables/posts.sql
-- ============================================

-- Posts table
CREATE TABLE posts (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    user_id UUID NOT NULL REFERENCES users(id),
    title VARCHAR(500) NOT NULL,
    content TEXT,
    created_at TIMESTAMP NOT NULL DEFAULT NOW()
);

CREATE INDEX idx_posts_user_id ON posts(user_id);

-- ============================================
-- File: 10_tables/users.sql
-- ============================================

-- Users table
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    username VARCHAR(255) NOT NULL UNIQUE,
    email VARCHAR(255) NOT NULL UNIQUE,
    created_at TIMESTAMP NOT NULL DEFAULT NOW()
);

CREATE INDEX idx_users_username ON users(username);

-- ============================================
-- File: 20_views/user_stats.sql
-- ============================================

-- User statistics view
CREATE VIEW user_stats AS
SELECT
    u.id,
    u.username,
    COUNT(p.id) AS post_count
FROM users u
LEFT JOIN posts p ON p.user_id = u.id
GROUP BY u.id, u.username;
