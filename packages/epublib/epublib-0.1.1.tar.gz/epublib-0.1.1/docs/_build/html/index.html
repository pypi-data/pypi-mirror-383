<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="EPUBLib" />
<meta property="og:type" content="website" />
<meta property="og:url" content="index.html" />
<meta property="og:site_name" content="EPUBLib" />
<meta property="og:description" content="A spec compliant, memory efficient EPUB3 library. Designed for editing EPUBs, but can also create them. Spec compliant: code aims at being compliant with the EPUB 3.3 specification(although it does..." />
<meta property="og:image:width" content="1146" />
<meta property="og:image:height" content="600" />
<meta property="og:image" content="_images/social_previews/summary_index_3d0b8889.png" />
<meta property="og:image:alt" content="A spec compliant, memory efficient EPUB3 library. Designed for editing EPUBs, but can also create them. Spec compliant: code aims at being compliant with the EPUB 3.3 specification(although it does..." />
<meta name="description" content="A spec compliant, memory efficient EPUB3 library. Designed for editing EPUBs, but can also create them. Spec compliant: code aims at being compliant with the EPUB 3.3 specification(although it does..." />
<meta name="twitter:card" content="summary_large_image" />
<link rel="index" title="Index" href="genindex.html"><link rel="search" title="Search" href="search.html"><link rel="next" title="API" href="epublib.html">

    <link rel="shortcut icon" href="_static/favicon.svg"><!-- Generated with Sphinx 8.2.3 and Furo 2025.09.25 -->
        <title>EPUBLib documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=d111a655" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=580074bf" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=8dab3a3b" />
    
    


<style>
  body {
    --color-code-background: #f2f2f2;
  --color-code-foreground: #1e1e1e;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle site navigation sidebar">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc" aria-label="Toggle table of contents sidebar">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <span class="icon"><svg><use href="#svg-menu"></use></svg></span>
      </label>
    </div>
    <div class="header-center">
      <a href="#"><div class="brand">EPUBLib  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="#">
  
  <span class="sidebar-brand-text">EPUBLib  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">EPUBLib</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="epublib.html">API</a><input aria-label="Toggle navigation of API" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="epublib.nav.html">epublib.nav package</a><input aria-label="Toggle navigation of epublib.nav package" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="epublib.nav.reset.html">epublib.nav.reset module</a></li>
<li class="toctree-l3"><a class="reference internal" href="epublib.nav.resource.html">epublib.nav.resource module</a></li>
<li class="toctree-l3"><a class="reference internal" href="epublib.nav.util.html">epublib.nav.util module</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="epublib.ncx.html">epublib.ncx package</a><input aria-label="Toggle navigation of epublib.ncx package" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="epublib.ncx.reset.html">epublib.ncx.reset module</a></li>
<li class="toctree-l3"><a class="reference internal" href="epublib.ncx.resource.html">epublib.ncx.resource module</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="epublib.package.html">epublib.package package</a><input aria-label="Toggle navigation of epublib.package package" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="epublib.package.guide.html">epublib.package.guide module</a></li>
<li class="toctree-l3"><a class="reference internal" href="epublib.package.manifest.html">epublib.package.manifest module</a></li>
<li class="toctree-l3"><a class="reference internal" href="epublib.package.metadata.html">epublib.package.metadata module</a></li>
<li class="toctree-l3"><a class="reference internal" href="epublib.package.properties.html">epublib.package.properties module</a></li>
<li class="toctree-l3"><a class="reference internal" href="epublib.package.resource.html">epublib.package.resource module</a></li>
<li class="toctree-l3"><a class="reference internal" href="epublib.package.spine.html">epublib.package.spine module</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="epublib.resources.html">epublib.resources package</a><input aria-label="Toggle navigation of epublib.resources package" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="epublib.resources.create.html">epublib.resources.create module</a></li>
<li class="toctree-l3"><a class="reference internal" href="epublib.resources.manager.html">epublib.resources.manager module</a></li>
<li class="toctree-l3"><a class="reference internal" href="epublib.resources.window.html">epublib.resources.window module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="epublib.create.html">epublib.create module</a></li>
<li class="toctree-l2"><a class="reference internal" href="epublib.exceptions.html">epublib.exceptions module</a></li>
<li class="toctree-l2"><a class="reference internal" href="epublib.identifier.html">epublib.identifier module</a></li>
<li class="toctree-l2"><a class="reference internal" href="epublib.media_type.html">epublib.media_type module</a></li>
<li class="toctree-l2"><a class="reference internal" href="epublib.parse.html">epublib.parse module</a></li>
<li class="toctree-l2"><a class="reference internal" href="epublib.soup.html">epublib.soup module</a></li>
<li class="toctree-l2"><a class="reference internal" href="epublib.source.html">epublib.source module</a></li>
<li class="toctree-l2"><a class="reference internal" href="epublib.types.html">epublib.types module</a></li>
<li class="toctree-l2"><a class="reference internal" href="epublib.util.html">epublib.util module</a></li>
<li class="toctree-l2"><a class="reference internal" href="epublib.xml_element.html">epublib.xml_element module</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="_sources/index.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="epublib">
<h1>EPUBLib<a class="headerlink" href="#epublib" title="Link to this heading">¶</a></h1>
<p>A spec compliant, memory efficient EPUB3 library. Designed for editing
EPUBs, but can also create them.</p>
<ul class="simple">
<li><p>Spec compliant: code aims at being compliant with the
<a class="reference external" href="https://www.w3.org/TR/epub-33/">EPUB 3.3 specification</a> (although it
does not attempt to validate the EPUB. Use
<a class="reference external" href="https://daisy.org/activities/software/ace/">Ace by Daisy</a> and
<a class="reference external" href="https://www.w3.org/publishing/epubcheck/">EPUBCheck</a> for that);</p></li>
<li><p>Memory efficient: leverages python standard library’s zipfile module to
load data into memory as needed only;</p></li>
<li><p>Designed for editing: handles EPUBs non intrusively (e.g. won’t
recreate the manifest and the metadata).</p></li>
</ul>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Link to this heading">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>epublib
</pre></div>
</div>
<section id="dependencies">
<h3>Dependencies<a class="headerlink" href="#dependencies" title="Link to this heading">¶</a></h3>
<p>Installing EPUBLib will also install its dependencies:</p>
<ul class="simple">
<li><p>BeautifulSoup (<code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">beautifulsoup</span></code>)</p></li>
<li><p>lxml (<code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">lxml</span></code>)</p></li>
</ul>
</section>
</section>
<section id="contributing">
<h2>Contributing<a class="headerlink" href="#contributing" title="Link to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p>Clone from
<a class="reference external" href="https://gitlab.com/joaoseckler/epublib">gitlab.com/joaoseckler/epublib</a>.</p></li>
<li><p>Use <a class="reference external" href="https://docs.astral.sh/uv/"><code class="docutils literal notranslate"><span class="pre">uv</span></code></a> to manage development dependencies.
Sync with <code class="docutils literal notranslate"><span class="pre">uv</span> <span class="pre">sync</span> <span class="pre">--all-packages</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pre-commit</span> <span class="pre">install</span></code></p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">basedpyright</span></code> to type check your contribution. There is currently no
pre-commit rule for it, but contributions are expected not to introduce any
type checking errors or warnings.</p></li>
</ol>
</section>
<section id="related">
<h2>Related<a class="headerlink" href="#related" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/aerkalov/ebooklib">Ebooklib</a></p></li>
<li><p><a class="reference external" href="https://sigil-ebook.com/">Sigil</a></p></li>
</ul>
</section>
<section id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Link to this heading">¶</a></h2>
<section id="basic-usage">
<h3>Basic usage<a class="headerlink" href="#basic-usage" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">epublib</span><span class="w"> </span><span class="kn">import</span> <span class="n">EPUB</span>

<span class="k">with</span> <span class="n">EPUB</span><span class="p">(</span><span class="s2">&quot;book.epub&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">book</span><span class="p">:</span>
    <span class="n">book</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;New title&quot;</span>

    <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">book</span><span class="o">.</span><span class="n">documents</span><span class="p">:</span>
        <span class="n">new_script</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">soup</span><span class="o">.</span><span class="n">new_tag</span><span class="p">(</span><span class="s2">&quot;script&quot;</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;src&quot;</span><span class="p">:</span> <span class="s2">&quot;../Misc/myscript.js&quot;</span><span class="p">})</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">soup</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_script</span><span class="p">)</span>

        <span class="n">new_heading</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">soup</span><span class="o">.</span><span class="n">new_tag</span><span class="p">(</span><span class="s2">&quot;h1&quot;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s2">&quot;New heading&quot;</span><span class="p">)</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">soup</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">new_heading</span><span class="p">)</span>

    <span class="n">book</span><span class="o">.</span><span class="n">update_manifest_properties</span><span class="p">()</span>
    <span class="n">book</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;book-modified.epub&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="reading-writing-and-creating">
<h3>Reading, writing and creating<a class="headerlink" href="#reading-writing-and-creating" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">epublib</span><span class="w"> </span><span class="kn">import</span> <span class="n">EPUB</span>

<span class="c1"># From path</span>
<span class="k">with</span> <span class="n">EPUB</span><span class="p">(</span><span class="s2">&quot;book.epub&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">book</span><span class="p">:</span>
    <span class="n">book</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;book-modified.epub&quot;</span><span class="p">)</span>

<span class="c1"># From file</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;book.epub&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">read_file</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">EPUB</span><span class="p">(</span><span class="n">read_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">book</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;book-modified.epub&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">book</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="c1"># Read from folder path (unzipped EPUB)</span>
<span class="k">with</span> <span class="n">EPUB</span><span class="p">(</span><span class="s2">&quot;book-folder/&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">book</span><span class="p">:</span>
    <span class="n">book</span><span class="o">.</span><span class="n">write_to_folder</span><span class="p">(</span><span class="s2">&quot;book-folder-modified/&quot;</span><span class="p">)</span>

<span class="c1"># Create new EPUB</span>
<span class="k">with</span> <span class="n">EPUB</span><span class="p">()</span> <span class="k">as</span> <span class="n">book</span><span class="p">:</span>
    <span class="n">book</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;A new book&quot;</span>
    <span class="n">book</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">identifier</span> <span class="o">=</span> <span class="s2">&quot;urn:uuid:123e4567-e89b-12d3-a456-426614174000&quot;</span>
    <span class="n">book</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="s2">&quot;en&quot;</span>
    <span class="n">book</span><span class="o">.</span><span class="n">nav</span><span class="o">.</span><span class="n">soup</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;Navigation title&quot;</span>

    <span class="c1"># the default TOC comes with one single self referential item</span>
    <span class="n">book</span><span class="o">.</span><span class="n">nav</span><span class="o">.</span><span class="n">toc</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Toc title&quot;</span> <span class="c1"># Title of the toc</span>
    <span class="n">item_referencing_toc</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">nav</span><span class="o">.</span><span class="n">toc</span><span class="o">.</span><span class="n">items_referencing</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">nav</span><span class="o">.</span><span class="n">filename</span><span class="p">))</span>
    <span class="n">item_referencing_toc</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Toc title&quot;</span>
</pre></div>
</div>
<p>EPUBLib does not guarantee the validity of the EPUB resulting from
calling <code class="docutils literal notranslate"><span class="pre">EPUB()</span></code>. It is the user’s responsability to add, at least:</p>
<ul class="simple">
<li><p>a title (<code class="docutils literal notranslate"><span class="pre">book.metadata.title</span> <span class="pre">=</span> <span class="pre">&lt;title&gt;</span></code>)</p></li>
<li><p>an identifier (<code class="docutils literal notranslate"><span class="pre">book.metadata.identifier</span> <span class="pre">=</span> <span class="pre">&lt;id&gt;</span></code>)</p></li>
<li><p>a language (<code class="docutils literal notranslate"><span class="pre">book.metadata.language</span> <span class="pre">=</span> <span class="pre">&lt;language&gt;</span></code>)</p></li>
<li><p>A title for the navigation document (<code class="docutils literal notranslate"><span class="pre">book.nav.soup.title.string</span> <span class="pre">=</span> <span class="pre">&lt;title&gt;</span></code>)</p></li>
<li><p>A title for the elements of the table of contents (see example above
for one way of doing it)</p></li>
</ul>
</section>
<section id="accessing-resources">
<h3>Accessing resources<a class="headerlink" href="#accessing-resources" title="Link to this heading">¶</a></h3>
<p>Each resource corresponds to a file in the EPUB archive.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">zipfile</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">epublib</span><span class="w"> </span><span class="kn">import</span> <span class="n">EPUB</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">epublib.media_type</span><span class="w"> </span><span class="kn">import</span> <span class="n">MediaType</span><span class="p">,</span> <span class="n">Category</span>

<span class="k">with</span> <span class="n">EPUB</span><span class="p">(</span><span class="s2">&quot;book.epub&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">book</span><span class="p">:</span>
    <span class="n">book</span><span class="o">.</span><span class="n">resources</span> <span class="c1">#  all resources</span>
    <span class="nb">print</span><span class="p">([</span><span class="n">resource</span><span class="o">.</span><span class="n">filename</span> <span class="k">for</span> <span class="n">resource</span> <span class="ow">in</span> <span class="n">book</span><span class="o">.</span><span class="n">resources</span><span class="p">])</span>
    <span class="c1"># [</span>
    <span class="c1">#     &quot;mimetype&quot;,</span>
    <span class="c1">#     &quot;META-INF/container.xml&quot;,</span>
    <span class="c1">#     &quot;content.opf&quot;,</span>
    <span class="c1">#     &quot;Text/chapter1.xhtml&quot;,</span>
    <span class="c1">#     &quot;Images/image.png&quot;,</span>
    <span class="c1">#     ...,</span>
    <span class="c1"># ]</span>

    <span class="n">resource</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Text/chapter1.xhtml&quot;</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">resource</span><span class="o">.</span><span class="n">filename</span> <span class="o">==</span> <span class="s2">&quot;Text/chapter1.xhtml&quot;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">zipinfo</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipInfo</span><span class="p">)</span>

    <span class="n">documents</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">documents</span> <span class="c1"># All XHTML and SVG resources</span>
    <span class="n">images</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">images</span> <span class="c1"># All image resources</span>
    <span class="n">scripts</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">scripts</span> <span class="c1"># All JavaScript resources</span>
    <span class="n">styles</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">styles</span> <span class="c1"># All style resources</span>

    <span class="k">assert</span> <span class="n">book</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Text/chapter1.xhtml&quot;</span><span class="p">)</span> <span class="c1"># ContentDocument(Text/chapter1.xhtml)</span>
    <span class="k">assert</span> <span class="n">book</span><span class="o">.</span><span class="n">documents</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Text/chapter1.xhtml&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="n">book</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Text/chapter1.xhtml&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">book</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Text/chapter1.xhtml&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="n">book</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Images/image.png&quot;</span><span class="p">)</span> <span class="c1"># PublicationResource(Images/image.png)</span>

    <span class="n">pngs</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">MediaType</span><span class="o">.</span><span class="n">IMAGE_PNG</span><span class="p">)</span> <span class="c1"># All PNG images</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">media_type</span> <span class="ow">is</span> <span class="n">MediaType</span><span class="o">.</span><span class="n">IMAGE_PNG</span> <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">pngs</span><span class="p">)</span>

    <span class="n">images</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Category</span><span class="o">.</span><span class="n">IMAGE</span><span class="p">)</span> <span class="c1"># All images. Same as book.images()</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">media_type</span><span class="o">.</span><span class="n">category</span> <span class="ow">is</span> <span class="n">Category</span><span class="o">.</span><span class="n">IMAGE</span> <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">images</span><span class="p">)</span>
</pre></div>
</div>
<section id="creating">
<h4>Creating<a class="headerlink" href="#creating" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">epublib</span><span class="w"> </span><span class="kn">import</span> <span class="n">EPUB</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">epublib.identifier</span><span class="w"> </span><span class="kn">import</span> <span class="n">EPUBId</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">epublib.resources</span><span class="w"> </span><span class="kn">import</span> <span class="n">PublicationResource</span><span class="p">,</span> <span class="n">ContentDocument</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">epublib.resources.create</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_resource_from_path</span><span class="p">,</span> <span class="n">create_resource</span>

<span class="k">with</span> <span class="n">EPUB</span><span class="p">(</span><span class="s2">&quot;book.epub&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">book</span><span class="p">:</span>
    <span class="c1"># Create a new resource from filesystem path</span>
    <span class="n">new_resource</span> <span class="o">=</span> <span class="n">create_resource_from_path</span><span class="p">(</span><span class="s2">&quot;new-image.jpg&quot;</span><span class="p">,</span> <span class="s2">&quot;Images/name-in-epub.jpg&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_resource</span><span class="p">,</span> <span class="n">PublicationResource</span><span class="p">)</span>
    <span class="n">book</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">resource</span><span class="o">=</span><span class="n">new_resource</span><span class="p">)</span>

    <span class="c1"># Create a new resource from content</span>

    <span class="n">xhtml</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="s2">    &lt;!DOCTYPE html&gt;</span>
<span class="s2">    &lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xmlns:epub=&quot;http://www.idpf.org/2007/ops&quot;&gt;</span>
<span class="s2">    &lt;head&gt;</span>
<span class="s2">      &lt;title&gt;A Small Document&lt;/title&gt;</span>
<span class="s2">    &lt;/head&gt;</span>
<span class="s2">    &lt;body&gt;</span>
<span class="s2">      &lt;p&gt;A simple page!&lt;/p&gt;</span>
<span class="s2">    &lt;/body&gt;</span>
<span class="s2">    &lt;/html&gt;</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">new_resource</span> <span class="o">=</span> <span class="n">create_resource</span><span class="p">(</span><span class="n">xhtml</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="s2">&quot;Text/Chapter4.xhtml&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_resource</span><span class="p">,</span> <span class="n">ContentDocument</span><span class="p">)</span>
    <span class="n">book</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">resource</span><span class="o">=</span><span class="n">new_resource</span><span class="p">)</span>

    <span class="c1"># More options when adding are available (see full signature in the API</span>
    <span class="c1"># documentation)</span>
    <span class="n">new_resource</span> <span class="o">=</span> <span class="n">create_resource</span><span class="p">(</span><span class="n">xhtml</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="s2">&quot;Text/Chapter5.xhtml&quot;</span><span class="p">)</span>
    <span class="n">book</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="n">resource</span><span class="o">=</span><span class="n">new_resource</span><span class="p">,</span>
        <span class="n">is_cover</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">position</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="c1"># position in book.resources list</span>
                      <span class="c1"># (and thus in archive). Default: None</span>
        <span class="n">after</span> <span class="o">=</span> <span class="s2">&quot;Text/Chapter1.xhtml&quot;</span><span class="p">,</span> <span class="c1"># insert after this resource, default: None</span>
        <span class="n">before</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>                 <span class="c1"># insert before this resource</span>

        <span class="c1"># if None, it will be added unless it is the mimetype or the container.xml</span>
        <span class="c1"># file. caution: setting this to False or True may yield invalid EPUBs</span>
        <span class="n">add_to_manifest</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>

        <span class="n">add_to_spine</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">spine_position</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">linear</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">add_to_toc</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">toc_position</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
</section>
<section id="removing">
<h4>Removing<a class="headerlink" href="#removing" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">epublib</span><span class="w"> </span><span class="kn">import</span> <span class="n">EPUB</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">epublib.identifier</span><span class="w"> </span><span class="kn">import</span> <span class="n">EPUBId</span>

<span class="k">with</span> <span class="n">EPUB</span><span class="p">(</span><span class="s2">&quot;book.epub&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">book</span><span class="p">:</span>
    <span class="n">resource</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Text/chapter1.xhtml&quot;</span><span class="p">)</span>
    <span class="n">book</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">resource</span><span class="p">)</span>

    <span class="c1"># It is possible to use the filename directly</span>
    <span class="n">book</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;Images/image.png&quot;</span><span class="p">)</span>

    <span class="c1"># or the manifest item id</span>
    <span class="n">book</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">EPUBId</span><span class="p">(</span><span class="s2">&quot;image2&quot;</span><span class="p">))</span>

    <span class="c1"># If it is a CSS or JS file, you can set the remove_css_js_links flag</span>
    <span class="c1"># To remove any &lt;link rel=&quot;stylesheet&quot;&gt; or &lt;script&gt; tags pointing to it</span>
    <span class="n">book</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;Styles/style.css&quot;</span><span class="p">,</span> <span class="n">remove_css_js_links</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># If it has any other type, you&#39;ll have to individually remove any</span>
    <span class="c1"># references to it</span>
</pre></div>
</div>
</section>
<section id="renaming">
<h4>Renaming<a class="headerlink" href="#renaming" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">epublib</span><span class="w"> </span><span class="kn">import</span> <span class="n">EPUB</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">epublib.identifier</span><span class="w"> </span><span class="kn">import</span> <span class="n">EPUBId</span>

<span class="k">with</span> <span class="n">EPUB</span><span class="p">(</span><span class="s2">&quot;book.epub&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">book</span><span class="p">:</span>
    <span class="n">resource</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Text/chapter1.xhtml&quot;</span><span class="p">)</span>
    <span class="n">book</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="s2">&quot;Text/chapter-one.xhtml&quot;</span><span class="p">)</span>

    <span class="c1"># The same can be achieved by</span>
    <span class="n">book</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;Text/chapter-one.xhtml&quot;</span><span class="p">,</span> <span class="s2">&quot;Text/chapter1.xhtml&quot;</span><span class="p">)</span>

    <span class="c1"># or</span>
    <span class="n">book</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">EPUBId</span><span class="p">(</span><span class="s2">&quot;chapter1&quot;</span><span class="p">),</span> <span class="s2">&quot;Text/chapter-one.xhtml&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>By default, renaming a resource will update all references to it in the
rest of the book – namely, in every <code class="docutils literal notranslate"><span class="pre">XMLResource</span></code> (see
<a class="reference internal" href="#internal-representation">below</a>). If you want to rename
a resource without updating references to it, you can set the
<code class="docutils literal notranslate"><span class="pre">update_references</span></code> flag to <code class="docutils literal notranslate"><span class="pre">False</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">epublib</span><span class="w"> </span><span class="kn">import</span> <span class="n">EPUB</span>

<span class="k">with</span> <span class="n">EPUB</span><span class="p">(</span><span class="s2">&quot;book.epub&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">book</span><span class="p">:</span>
    <span class="n">book</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
        <span class="s2">&quot;Text/chapter1.xhtml&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Text/chapter-one.xhtml&quot;</span><span class="p">,</span>
        <span class="n">update_references</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>By default, these references are looked up by using the following XML
attributes: <code class="docutils literal notranslate"><span class="pre">[&quot;href&quot;,</span> <span class="pre">&quot;src&quot;,</span> <span class="pre">&quot;full-path&quot;,</span> <span class="pre">&quot;xlink:href&quot;]</span></code>. If you want to
use a different set of attributes, you can pass them as a list to the
<code class="docutils literal notranslate"><span class="pre">reference_attrs</span></code> parameter:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">epublib</span><span class="w"> </span><span class="kn">import</span> <span class="n">EPUB</span>

<span class="k">with</span> <span class="n">EPUB</span><span class="p">(</span><span class="s2">&quot;book.epub&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">book</span><span class="p">:</span>
    <span class="n">book</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
        <span class="s2">&quot;Text/chapter1.xhtml&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Text/chapter-one.xhtml&quot;</span><span class="p">,</span>
        <span class="n">reference_attrs</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;data-src&quot;</span><span class="p">,</span> <span class="s2">&quot;href&quot;</span><span class="p">],</span>
    <span class="p">)</span>
</pre></div>
</div>
</section>
<section id="internal-representation">
<h4>Internal representation<a class="headerlink" href="#internal-representation" title="Link to this heading">¶</a></h4>
<p>Resources are represented by instances of <code class="docutils literal notranslate"><span class="pre">epublib.resources.Resource</span></code>
or one of its subclasses, depending on the type of resource:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Resource</span></code>: generic resource. Usually, the only file in the EPUB that is
represented by a generic Resource is
<a class="reference external" href="https://www.w3.org/TR/epub-33/#sec-zip-container-mime">the <code class="docutils literal notranslate"><span class="pre">mimetype</span></code> file</a>;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">XMLResource</span></code>: XML resources (XHTML, SVG, XML). Provides a <code class="docutils literal notranslate"><span class="pre">soup</span></code>
attribute representing the content as a BeautifulSoup object.
Subclasses <code class="docutils literal notranslate"><span class="pre">Resource</span></code>;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PublicationResource</span></code>: A resource that contributes to the logic and
rendering of the publication. This includes CSS files, fonts, images,
JavaScript files, XHTML and SVG (although the last two have their own
specific subclass: see below). All publication resources should have a
manifest entry associated to them. Provides a <code class="docutils literal notranslate"><span class="pre">media_type:</span> <span class="pre">MediaType</span></code>
(more on media types <a class="reference internal" href="#media-types">below</a>). Subclasses <code class="docutils literal notranslate"><span class="pre">Resource</span></code>;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ContentDocument</span></code>: A XHTML or SVG document. Subclasses <code class="docutils literal notranslate"><span class="pre">XMLResource</span></code> and
<code class="docutils literal notranslate"><span class="pre">PublicationResource</span></code>;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PackageDocument</span></code>: The package document (content.opf). Subclasses
<code class="docutils literal notranslate"><span class="pre">XMLResource</span></code>. More about the package document <a class="reference internal" href="#the-package-document">below</a>;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NavigationDocument</span></code>: A XHTML or SVG document that represents the
navigation document of the EPUB (the one with <code class="docutils literal notranslate"><span class="pre">properties=&quot;nav&quot;</span></code> in
the manifest). Subclasses <code class="docutils literal notranslate"><span class="pre">ContentDocument</span></code>. More about the navigation
document <a class="reference internal" href="#navigation-document">below</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NCXFile</span></code>: A XML document that represents the NCX file of the EPUB
(if it exists). Subclasses <code class="docutils literal notranslate"><span class="pre">PublicationResource</span></code> and <code class="docutils literal notranslate"><span class="pre">XMLResource</span></code>. More
about the NCX file <a class="reference internal" href="#ncx-file">below</a>.</p></li>
</ul>
<p>The class hierarchy is as follows:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>                     ┌────────┐
                ┌────│Resource│───────┐
                │    └────────┘       │
                │                     │
                │                     │
                │                     │
           ┌────▼──────┐    ┌───────────────────┐
      ┌────│XMLResource│──┬─│PublicationResource│
      │    └───────────┘  │ └───────────────────┘
      │                   │
      │                   ├─────────────┐
      │                   │             │
┌─────▼─────────┐ ┌───────▼───────┐ ┌───▼───┐
│PackageDocument│ │ContentDocument│ │NCXFile│
└───────────────┘ └───────────────┘ └───────┘
                         │
                         │
                 ┌───────▼──────────┐
                 │NavigationDocument│
                 └──────────────────┘
</pre></div>
</div>
</section>
</section>
<section id="the-package-document">
<h3>The package document<a class="headerlink" href="#the-package-document" title="Link to this heading">¶</a></h3>
<p>The package document (sometimes referred to as OPF or <code class="docutils literal notranslate"><span class="pre">content.opf</span></code>) is
“an XML document that consists of a set of elements that each
encapsulate information about a particular aspect of an EPUB
publication” (from <a class="reference external" href="https://www.w3.org/TR/epub-33/#sec-package-intro">the spec</a>).
It contains:</p>
<ul class="simple">
<li><p>Metadata: title, author, language, date, etc;</p></li>
<li><p>Manifest: list of all resources in the EPUB;</p></li>
<li><p>Spine: reading order of resources;</p></li>
<li><p>Collections (optional): groupings of resources;</p></li>
<li><p>Manifest fallback chains (optional): define equivalence of resources
to be used as fallbacks.</p></li>
</ul>
<p>EPUBLib has specific features for handling the first three elements.
Further reading  at the <a class="reference external" href="https://www.w3.org/TR/epub-33/#sec-package-doc">spec section about the package
document</a>. The package
document itself is a resource from the epub and is available at
<code class="docutils literal notranslate"><span class="pre">book.package_document</span></code>.</p>
<section id="metadata">
<h4>Metadata<a class="headerlink" href="#metadata" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">epublib</span><span class="w"> </span><span class="kn">import</span> <span class="n">EPUB</span>

<span class="k">with</span> <span class="n">EPUB</span><span class="p">(</span><span class="s2">&quot;book.epub&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">book</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span> <span class="c1"># BookMetadata(10 items)</span>

    <span class="c1"># book.metadata is an alias of book.package_document.metadata</span>
    <span class="k">assert</span> <span class="n">book</span><span class="o">.</span><span class="n">metadata</span> <span class="ow">is</span> <span class="n">book</span><span class="o">.</span><span class="n">package_document</span><span class="o">.</span><span class="n">metadata</span>

    <span class="c1"># Mandatory metadata fields are available as attributes of convenient types</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">language</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">modified</span><span class="p">,</span> <span class="n">datetime</span><span class="p">)</span>
    <span class="n">book</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;New title&quot;</span>
    <span class="n">book</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">modified</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

    <span class="c1"># Access as item (read-only) yields internal representation</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">])</span>
    <span class="c1"># DublinCoreMetadataItem(</span>
    <span class="c1">#     name=&#39;title&#39;,</span>
    <span class="c1">#     tag=&lt;dc:title&gt;New title&lt;/dc:title&gt;,</span>
    <span class="c1">#     value=&#39;New title&#39;,</span>
    <span class="c1">#     id=None,</span>
    <span class="c1">#     dir=None,</span>
    <span class="c1">#     lang=None</span>
    <span class="c1"># )</span>

</pre></div>
</div>
<section id="adding-metadata">
<h5>Adding metadata<a class="headerlink" href="#adding-metadata" title="Link to this heading">¶</a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">epublib</span><span class="w"> </span><span class="kn">import</span> <span class="n">EPUB</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">epublib.package.metadata</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">GenericMetadataItem</span><span class="p">,</span>
    <span class="n">DublinCoreMetadataItem</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">with</span> <span class="n">EPUB</span><span class="p">(</span><span class="s2">&quot;book.epub&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">book</span><span class="p">:</span>
    <span class="n">new_item</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;pageBreakSource&quot;</span><span class="p">,</span> <span class="s2">&quot;Our print version, 1976&quot;</span><span class="p">)</span>
    <span class="n">new_item_dc</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">add_dc</span><span class="p">(</span><span class="s2">&quot;rights&quot;</span><span class="p">,</span> <span class="s2">&quot;© 1976 Our Publisher&quot;</span><span class="p">)</span>

    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_item</span><span class="p">,</span> <span class="n">GenericMetadataItem</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_item_dc</span><span class="p">,</span> <span class="n">DublinCoreMetadataItem</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">new_item</span><span class="p">)</span>
    <span class="c1"># GenericMetadataItem(name=&#39;pageBreakSource&#39;,</span>
    <span class="c1">#     tag=&lt;meta property=&quot;pageBreakSource&quot;&gt;Our print version,</span>
    <span class="c1">#     1976&lt;/meta&gt;,</span>
    <span class="c1">#     value=&#39;Our print version,</span>
    <span class="c1">#     1976&#39;,</span>
    <span class="c1">#     id=None,</span>
    <span class="c1">#     dir=None,</span>
    <span class="c1">#     lang=None,</span>
    <span class="c1">#     refines=None,</span>
    <span class="c1">#     scheme=None</span>
    <span class="c1"># )</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">new_item_dc</span><span class="p">)</span>
    <span class="c1"># DublinCoreMetadataItem(</span>
    <span class="c1">#     name=&#39;rights&#39;,</span>
    <span class="c1">#     tag=&lt;dc:rights&gt;© 1976 Our Publisher&lt;/dc:rights&gt;,</span>
    <span class="c1">#     value=&#39;© 1976 Our Publisher&#39;,</span>
    <span class="c1">#     id=None,</span>
    <span class="c1">#     dir=None,</span>
    <span class="c1">#     lang=None</span>
    <span class="c1"># )</span>
</pre></div>
</div>
</section>
<section id="adding-other-types-of-metadata">
<h5>Adding other types of metadata<a class="headerlink" href="#adding-other-types-of-metadata" title="Link to this heading">¶</a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">epublib</span><span class="w"> </span><span class="kn">import</span> <span class="n">EPUB</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">epublib.package.metadata</span><span class="w"> </span><span class="kn">import</span> <span class="n">MetadataItem</span><span class="p">,</span> <span class="n">LinkMetadataItem</span>

<span class="k">with</span> <span class="n">EPUB</span><span class="p">(</span><span class="s2">&quot;book.epub&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">book</span><span class="p">:</span>
    <span class="n">link_item</span> <span class="o">=</span> <span class="n">LinkMetadataItem</span><span class="p">(</span>
        <span class="n">soup</span><span class="o">=</span><span class="n">book</span><span class="o">.</span><span class="n">package_document</span><span class="o">.</span><span class="n">soup</span><span class="p">,</span>
        <span class="n">href</span><span class="o">=</span><span class="s2">&quot;front.xhtml#meta-json&quot;</span><span class="p">,</span>
        <span class="n">rel</span><span class="o">=</span><span class="s2">&quot;record&quot;</span><span class="p">,</span>
        <span class="n">media_type</span><span class="o">=</span><span class="s2">&quot;application/xhtml+xml&quot;</span><span class="p">,</span>
        <span class="n">hreflang</span><span class="o">=</span><span class="s2">&quot;en&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">book</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="n">link_item</span><span class="p">)</span>

    <span class="c1"># You can also create your own custom metadata items by subclassing MetadataItem</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">custom_item</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_some_custom_item</span>

    <span class="n">custom_item</span> <span class="o">=</span> <span class="n">create_some_custom_item</span><span class="p">()</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">custom_item</span><span class="p">,</span> <span class="n">MetadataItem</span><span class="p">)</span>
    <span class="n">book</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="n">custom_item</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="getting-all-metadata">
<h5>Getting all metadata<a class="headerlink" href="#getting-all-metadata" title="Link to this heading">¶</a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">epublib</span><span class="w"> </span><span class="kn">import</span> <span class="n">EPUB</span>

<span class="k">with</span> <span class="n">EPUB</span><span class="p">(</span><span class="s2">&quot;book.epub&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">book</span><span class="p">:</span>
    <span class="n">book</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">items</span> <span class="c1"># Each item in internal representation</span>
    <span class="n">book</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">tag</span> <span class="c1"># The full metadata tag as an bs4.Tag element</span>
</pre></div>
</div>
</section>
</section>
<section id="manifest">
<h4>Manifest<a class="headerlink" href="#manifest" title="Link to this heading">¶</a></h4>
<p>From the <a class="reference external" href="https://www.w3.org/TR/epub-33/#sec-manifest-elem">spec</a>, the
manifest “provides an exhaustive list of publication resources used
in the rendering of the content.” Each of its items needs to have:</p>
<ul class="simple">
<li><p>an href, a relative path to the resource in the archive;</p></li>
<li><p>a media-type (see <a class="reference internal" href="#media-types">media types</a> below);</p></li>
<li><p>a unique identifier;</p></li>
</ul>
<p>and can optionally have:</p>
<ul class="simple">
<li><p>properties (see <a class="reference internal" href="#manifest-properties">manifest properties</a> below);</p></li>
<li><p>a fallback;</p></li>
<li><p>a media-overlay.</p></li>
</ul>
<p>The manifest is internally represented by <code class="docutils literal notranslate"><span class="pre">BookManifest</span></code>, and each item
by <code class="docutils literal notranslate"><span class="pre">ManifestItem</span></code>. Instead of the relative path, we primarily use the
absolute path of each resource to identify it in the EPUB (corresponding
to the <code class="docutils literal notranslate"><span class="pre">href</span></code> and <code class="docutils literal notranslate"><span class="pre">filename</span></code> attributes of <code class="docutils literal notranslate"><span class="pre">ManifestItem</span></code>,
respectivelly). If you whish to use the identifier instead, you can
signal that by using <code class="docutils literal notranslate"><span class="pre">EPUBId</span></code>, a <code class="docutils literal notranslate"><span class="pre">str</span></code> subclass, to wrap the identifier
string.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">epublib</span><span class="w"> </span><span class="kn">import</span> <span class="n">EPUB</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">epublib.package.manifest</span><span class="w"> </span><span class="kn">import</span> <span class="n">BookManifest</span><span class="p">,</span> <span class="n">ManifestItem</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">epublib.identifier</span><span class="w"> </span><span class="kn">import</span> <span class="n">EPUBId</span>

<span class="k">with</span> <span class="n">EPUB</span><span class="p">(</span><span class="s2">&quot;book.epub&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">book</span><span class="p">:</span>
    <span class="c1"># book.manifest is an alias of book.package_document.manifest</span>
    <span class="k">assert</span> <span class="n">book</span><span class="o">.</span><span class="n">manifest</span> <span class="ow">is</span> <span class="n">book</span><span class="o">.</span><span class="n">package_document</span><span class="o">.</span><span class="n">manifest</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">manifest</span><span class="p">)</span> <span class="c1"># BookManifest(4 items)</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">ManifestItem</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">book</span><span class="o">.</span><span class="n">manifest</span><span class="o">.</span><span class="n">items</span><span class="p">)</span>

    <span class="c1"># Get manifest item by filename (absolute path). Raise KeyError if not found</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">manifest</span><span class="p">[</span><span class="s2">&quot;Text/chapter1.xhtml&quot;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">item</span>

    <span class="c1"># Get manifest item, return None if not found</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">manifest</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Text/chapter99.xhtml&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">item</span> <span class="ow">is</span> <span class="kc">None</span>

    <span class="c1"># Get manifest item by identifier (EPUBId)</span>
    <span class="n">nav_item</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">manifest</span><span class="p">[</span><span class="n">EPUBId</span><span class="p">(</span><span class="s2">&quot;nav&quot;</span><span class="p">)]</span>
    <span class="k">assert</span> <span class="n">nav_item</span>
</pre></div>
</div>
<p>Adding and removing manifest items are normally done when adding or
removing resources (see <a class="reference internal" href="#accessing-resources">above</a>), which is done
under the hood by <code class="docutils literal notranslate"><span class="pre">EPUB.resources</span></code>. If you need custom control of
manifest items regardless of their resource counterparts, you can use
the <code class="docutils literal notranslate"><span class="pre">add_item</span></code>, <code class="docutils literal notranslate"><span class="pre">insert_item</span></code> and <code class="docutils literal notranslate"><span class="pre">remove_item</span></code> methods of
<code class="docutils literal notranslate"><span class="pre">BookManifest</span></code>. Caution is advised, as this may result in invalid EPUBs.</p>
<section id="manifest-properties">
<h5>Manifest properties<a class="headerlink" href="#manifest-properties" title="Link to this heading">¶</a></h5>
<p>Each manifest item can have a set of properties, which convey additional
information about the resource (read more <a class="reference external" href="https://www.w3.org/TR/epub-33/#sec-item-resource-properties">in the
spec</a>). A
non-exhaustive list of properties follows:</p>
<ul class="simple">
<li><p>nav (mandatory and unique, sets the navigation document)</p></li>
<li><p>cover-image</p></li>
<li><p><a class="reference external" href="https://www.w3.org/TR/epub-33/#sec-mathml">mathml</a></p></li>
<li><p><a class="reference external" href="https://www.w3.org/TR/epub-33/#sec-remote-resources">remote-resources</a></p></li>
<li><p><a class="reference external" href="https://www.w3.org/TR/epub-33/#sec-scripted">scripted</a></p></li>
<li><p><a class="reference external" href="https://www.w3.org/TR/epub-33/#sec-svg">svg</a></p></li>
<li><p><a class="reference external" href="https://www.w3.org/TR/epub-33/#sec-switch">switch</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">epublib</span><span class="w"> </span><span class="kn">import</span> <span class="n">EPUB</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">epublib.identifier</span><span class="w"> </span><span class="kn">import</span> <span class="n">EPUBId</span>

<span class="k">with</span> <span class="n">EPUB</span><span class="p">(</span><span class="s2">&quot;book.epub&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">book</span><span class="p">:</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">manifest</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Text/chapter1.xhtml&quot;</span><span class="p">)</span>

    <span class="c1"># Only do this if there are external links in chapter 1</span>
    <span class="n">item</span><span class="o">.</span><span class="n">add_property</span><span class="p">(</span><span class="s2">&quot;remote-resources&quot;</span><span class="p">)</span>
    <span class="c1"># Only do this if there are math expressions in chapter 1</span>
    <span class="n">item</span><span class="o">.</span><span class="n">add_property</span><span class="p">(</span><span class="s2">&quot;mathml&quot;</span><span class="p">)</span>

    <span class="n">item</span><span class="o">.</span><span class="n">remove_property</span><span class="p">(</span><span class="s2">&quot;remote-resources&quot;</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">item</span><span class="o">.</span><span class="n">has_property</span><span class="p">(</span><span class="s2">&quot;mathml&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">item</span><span class="o">.</span><span class="n">has_property</span><span class="p">(</span><span class="s2">&quot;remote-resources&quot;</span><span class="p">)</span>

    <span class="c1"># There are shortcuts to the nav item and the cover image item.</span>
    <span class="k">assert</span> <span class="n">book</span><span class="o">.</span><span class="n">manifest</span><span class="o">.</span><span class="n">nav</span> <span class="ow">is</span> <span class="n">book</span><span class="o">.</span><span class="n">manifest</span><span class="p">[</span><span class="n">EPUBId</span><span class="p">(</span><span class="s2">&quot;nav&quot;</span><span class="p">)]</span>

    <span class="c1"># Get the manifest item corresponding to the cover image. Currently,</span>
    <span class="c1"># there is no cover.</span>
    <span class="k">assert</span> <span class="n">book</span><span class="o">.</span><span class="n">manifest</span><span class="o">.</span><span class="n">cover_image</span> <span class="ow">is</span> <span class="kc">None</span>

    <span class="c1"># Promote some image to cover image</span>
    <span class="n">book</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">set_cover_image</span><span class="p">(</span><span class="s2">&quot;Images/image.png&quot;</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">book</span><span class="o">.</span><span class="n">manifest</span><span class="o">.</span><span class="n">cover_image</span> <span class="ow">is</span> <span class="n">book</span><span class="o">.</span><span class="n">manifest</span><span class="p">[</span><span class="s2">&quot;Images/image.png&quot;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">book</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">cover_image</span> <span class="ow">is</span> <span class="n">book</span><span class="o">.</span><span class="n">resources</span><span class="p">[</span><span class="s2">&quot;Images/image.png&quot;</span><span class="p">]</span>
</pre></div>
</div>
</section>
</section>
<section id="spine">
<h4>Spine<a class="headerlink" href="#spine" title="Link to this heading">¶</a></h4>
<p>The spine defines the default reading order of the publication. Each
spine item conveys the following information:</p>
<ul class="simple">
<li><p>idref (required): the identifier of the corresponding manifest item;</p></li>
<li><p>linear: whether the item is part of the default reading order or not;</p></li>
<li><p>properties (optional): additional information about the item;</p></li>
<li><p>id: an identifier for the spine item itself.</p></li>
</ul>
<p>Only the first one is mandatory. The spine is internally represented by
<code class="docutils literal notranslate"><span class="pre">BookSpine</span></code> (found at <code class="docutils literal notranslate"><span class="pre">book.spine</span></code>, an alias of
<code class="docutils literal notranslate"><span class="pre">book.package_document.spine</span></code>), and each item by <code class="docutils literal notranslate"><span class="pre">SpineItemRef</span></code>.
Different than manifest items, spine items are primarily identified by
their <code class="docutils literal notranslate"><span class="pre">idref</span></code> (their only required attribute).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">epublib</span><span class="w"> </span><span class="kn">import</span> <span class="n">EPUB</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>

<span class="k">with</span> <span class="n">EPUB</span><span class="p">(</span><span class="s2">&quot;book.epub&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">book</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">spine</span><span class="p">)</span> <span class="c1"># BookSpine(2 items)</span>

    <span class="k">assert</span> <span class="n">book</span><span class="o">.</span><span class="n">spine</span><span class="p">[</span><span class="s2">&quot;nav&quot;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">book</span><span class="o">.</span><span class="n">spine</span><span class="p">[</span><span class="s2">&quot;chapter1&quot;</span><span class="p">]</span>

    <span class="c1"># Getting spine item by position</span>
    <span class="k">assert</span> <span class="n">book</span><span class="o">.</span><span class="n">spine</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="n">book</span><span class="o">.</span><span class="n">spine</span><span class="p">[</span><span class="s2">&quot;chapter1&quot;</span><span class="p">]</span>

    <span class="c1"># If you need to get a spine item by its filename, go through the</span>
    <span class="c1"># manifest first (since the filename information is not stored in the spine):</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">spine</span><span class="p">[</span><span class="n">book</span><span class="o">.</span><span class="n">manifest</span><span class="p">[</span><span class="s2">&quot;Text/chapter1.xhtml&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>

    <span class="c1"># To reorder the spine, you can use the move_item method:</span>
    <span class="n">book</span><span class="o">.</span><span class="n">spine</span><span class="o">.</span><span class="n">move_item</span><span class="p">(</span><span class="s2">&quot;nav&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="c1"># Move nav to the beginning of the spine</span>
    <span class="k">assert</span> <span class="n">book</span><span class="o">.</span><span class="n">spine</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">idref</span> <span class="o">==</span> <span class="s2">&quot;nav&quot;</span>

    <span class="c1"># Or completely reorder the spine</span>
    <span class="n">new_order</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">spine</span><span class="o">.</span><span class="n">items</span><span class="p">)</span>
    <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">new_order</span><span class="p">)</span>

    <span class="n">book</span><span class="o">.</span><span class="n">spine</span><span class="o">.</span><span class="n">reorder</span><span class="p">(</span><span class="n">new_order</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">spine</span><span class="o">.</span><span class="n">items</span><span class="p">)</span> <span class="o">==</span> <span class="n">new_order</span>
</pre></div>
</div>
<p>As with the manifest, adding and removing spine items are normally done
when adding or removing resources (see <a class="reference internal" href="#accessing-resources">above</a>).
Refer to the following parameters of the <code class="docutils literal notranslate"><span class="pre">EPUB.resources.add</span></code> method:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">after</span></code> and <code class="docutils literal notranslate"><span class="pre">before</span></code>;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">add_to_spine</span></code>;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">spine_position</span></code>;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">linear</span></code>.</p></li>
</ul>
<p>If you need custom control of spine items the <code class="docutils literal notranslate"><span class="pre">add_item</span></code>, <code class="docutils literal notranslate"><span class="pre">insert_item</span></code>
and <code class="docutils literal notranslate"><span class="pre">remove_item</span></code> methods of <code class="docutils literal notranslate"><span class="pre">BookSpine</span></code>. Caution is advised, as this
may result in invalid EPUBs.</p>
</section>
</section>
<section id="navigation-document">
<h3>Navigation document<a class="headerlink" href="#navigation-document" title="Link to this heading">¶</a></h3>
<p>The navigation document is a special XHTML document that contains
“human- and machine-readable global navigation information.” (from <a class="reference external" href="https://www.w3.org/TR/epub-33/#dfn-epub-navigation-document">the
spec</a>). In
other words, it is a regular XHTML file with some extra requirements:</p>
<ul class="simple">
<li><p>Must include exactly one <code class="docutils literal notranslate"><span class="pre">nav</span></code> html element with <code class="docutils literal notranslate"><span class="pre">epub:type=&quot;toc&quot;</span></code>
(the table of contents);</p></li>
<li><p>All <code class="docutils literal notranslate"><span class="pre">nav</span></code> html elements with a <code class="docutils literal notranslate"><span class="pre">epub:type</span></code> attribute, including the
table of contents, must follow a <a class="reference external" href="https://www.w3.org/TR/epub-33/#sec-nav-def-model">specific
structure</a>, using
only ordered lists (<code class="docutils literal notranslate"><span class="pre">ol</span></code>, possibly nested), list items (<code class="docutils literal notranslate"><span class="pre">li</span></code>), spans
(<code class="docutils literal notranslate"><span class="pre">span</span></code>) and anchors (<code class="docutils literal notranslate"><span class="pre">a</span></code>);</p></li>
</ul>
<p>There may also exist other <code class="docutils literal notranslate"><span class="pre">nav</span></code> elements with different <code class="docutils literal notranslate"><span class="pre">epub:type</span></code>
attributes. The spec talks about two other types:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">page-list</span></code>: a list of links to the locations in the publication
that correspond to page numbers in a print edition of the work;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">landmarks</span></code>: a list of links to important locations in the
publication, such as the title page, table of contents, main
content, bibliography, etc.</p></li>
</ul>
<p>This requirements allow EPUBLib to provide specific features for
handling the navigation document, which is represented by
a <code class="docutils literal notranslate"><span class="pre">NavigationDocument</span></code> resource, available at <code class="docutils literal notranslate"><span class="pre">book.nav</span></code>.
There are features for handling the table of contents, page list and
landmarks.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">epublib</span><span class="w"> </span><span class="kn">import</span> <span class="n">EPUB</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">epublib.resources</span><span class="w"> </span><span class="kn">import</span> <span class="n">ContentDocument</span>

<span class="k">with</span> <span class="n">EPUB</span><span class="p">(</span><span class="s2">&quot;book.epub&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">book</span><span class="p">:</span>
    <span class="c1"># Table of contents</span>
    <span class="n">book</span><span class="o">.</span><span class="n">reset_toc</span><span class="p">(</span>
        <span class="n">targets_selector</span> <span class="o">=</span> <span class="s2">&quot;h1, h2, h3&quot;</span><span class="p">,</span>  <span class="c1"># defaults to all headings, in which case</span>
                                          <span class="c1"># a nested toc is created</span>
        <span class="n">include_filenames</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>        <span class="c1"># Whether to include filenames in TOC entries</span>
                                          <span class="c1"># (i.e. hrefs with no fragments)</span>
        <span class="n">spine_only</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>                <span class="c1"># Only read from resources in the spine</span>
                                          <span class="c1"># (yields correctly orderered TOC)</span>
        <span class="n">resource_class</span> <span class="o">=</span> <span class="n">ContentDocument</span><span class="p">,</span> <span class="c1"># Only consider resources of this class</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Table of contents&quot;</span><span class="p">,</span>        <span class="c1"># Title of the TOC</span>
    <span class="p">)</span>

    <span class="c1"># Landmarks</span>
    <span class="n">book</span><span class="o">.</span><span class="n">create_landmarks</span><span class="p">(</span>
        <span class="n">include_toc</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>                          <span class="c1"># Include TOC in landmarks</span>
        <span class="n">targets_selector</span> <span class="o">=</span> <span class="s2">&quot;#landmark1, #landmark2&quot;</span><span class="p">,</span> <span class="c1"># Defaults to None,</span>
                                                     <span class="c1"># selecting no landmark</span>
    <span class="p">)</span>

    <span class="c1"># This will error if a landmarks list already exists. Use the following</span>
    <span class="c1"># to force recreation</span>
    <span class="n">book</span><span class="o">.</span><span class="n">reset_landmarks</span><span class="p">()</span>


    <span class="c1"># Page list</span>
    <span class="n">book</span><span class="o">.</span><span class="n">create_page_list</span><span class="p">(</span>
        <span class="n">id_format</span> <span class="o">=</span> <span class="s2">&quot;page_</span><span class="si">{page}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="c1"># If a page breaks is identified but has</span>
                                   <span class="c1"># no id, use this format to attribute one</span>
        <span class="n">label_format</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{page}</span><span class="s2">&quot;</span><span class="p">,</span>   <span class="c1"># Format for page label, shown in the page list</span>
        <span class="n">pagebreak_selector</span> <span class="o">=</span> <span class="s1">&#39;[role=&quot;doc-pagebreak&quot;], [epub|type=&quot;pagebreak&quot;]&#39;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># This will error if a toc already exists. Use the following to force recreation</span>
    <span class="n">book</span><span class="o">.</span><span class="n">reset_page_list</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="ncx-file">
<h3>NCX file<a class="headerlink" href="#ncx-file" title="Link to this heading">¶</a></h3>
<p>The NCX file is an XML file used in EPUB 2 publications to define the
table of contents. It has been superseded by the <a class="reference internal" href="#navigation-document">navigation
document</a>, but may optionally be included in EPUB
3 publications for backwards compatibility with EPUB 2 readers. There
are several features of the NCX format, only part of which are
represented in EPUBLib:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">head</span></code> element contains metadata, some of which are required (<code class="docutils literal notranslate"><span class="pre">uid</span></code>,
<code class="docutils literal notranslate"><span class="pre">depth</span></code>, <code class="docutils literal notranslate"><span class="pre">totalPageCount</span></code>, <code class="docutils literal notranslate"><span class="pre">maxPageNumber</span></code>);</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">docTitle</span></code> element contains the title of the publication;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">docAuthor</span></code> elements contain the authors of the publication;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">navMap</span></code> element contains the actual table of contents;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pageList</span></code> element contains the list of pages.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">navList</span></code> elements (any number of them) can contains other lists of
points of interest.</p></li>
</ul>
<p>Currentrly, epublib does not handle any features of the NCX related to
SMIL and doesn’t not handle audio and image tags inside <code class="docutils literal notranslate"><span class="pre">navPoint</span></code>s or
<code class="docutils literal notranslate"><span class="pre">pageTarget</span></code>’s.</p>
<p>Refer to the
<a class="reference external" href="https://daisy.org/activities/standards/daisy/daisy-3/z39-86-2005-r2012-specifications-for-the-digital-talking-book/#NCX">specification</a>
for more details.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">epublib</span><span class="w"> </span><span class="kn">import</span> <span class="n">EPUB</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">epublib.ncx</span><span class="w"> </span><span class="kn">import</span> <span class="n">NCXHead</span><span class="p">,</span> <span class="n">NCXNavMap</span><span class="p">,</span> <span class="n">NCXPageList</span>

<span class="k">with</span> <span class="n">EPUB</span><span class="p">(</span><span class="s2">&quot;book.epub&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">book</span><span class="p">:</span>
    <span class="n">book</span><span class="o">.</span><span class="n">generate_ncx</span><span class="p">()</span> <span class="c1"># use reset_ncx if one already exists</span>
    <span class="k">assert</span> <span class="n">book</span><span class="o">.</span><span class="n">ncx</span>
    <span class="k">assert</span> <span class="n">book</span><span class="o">.</span><span class="n">ncx</span><span class="o">.</span><span class="n">nav_map</span>
    <span class="k">assert</span> <span class="n">book</span><span class="o">.</span><span class="n">ncx</span><span class="o">.</span><span class="n">head</span>


    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">ncx</span><span class="o">.</span><span class="n">head</span><span class="p">,</span> <span class="n">NCXHead</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">ncx</span><span class="o">.</span><span class="n">nav_map</span><span class="p">,</span> <span class="n">NCXNavMap</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">book</span><span class="o">.</span><span class="n">ncx</span><span class="o">.</span><span class="n">page_list</span> <span class="ow">is</span> <span class="kc">None</span> <span class="c1"># No page list yet!</span>

    <span class="n">item</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">ncx</span><span class="o">.</span><span class="n">nav_map</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">assert</span> <span class="n">item</span><span class="o">.</span><span class="n">href</span> <span class="o">==</span> <span class="s2">&quot;Text/chapter1.xhtml&quot;</span>
    <span class="k">assert</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s2">&quot;Start&quot;</span>

    <span class="c1"># Will recreate the nav_map unless reset_ncx is False or there is no NCX file</span>
    <span class="n">book</span><span class="o">.</span><span class="n">reset_toc</span><span class="p">(</span><span class="n">reset_ncx</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Will recreate the page_list unless reset_ncx is False or there is no NCX file</span>
    <span class="n">book</span><span class="o">.</span><span class="n">reset_page_list</span><span class="p">(</span><span class="n">reset_ncx</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">ncx</span><span class="o">.</span><span class="n">page_list</span><span class="p">,</span> <span class="n">NCXPageList</span><span class="p">)</span>


    <span class="c1"># To synchronize specific parts of the NCX file with the rest of the book:</span>
    <span class="n">book</span><span class="o">.</span><span class="n">ncx</span><span class="o">.</span><span class="n">sync_head</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
    <span class="n">book</span><span class="o">.</span><span class="n">ncx</span><span class="o">.</span><span class="n">sync_toc</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">nav</span><span class="p">)</span>
    <span class="n">book</span><span class="o">.</span><span class="n">ncx</span><span class="o">.</span><span class="n">sync_page_list</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">nav</span><span class="p">)</span>

    <span class="c1"># Update metadata numbers in the head of the NCX which are calculated</span>
    <span class="c1"># (depth, total page count, max page number and play order)</span>
    <span class="n">book</span><span class="o">.</span><span class="n">ncx</span><span class="o">.</span><span class="n">update_numbers</span><span class="p">()</span>

    <span class="c1"># Use reset_ncx to do all of the above at once</span>
    <span class="n">book</span><span class="o">.</span><span class="n">reset_ncx</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="soup-and-internal-representations">
<h3>Soup and internal representations<a class="headerlink" href="#soup-and-internal-representations" title="Link to this heading">¶</a></h3>
<blockquote>
<div><p>tl;dr: If possible, do not alter the <code class="docutils literal notranslate"><span class="pre">soup</span></code> attribute of
<code class="docutils literal notranslate"><span class="pre">PackageDocument</span></code>, <code class="docutils literal notranslate"><span class="pre">NavigationDocument</span></code> or <code class="docutils literal notranslate"><span class="pre">NCXFile</span></code> directly. If you
do need to alter them, make sure to call
<code class="docutils literal notranslate"><span class="pre">book.package_document.on_soup_change()</span></code> or
<code class="docutils literal notranslate"><span class="pre">book.nav.on_soup_change()</span></code> and <code class="docutils literal notranslate"><span class="pre">book.ncx.on_soup_change()</span></code>
afterwards.</p>
</div></blockquote>
<p>The features described above for handling the package document, the
navigation document and the NCX file involve parsing the corresponding
XML/XHTML files and building a internal representation of their content.
These representations are built lazily (i.e., the parsing only occurs
when some of the representation is accessed). Due to the mutable nature
of BeautifulSoup objects, the user may inadvertently introduce
discrepancies between them and the internal representation, which may
lead to errors. For example, if a user adds an item tag directly to the
soup of the package document, there is no way for EPUBLib to know about
the new item and add it to the <code class="docutils literal notranslate"><span class="pre">BookManifest</span></code> object.</p>
<p>If you do need to alter the <code class="docutils literal notranslate"><span class="pre">soup</span></code> attribute of these resources (or the
<code class="docutils literal notranslate"><span class="pre">tag</span></code> attributes of the internal representations), there may be two
scenarios:</p>
<ol class="arabic">
<li><p>You don’t need the internal representation, so we’re all good.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">epublib</span><span class="w"> </span><span class="kn">import</span> <span class="n">EPUB</span>

<span class="k">with</span> <span class="n">EPUB</span><span class="p">(</span><span class="s2">&quot;book.epub&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">book</span><span class="p">:</span>
    <span class="n">new_tag</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">package_document</span><span class="o">.</span><span class="n">soup</span><span class="o">.</span><span class="n">new_tag</span><span class="p">(</span>
        <span class="s2">&quot;item&quot;</span><span class="p">,</span>
        <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;file.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;media-type&quot;</span><span class="p">:</span> <span class="s2">&quot;text/plain&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;file&quot;</span><span class="p">},</span>
    <span class="p">)</span>
    <span class="n">book</span><span class="o">.</span><span class="n">manifest</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_tag</span><span class="p">)</span>
    <span class="n">book</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;book-modified.epub&quot;</span><span class="p">)</span> <span class="c1"># All good</span>
</pre></div>
</div>
</li>
<li><p>You do need the internal representation. In this case, you need to call
the <code class="docutils literal notranslate"><span class="pre">on_soup_change</span></code> method of the corresponding resource after
altering its soup.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">epublib</span><span class="w"> </span><span class="kn">import</span> <span class="n">EPUB</span>

<span class="k">with</span> <span class="n">EPUB</span><span class="p">(</span><span class="s2">&quot;book.epub&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">book</span><span class="p">:</span>
    <span class="n">new_tag</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">package_document</span><span class="o">.</span><span class="n">soup</span><span class="o">.</span><span class="n">new_tag</span><span class="p">(</span>
        <span class="s2">&quot;item&quot;</span><span class="p">,</span>
        <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;file.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;media-type&quot;</span><span class="p">:</span> <span class="s2">&quot;text/plain&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;file&quot;</span><span class="p">},</span>
    <span class="p">)</span>
    <span class="n">book</span><span class="o">.</span><span class="n">package_document</span><span class="o">.</span><span class="n">soup</span><span class="o">.</span><span class="n">manifest</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_tag</span><span class="p">)</span>

    <span class="c1"># Mark the internal representation for reparsing</span>
    <span class="n">book</span><span class="o">.</span><span class="n">package_document</span><span class="o">.</span><span class="n">on_soup_change</span><span class="p">()</span>

    <span class="c1"># Internal representation is up to date</span>
    <span class="k">assert</span> <span class="n">book</span><span class="o">.</span><span class="n">manifest</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;file.txt&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
<p>Note that the internal representation reflect its changes to the soup,
so you don’t need to do anything to see the changes there.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">epublib</span><span class="w"> </span><span class="kn">import</span> <span class="n">EPUB</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">epublib.resources.create</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_resource</span>

<span class="k">with</span> <span class="n">EPUB</span><span class="p">(</span><span class="s2">&quot;book.epub&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">book</span><span class="p">:</span>
    <span class="n">book</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">add_to_manifest</span><span class="p">(</span>
        <span class="n">create_resource</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;Some text content&quot;</span><span class="p">,</span> <span class="s2">&quot;Text/file.txt&quot;</span><span class="p">),</span>
        <span class="n">identifier</span><span class="o">=</span><span class="s2">&quot;new-item&quot;</span>
    <span class="p">)</span>

    <span class="k">assert</span> <span class="n">book</span><span class="o">.</span><span class="n">package_document</span><span class="o">.</span><span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;new-item&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>If you completely overwrite the <code class="docutils literal notranslate"><span class="pre">soup</span></code> attribute of these resources,
there is also no need to call <code class="docutils literal notranslate"><span class="pre">on_soup_change</span></code>, as the property setter
will already do that for you. This is why there is no similar issue
with the <code class="docutils literal notranslate"><span class="pre">contents</span></code> attribute: since bytes are immutable, every change
to it will trigger a reparse from the property setter.</p>
</section>
<section id="media-types">
<h3>Media types<a class="headerlink" href="#media-types" title="Link to this heading">¶</a></h3>
<p>Media types (also known as MIME types or content types) are strings that
represent the format of a file. They are used in EPUBs to describe the
format of each resource, and are required in every manifest item.</p>
<p>EPUBLib provides a <code class="docutils literal notranslate"><span class="pre">MediaType</span></code> class that represents media types, both
core and foreign.</p>
<p>We also introduce a helper class called <code class="docutils literal notranslate"><span class="pre">Category</span></code>, which represents the
main category of a media type. For example, the media type
<code class="docutils literal notranslate"><span class="pre">image/png</span></code> (<code class="docutils literal notranslate"><span class="pre">MediaType.IMAGE_PNG</span></code>) has the category <code class="docutils literal notranslate"><span class="pre">Category.IMAGE</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">epublib.media_type</span><span class="w"> </span><span class="kn">import</span> <span class="n">MediaType</span><span class="p">,</span> <span class="n">Category</span>

<span class="c1"># From filename</span>
<span class="k">assert</span> <span class="n">MediaType</span><span class="o">.</span><span class="n">from_filename</span><span class="p">(</span><span class="s2">&quot;image.png&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="n">MediaType</span><span class="o">.</span><span class="n">IMAGE_PNG</span>
<span class="k">assert</span> <span class="n">MediaType</span><span class="o">.</span><span class="n">from_filename</span><span class="p">(</span><span class="s2">&quot;image.jpg&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="n">MediaType</span><span class="o">.</span><span class="n">IMAGE_JPEG</span>
<span class="k">assert</span> <span class="n">MediaType</span><span class="o">.</span><span class="n">from_filename</span><span class="p">(</span><span class="s2">&quot;audio.ogg&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="n">MediaType</span><span class="o">.</span><span class="n">AUDIO_OGG</span>

<span class="c1"># From mimetype string</span>
<span class="k">assert</span> <span class="n">MediaType</span><span class="p">(</span><span class="s2">&quot;font/ttf&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="n">MediaType</span><span class="o">.</span><span class="n">FONT_TTF</span>
<span class="k">assert</span> <span class="n">MediaType</span><span class="p">(</span><span class="s2">&quot;text/css&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="n">MediaType</span><span class="o">.</span><span class="n">CSS</span>

<span class="c1"># Utilities</span>
<span class="k">assert</span> <span class="n">MediaType</span><span class="o">.</span><span class="n">from_filename</span><span class="p">(</span><span class="s2">&quot;script.js&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">is_js</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">MediaType</span><span class="o">.</span><span class="n">from_filename</span><span class="p">(</span><span class="s2">&quot;style.css&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">is_css</span><span class="p">()</span>

<span class="c1"># The category and mimetype are available as a properties in MediaType instances</span>
<span class="n">media_type</span> <span class="o">=</span> <span class="n">MediaType</span><span class="o">.</span><span class="n">from_filename</span><span class="p">(</span><span class="s2">&quot;image.png&quot;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">media_type</span><span class="o">.</span><span class="n">category</span> <span class="ow">is</span> <span class="n">Category</span><span class="o">.</span><span class="n">IMAGE</span>
<span class="k">assert</span> <span class="n">media_type</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;image/png&quot;</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">MediaType</span></code> is a “flexible” enum, meaning you can instantiate it
with any string value. This implementation comes from the non
restrictive nature of the spec regargind media types. Any valid mime
type is allowed, even if not listed as one the <a class="reference external" href="https://www.w3.org/TR/epub-33/#sec-core-media-types">“core media
types”</a>. In this
case, the resource in question is called a foreign resource.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">epublib.media_type</span><span class="w"> </span><span class="kn">import</span> <span class="n">MediaType</span><span class="p">,</span> <span class="n">Category</span>

<span class="n">media_type</span> <span class="o">=</span> <span class="n">MediaType</span><span class="p">(</span><span class="s2">&quot;application/x-zerosize&quot;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">media_type</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;application/x-zerosize&quot;</span>
<span class="k">assert</span> <span class="n">media_type</span><span class="o">.</span><span class="n">category</span> <span class="ow">is</span> <span class="n">Category</span><span class="o">.</span><span class="n">FOREIGN</span>
<span class="k">assert</span> <span class="n">media_type</span> <span class="o">==</span> <span class="n">MediaType</span><span class="p">(</span><span class="s2">&quot;application/x-zerosize&quot;</span><span class="p">)</span>

<span class="n">media_type</span> <span class="o">=</span> <span class="n">MediaType</span><span class="o">.</span><span class="n">from_filename</span><span class="p">(</span><span class="s2">&quot;file.jar&quot;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">media_type</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;application/java-archive&quot;</span>
<span class="k">assert</span> <span class="n">media_type</span><span class="o">.</span><span class="n">category</span> <span class="o">==</span> <span class="n">Category</span><span class="o">.</span><span class="n">FOREIGN</span>
</pre></div>
</div>
</section>
<section id="utilities">
<h3>Utilities<a class="headerlink" href="#utilities" title="Link to this heading">¶</a></h3>
<section id="relative-path-resolution">
<h4>Relative path resolution<a class="headerlink" href="#relative-path-resolution" title="Link to this heading">¶</a></h4>
<p>When dealing with EPUBs it is often necessary to, given a relative path
(e.g. in an <code class="docutils literal notranslate"><span class="pre">href</span></code> or <code class="docutils literal notranslate"><span class="pre">src</span></code> attribute), find the full path of the
referred file. The other way around may also be necessary: given the
absolute filename, find the relative path from some resource to that
filename. Two helper functions are provided for this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">epublib.util</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_absolute_href</span><span class="p">,</span> <span class="n">get_relative_href</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">epublib</span><span class="w"> </span><span class="kn">import</span> <span class="n">EPUB</span>

<span class="k">with</span> <span class="n">EPUB</span><span class="p">(</span><span class="s2">&quot;book.epub&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">book</span><span class="p">:</span>
    <span class="n">href</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">nav</span><span class="o">.</span><span class="n">soup</span><span class="o">.</span><span class="n">select_one</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)[</span><span class="s2">&quot;href&quot;</span><span class="p">]</span> <span class="c1"># &quot;chapter1.xhtml&quot;</span>
    <span class="n">absolute_path</span> <span class="o">=</span> <span class="n">get_absolute_href</span><span class="p">(</span>
        <span class="n">origin_href</span><span class="o">=</span><span class="n">book</span><span class="o">.</span><span class="n">nav</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="c1"># &quot;Text/nav.xhtml&quot;</span>
        <span class="n">href</span><span class="o">=</span><span class="n">href</span><span class="p">,</span>                     <span class="c1"># &quot;chapter1.xhtml&quot;</span>
    <span class="p">)</span>

    <span class="k">assert</span> <span class="n">absolute_path</span> <span class="o">==</span> <span class="s2">&quot;Text/chapter1.xhtml&quot;</span>

    <span class="c1"># Vice versa:</span>
    <span class="n">relative_path</span> <span class="o">=</span> <span class="n">get_relative_href</span><span class="p">(</span>
        <span class="n">relative_to</span><span class="o">=</span><span class="n">book</span><span class="o">.</span><span class="n">nav</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="c1"># &quot;Text/nav.xhtml&quot;</span>
        <span class="n">absolute_href</span><span class="o">=</span><span class="s2">&quot;Text/chapter1.xhtml&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">assert</span> <span class="n">relative_path</span> <span class="o">==</span> <span class="s2">&quot;chapter1.xhtml&quot;</span>
</pre></div>
</div>
<p>At a higher level, the <code class="docutils literal notranslate"><span class="pre">EPUB.resources</span></code> provides a method for resolving a
string representing an href (possibly with a fragment) to the actual
resource it refers to (and optionally to the tag is refers to):
<code class="docutils literal notranslate"><span class="pre">resolve_href</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">bs4</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">epublib</span><span class="w"> </span><span class="kn">import</span> <span class="n">EPUB</span>

<span class="k">with</span> <span class="n">EPUB</span><span class="p">(</span><span class="s2">&quot;book.epub&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">book</span><span class="p">:</span>
    <span class="n">resource</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">resolve_href</span><span class="p">(</span><span class="s2">&quot;Text/chapter1.xhtml#section1&quot;</span><span class="p">,</span> <span class="n">with_tag</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">resource</span> <span class="ow">is</span> <span class="n">book</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Text/chapter1.xhtml&quot;</span><span class="p">)</span>

    <span class="c1"># If the href is found inside some resource, you can use the</span>
    <span class="c1"># `relative_to` parameter</span>
    <span class="n">resource</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">resolve_href</span><span class="p">(</span>
        <span class="s2">&quot;../Text/chapter1.xhtml#section1&quot;</span><span class="p">,</span>
        <span class="n">with_tag</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">relative_to</span><span class="o">=</span><span class="s2">&quot;Styles/style.css&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">assert</span> <span class="n">resource</span> <span class="ow">is</span> <span class="n">book</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Text/chapter1.xhtml&quot;</span><span class="p">)</span>

    <span class="c1"># To capture the tag the href refers to, use the `with_tag` parameter:</span>
    <span class="n">resource</span><span class="p">,</span> <span class="n">tag</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">resolve_href</span><span class="p">(</span>
        <span class="s2">&quot;../Text/nav.xhtml#toc&quot;</span><span class="p">,</span>
        <span class="n">with_tag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">relative_to</span><span class="o">=</span><span class="s2">&quot;Styles/style.css&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">assert</span> <span class="n">resource</span><span class="o">.</span><span class="n">filename</span> <span class="o">==</span> <span class="s2">&quot;Text/nav.xhtml&quot;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">bs4</span><span class="o">.</span><span class="n">Tag</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">tag</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;toc&quot;</span>
</pre></div>
</div>
</section>
</section>
</section>
</section>
<hr class="docutils" />
<section id="contents">
<h1>Contents<a class="headerlink" href="#contents" title="Link to this heading">¶</a></h1>
<div class="toctree-wrapper compound">
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">EPUBLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="epublib.html">API</a></li>
</ul>
</div>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="epublib.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">API</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025 João Seckler
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">EPUBLib</a><ul>
<li><a class="reference internal" href="#installation">Installation</a><ul>
<li><a class="reference internal" href="#dependencies">Dependencies</a></li>
</ul>
</li>
<li><a class="reference internal" href="#contributing">Contributing</a></li>
<li><a class="reference internal" href="#related">Related</a></li>
<li><a class="reference internal" href="#usage">Usage</a><ul>
<li><a class="reference internal" href="#basic-usage">Basic usage</a></li>
<li><a class="reference internal" href="#reading-writing-and-creating">Reading, writing and creating</a></li>
<li><a class="reference internal" href="#accessing-resources">Accessing resources</a><ul>
<li><a class="reference internal" href="#creating">Creating</a></li>
<li><a class="reference internal" href="#removing">Removing</a></li>
<li><a class="reference internal" href="#renaming">Renaming</a></li>
<li><a class="reference internal" href="#internal-representation">Internal representation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-package-document">The package document</a><ul>
<li><a class="reference internal" href="#metadata">Metadata</a><ul>
<li><a class="reference internal" href="#adding-metadata">Adding metadata</a></li>
<li><a class="reference internal" href="#adding-other-types-of-metadata">Adding other types of metadata</a></li>
<li><a class="reference internal" href="#getting-all-metadata">Getting all metadata</a></li>
</ul>
</li>
<li><a class="reference internal" href="#manifest">Manifest</a><ul>
<li><a class="reference internal" href="#manifest-properties">Manifest properties</a></li>
</ul>
</li>
<li><a class="reference internal" href="#spine">Spine</a></li>
</ul>
</li>
<li><a class="reference internal" href="#navigation-document">Navigation document</a></li>
<li><a class="reference internal" href="#ncx-file">NCX file</a></li>
<li><a class="reference internal" href="#soup-and-internal-representations">Soup and internal representations</a></li>
<li><a class="reference internal" href="#media-types">Media types</a></li>
<li><a class="reference internal" href="#utilities">Utilities</a><ul>
<li><a class="reference internal" href="#relative-path-resolution">Relative path resolution</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#contents">Contents</a></li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=8a448e45"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=46bd48cc"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    </body>
</html>