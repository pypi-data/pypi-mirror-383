"use strict";(self.webpackChunk_amphi_pipeline_log_console=self.webpackChunk_amphi_pipeline_log_console||[]).push([[942],{8942:(e,t,n)=>{n.r(t),n.d(t,{default:()=>R});var o=n(3794),a=n(9219),s=n(6417),i=n(8222),r=n(316),l=n(8462),c=n(4602);class d{constructor(e){this._isDisposed=!1,this._disposed=new c.Signal(this),this._rendermime=null,this._connector=e}get disposed(){return this._disposed}get isDisposed(){return this._isDisposed}get rendermime(){return this._rendermime}dispose(){this.isDisposed||(this._isDisposed=!0,this._disposed.emit(),c.Signal.clearData(this))}}class h extends d{constructor(e){var t;super(e.connector),this._id=e.id,this._rendermime=null!==(t=e.rendermime)&&void 0!==t?t:null,this._ready=this._connector.ready,this._connector.kernelRestarted.connect((e,t)=>{this._ready=this._connector.ready})}get id(){return this._id}get ready(){return this._ready}}class p{constructor(e){this._kernelRestarted=new c.Signal(this),this._session=e.session,this._session.statusChanged.connect((e,t)=>{switch(t){case"restarting":case"autorestarting":this._kernelRestarted.emit(this._session.ready)}})}get kernelRestarted(){return this._kernelRestarted}get kernelLanguage(){var e;return(null===(e=this._session.session)||void 0===e?void 0:e.kernel)?this._session.session.kernel.info.then(e=>e.language_info.name):Promise.resolve("")}get kernelName(){return this._session.kernelDisplayName}get ready(){return this._session.ready}get iopubMessage(){return this._session.iopubMessage}execute(e){var t;if(!(null===(t=this._session.session)||void 0===t?void 0:t.kernel))throw new Error("No session available.");return this._session.session.kernel.requestExecute(e)}}var m=n(5256),u=n(3345),v=n.n(u),g=n(7628),w=n.n(g),k=(n(2888),n(3063)),b=n(6172),f=n(8634);const y={left:0,top:0,width:0,height:0,right:0,bottom:0},_=({htmlData:e})=>{const[t,n]=(0,u.useState)(()=>window.devicePixelRatio),[o,a]=(0,u.useState)([]),[s,i]=(0,u.useState)([]),[r,l]=(0,u.useState)([]),[c,d]=(0,u.useState)(),h=(0,u.useRef)(0),p=(0,u.useRef)(null);(0,u.useEffect)(()=>{const e=()=>{window.devicePixelRatio!==t&&n(window.devicePixelRatio)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[t]),(0,u.useEffect)(()=>()=>window.clearTimeout(h.current),[]);const m=e=>Math.min(Math.max(8*e.length+40,100),200);(0,u.useEffect)(()=>{const{data:t,headers:n}=function(e){const t=(new DOMParser).parseFromString(e,"text/html"),n=Array.from(t.querySelectorAll("table thead th")).map(e=>{var t,n;return null!==(n=null===(t=e.textContent)||void 0===t?void 0:t.trim())&&void 0!==n?n:""}),o=t.querySelectorAll("table tbody tr");return{data:Array.from(o,e=>{const t=e.querySelectorAll("th, td"),o={};return n.forEach((e,n)=>{var a,s,i;o[e]=null!==(i=null===(s=null===(a=t[n])||void 0===a?void 0:a.textContent)||void 0===s?void 0:s.trim())&&void 0!==i?i:""}),o}),headers:n}}(e);l(n);const o=t.map(e=>{const t={...e};return Object.keys(t).forEach(e=>{"<NA>"===t[e]&&(t[e]="")}),t}),s=n.map(e=>{if(!e.trim())return{title:e,width:m(e)};const t=e.match(/^(.*?)\s*\((.*?)\)\s*$/);let n=e,o="string";if(t){n=t[1].trim();const e=t[2].trim().toLowerCase();e.includes("int")?o="number":e.includes("float")||e.includes("decimal")?o="decimal":e.includes("date")||e.includes("time")?o="datetime":e.includes("bool")&&(o="boolean")}return{title:n,id:e,icon:o,width:m(n)}});i(s),a(o)},[e]);const g=(0,u.useCallback)((e,t,n)=>{i(e=>{const o=[...e];return o[n]={...o[n],width:t},o})},[]),w=(0,u.useCallback)(([e,t])=>{var n;if(t>=o.length||e>=s.length)return{kind:k.dd.Text,data:"",displayData:"",allowOverlay:!1};const a=r[e],i=null!==(n=o[t][a])&&void 0!==n?n:"";return{kind:k.dd.Text,data:i,displayData:i,allowOverlay:!1}},[s,o,r]),_=(0,u.useCallback)(e=>{if("header"!==e.kind)return window.clearTimeout(h.current),void d(void 0);window.clearTimeout(h.current),d(void 0);const t=e.location[0];h.current=window.setTimeout(()=>{if(t>=s.length)return;const n=r[t].match(/\((.+?)\)/),o=n?n[1]:"string",{x:a,y:i,width:l,height:c}=e.bounds;d({val:o,bounds:{left:a,top:i,width:l,height:c,right:a+l,bottom:i+c}})},1e3)},[s,r]),x=(0,u.useMemo)(()=>({string:e=>`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="${e.bgColor}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>\n        <path d="M3 16v-6a2 2 0 1 1 4 0v6" />\n        <path d="M3 13h4" />\n        <path d="M10 8v6a2 2 0 1 0 4 0v-1a2 2 0 1 0 -4 0v1" />\n        <path d="M20.732 12a2 2 0 0 0 -3.732 1v1a2 2 0 0 0 3.726 1.01" />\n      </svg>`,number:e=>`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="${e.bgColor}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>\n        <path d="M3 10l2 -2v8" />\n        <path d="M9 8h3a1 1 0 0 1 1 1v2a1 1 0 0 1 -1 1h-2a1 1 0 0 0 -1 1v2a1 1 0 0 0 1 1h3" />\n        <path d="M17 8h2.5a1.5 1.5 0 0 1 1.5 1.5v1a1.5 1.5 0 0 1 -1.5 1.5h-1.5h1.5a1.5 1.5 0 0 1 1.5 1.5v1a1.5 1.5 0 0 1 -1.5 1.5h-2.5" />\n      </svg>`,decimal:e=>`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="${e.bgColor}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>\n        <path d="M17 8a2 2 0 0 1 2 2v4a2 2 0 1 1 -4 0v-4a2 2 0 0 1 2 -2z" />\n        <path d="M10 8a2 2 0 0 1 2 2v4a2 2 0 1 1 -4 0v-4a2 2 0 0 1 2 -2z" />\n        <path d="M5 16h.01" />\n      </svg>`,datetime:e=>`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="${e.bgColor}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>\n        <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />\n        <path d="M18 18m-4 0a4 4 0 1 0 8 0a4 4 0 1 0 -8 0" />\n        <path d="M15 3v4" />\n        <path d="M7 3v4" />\n        <path d="M3 11h16" />\n        <path d="M18 16.496v1.504l1 1" />\n      </svg>`,boolean:e=>`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" \n      viewBox="0 0 24 24" fill="none" stroke="${e.bgColor}" stroke-width="2" \n      stroke-linecap="round" stroke-linejoin="round">\n        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>\n        <path d="M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0" />\n        <path d="M12 3v18" />\n        <path d="M12 14l7 -7" />\n        <path d="M12 19l8.5 -8.5" />\n        <path d="M12 9l4.5 -4.5" />\n      </svg>`}),[]),C=void 0!==c,{renderLayer:M,layerProps:S}=(0,f.Z4)({isOpen:void 0!==c,triggerOffset:8,placement:"top-center",possiblePlacements:["top-center","bottom-center","left-center","right-center"],auto:!0,containerOffset:16,trigger:{getBounds:()=>{var e;return null!==(e=null==c?void 0:c.bounds)&&void 0!==e?e:y}}});return v().createElement("div",{ref:p,style:{position:"relative",width:"100%",height:"100%"}},v().createElement(b.D,{key:t,columns:s,minColumnWidth:100,getCellContent:w,rows:o.length,rowMarkers:"none",onColumnResize:g,onItemHovered:_,smoothScrollX:!1,smoothScrollY:!1,experimental:{strict:!1,renderStrategy:"direct"},headerIcons:x,getCellsForSelection:!0,theme:(0,u.useMemo)(()=>({baseFontStyle:"0.8125rem",headerFontStyle:"600 0.8125rem",editorFontSize:"0.8125rem",accentColor:"#5f9b97",accentLight:"#edf4f3",bgHeaderHovered:"#edf4f3",bgBubbleSelected:"#edf4f3",bgHeader:"#fafafa",bgIconHeader:"#5F9B97"}),[])}),C&&M(v().createElement("div",{...S,style:{...S.style,padding:"8px 12px",color:"white",font:"500 13px Inter",backgroundColor:"rgba(0, 0, 0, 0.85)",fontFamily:"-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji'",borderRadius:7,maxWidth:"300px",wordBreak:"break-word",zIndex:9999}},null==c?void 0:c.val)))};var x=n(8859);const C=({htmlData:e})=>{const t=(e=>{const t=(new DOMParser).parseFromString(e,"text/html").querySelectorAll("#documents > div._amphi_document"),n=[];return t.forEach(e=>{var t,o,a;const s=e.querySelector("div._amphi_nb"),i=e.querySelector("div._amphi_page_content"),r=e.querySelector("div._amphi_metadata");if(s&&i&&r){const e=(null===(t=s.textContent)||void 0===t?void 0:t.trim())||"",l=(null===(o=i.innerHTML)||void 0===o?void 0:o.replace("<strong>Document Content:</strong>","").trim())||"";let c,d=(null===(a=r.textContent)||void 0===a?void 0:a.replace("Metadata:","").trim())||"";try{d=d.replace(/'/g,'"'),c=JSON.parse(d)}catch(e){console.error("Error parsing metadata:",e),c=d}n.push({nb:e,page_content:l,metadata:c})}}),n})(e).map((e,t)=>({title:e.nb,key:`doc-${t}`,children:[{title:v().createElement("pre",{style:{userSelect:"text",cursor:"text"}},e.page_content),key:`doc-${t}-page-content`},{title:"Metadata",key:`doc-${t}-metadata`,children:Object.entries(e.metadata).map(([e,n])=>({title:`${e}: ${n}`,key:`doc-${t}-metadata-${e}`}))}]}));return v().createElement(x.A,{defaultExpandedKeys:t.map(e=>e.key),defaultSelectedKeys:t.map(e=>e.key),defaultCheckedKeys:t.map(e=>e.key),treeData:t})};var M=n(782),S=n(3517),E=n(9057);const z=new i.LabIcon({name:"amphi:clock-icon",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><g fill="currentColor"><path d="M8.5 3.75a.75.75 0 00-1.5 0V8c0 .284.16.544.415.67l2.5 1.25a.75.75 0 10.67-1.34L8.5 7.535V3.75z"/><path fill-rule="evenodd" d="M8 0a8 8 0 100 16A8 8 0 008 0zM1.5 8a6.5 6.5 0 1113 0 6.5 6.5 0 01-13 0z" clip-rule="evenodd"/></g></svg>'}),I=new i.LabIcon({name:"amphi:pipeline-console-icon",svgstr:'<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg\n   width="16"\n   height="16"\n   fill="none"\n   viewBox="0 0 16 16"\n   version="1.1"\n   id="svg1"\n   sodipodi:docname="pipeline-16.svg"\n   inkscape:version="1.3 (0e150ed, 2023-07-21)"\n   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"\n   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"\n   xmlns="http://www.w3.org/2000/svg"\n   xmlns:svg="http://www.w3.org/2000/svg">\n  <defs\n     id="defs1" />\n  <sodipodi:namedview\n     id="namedview1"\n     pagecolor="#505050"\n     bordercolor="#eeeeee"\n     borderopacity="1"\n     inkscape:showpageshadow="0"\n     inkscape:pageopacity="0"\n     inkscape:pagecheckerboard="0"\n     inkscape:deskcolor="#505050"\n     inkscape:zoom="14.75"\n     inkscape:cx="8"\n     inkscape:cy="8"\n     inkscape:window-width="1312"\n     inkscape:window-height="449"\n     inkscape:window-x="0"\n     inkscape:window-y="639"\n     inkscape:window-maximized="0"\n     inkscape:current-layer="svg1" />\n  <path\n     fill="currentColor"\n     fill-rule="evenodd"\n     d="M2.75 2.5A1.75 1.75 0 001 4.25v1C1 6.216 1.784 7 2.75 7h1a1.75 1.75 0 001.732-1.5H6.5a.75.75 0 01.75.75v3.5A2.25 2.25 0 009.5 12h1.018c.121.848.85 1.5 1.732 1.5h1A1.75 1.75 0 0015 11.75v-1A1.75 1.75 0 0013.25 9h-1a1.75 1.75 0 00-1.732 1.5H9.5a.75.75 0 01-.75-.75v-3.5A2.25 2.25 0 006.5 4H5.482A1.75 1.75 0 003.75 2.5h-1zM2.5 4.25A.25.25 0 012.75 4h1a.25.25 0 01.25.25v1a.25.25 0 01-.25.25h-1a.25.25 0 01-.25-.25v-1zm9.75 6.25a.25.25 0 00-.25.25v1c0 .138.112.25.25.25h1a.25.25 0 00.25-.25v-1a.25.25 0 00-.25-.25h-1z"\n     clip-rule="evenodd"\n     id="path1"\n     style="fill:#000000;fill-opacity:1" />\n</svg>\n'}),A=new i.LabIcon({name:"amphi:grid-console-icon",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><g fill="currentColor" fill-rule="evenodd" clip-rule="evenodd"><path d="M2.25 1C1.56 1 1 1.56 1 2.25v3.5C1 6.44 1.56 7 2.25 7h3.5C6.44 7 7 6.44 7 5.75v-3.5C7 1.56 6.44 1 5.75 1h-3.5zm.25 4.5v-3h3v3h-3zM10.25 1C9.56 1 9 1.56 9 2.25v3.5C9 6.44 9.56 7 10.25 7h3.5C14.44 7 15 6.44 15 5.75v-3.5C15 1.56 14.44 1 13.75 1h-3.5zm.25 4.5v-3h3v3h-3zM9 10.25C9 9.56 9.56 9 10.25 9h3.5c.69 0 1.25.56 1.25 1.25v3.5c0 .69-.56 1.25-1.25 1.25h-3.5C9.56 15 9 14.44 9 13.75v-3.5zm1.5.25v3h3v-3h-3zM2.25 9C1.56 9 1 9.56 1 10.25v3.5c0 .69.56 1.25 1.25 1.25h3.5C6.44 15 7 14.44 7 13.75v-3.5C7 9.56 6.44 9 5.75 9h-3.5zm.25 4.5v-3h3v3h-3z"/></g></svg>'}),H=new i.LabIcon({name:"amphi:cpu-icon",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><g fill="currentColor" fill-rule="evenodd" clip-rule="evenodd"><path d="M6.25 5C5.56 5 5 5.56 5 6.25v3.5c0 .69.56 1.25 1.25 1.25h3.5c.69 0 1.25-.56 1.25-1.25v-3.5C11 5.56 10.44 5 9.75 5h-3.5zm.25 4.5v-3h3v3h-3z"/><path d="M6.25.05a.7.7 0 01.7.7V2h2.1V.75a.7.7 0 111.4 0V2h1.3A2.25 2.25 0 0114 4.25v1.3h1.25a.7.7 0 110 1.4H14v2.1h1.25a.7.7 0 110 1.4H14v1.3A2.25 2.25 0 0111.75 14h-1.3v1.25a.7.7 0 11-1.4 0V14h-2.1v1.25a.7.7 0 11-1.4 0V14h-1.3A2.25 2.25 0 012 11.75v-1.3H.75a.7.7 0 110-1.4H2v-2.1H.75a.7.7 0 110-1.4H2v-1.3A2.25 2.25 0 014.25 2h1.3V.75a.7.7 0 01.7-.7zM3.5 4.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z"/></g></svg>'}),D=(new i.LabIcon({name:"amphi:date-time-icon",svgstr:'<svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-calendar-time"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" /><path d="M18 18m-4 0a4 4 0 1 0 8 0a4 4 0 1 0 -8 0" /><path d="M15 3v4" /><path d="M7 3v4" /><path d="M3 11h16" /><path d="M18 16.496v1.504l1 1" /></svg>'}),new i.LabIcon({name:"amphi:number-icon",svgstr:'<svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-number-123"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 10l2 -2v8" /><path d="M9 8h3a1 1 0 0 1 1 1v2a1 1 0 0 1 -1 1h-2a1 1 0 0 0 -1 1v2a1 1 0 0 0 1 1h3" /><path d="M17 8h2.5a1.5 1.5 0 0 1 1.5 1.5v1a1.5 1.5 0 0 1 -1.5 1.5h-1.5h1.5a1.5 1.5 0 0 1 1.5 1.5v1a1.5 1.5 0 0 1 -1.5 1.5h-2.5" /></svg>'}),new i.LabIcon({name:"amphi:decimal-icon",svgstr:'<svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-decimal"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M17 8a2 2 0 0 1 2 2v4a2 2 0 1 1 -4 0v-4a2 2 0 0 1 2 -2z" /><path d="M10 8a2 2 0 0 1 2 2v4a2 2 0 1 1 -4 0v-4a2 2 0 0 1 2 -2z" /><path d="M5 16h.01" /></svg>'}),new i.LabIcon({name:"amphi:string-icon",svgstr:'<svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-abc"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 16v-6a2 2 0 1 1 4 0v6" /><path d="M3 13h4" /><path d="M10 8v6a2 2 0 1 0 4 0v-1a2 2 0 1 0 -4 0v1" /><path d="M20.732 12a2 2 0 0 0 -3.732 1v1a2 2 0 0 0 3.726 1.01" /></svg>'}),"amphi-Console-single-column");class L extends m.Widget{constructor(e,t,n){super(),this._source=null,this._app=e,this._commands=t,this._context=n,this.addClass("amphi-Console");const o=document.createElement("div");o.id="portal",o.style.position="absolute",o.style.left="0",o.style.top="0",o.style.width="100%",o.style.height="100%",o.style.zIndex="9999",this._title=N.createTitle(),this._title.className="amphi-Console-title",this._console=N.createConsole(),this._console.className="amphi-Console-table",o.appendChild(this._title),o.appendChild(this._console),this.node.appendChild(o)}get source(){return this._source}set source(e){this._source!==e&&(this._source&&this._source.disposed.disconnect(this.onSourceDisposed,this),this._source=e,this._source&&this._source.disposed.connect(this.onSourceDisposed,this))}dispose(){this.isDisposed||(this.source=null,super.dispose())}onNewLog(e,t,n,o,a){if(!this.isAttached)return;this._console.tFoot||(this._console.createTFoot(),this._console.tFoot.className="amphi-Console-content");let s=this._console.tFoot.insertRow(0);s.className=`amphi-Console-table-row ${D}`;let i,r=s.insertCell(0);r.style.padding="5px",r.className=D;let l,c=v().createElement(M.A,{bordered:!1,icon:v().createElement(I.react,{className:"anticon amphi-Console-icon-size"}),style:{whiteSpace:"normal",wordWrap:"break-word"}},t),d=null,h=null,p=null,m=null;switch(n){case"info":i=v().createElement(M.A,{bordered:!1,icon:v().createElement(z.react,{className:"anticon"}),style:{whiteSpace:"normal",wordWrap:"break-word"}},e),l=v().createElement(S.A,{showIcon:!0,banner:!0,message:v().createElement("div",{dangerouslySetInnerHTML:{__html:o}}),type:/SUCCESS/i.test(o)?"success":/ERROR|WARNING/i.test(o)?"warning":"info"});break;case"error":i=v().createElement(M.A,{bordered:!1,icon:v().createElement(z.react,{className:"anticon amphi-Console-icon-size"}),style:{whiteSpace:"normal",wordWrap:"break-word"}},e),l=v().createElement(S.A,{message:"Error",banner:!0,showIcon:!0,description:v().createElement("div",{dangerouslySetInnerHTML:{__html:o.replace(/\n/g,"<br>").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;")}}),type:"error"});break;case"data":i=v().createElement(M.A,{bordered:!1,icon:v().createElement(z.react,{className:"anticon amphi-Console-icon-size"}),style:{whiteSpace:"normal",wordWrap:"break-word"}},e),h=v().createElement(M.A,{bordered:!1,icon:v().createElement(z.react,{className:"anticon amphi-Console-icon-size"}),style:{whiteSpace:"normal",wordWrap:"break-word"}},a.nodeId),p=v().createElement(M.A,{bordered:!1,icon:v().createElement(H.react,{className:"anticon amphi-Console-icon-size"}),style:{whiteSpace:"normal",wordWrap:"break-word"}},a.runtime),m=v().createElement(M.A,{bordered:!1,onClick:()=>this._commands.execute("pipeline-editor-component:view-data",{nodeId:a.nodeId,context:this._context}),icon:v().createElement(z.react,{className:"anticon amphi-Console-icon-size"}),color:"#44776D",style:{whiteSpace:"normal",wordWrap:"break-word"}},"View data");const t=(new DOMParser).parseFromString(o,"text/html");console.log(t);const n=t.querySelector("div");if(n&&"documents"===n.id)l=v().createElement(C,{htmlData:o});else{const e=t.querySelector("p:last-of-type");let n=null;e&&e.textContent.includes("rows Ã—")&&(n=e.textContent.trim()),n&&(d=v().createElement(M.A,{bordered:!1,icon:v().createElement(A.react,{className:"anticon amphi-Console-icon-size"}),style:{whiteSpace:"normal",wordWrap:"break-word"}},n)),l=v().createElement(v().Fragment,null,v().createElement(_,{htmlData:o}))}break;case"rich":i=v().createElement(M.A,{bordered:!1,icon:v().createElement(z.react,{className:"anticon amphi-Console-icon-size"})},e),l=v().createElement("div",{dangerouslySetInnerHTML:{__html:o}});break;default:i=v().createElement(M.A,{bordered:!1},e),l=v().createElement("div",null,o)}w().render(v().createElement("div",{style:{display:"flex",flexDirection:"column",gap:"4px"}},v().createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"0px",marginBottom:"2px"}},v().createElement("div",{style:{display:"flex",alignItems:"center",gap:"4px"}},i,c,d,p),v().createElement("div",null)),v().createElement("div",null,l),v().createElement(E.A,{style:{margin:"6px 0"}})),r),this._console.parentElement.scrollTop=0}clearLogs(){if(this._console.tFoot)for(;this._console.tFoot.rows.length>0;)this._console.tFoot.deleteRow(0)}onSourceDisposed(e,t){this.source=null}}var N;!function(e){const t=new Map(Object.entries({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"}));e.escapeHtml=function(e){return String(e).replace(/[&<>"'/]/g,e=>t.get(e))},e.createConsole=function(){return document.createElement("table")},e.createTitle=function(e=""){const t=document.createElement("p");return t.innerHTML=e,t}}(N||(N={}));class T{constructor(){this._source=null,this._panel=null,this._handlers={}}hasHandler(e){return!!this._handlers[e]}getHandler(e){return this._handlers[e]}addHandler(e){this._handlers[e.id]=e}get panel(){return this._panel}set panel(e){this.panel!==e&&(this._panel=e,e&&!e.source&&(e.source=this._source))}get source(){return this._source}set source(e){this._source!==e&&(this._source&&this._source.disposed.disconnect(this._onSourceDisposed,this),this._source=e,this._panel&&!this._panel.isDisposed&&(this._panel.source=this._source),this._source&&this._source.disposed.connect(this._onSourceDisposed,this))}_onSourceDisposed(){this._source=null}}var $=n(7262);const P=new $.Token("jupyterlab_extension/logconsole:IPipelineConsoleManager");var B;new $.Token("jupyterlab_extension/logconsole:IPipelineConsole"),function(e){e.open="pipeline-console:open"}(B||(B={}));const R=[{id:"@amphi/pipeline-log-console:extension",requires:[o.ICommandPalette,a.ILayoutRestorer,a.ILabShell,r.ISettingRegistry,l.IPipelineTracker],provides:P,autoStart:!0,activate:(e,t,n,a,s,r)=>{const l=new T,c=B.open,d=new o.WidgetTracker({namespace:"pipeline-console"});let h=80;function p(e){h=e.get("maxPreview").composite,console.log(`Settings Example extension: maxPreview is set to '${h}'`)}return Promise.all([e.restored,s.load("@amphi/pipeline-log-console:extension")]).then(([,n])=>{p(n),n.changed.connect(p),e.commands.addCommand(c,{label:"Pipeline Console",execute:()=>{let t=null;for(const n of e.shell.widgets("main"))if("amphi-metadataPanel"===n.id){t=n;break}l.panel&&!l.panel.isDisposed||(l.panel=function(){const t=a.currentWidget;if(!t||!r.has(t))return void console.warn("No active pipeline to provide context.");const n=t.context,o=new L(e,e.commands,n);return o.id="amphi-logConsole",o.title.label="Pipeline Console",o.title.icon=i.listIcon,o.title.closable=!0,o.disposed.connect(()=>{l.panel===o&&(l.panel=null)}),d.add(o),o}()),t&&t.isAttached?l.panel.isAttached||e.shell.add(l.panel,"main",{ref:t.id,mode:"tab-after"}):l.panel.isAttached||e.shell.add(l.panel,"main",{mode:"split-bottom"}),e.shell.activateById(l.panel.id)}}),t.addItem({command:c,category:"Pipeline Console"}),e.commands.addCommand("pipeline-console:clear",{execute:()=>{l.panel.clearLogs()},label:"Clear Console"}),e.commands.addCommand("pipeline-console:settings",{execute:()=>{},label:"Console Settings"}),e.contextMenu.addItem({command:"pipeline-console:clear",selector:".amphi-Console",rank:1})}).catch(e=>{console.error(`Something went wrong when reading the settings.\n${e}`)}),n.restore(d,{command:c,args:()=>({}),name:()=>"amphi-logConsole"}),console.log("JupyterLab extension @amphi/pipeline-log-console is activated!"),l}},{id:"@amphi/pipeline-log-console:pipelines",requires:[P,l.IPipelineTracker,a.ILabShell],autoStart:!0,activate:(e,t,n,a)=>{const i={};function r(e){const t=new Date(e);return`${t.toLocaleDateString()}\n${t.toLocaleTimeString()}`}n.widgetAdded.connect((e,n)=>{t.hasHandler(n.context.sessionContext.path)?i[n.id]=new Promise(e=>{e(t.getHandler(n.context.sessionContext.path))}):i[n.id]=new Promise(e=>{const a=n.context.sessionContext,l=new p({session:a}),c={connector:l,id:a.path},d=new h(c);t.addHandler(d),n.disposed.connect(()=>{delete i[n.id],d.dispose()}),d.ready.then(()=>{e(d),l.ready.then(async()=>{a.session.kernel.anyMessage.connect((e,n)=>{var i,l;if(!t.panel)return;if("recv"!==n.direction)return;const{msg:c}=n,d=c.header.msg_type;if("execute_result"===d||"display_data"===d){const e=c.content,n=e.data;if(n["text/html"])return void t.panel.onNewLog(r(c.header.date),a.name,"data",n["text/html"],e.metadata);if(n["image/png"]){const o=`<img alt="plot" style="max-width:100%;height:auto;" src="data:image/png;base64,${n["image/png"]}" />`;return void t.panel.onNewLog(r(c.header.date),a.name,"rich",o,e.metadata)}if(n["image/svg+xml"]){const o=n["image/svg+xml"],s="string"==typeof o?o:o.join("\n");return void t.panel.onNewLog(r(c.header.date),a.name,"rich",s,e.metadata)}return}if("stream"!==d&&"error"===d){const e=c,n=null!==(l=null===(i=e.content.traceback)||void 0===i?void 0:i.join("\n"))&&void 0!==l?l:"",d=`traceback-${Date.now()}`,h=document.createElement("div"),p=`${e.content.evalue}`;h.innerHTML=`<pre><span>${p}</span><br><a href="#" style="text-decoration: underline; color: grey;" id="link-${d}" onClick="document.getElementById('${d}').style.display = document.getElementById('${d}').style.display === 'none' ? 'block' : 'none'; return false;">Show Traceback</a></pre>`;const m=document.createElement("pre");m.id=d,m.style.display="none",h.appendChild(m);const u={host:m,source:n,sanitizer:new o.Sanitizer};(0,s.renderText)(u).then(()=>{const n=h.outerHTML;t.panel.onNewLog(r(e.header.date),a.name,"error",n,null)})}})})})}),l(a)});const l=(e,o)=>{var a;const s=null!==(a=null==o?void 0:o.newValue)&&void 0!==a?a:e.currentWidget;s&&n.has(s)&&i[s.id].then(e=>{e&&(t.source=e)})};l(a),a.currentChanged.connect(l)}}]}}]);