(function(Q,ae){typeof exports=="object"&&typeof module<"u"?ae(exports):typeof define=="function"&&define.amd?define(["exports"],ae):(Q=typeof globalThis<"u"?globalThis:Q||self,ae(Q.trame_rca={}))})(this,function(Q){"use strict";class ae{constructor(t){this.vueComponent=t,this.img=new Image,this.url="",this.blob=null,this.img.addEventListener("load",()=>{this.vueComponent.displayURL=this.url,this.vueComponent.hasContent=!0})}update(t,r){window.URL.revokeObjectURL(this.url),this.blob=new Blob([r],{type:t}),this.url=URL.createObjectURL(this.blob),this.img.src=this.url}}const Je={props:{name:{type:String,default:"default"},origin:{type:String,default:"anonymous"},poolSize:{type:Number,default:4},imageStyle:{type:Object,default:()=>({width:"100%"})}},watch:{poolSize(){this.updatePoolSize()}},data(){return{hasContent:!1,displayURL:""}},expose:["resetContent","updatePoolSize"],methods:{resetContent(){this.hasContent=!1},updatePoolSize(){for(;this.frames.length<this.poolSize;)this.frames.push(new ae(this));for(;this.frames.length>this.poolSize;)this.frames.pop()},cleanup(){this.wslinkSubscription&&this.trame&&(this.trame.client.getConnection().getSession().unsubscribe(this.wslinkSubscription),this.wslinkSubscription=null)}},created(){this.frames=[],this.nextFrameIndex=0,this.updatePoolSize(),this.wslinkSubscription=null,this.onImage=([{name:e,meta:t,content:r}])=>{const n=["image/apng","image/avif","image/gif","image/jpeg","image/png","image/svg+xml","image/webp"];this.name===e&&(n.includes(t.type)?(this.nextFrameIndex=(this.nextFrameIndex+1)%this.frames.length,this.frames[this.nextFrameIndex].update(t.type,r)):this.hasContent=!1)},this.trame&&(this.wslinkSubscription=this.trame.client.getConnection().getSession().subscribe("trame.rca.topic.stream",this.onImage))},beforeDestroy(){this.cleanup()},beforeUnmount(){this.cleanup()},inject:["trame"],template:'<img :style="imageStyle" :src="displayURL" v-show="hasContent" />'};class nn{constructor(t,r="video/webm; codecs=vp09.00.10.08"){this.videoElement=t,this.mime=r,this.sourceBuffer=null,this.mediaSource=null,this.initSegment=null,this.mediaSegments=[],this.loaded=0,"MediaSource"in window?(this.mediaSource=new MediaSource,this.videoElement.src=URL.createObjectURL(this.mediaSource),this.mediaSource.addEventListener("sourceopen",()=>{MediaSource.isTypeSupported(this.mime)?this.initSourceBuffer():console.error(`Unsupported MIME type or codec: ${this.mime}`)})):console.error("The Media Source Extensions API is not supported.")}initSourceBuffer(){this.sourceBuffer=this.mediaSource.addSourceBuffer(this.mime),this.sourceBuffer.mode="sequence",this.initSegment?this.sourceBuffer.appendBuffer(this.initSegment):console.error("Need initialization segment"),this.sourceBuffer.onupdateend=()=>{if(this.mediaSegments.length)this.sourceBuffer.updating===!1&&(this.sourceBuffer.appendBuffer(this.mediaSegments.shift()),this.loaded+=1);else return}}queueChunk(t){this.mediaSource.readyState==="open"&&this.sourceBuffer&&this.sourceBuffer.updating===!1?(this.sourceBuffer.appendBuffer(t),this.loaded+=1):this.mediaSegments.push(t)}exit(){this.sourceBuffer.abort(),this.mediaSource.endOfStream(),this.videoElement.play(),URL.revokeObjectURL(this.videoElement.src)}}const Qe={props:{name:{type:String,default:"default"},origin:{type:String,default:"anonymous"}},data(){return{hasContent:!1,loaded:0,received:0}},expose:["requestInitializationSegment"],methods:{requestInitializationSegment(){this.rcaPushSize&&this.rcaPushSize({videoHeader:1})},cleanup(){this.wslinkSubscription&&this.trame&&(this.trame.client.getConnection().getSession().unsubscribe(this.wslinkSubscription),this.wslinkSubscription=null,this.decoder.exit())}},created(){this.pushChunk=(e,t)=>{Array.from(new Uint8Array(e).slice(0,4)).map(n=>n.toString(16)).join("")=="1a45dfa3"&&t.includes("webm")?(console.log("detected ebml fourcc"),this.decoder&&this.decoder.exit(),this.decoder=new nn(this.$el),this.decoder.initSegment=new Uint8Array(e)):this.decoder.mime!==t?(console.log("detected mime change"),this.requestInitializationSegment()):(this.decoder.queueChunk(e),this.loaded=this.decoder.loaded,this.hasContent=!0)}},mounted(){this.onChunkAvailable=async([{name:e,meta:t,content:r}])=>{if(!t.type.includes("video/")){this.hasContent=!1;return}if(this.name===e){this.received+=1;const n=r.buffer?r:new Uint8Array(await r.arrayBuffer());this.pushChunk(n,t.type),this.hasContent=!0}},this.trame&&(this.wslinkSubscription=this.trame.client.getConnection().getSession().subscribe("trame.rca.topic.stream",this.onChunkAvailable),this.requestInitializationSegment())},beforeUnmount(){this.cleanup()},beforeDestroy(){this.cleanup()},inject:["trame","rcaPushSize"],template:`
    <video autoplay="autoplay" muted="muted" v-show="hasContent">
      Your browser does not support the video tag.
    </video>
  `},rn=1,on=2,an=3,sn=4,un=5,cn=6,fn=`

function reportError(e) {
  console.log(e.message);
  postMessage(e.message);
}

function createDecoder(canvas) {
  const ctx = canvas.getContext('2d');
  const ready_frames = [];
  let underflow = true;

  function renderFrame() {
    if (ready_frames.length === 0) {
      underflow = true;
      return;
    }
    const frame = ready_frames.shift();
    underflow = false;
    ctx.drawImage(frame, 0, 0);
    frame.close();
    setTimeout(renderFrame, 0);
  }

  function handleFrame(frame) {
    ready_frames.push(frame);
    if (underflow) {
      underflow = false;
      setTimeout(renderFrame, 0);
    }
  }

  const init = {
    output: handleFrame,
    error: reportError,
  };

  return new VideoDecoder(init);
}

onmessage = async function({ data: msg }) {
  switch(msg.action) {
    case 1: // init
      this.canvas = msg.canvas;
      this.decoder = createDecoder(this.canvas);
      break;
    case 2: // config
      this.canvas.width = msg.config.codedWidth;
      this.canvas.height = msg.config.codedHeight;
      this.decoder.configure(msg.config);
      break;
    case 3: // chunk
      this.decoder.decode(new EncodedVideoChunk({
        timestamp: msg.timestamp,
        type: msg.type,
        data: msg.data,
      }));
      break;
    case 4: // flush
      this.decoder.flush();
      break;
    case 5: // reset
      this.decoder.reset();
      break;
    case 6: // close
      // flush before close() to avoid currepoted state.
      // calling postMessage(flush)
      //         postMessage(close) is not enough since the second
      // abort the first before it finishes.
      await this.decoder.flush();
      this.decoder.close();
      break;
  }
}
`,ln=URL.createObjectURL(new Blob([fn]));function hn(){const e=new Worker(ln);return e.addEventListener("error",()=>console.error("worker failed"),!1),e.onmessage=t=>{console.log(`Worker message: ${t.data}`),console.log(">>> FIXME .....")},e}class pn{constructor(){this.worker=hn(),this.codec="",this.width=0,this.height=0}bindCanvas(t){const r=rn,n=t.transferControlToOffscreen();this.worker.postMessage({action:r,canvas:n},[n])}setContentType(t,r,n){if(this.codec!==t||this.width!==r||this.height!==n){const a=on;this.codec=t,this.width=r,this.height=n,this.worker.postMessage({action:a,config:{codec:t,codedWidth:r,codedHeight:n}})}}pushChunk(t,r,n){const a=an;this.worker.postMessage({action:a,timestamp:t,type:r,data:n},[n.buffer])}flush(){this.worker.postMessage({action:sn})}reset(){this.worker.postMessage({action:un})}terminate(){this.worker.postMessage({action:cn})}}const Ze={props:{name:{type:String,default:"default"},origin:{type:String,default:"anonymous"}},data(){return{isSupported:"VideoFrame"in window}},expose:[""],methods:{cleanup(){this.worker&&this.worker.terminate(),this.wslinkSubscription&&this.trame&&(this.trame.client.getConnection().getSession().unsubscribe(this.wslinkSubscription),this.wslinkSubscription=null)}},mounted(){if(this.worker=new pn,this.isSupported){const e=this.$el.querySelector(".js-canvas");this.worker.bindCanvas(e),this.onChunkAvailable=async([{name:t,meta:r,content:n}])=>{if(!(!r.type.includes("application/octet-stream")||!r.codec.length||r.codec.includes("unknown"))&&this.name===t&&r.codec.length){this.worker.setContentType(r.codec,r.w,r.h);const a=n.buffer?n:new Uint8Array(await n.arrayBuffer());this.worker.pushChunk(r.st,r.key,a)}},this.trame&&(this.wslinkSubscription=this.trame.client.getConnection().getSession().subscribe("trame.rca.topic.stream",this.onChunkAvailable))}},beforeUnmount(){this.cleanup()},beforeDestroy(){this.cleanup()},inject:["trame","rcaPushSize"],template:`
    <div>
      <h1 v-if="!isSupported">WebCodecs API is not supported.</h1>
      <canvas class="js-canvas"></canvas>
    </div>
  `},Ie={props:{name:{type:String,default:"default"},origin:{type:String,default:"anonymous"},imageStyle:{type:Object,default:()=>({width:"100%"})}},data(){return{hasContent:!1}},methods:{cleanup(){this.wslinkSubscription&&this.trame&&(this.trame.client.getConnection().getSession().unsubscribe(this.wslinkSubscription),this.wslinkSubscription=null)}},mounted(){this.wslinkSubscription=null;const e=this.$el,t=e.getContext("2d");this.onImage=async([{name:r,meta:n,content:a}])=>{if(this.name===r)if(n.type.includes("image/rgb24")){const l=a.buffer?a:new Uint8Array(await a.arrayBuffer());e.width=n.w,e.height=n.h;const y=t.createImageData(n.w,n.h),u=y.data;let i=0,s=0;for(;s<u.length;)u[s++]=l[i++],u[s++]=l[i++],u[s++]=l[i++],u[s++]=255;t.putImageData(y,0,0),this.hasContent=!0}else if(n.type.includes("image/rgba32")){const l=new Uint8ClampedArray(a.buffer?a:await a.arrayBuffer());e.width=n.w,e.height=n.h;const y=new ImageData(l,n.w,n.h);t.putImageData(y,0,0),this.hasContent=!0}else this.hasContent=!1},this.trame&&(this.wslinkSubscription=this.trame.client.getConnection().getSession().subscribe("trame.rca.topic.stream",this.onImage))},beforeDestroy(){this.cleanup()},beforeUnmount(){this.cleanup()},inject:["trame"],template:'<canvas class="js-canvas" :style="imageStyle" v-show="hasContent"></canvas>'},yn={components:{ImageDisplayArea:Je,MediaSourceDisplayArea:Qe,VideoDecoderDisplayArea:Ze,RawImageDisplayArea:Ie},props:{name:{type:String,default:"default"},origin:{type:String,default:"anonymous"},display:{type:String,default:"image"},imageStyle:{type:Object,default:()=>({width:"100%"})}},template:`
    <div style="width: 100%; height: 100%; display: flex; justify-content: center; align-items: center;">
      <image-display-area v-if="display === 'image'" :name="name" :origin="origin" :poolSize="4" :imageStyle="imageStyle" />
      <media-source-display-area v-if="display === 'media-source'" :name="name" :origin="origin" />
      <video-decoder-display-area v-if="display === 'video-decoder'" :name="name" :origin="origin" />
      <raw-image-display-area v-if="display === 'raw-image'" :name="name" :origin="origin" :imageStyle="imageStyle" />
    </div>
  `},vn=["B/s","KB/s","MB/s"];class dn{constructor(t=255,r=10,n=1e3){this.windowSize=t,this.windowStatSize=r,this.newInteractionThreshold=n,this.lastTS=0,this.serverTime=[],this.clientTimes=[],this.packetSizes=[],this.statWindow=[]}trim(){for(;this.serverTime.length>this.windowSize;)this.serverTime.shift(),this.clientTimes.shift(),this.packetSizes.shift();for(;this.statWindow.length>this.windowStatSize;)this.statWindow.shift()}compute(){if(this.statWindow.length<2)return null;const t=this.statWindow[0],n=(this.statWindow[this.statWindow.length-1]-t)/(this.statWindow.length-1),a=1e3/n,l=[],y=[],u=[0,0];let i=this.clientTimes[0],s=this.serverTime[0],c=0;for(let f=0;f<this.clientTimes.length;f++){const p=this.clientTimes[f]-i,o=this.serverTime[f]-s;c+=this.packetSizes[f],l.push(p),y.push(o),i+=n,s+=n;const h=p<o?p:o,d=p>o?p:o;u[0]>h&&(u[0]=h),u[1]<d&&(u[1]=d)}return c*=a/this.packetSizes.length,{avgFps:a,client:l,server:y,minMax:u,totalSize:c}}addEntry(t,r){const n=Date.now();return this.packetSizes.push(r),this.serverTime.push(t),this.clientTimes.push(n),n-this.lastTS<this.newInteractionThreshold?this.statWindow.push(n):this.statWindow.length=0,this.lastTS=n,this.trim(),this.compute()}}const gn={props:{name:{type:String,default:"default"},fpsDelta:{type:Number,default:4},statWindowSize:{type:Number,default:10},historyWindowSize:{type:Number,default:255},resetMsThreshold:{type:Number,default:255},wsLinkTopic:{type:String,default:"trame.rca.topic.stream"},packetDecorator:{type:Function,default:({name:e,meta:t,content:r})=>({name:e,serverTime:t.st,contentSize:r.length})}},data(){return{cw:200,ch:200,avg:30,delta:2,totalSize:0}},watch:{statWindowSize(e){this.monitor.windowStatSize=e},historyWindowSize(e){this.monitor.windowSize=e},resetMsThreshold(e){this.monitor.newInteractionThreshold=e}},expose:["sizeUnit"],methods:{sizeUnit(e){let t=e;for(let r=0;r<3;r++){if(t<1e3)return`${t.toFixed(1)} ${vn[r]}`;t/=1e3}},cleanup(){this.observer.unobserve(this.$el),this.wslinkSubscription&&this.trame&&(this.trame.client.getConnection().getSession().unsubscribe(this.wslinkSubscription),this.wslinkSubscription=null)},draw(e,t,r="#1DE9B688",n="#EF9A9A"){if(!this.$el)return;const{cw:a,ch:l}=this,u=this.$el.querySelector(".js-canvas").getContext("2d"),i=Math.floor(l*.5+.5),s=i/(1001*this.fpsDelta),c=a/(e.length-2);u.clearRect(0,0,a,l),u.strokeStyle="black",u.beginPath(),u.moveTo(0,i),u.lineTo(a,i),u.stroke(),u.strokeStyle="#eee";for(let f=0;f<this.fpsDelta;f++)u.beginPath(),u.moveTo(0,i+1e3*(f+1)*s),u.lineTo(a,i+1e3*(f+1)*s),u.stroke(),u.beginPath(),u.moveTo(0,i-1e3*(f+1)*s),u.lineTo(a,i-1e3*(f+1)*s),u.stroke();u.strokeStyle=r,u.lineWidth=8,u.beginPath(),u.moveTo(0,i-s*e[1]);for(let f=2;f<e.length;f++)u.lineTo((f-1)*c,i-s*e[f]);u.stroke(),u.strokeStyle=n,u.lineWidth=2,u.beginPath(),u.moveTo(0,i-s*t[1]);for(let f=2;f<t.length;f++)u.lineTo((f-1)*c,i-s*t[f]);u.stroke()}},created(){this.monitor=new dn(this.historyWindowSize,this.statWindowSize),this.wslinkSubscription=null,this.onStreamPacket=([e])=>{const{name:t,serverTime:r,contentSize:n}=this.packetDecorator(e);if(this.name===t){const a=this.monitor.addEntry(r,n);a&&(this.avg=a.avgFps,this.totalSize=a.totalSize,this.delta=1e3/(a.minMax[1]-a.minMax[0]),this.draw(a.client,a.server))}},this.trame&&(this.wslinkSubscription=this.trame.client.getConnection().getSession().subscribe(this.wsLinkTopic,this.onStreamPacket)),this.observer=new ResizeObserver(()=>{if(!this.$el)return;const{width:e,height:t}=this.$el.getBoundingClientRect();this.cw=e,this.ch=t})},mounted(){this.observer.observe(this.$el)},beforeDestroy(){this.cleanup()},beforeUnmount(){this.cleanup()},inject:["trame"],template:`
    <v-col style="width: 100%; height: 100%; position: relative;">
      <v-row class="text-subtitle-2" style="position: absolute; top: 0; left: 0; width: 100%; z-index: 1;">
        <v-icon>mdi-gauge</v-icon>
        <v-spacer />
        <div>
          {{ avg.toFixed(1) }} fps
        </div>
        <v-spacer />
        <v-icon>mdi-database-import</v-icon>
        <v-spacer />
        <div>
          {{ sizeUnit(totalSize) }}
        </div>
      </v-row>
      <canvas style="position: absolute; left: 0; top: 0;" class="js-canvas" :width="cw" :height="ch">
      </canvas>
    </v-col>
  `};function ke(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function mn(e){if(Array.isArray(e))return ke(e)}function wn(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function et(e,t){if(e){if(typeof e=="string")return ke(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ke(e,t)}}function Sn(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ie(e){return mn(e)||wn(e)||et(e)||Sn()}function K(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function En(e){if(Array.isArray(e))return e}function On(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,l=!1,y,u;try{for(r=r.call(e);!(a=(y=r.next()).done)&&(n.push(y.value),!(t&&n.length===t));a=!0);}catch(i){l=!0,u=i}finally{try{!a&&r.return!=null&&r.return()}finally{if(l)throw u}}return n}}function bn(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Re(e,t){return En(e)||On(e,t)||et(e,t)||bn()}function V(e){"@babel/helpers - typeof";return V=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},V(e)}function se(e,t){return se=Object.setPrototypeOf||function(n,a){return n.__proto__=a,n},se(e,t)}function xn(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function ue(e,t,r){return xn()?ue=Reflect.construct:ue=function(a,l,y){var u=[null];u.push.apply(u,l);var i=Function.bind.apply(a,u),s=new i;return y&&se(s,y.prototype),s},ue.apply(null,arguments)}var B=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function tt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Tn(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function n(){return this instanceof n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var a=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,a.get?a:{enumerable:!0,get:function(){return e[n]}})}),r}var kn=function e(t,r){if(t===r)return!0;if(t&&r&&typeof t=="object"&&typeof r=="object"){if(t.constructor!==r.constructor)return!1;var n,a,l;if(Array.isArray(t)){if(n=t.length,n!=r.length)return!1;for(a=n;a--!==0;)if(!e(t[a],r[a]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if(l=Object.keys(t),n=l.length,n!==Object.keys(r).length)return!1;for(a=n;a--!==0;)if(!Object.prototype.hasOwnProperty.call(r,l[a]))return!1;for(a=n;a--!==0;){var y=l[a];if(!e(t[y],r[y]))return!1}return!0}return t!==t&&r!==r};const Rn=tt(kn);var nt=Object.prototype.toString,rt=function(t){var r=nt.call(t),n=r==="[object Arguments]";return n||(n=r!=="[object Array]"&&t!==null&&typeof t=="object"&&typeof t.length=="number"&&t.length>=0&&nt.call(t.callee)==="[object Function]"),n},Me,ot;function Mn(){if(ot)return Me;ot=1;var e;if(!Object.keys){var t=Object.prototype.hasOwnProperty,r=Object.prototype.toString,n=rt,a=Object.prototype.propertyIsEnumerable,l=!a.call({toString:null},"toString"),y=a.call(function(){},"prototype"),u=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],i=function(p){var o=p.constructor;return o&&o.prototype===p},s={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},c=function(){if(typeof window>"u")return!1;for(var p in window)try{if(!s["$"+p]&&t.call(window,p)&&window[p]!==null&&typeof window[p]=="object")try{i(window[p])}catch{return!0}}catch{return!0}return!1}(),f=function(p){if(typeof window>"u"||!c)return i(p);try{return i(p)}catch{return!1}};e=function(o){var h=o!==null&&typeof o=="object",d=r.call(o)==="[object Function]",v=n(o),m=h&&r.call(o)==="[object String]",w=[];if(!h&&!d&&!v)throw new TypeError("Object.keys called on a non-object");var T=y&&d;if(m&&o.length>0&&!t.call(o,0))for(var g=0;g<o.length;++g)w.push(String(g));if(v&&o.length>0)for(var S=0;S<o.length;++S)w.push(String(S));else for(var E in o)!(T&&E==="prototype")&&t.call(o,E)&&w.push(String(E));if(l)for(var O=f(o),b=0;b<u.length;++b)!(O&&u[b]==="constructor")&&t.call(o,u[b])&&w.push(u[b]);return w}}return Me=e,Me}var jn=Array.prototype.slice,Dn=rt,at=Object.keys,ye=at?function(t){return at(t)}:Mn(),it=Object.keys;ye.shim=function(){if(Object.keys){var t=function(){var r=Object.keys(arguments);return r&&r.length===arguments.length}(1,2);t||(Object.keys=function(n){return Dn(n)?it(jn.call(n)):it(n)})}else Object.keys=ye;return Object.keys||ye};var Cn=ye,_n=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},r=Symbol("test"),n=Object(r);if(typeof r=="string"||Object.prototype.toString.call(r)!=="[object Symbol]"||Object.prototype.toString.call(n)!=="[object Symbol]")return!1;var a=42;t[r]=a;for(r in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var l=Object.getOwnPropertySymbols(t);if(l.length!==1||l[0]!==r||!Object.prototype.propertyIsEnumerable.call(t,r))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var y=Object.getOwnPropertyDescriptor(t,r);if(y.value!==a||y.enumerable!==!0)return!1}return!0},st=typeof Symbol<"u"&&Symbol,Ln=_n,Fn=function(){return typeof st!="function"||typeof Symbol!="function"||typeof st("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:Ln()},ut={foo:{}},Un=Object,Bn=function(){return{__proto__:ut}.foo===ut.foo&&!({__proto__:null}instanceof Un)},zn="Function.prototype.bind called on incompatible ",je=Array.prototype.slice,Wn=Object.prototype.toString,$n="[object Function]",Gn=function(t){var r=this;if(typeof r!="function"||Wn.call(r)!==$n)throw new TypeError(zn+r);for(var n=je.call(arguments,1),a,l=function(){if(this instanceof a){var c=r.apply(this,n.concat(je.call(arguments)));return Object(c)===c?c:this}else return r.apply(t,n.concat(je.call(arguments)))},y=Math.max(0,r.length-n.length),u=[],i=0;i<y;i++)u.push("$"+i);if(a=Function("binder","return function ("+u.join(",")+"){ return binder.apply(this,arguments); }")(l),r.prototype){var s=function(){};s.prototype=r.prototype,a.prototype=new s,s.prototype=null}return a},Nn=Gn,ct=Function.prototype.bind||Nn,Kn=ct,Vn=Kn.call(Function.call,Object.prototype.hasOwnProperty),x,Z=SyntaxError,ft=Function,I=TypeError,De=function(e){try{return ft('"use strict"; return ('+e+").constructor;")()}catch{}},q=Object.getOwnPropertyDescriptor;if(q)try{q({},"")}catch{q=null}var Ce=function(){throw new I},qn=q?function(){try{return arguments.callee,Ce}catch{try{return q(arguments,"callee").get}catch{return Ce}}}():Ce,ee=Fn(),Pn=Bn(),D=Object.getPrototypeOf||(Pn?function(e){return e.__proto__}:null),te={},Xn=typeof Uint8Array>"u"||!D?x:D(Uint8Array),P={"%AggregateError%":typeof AggregateError>"u"?x:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?x:ArrayBuffer,"%ArrayIteratorPrototype%":ee&&D?D([][Symbol.iterator]()):x,"%AsyncFromSyncIteratorPrototype%":x,"%AsyncFunction%":te,"%AsyncGenerator%":te,"%AsyncGeneratorFunction%":te,"%AsyncIteratorPrototype%":te,"%Atomics%":typeof Atomics>"u"?x:Atomics,"%BigInt%":typeof BigInt>"u"?x:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?x:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?x:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?x:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":typeof Float32Array>"u"?x:Float32Array,"%Float64Array%":typeof Float64Array>"u"?x:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?x:FinalizationRegistry,"%Function%":ft,"%GeneratorFunction%":te,"%Int8Array%":typeof Int8Array>"u"?x:Int8Array,"%Int16Array%":typeof Int16Array>"u"?x:Int16Array,"%Int32Array%":typeof Int32Array>"u"?x:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":ee&&D?D(D([][Symbol.iterator]())):x,"%JSON%":typeof JSON=="object"?JSON:x,"%Map%":typeof Map>"u"?x:Map,"%MapIteratorPrototype%":typeof Map>"u"||!ee||!D?x:D(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?x:Promise,"%Proxy%":typeof Proxy>"u"?x:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":typeof Reflect>"u"?x:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?x:Set,"%SetIteratorPrototype%":typeof Set>"u"||!ee||!D?x:D(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?x:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":ee&&D?D(""[Symbol.iterator]()):x,"%Symbol%":ee?Symbol:x,"%SyntaxError%":Z,"%ThrowTypeError%":qn,"%TypedArray%":Xn,"%TypeError%":I,"%Uint8Array%":typeof Uint8Array>"u"?x:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?x:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?x:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?x:Uint32Array,"%URIError%":URIError,"%WeakMap%":typeof WeakMap>"u"?x:WeakMap,"%WeakRef%":typeof WeakRef>"u"?x:WeakRef,"%WeakSet%":typeof WeakSet>"u"?x:WeakSet};if(D)try{null.error}catch(e){var Hn=D(D(e));P["%Error.prototype%"]=Hn}var Yn=function e(t){var r;if(t==="%AsyncFunction%")r=De("async function () {}");else if(t==="%GeneratorFunction%")r=De("function* () {}");else if(t==="%AsyncGeneratorFunction%")r=De("async function* () {}");else if(t==="%AsyncGenerator%"){var n=e("%AsyncGeneratorFunction%");n&&(r=n.prototype)}else if(t==="%AsyncIteratorPrototype%"){var a=e("%AsyncGenerator%");a&&D&&(r=D(a.prototype))}return P[t]=r,r},lt={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},ce=ct,ve=Vn,An=ce.call(Function.call,Array.prototype.concat),Jn=ce.call(Function.apply,Array.prototype.splice),ht=ce.call(Function.call,String.prototype.replace),de=ce.call(Function.call,String.prototype.slice),Qn=ce.call(Function.call,RegExp.prototype.exec),Zn=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,In=/\\(\\)?/g,er=function(t){var r=de(t,0,1),n=de(t,-1);if(r==="%"&&n!=="%")throw new Z("invalid intrinsic syntax, expected closing `%`");if(n==="%"&&r!=="%")throw new Z("invalid intrinsic syntax, expected opening `%`");var a=[];return ht(t,Zn,function(l,y,u,i){a[a.length]=u?ht(i,In,"$1"):y||l}),a},tr=function(t,r){var n=t,a;if(ve(lt,n)&&(a=lt[n],n="%"+a[0]+"%"),ve(P,n)){var l=P[n];if(l===te&&(l=Yn(n)),typeof l>"u"&&!r)throw new I("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:a,name:n,value:l}}throw new Z("intrinsic "+t+" does not exist!")},nr=function(t,r){if(typeof t!="string"||t.length===0)throw new I("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof r!="boolean")throw new I('"allowMissing" argument must be a boolean');if(Qn(/^%?[^%]*%?$/,t)===null)throw new Z("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=er(t),a=n.length>0?n[0]:"",l=tr("%"+a+"%",r),y=l.name,u=l.value,i=!1,s=l.alias;s&&(a=s[0],Jn(n,An([0,1],s)));for(var c=1,f=!0;c<n.length;c+=1){var p=n[c],o=de(p,0,1),h=de(p,-1);if((o==='"'||o==="'"||o==="`"||h==='"'||h==="'"||h==="`")&&o!==h)throw new Z("property names with quotes must have matching quotes");if((p==="constructor"||!f)&&(i=!0),a+="."+p,y="%"+a+"%",ve(P,y))u=P[y];else if(u!=null){if(!(p in u)){if(!r)throw new I("base intrinsic for "+t+" exists, but the property is not available.");return}if(q&&c+1>=n.length){var d=q(u,p);f=!!d,f&&"get"in d&&!("originalValue"in d.get)?u=d.get:u=u[p]}else f=ve(u,p),u=u[p];f&&!i&&(P[y]=u)}}return u},rr=nr,_e=rr("%Object.defineProperty%",!0),Le=function(){if(_e)try{return _e({},"a",{value:1}),!0}catch{return!1}return!1};Le.hasArrayLengthDefineBug=function(){if(!Le())return null;try{return _e([],"length",{value:1}).length!==1}catch{return!0}};var or=Le,ar=Cn,ir=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",sr=Object.prototype.toString,ur=Array.prototype.concat,pt=Object.defineProperty,cr=function(e){return typeof e=="function"&&sr.call(e)==="[object Function]"},fr=or(),yt=pt&&fr,lr=function(e,t,r,n){if(t in e){if(n===!0){if(e[t]===r)return}else if(!cr(n)||!n())return}yt?pt(e,t,{configurable:!0,enumerable:!1,value:r,writable:!0}):e[t]=r},vt=function(e,t){var r=arguments.length>2?arguments[2]:{},n=ar(t);ir&&(n=ur.call(n,Object.getOwnPropertySymbols(t)));for(var a=0;a<n.length;a+=1)lr(e,n[a],t[n[a]],r[n[a]])};vt.supportsDescriptors=!!yt;var dt=vt,ge={exports:{}};typeof self<"u"?ge.exports=self:typeof window<"u"?ge.exports=window:ge.exports=Function("return this")();var gt=ge.exports,hr=gt,mt=function(){return typeof B!="object"||!B||B.Math!==Math||B.Array!==Array?hr:B},pr=dt,yr=mt,vr=function(){var t=yr();if(pr.supportsDescriptors){var r=Object.getOwnPropertyDescriptor(t,"globalThis");(!r||r.configurable&&(r.enumerable||!r.writable||globalThis!==t))&&Object.defineProperty(t,"globalThis",{configurable:!0,enumerable:!1,value:t,writable:!0})}else(typeof globalThis!="object"||globalThis!==t)&&(t.globalThis=t);return t},dr=dt,gr=gt,wt=mt,mr=vr,wr=wt(),St=function(){return wr};dr(St,{getPolyfill:wt,implementation:gr,shim:mr});var Sr=St;const Er=tt(Sr);function Et(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Or(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Et(Object(r),!0).forEach(function(n){K(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Et(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var W=Er(),Ot={vtkObject:function(){return null}};function X(e){if(e==null||e.isA)return e;if(!e.vtkClass)return W.console&&W.console.error&&W.console.error("Invalid VTK object"),null;var t=Ot[e.vtkClass];if(!t)return W.console&&W.console.error&&W.console.error("No vtk class found for Object of type ".concat(e.vtkClass)),null;var r=Or({},e);Object.keys(r).forEach(function(a){r[a]&&V(r[a])==="object"&&r[a].vtkClass&&(r[a]=X(r[a]))});var n=t(r);return n&&n.modified&&n.modified(),n}function br(e,t){Ot[e]=t}X.register=br;function xr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function bt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Tr(e,t,r){return t&&bt(e.prototype,t),r&&bt(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function H(e){return H=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},H(e)}function kr(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&(e=H(e),e!==null););return e}function me(){return typeof Reflect<"u"&&Reflect.get?me=Reflect.get:me=function(t,r,n){var a=kr(t,r);if(a){var l=Object.getOwnPropertyDescriptor(a,r);return l.get?l.get.call(arguments.length<3?t:n):l.value}},me.apply(this,arguments)}function Rr(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&se(e,t)}function Mr(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function jr(e,t){if(t&&(V(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Mr(e)}function Dr(e){return Function.toString.call(e).indexOf("[native code]")!==-1}function Fe(e){var t=typeof Map=="function"?new Map:void 0;return Fe=function(n){if(n===null||!Dr(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof t<"u"){if(t.has(n))return t.get(n);t.set(n,a)}function a(){return ue(n,arguments,H(this).constructor)}return a.prototype=Object.create(n.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),se(a,n)},Fe(e)}function Cr(e){var t=_r();return function(){var n=H(e),a;if(t){var l=H(this).constructor;a=Reflect.construct(n,arguments,l)}else a=n.apply(this,arguments);return jr(this,a)}}function _r(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Ue=function(e){Rr(r,e);var t=Cr(r);function r(){return xr(this,r),t.apply(this,arguments)}return Tr(r,[{key:"push",value:function(){for(var a=0;a<arguments.length;a++)this.includes(arguments[a])||me(H(r.prototype),"push",this).call(this,arguments[a]);return this.length}}]),r}(Fe(Array));function xt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function we(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?xt(Object(r),!0).forEach(function(n){K(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xt(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Be=0,Lr=Symbol("void");function Fr(){return Be}var Tt={};function Y(){}var Ur=["log","debug","info","warn","error","time","timeEnd","group","groupEnd"];Ur.forEach(function(e){Tt[e]=Y}),W.console=console.hasOwnProperty("log")?console:Tt;var U={debug:Y,error:W.console.error||Y,info:W.console.info||Y,log:W.console.log||Y,warn:W.console.warn||Y};function Br(e,t){U[e]&&(U[e]=t||Y)}function zr(){U.log.apply(U,arguments)}function Wr(){U.info.apply(U,arguments)}function ze(){U.debug.apply(U,arguments)}function C(){U.error.apply(U,arguments)}function kt(){U.warn.apply(U,arguments)}var Rt={};function $r(e){Rt[e]||(U.error(e),Rt[e]=!0)}var F=Object.create(null);F.Float32Array=Float32Array,F.Float64Array=Float64Array,F.Uint8Array=Uint8Array,F.Int8Array=Int8Array,F.Uint16Array=Uint16Array,F.Int16Array=Int16Array,F.Uint32Array=Uint32Array,F.Int32Array=Int32Array,F.Uint8ClampedArray=Uint8ClampedArray;try{F.BigInt64Array=BigInt64Array,F.BigUint64Array=BigUint64Array}catch{}function Gr(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return ue(F[e]||Float64Array,r)}function Nr(e){for(var t,r=arguments.length,n=new Array(r>1?r-1:0),a=1;a<r;a++)n[a-1]=arguments[a];return(t=F[e]||Float64Array).from.apply(t,n)}function We(e){return e.charAt(0).toUpperCase()+e.slice(1)}function j(e){return We(e[0]==="_"?e.slice(1):e)}function Kr(e){return e.charAt(0).toLowerCase()+e.slice(1)}function Vr(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1e3,n=["TB","GB","MB","KB"],a=Number(e),l="B";a>r;)a/=r,l=n.pop();return"".concat(a.toFixed(t)," ").concat(l)}function qr(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:" ",r=[],n=e;n>1e3;)r.push("000".concat(n%1e3).slice(-3)),n=Math.floor(n/1e3);return n>0&&r.push(n),r.reverse(),r.join(t)}function Mt(e){Object.keys(e).forEach(function(t){Array.isArray(e[t])&&(e[t]=[].concat(e[t]))})}function Pr(e,t){if(e===t)return!0;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}return!1}function Xr(e,t){return Object.keys(e).find(function(r){return e[r]===t})}function jt(e){return e&&e.isA?e.getState():e}function Dt(e){setTimeout(e,0)}function Hr(e,t){var r=performance.now();e.finally(function(){var n=performance.now()-r;t(n)})}function Yr(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Mt(t);var r=[];if(Number.isInteger(t.mtime)||(t.mtime=++Be),!("classHierarchy"in t))t.classHierarchy=new Ue("vtkObject");else if(!(t.classHierarchy instanceof Ue)){for(var n=new Ue,a=0;a<t.classHierarchy.length;a++)n.push(t.classHierarchy[a]);t.classHierarchy=n}function l(u){r[u]=null}function y(u){function i(){l(u)}return Object.freeze({unsubscribe:i})}return e.isDeleted=function(){return!!t.deleted},e.modified=function(u){if(t.deleted){C("instance deleted - cannot call any method");return}u&&u<e.getMTime()||(t.mtime=++Be,r.forEach(function(i){return i&&i(e)}))},e.onModified=function(u){if(t.deleted)return C("instance deleted - cannot call any method"),null;var i=r.length;return r.push(u),y(i)},e.getMTime=function(){return t.mtime},e.isA=function(u){for(var i=t.classHierarchy.length;i--;)if(t.classHierarchy[i]===u)return!0;return!1},e.getClassName=function(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return t.classHierarchy[t.classHierarchy.length-1-u]},e.set=function(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,c=!1;return Object.keys(u).forEach(function(f){var p=s?null:e["set".concat(We(f))];p&&Array.isArray(u[f])&&p.length>1?c=p.apply(void 0,ie(u[f]))||c:p?c=p(u[f])||c:(["mtime"].indexOf(f)===-1&&!i&&kt("Warning: Set value to model directly ".concat(f,", ").concat(u[f])),c=t[f]!==u[f]||c,t[f]=u[f])}),c},e.get=function(){for(var u=arguments.length,i=new Array(u),s=0;s<u;s++)i[s]=arguments[s];if(!i.length)return t;var c={};return i.forEach(function(f){c[f]=t[f]}),c},e.getReferenceByName=function(u){return t[u]},e.delete=function(){Object.keys(t).forEach(function(u){return delete t[u]}),r.forEach(function(u,i){return l(i)}),t.deleted=!0},e.getState=function(){if(t.deleted)return null;var u=we(we({},t),{},{vtkClass:e.getClassName()});Object.keys(u).forEach(function(s){u[s]===null||u[s]===void 0||s[0]==="_"?delete u[s]:u[s].isA?u[s]=u[s].getState():Array.isArray(u[s])&&(u[s]=u[s].map(jt))});var i={};return Object.keys(u).sort().forEach(function(s){i[s]=u[s]}),i.mtime&&delete i.mtime,i},e.shallowCopy=function(u){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(u.getClassName()!==e.getClassName())throw new Error("Cannot ShallowCopy ".concat(u.getClassName()," into ").concat(e.getClassName()));var s=u.get(),c=Object.keys(t).sort(),f=Object.keys(s).sort();f.forEach(function(p){var o=c.indexOf(p);o===-1?i&&ze("add ".concat(p," in shallowCopy")):c.splice(o,1),t[p]=s[p]}),c.length&&i&&ze("Untouched keys: ".concat(c.join(", "))),e.modified()},e.toJSON=function(){return e.getState()},e}var Ar={object:function(t,r,n){return function(){return we({},r[n.name])}}};function Se(e,t,r){r.forEach(function(n){if(V(n)==="object"){var a=Ar[n.type];a?e["get".concat(j(n.name))]=a(e,t,n):e["get".concat(j(n.name))]=function(){return t[n.name]}}else e["get".concat(j(n))]=function(){return t[n]}})}var Jr={enum:function(t,r,n){var a="_on".concat(j(n.name),"Changed");return function(l){if(typeof l=="string"){if(n.enum[l]!==void 0)return r[n.name]!==n.enum[l]?(r[n.name]=n.enum[l],t.modified(),!0):!1;throw C("Set Enum with invalid argument ".concat(n,", ").concat(l)),new RangeError("Set Enum with invalid string argument")}if(typeof l=="number"){if(r[n.name]!==l){if(Object.keys(n.enum).map(function(i){return n.enum[i]}).indexOf(l)!==-1){var y,u=r[n.name];return r[n.name]=l,(y=r[a])===null||y===void 0||y.call(r,t,r,l,u),t.modified(),!0}throw C("Set Enum outside numeric range ".concat(n,", ").concat(l)),new RangeError("Set Enum outside numeric range")}return!1}throw C("Set Enum with invalid argument (String/Number) ".concat(n,", ").concat(l)),new TypeError("Set Enum with invalid argument (String/Number)")}},object:function(t,r,n){var a="_on".concat(j(n.name),"Changed");return function(l){if(!Rn(r[n.name],l)){var y,u=r[n.name];return r[n.name]=l,(y=r[a])===null||y===void 0||y.call(r,t,r,l,u),t.modified(),!0}return!1}}};function Ct(e){if(V(e)==="object"){var t=Jr[e.type];if(t)return function(r,n){return t(r,n,e)};throw C("No setter for field ".concat(e)),new TypeError("No setter for field")}return function(n,a){var l="_on".concat(j(e),"Changed");return function(u){if(a.deleted)return C("instance deleted - cannot call any method"),!1;if(a[e]!==u){var i,s=a[e.name];return a[e]=u,(i=a[l])===null||i===void 0||i.call(a,n,a,u,s),n.modified(),!0}return!1}}}function _t(e,t,r){r.forEach(function(n){V(n)==="object"?e["set".concat(j(n.name))]=Ct(n)(e,t):e["set".concat(j(n))]=Ct(n)(e,t)})}function Lt(e,t,r){Se(e,t,r),_t(e,t,r)}function Ft(e,t,r){r.forEach(function(n){e["get".concat(j(n))]=function(){return t[n]?Array.from(t[n]):t[n]},e["get".concat(j(n),"ByReference")]=function(){return t[n]}})}function Ut(e,t,r,n){var a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0;r.forEach(function(l){if(t[l]&&n&&t[l].length!==n)throw new RangeError("Invalid initial number of values for array (".concat(l,")"));var y="_on".concat(j(l),"Changed");e["set".concat(j(l))]=function(){if(t.deleted)return C("instance deleted - cannot call any method"),!1;for(var u=arguments.length,i=new Array(u),s=0;s<u;s++)i[s]=arguments[s];var c=i,f,p=!1;if(c.length===1&&(c[0]==null||c[0].length>=0)&&(c=c[0],p=!0),c==null)f=t[l]!==c;else{if(n&&c.length!==n)if(c.length<n&&a!==void 0)for(c=Array.from(c),p=!1;c.length<n;)c.push(a);else throw new RangeError("Invalid number of values for array setter (".concat(l,")"));f=t[l]==null||t[l].length!==c.length;for(var o=0;!f&&o<c.length;++o)f=t[l][o]!==c[o];f&&p&&(c=Array.from(c))}if(f){var h,d=t[l.name];t[l]=c,(h=t[y])===null||h===void 0||h.call(t,e,t,c,d),e.modified()}return f},e["set".concat(j(l),"From")]=function(u){var i=t[l];u.forEach(function(s,c){i[c]=s})}})}function Qr(e,t,r,n){var a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0;Ft(e,t,r),Ut(e,t,r,n,a)}function Zr(e,t,r){for(var n=0;n<r.length;n++){var a=r[n];t[a]!==void 0&&(t["_".concat(a)]=t[a],delete t[a])}}function Ir(e,t,r,n){t.inputData?t.inputData=t.inputData.map(X):t.inputData=[],t.inputConnection?t.inputConnection=t.inputConnection.map(X):t.inputConnection=[],t.output?t.output=t.output.map(X):t.output=[],t.inputArrayToProcess?t.inputArrayToProcess=t.inputArrayToProcess.map(X):t.inputArrayToProcess=[],t.numberOfInputs=r;function a(h){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(t.deleted){C("instance deleted - cannot call any method");return}if(d>=t.numberOfInputs){C("algorithm ".concat(e.getClassName()," only has ").concat(t.numberOfInputs," input ports. To add more input ports, use addInputData()"));return}(t.inputData[d]!==h||t.inputConnection[d])&&(t.inputData[d]=h,t.inputConnection[d]=null,e.modified&&e.modified())}function l(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return t.inputConnection[h]&&(t.inputData[h]=t.inputConnection[h]()),t.inputData[h]}function y(h){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(t.deleted){C("instance deleted - cannot call any method");return}if(d>=t.numberOfInputs){var v="algorithm ".concat(e.getClassName()," only has ");v+="".concat(t.numberOfInputs),v+=" input ports. To add more input ports, use addInputConnection()",C(v);return}t.inputData[d]=null,t.inputConnection[d]=h}function u(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return t.inputConnection[h]}function i(){for(var h=t.numberOfInputs;h&&!t.inputData[h-1]&&!t.inputConnection[h-1];)h--;return h===t.numberOfInputs&&t.numberOfInputs++,h}function s(h){if(t.deleted){C("instance deleted - cannot call any method");return}y(h,i())}function c(h){if(t.deleted){C("instance deleted - cannot call any method");return}a(h,i())}function f(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return t.deleted?(C("instance deleted - cannot call any method"),null):(e.shouldUpdate()&&e.update(),t.output[h])}e.shouldUpdate=function(){for(var h=e.getMTime(),d=1/0,v=n;v--;){if(!t.output[v]||t.output[v].isDeleted())return!0;var m=t.output[v].getMTime();if(m<h)return!0;m<d&&(d=m)}for(v=t.numberOfInputs;v--;){var w,T;if((w=t.inputConnection[v])!==null&&w!==void 0&&w.filter.shouldUpdate()||((T=e.getInputData(v))===null||T===void 0?void 0:T.getMTime())>d)return!0}return!1};function p(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,d=function(){return f(h)};return d.filter=e,d}if(t.numberOfInputs){for(var o=t.numberOfInputs;o--;)t.inputData.push(null),t.inputConnection.push(null);e.setInputData=a,e.setInputConnection=y,e.addInputData=c,e.addInputConnection=s,e.getInputData=l,e.getInputConnection=u}n&&(e.getOutputData=f,e.getOutputPort=p),e.update=function(){var h=[];if(t.numberOfInputs)for(var d=0;d<t.numberOfInputs;)h[d]=e.getInputData(d),d++;e.shouldUpdate()&&e.requestData&&e.requestData(h,t.output)},e.getNumberOfInputPorts=function(){return t.numberOfInputs},e.getNumberOfOutputPorts=function(){return n||t.output.length},e.getInputArrayToProcess=function(h){var d=t.inputArrayToProcess[h],v=t.inputData[h];return d&&v?v["get".concat(d.fieldAssociation)]().getArray(d.arrayName):null},e.setInputArrayToProcess=function(h,d,v){for(var m=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"Scalars";t.inputArrayToProcess.length<h;)t.inputArrayToProcess.push(null);t.inputArrayToProcess[h]={arrayName:d,fieldAssociation:v,attributeType:m}}}var Bt=Symbol("Event abort");function eo(e,t,r){var n=[],a=e.delete,l=1;function y(s){for(var c=0;c<n.length;++c){var f=Re(n[c],1),p=f[0];if(p===s){n.splice(c,1);return}}}function u(s){function c(){y(s)}return Object.freeze({unsubscribe:c})}function i(){var s=arguments;if(t.deleted){C("instance deleted - cannot call any method");return}for(var c=n.slice(),f=function(d){var v=Re(c[d],3),m=v[1],w=v[2];if(!m)return"continue";if(w<0)setTimeout(function(){return m.apply(e,s)},1-w);else{var T=m.apply(e,s);if(T===Bt)return"break"}},p=0;p<c.length;++p){var o=f(p);if(o!=="continue"&&o==="break")break}}e["invoke".concat(j(r))]=i,e["on".concat(j(r))]=function(s){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!s.apply)return console.error("Invalid callback for event ".concat(r)),null;if(t.deleted)return C("instance deleted - cannot call any method"),null;var f=l++;return n.push([f,s,c]),n.sort(function(p,o){return o[2]-p[2]}),u(f)},e.delete=function(){a(),n.forEach(function(s){var c=Re(s,1),f=c[0];return y(f)})}}function to(e,t){var r=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l={},y={};return e(y,l,a),Object.freeze(y)};return t&&X.register(t,r),r}function no(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(){for(var n=arguments.length,a=new Array(n),l=0;l<n;l++)a[l]=arguments[l];return t.filter(function(y){return!!y}).map(function(y){return y.apply(void 0,a)})}}function zt(e){return e&&e.isA&&e.isA("vtkObject")}function $e(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[];if(zt(e)){if(n.indexOf(e)>=0)return r;n.push(e);var a=t(e);a!==void 0&&r.push(a);var l=e.get();Object.keys(l).forEach(function(y){var u=l[y];Array.isArray(u)?u.forEach(function(i){$e(i,t,r,n)}):$e(u,t,r,n)})}return r}function ro(e,t,r){var n=this,a,l=function(){for(var u=arguments.length,i=new Array(u),s=0;s<u;s++)i[s]=arguments[s];var c=n,f=function(){a=null,r||e.apply(c,i)},p=r&&!a;clearTimeout(a),a=setTimeout(f,t),p&&e.apply(c,i)};return l.cancel=function(){return clearTimeout(a)},l}function oo(e,t){var r=!1,n=null;function a(){r=!1,n!==null&&(l.apply(void 0,ie(n)),n=null)}function l(){for(var y=arguments.length,u=new Array(y),i=0;i<y;i++)u[i]=arguments[i];if(r){n=u;return}r=!0,e.apply(void 0,u),setTimeout(a,t)}return l}function Wt(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};t.keystore=Object.assign(t.keystore||{},r),e.setKey=function(n,a){t.keystore[n]=a},e.getKey=function(n){return t.keystore[n]},e.getAllKeys=function(){return Object.keys(t.keystore)},e.deleteKey=function(n){return delete t.keystore[n]},e.clearKeystore=function(){return e.getAllKeys().forEach(function(n){return delete t.keystore[n]})}}var ao=1,Ee="__root__";function io(e,t){Wt(e,t);var r=e.delete;t.proxyId="".concat(ao++),t.ui=JSON.parse(JSON.stringify(t.ui||[])),Se(e,t,["proxyId","proxyGroup","proxyName"]),Lt(e,t,["proxyManager"]);var n={},a={};function l(s,c){a[c]||(a[c]=[]);for(var f=a[c],p=0;p<s.length;p++)f.push(s[p].name),n[s[p].name]=s[p],s[p].children&&s[p].children.length&&l(s[p].children,s[p].name)}l(t.ui,Ee),e.updateUI=function(s){t.ui=JSON.parse(JSON.stringify(s||[])),Object.keys(n).forEach(function(c){return delete n[c]}),Object.keys(a).forEach(function(c){return delete a[c]}),l(t.ui,Ee),e.modified()};function y(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Ee;return a[s]}e.updateProxyProperty=function(s,c){var f=n[s];f?Object.assign(f,c):n[s]=we({},c)},e.activate=function(){if(t.proxyManager){var s="setActive".concat(j(e.getProxyGroup().slice(0,-1)));t.proxyManager[s]&&t.proxyManager[s](e)}},t.propertyLinkSubscribers={},e.registerPropertyLinkForGC=function(s,c){c in t.propertyLinkSubscribers||(t.propertyLinkSubscribers[c]=[]),t.propertyLinkSubscribers[c].push(s)},e.gcPropertyLinks=function(s){for(var c=t.propertyLinkSubscribers[s]||[];c.length;)c.pop().unbind(e)},t.propertyLinkMap={},e.getPropertyLink=function(s){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(t.propertyLinkMap[s])return t.propertyLinkMap[s];var f=null,p=[],o=0,h=!1;function d(g){var S=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(h)return null;var E=[],O=null;for(o=p.length;o--;){var b=p[o];b.instance===g?O=b:E.push(b)}if(!O)return null;var M=O.instance["get".concat(j(O.propertyName))]();if(!Pr(M,f)||S){for(f=M,h=!0;E.length;){var _=E.pop();_.instance.set(K({},_.propertyName,f))}h=!1}return t.propertyLinkMap[s].persistent&&(t.propertyLinkMap[s].value=M),M}function v(g,S){var E=[];for(o=p.length;o--;){var O=p[o];O.instance===g&&(O.propertyName===S||S===void 0)&&(O.subscription.unsubscribe(),E.push(o))}for(;E.length;)p.splice(E.pop(),1)}function m(g,S){var E=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,O=g.onModified(d),b=p[0];return p.push({instance:g,propertyName:S,subscription:O}),E&&(t.propertyLinkMap[s].persistent&&t.propertyLinkMap[s].value!==void 0?g.set(K({},S,t.propertyLinkMap[s].value)):b&&d(b.instance,!0)),{unsubscribe:function(){return v(g,S)}}}function w(){for(;p.length;)p.pop().subscription.unsubscribe()}var T={bind:m,unbind:v,unsubscribe:w,persistent:c};return t.propertyLinkMap[s]=T,T};function u(){for(var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Ee,c=[],f=t.proxyId,p=y(s)||[],o=0;o<p.length;o++){var h=p[o],d=e["get".concat(j(h))],v=d?d():void 0,m={id:f,name:h,value:v},w=u(h);w.length&&(m.children=w),c.push(m)}return c}e.listPropertyNames=function(){return u().map(function(s){return s.name})},e.getPropertyByName=function(s){return u().find(function(c){return c.name===s})},e.getPropertyDomainByName=function(s){return(n[s]||{}).domain},e.getProxySection=function(){return{id:t.proxyId,name:t.proxyGroup,ui:t.ui,properties:u()}},e.delete=function(){for(var s=Object.keys(t.propertyLinkMap),c=s.length;c--;)t.propertyLinkMap[s[c]].unsubscribe();Object.keys(t.propertyLinkSubscribers).forEach(e.gcPropertyLinks),r()},e.getState=function(){return null};function i(){if(t.links)for(var s=0;s<t.links.length;s++){var c=t.links[s],f=c.link,p=c.property,o=c.persistent,h=c.updateOnBind,d=c.type;if(d==="application"){var v=t.proxyManager.getPropertyLink(f,o);e.registerPropertyLinkForGC(v,"application"),v.bind(e,p,h)}}}Dt(i)}function so(e,t,r){for(var n=e.delete,a=[],l=Object.keys(r),y=l.length;y--;){var u=l[y],i=r[u],s=i.modelKey,c=i.property,f=i.modified,p=f===void 0?!0:f,o=j(c),h=j(u);e["get".concat(h)]=t[s]["get".concat(o)],e["set".concat(h)]=t[s]["set".concat(o)],p&&a.push(t[s].onModified(e.modified))}e.delete=function(){for(;a.length;)a.pop().unsubscribe();n()}}function uo(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};t.this=e;function a(i){for(var s=Object.keys(i),c=s.length;c--;){var f=s[c];t[f].set(i[f])}}for(var l=Object.keys(n),y=l.length,u=function(){var s=l[y];t[s]=n[s];var c=r[s];e["set".concat(j(s))]=function(f){if(f!==t[s]){t[s]=f;var p=c[f];a(p),e.modified()}}};y--;)u();l.length&&Se(e,t,l)}var $t=10,Gt=40,Nt=800;function co(e){var t=0,r=0,n=0,a=0;return"detail"in e&&(r=e.detail),"wheelDelta"in e&&(r=-e.wheelDelta/120),"wheelDeltaY"in e&&(r=-e.wheelDeltaY/120),"wheelDeltaX"in e&&(t=-e.wheelDeltaX/120),"axis"in e&&e.axis===e.HORIZONTAL_AXIS&&(t=r,r=0),n=t*$t,a=r*$t,"deltaY"in e&&(a=e.deltaY),"deltaX"in e&&(n=e.deltaX),(n||a)&&e.deltaMode&&(e.deltaMode===1?(n*=Gt,a*=Gt):(n*=Nt,a*=Nt)),n&&!t&&(t=n<1?-1:1),a&&!r&&(r=a<1?-1:1),{spinX:t,spinY:r,pixelX:n,pixelY:a}}var k={algo:Ir,capitalize:We,chain:no,debounce:ro,enumToString:Xr,event:eo,EVENT_ABORT:Bt,formatBytesToProperUnit:Vr,formatNumbersWithThousandSeparator:qr,get:Se,getArray:Ft,getCurrentGlobalMTime:Fr,getStateArrayMapFunc:jt,isVtkObject:zt,keystore:Wt,measurePromiseExecution:Hr,moveToProtected:Zr,newInstance:to,newTypedArray:Gr,newTypedArrayFrom:Nr,normalizeWheel:co,obj:Yr,proxy:io,proxyPropertyMapping:so,proxyPropertyState:uo,safeArrays:Mt,set:_t,setArray:Ut,setGet:Lt,setGetArray:Qr,setImmediate:Dt,setLoggerFunction:Br,throttle:oo,traverseInstanceTree:$e,TYPED_ARRAYS:F,uncapitalize:Kr,VOID:Lr,vtkDebugMacro:ze,vtkErrorMacro:C,vtkInfoMacro:Wr,vtkLogMacro:zr,vtkOnceErrorMacro:$r,vtkWarningMacro:kt},Ge={exports:{}};Ge.exports,function(e){(function(t,r,n){function a(i){var s=this,c=u();s.next=function(){var f=2091639*s.s0+s.c*23283064365386963e-26;return s.s0=s.s1,s.s1=s.s2,s.s2=f-(s.c=f|0)},s.c=1,s.s0=c(" "),s.s1=c(" "),s.s2=c(" "),s.s0-=c(i),s.s0<0&&(s.s0+=1),s.s1-=c(i),s.s1<0&&(s.s1+=1),s.s2-=c(i),s.s2<0&&(s.s2+=1),c=null}function l(i,s){return s.c=i.c,s.s0=i.s0,s.s1=i.s1,s.s2=i.s2,s}function y(i,s){var c=new a(i),f=s&&s.state,p=c.next;return p.int32=function(){return c.next()*4294967296|0},p.double=function(){return p()+(p()*2097152|0)*11102230246251565e-32},p.quick=p,f&&(typeof f=="object"&&l(f,c),p.state=function(){return l(c,{})}),p}function u(){var i=4022871197,s=function(c){c=String(c);for(var f=0;f<c.length;f++){i+=c.charCodeAt(f);var p=.02519603282416938*i;i=p>>>0,p-=i,p*=i,i=p>>>0,p-=i,i+=p*4294967296}return(i>>>0)*23283064365386963e-26};return s}r&&r.exports?r.exports=y:n&&n.amd?n(function(){return y}):this.alea=y})(B,e,!1)}(Ge);var fo=Ge.exports,Ne={exports:{}};Ne.exports,function(e){(function(t,r,n){function a(u){var i=this,s="";i.x=0,i.y=0,i.z=0,i.w=0,i.next=function(){var f=i.x^i.x<<11;return i.x=i.y,i.y=i.z,i.z=i.w,i.w^=i.w>>>19^f^f>>>8},u===(u|0)?i.x=u:s+=u;for(var c=0;c<s.length+64;c++)i.x^=s.charCodeAt(c)|0,i.next()}function l(u,i){return i.x=u.x,i.y=u.y,i.z=u.z,i.w=u.w,i}function y(u,i){var s=new a(u),c=i&&i.state,f=function(){return(s.next()>>>0)/4294967296};return f.double=function(){do var p=s.next()>>>11,o=(s.next()>>>0)/4294967296,h=(p+o)/(1<<21);while(h===0);return h},f.int32=s.next,f.quick=f,c&&(typeof c=="object"&&l(c,s),f.state=function(){return l(s,{})}),f}r&&r.exports?r.exports=y:n&&n.amd?n(function(){return y}):this.xor128=y})(B,e,!1)}(Ne);var lo=Ne.exports,Ke={exports:{}};Ke.exports,function(e){(function(t,r,n){function a(u){var i=this,s="";i.next=function(){var f=i.x^i.x>>>2;return i.x=i.y,i.y=i.z,i.z=i.w,i.w=i.v,(i.d=i.d+362437|0)+(i.v=i.v^i.v<<4^(f^f<<1))|0},i.x=0,i.y=0,i.z=0,i.w=0,i.v=0,u===(u|0)?i.x=u:s+=u;for(var c=0;c<s.length+64;c++)i.x^=s.charCodeAt(c)|0,c==s.length&&(i.d=i.x<<10^i.x>>>4),i.next()}function l(u,i){return i.x=u.x,i.y=u.y,i.z=u.z,i.w=u.w,i.v=u.v,i.d=u.d,i}function y(u,i){var s=new a(u),c=i&&i.state,f=function(){return(s.next()>>>0)/4294967296};return f.double=function(){do var p=s.next()>>>11,o=(s.next()>>>0)/4294967296,h=(p+o)/(1<<21);while(h===0);return h},f.int32=s.next,f.quick=f,c&&(typeof c=="object"&&l(c,s),f.state=function(){return l(s,{})}),f}r&&r.exports?r.exports=y:n&&n.amd?n(function(){return y}):this.xorwow=y})(B,e,!1)}(Ke);var ho=Ke.exports,Ve={exports:{}};Ve.exports,function(e){(function(t,r,n){function a(u){var i=this;i.next=function(){var c=i.x,f=i.i,p,o;return p=c[f],p^=p>>>7,o=p^p<<24,p=c[f+1&7],o^=p^p>>>10,p=c[f+3&7],o^=p^p>>>3,p=c[f+4&7],o^=p^p<<7,p=c[f+7&7],p=p^p<<13,o^=p^p<<9,c[f]=o,i.i=f+1&7,o};function s(c,f){var p,o=[];if(f===(f|0))o[0]=f;else for(f=""+f,p=0;p<f.length;++p)o[p&7]=o[p&7]<<15^f.charCodeAt(p)+o[p+1&7]<<13;for(;o.length<8;)o.push(0);for(p=0;p<8&&o[p]===0;++p);for(p==8?o[7]=-1:o[p],c.x=o,c.i=0,p=256;p>0;--p)c.next()}s(i,u)}function l(u,i){return i.x=u.x.slice(),i.i=u.i,i}function y(u,i){u==null&&(u=+new Date);var s=new a(u),c=i&&i.state,f=function(){return(s.next()>>>0)/4294967296};return f.double=function(){do var p=s.next()>>>11,o=(s.next()>>>0)/4294967296,h=(p+o)/(1<<21);while(h===0);return h},f.int32=s.next,f.quick=f,c&&(c.x&&l(c,s),f.state=function(){return l(s,{})}),f}r&&r.exports?r.exports=y:n&&n.amd?n(function(){return y}):this.xorshift7=y})(B,e,!1)}(Ve);var po=Ve.exports,qe={exports:{}};qe.exports,function(e){(function(t,r,n){function a(u){var i=this;i.next=function(){var c=i.w,f=i.X,p=i.i,o,h;return i.w=c=c+1640531527|0,h=f[p+34&127],o=f[p=p+1&127],h^=h<<13,o^=o<<17,h^=h>>>15,o^=o>>>12,h=f[p]=h^o,i.i=p,h+(c^c>>>16)|0};function s(c,f){var p,o,h,d,v,m=[],w=128;for(f===(f|0)?(o=f,f=null):(f=f+"\0",o=0,w=Math.max(w,f.length)),h=0,d=-32;d<w;++d)f&&(o^=f.charCodeAt((d+32)%f.length)),d===0&&(v=o),o^=o<<10,o^=o>>>15,o^=o<<4,o^=o>>>13,d>=0&&(v=v+1640531527|0,p=m[d&127]^=o+v,h=p==0?h+1:0);for(h>=128&&(m[(f&&f.length||0)&127]=-1),h=127,d=4*128;d>0;--d)o=m[h+34&127],p=m[h=h+1&127],o^=o<<13,p^=p<<17,o^=o>>>15,p^=p>>>12,m[h]=o^p;c.w=v,c.X=m,c.i=h}s(i,u)}function l(u,i){return i.i=u.i,i.w=u.w,i.X=u.X.slice(),i}function y(u,i){u==null&&(u=+new Date);var s=new a(u),c=i&&i.state,f=function(){return(s.next()>>>0)/4294967296};return f.double=function(){do var p=s.next()>>>11,o=(s.next()>>>0)/4294967296,h=(p+o)/(1<<21);while(h===0);return h},f.int32=s.next,f.quick=f,c&&(c.X&&l(c,s),f.state=function(){return l(s,{})}),f}r&&r.exports?r.exports=y:n&&n.amd?n(function(){return y}):this.xor4096=y})(B,e,!1)}(qe);var yo=qe.exports,Pe={exports:{}};Pe.exports,function(e){(function(t,r,n){function a(u){var i=this,s="";i.next=function(){var f=i.b,p=i.c,o=i.d,h=i.a;return f=f<<25^f>>>7^p,p=p-o|0,o=o<<24^o>>>8^h,h=h-f|0,i.b=f=f<<20^f>>>12^p,i.c=p=p-o|0,i.d=o<<16^p>>>16^h,i.a=h-f|0},i.a=0,i.b=0,i.c=-1640531527,i.d=1367130551,u===Math.floor(u)?(i.a=u/4294967296|0,i.b=u|0):s+=u;for(var c=0;c<s.length+20;c++)i.b^=s.charCodeAt(c)|0,i.next()}function l(u,i){return i.a=u.a,i.b=u.b,i.c=u.c,i.d=u.d,i}function y(u,i){var s=new a(u),c=i&&i.state,f=function(){return(s.next()>>>0)/4294967296};return f.double=function(){do var p=s.next()>>>11,o=(s.next()>>>0)/4294967296,h=(p+o)/(1<<21);while(h===0);return h},f.int32=s.next,f.quick=f,c&&(typeof c=="object"&&l(c,s),f.state=function(){return l(s,{})}),f}r&&r.exports?r.exports=y:n&&n.amd?n(function(){return y}):this.tychei=y})(B,e,!1)}(Pe);var vo=Pe.exports,Kt={exports:{}};const go=Tn(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));(function(e){(function(t,r,n){var a=256,l=6,y=52,u="random",i=n.pow(a,l),s=n.pow(2,y),c=s*2,f=a-1,p;function o(g,S,E){var O=[];S=S==!0?{entropy:!0}:S||{};var b=m(v(S.entropy?[g,T(r)]:g??w(),3),O),M=new h(O),_=function(){for(var L=M.g(l),$=i,z=0;L<s;)L=(L+z)*a,$*=a,z=M.g(1);for(;L>=c;)L/=2,$/=2,z>>>=1;return(L+z)/$};return _.int32=function(){return M.g(4)|0},_.quick=function(){return M.g(4)/4294967296},_.double=_,m(T(M.S),r),(S.pass||E||function(L,$,z,N){return N&&(N.S&&d(N,M),L.state=function(){return d(M,{})}),z?(n[u]=L,$):L})(_,b,"global"in S?S.global:this==n,S.state)}function h(g){var S,E=g.length,O=this,b=0,M=O.i=O.j=0,_=O.S=[];for(E||(g=[E++]);b<a;)_[b]=b++;for(b=0;b<a;b++)_[b]=_[M=f&M+g[b%E]+(S=_[b])],_[M]=S;(O.g=function(L){for(var $,z=0,N=O.i,oe=O.j,J=O.S;L--;)$=J[N=f&N+1],z=z*a+J[f&(J[N]=J[oe=f&oe+$])+(J[oe]=$)];return O.i=N,O.j=oe,z})(a)}function d(g,S){return S.i=g.i,S.j=g.j,S.S=g.S.slice(),S}function v(g,S){var E=[],O=typeof g,b;if(S&&O=="object")for(b in g)try{E.push(v(g[b],S-1))}catch{}return E.length?E:O=="string"?g:g+"\0"}function m(g,S){for(var E=g+"",O,b=0;b<E.length;)S[f&b]=f&(O^=S[f&b]*19)+E.charCodeAt(b++);return T(S)}function w(){try{var g;return p&&(g=p.randomBytes)?g=g(a):(g=new Uint8Array(a),(t.crypto||t.msCrypto).getRandomValues(g)),T(g)}catch{var S=t.navigator,E=S&&S.plugins;return[+new Date,t,E,t.screen,T(r)]}}function T(g){return String.fromCharCode.apply(0,g)}if(m(n.random(),r),e.exports){e.exports=o;try{p=go}catch{}}else n["seed"+u]=o})(typeof self<"u"?self:B,[],Math)})(Kt);var mo=Kt.exports,wo=fo,So=lo,Eo=ho,Oo=po,bo=yo,xo=vo,ne=mo;ne.alea=wo,ne.xor128=So,ne.xorwow=Eo,ne.xorshift7=Oo,ne.xor4096=bo,ne.tychei=xo;function Vt(e){return e*180/Math.PI}var To={Unknown:0,LeftController:1,RightController:2},ko={Unknown:0,Trigger:1,TrackPad:2,Grip:3,Thumbstick:4,A:5,B:6,ApplicationMenu:7},Ro={Unknown:0,TouchpadX:1,TouchpadY:2,ThumbstickX:3,ThumbstickY:4},Xe={Device:To,Input:ko,Axis:Ro};function qt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function R(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?qt(Object(r),!0).forEach(function(n){K(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):qt(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Oe=Xe.Device,A=Xe.Input,be=k.vtkWarningMacro,xe=k.vtkErrorMacro,Mo=k.normalizeWheel,jo=k.vtkOnceErrorMacro,re=new MouseEvent(""),He={"xr-standard":[A.Trigger,A.Grip,A.TrackPad,A.Thumbstick,A.A,A.B]},Ye=["StartAnimation","Animation","EndAnimation","PointerEnter","PointerLeave","MouseEnter","MouseLeave","StartMouseMove","MouseMove","EndMouseMove","LeftButtonPress","LeftButtonRelease","MiddleButtonPress","MiddleButtonRelease","RightButtonPress","RightButtonRelease","KeyPress","KeyDown","KeyUp","StartMouseWheel","MouseWheel","EndMouseWheel","StartPinch","Pinch","EndPinch","StartPan","Pan","EndPan","StartRotate","Rotate","EndRotate","Button3D","Move3D","StartPointerLock","EndPointerLock","StartInteraction","Interaction","EndInteraction","AnimationFrameRateUpdate"];function fe(e){e.cancelable&&e.preventDefault()}function Te(e){var t=Object.create(null);return e.forEach(function(r){var n=r.pointerId,a=r.position;t[n]=a}),t}function Do(e,t){t.classHierarchy.push("vtkRenderWindowInteractor");var r=new Set,n=new Map,a=1;e.start=function(){!t.initialized&&(e.initialize(),!t.initialized)||e.startEventLoop()},e.setRenderWindow=function(o){xe("you want to call setView(view) instead of setRenderWindow on a vtk.js interactor")},e.setInteractorStyle=function(o){t.interactorStyle!==o&&(t.interactorStyle!=null&&t.interactorStyle.setInteractor(null),t.interactorStyle=o,t.interactorStyle!=null&&t.interactorStyle.getInteractor()!==e&&t.interactorStyle.setInteractor(e))},e.initialize=function(){t.initialized=!0,e.enable(),e.render()},e.enable=function(){return e.setEnabled(!0)},e.disable=function(){return e.setEnabled(!1)},e.startEventLoop=function(){return be("empty event loop")};function l(o,h){t._forcedRenderer||(t.currentRenderer=e.findPokedRenderer(o,h))}e.getCurrentRenderer=function(){return t.currentRenderer||l(0,0),t.currentRenderer};function y(o){var h=t._view.getCanvas(),d=h.getBoundingClientRect(),v=h.width/d.width,m=h.height/d.height,w={x:v*(o.clientX-d.left),y:m*(d.height-o.clientY+d.top),z:0};return(n.size<=1||!t.currentRenderer)&&l(w.x,w.y),w}var u=t._getScreenEventPositionFor||y;function i(o){return{controlKey:o.ctrlKey,altKey:o.altKey,shiftKey:o.shiftKey}}function s(o){var h=i(o),d=R({key:o.key,keyCode:o.charCode},h);return d}function c(o){return o.pointerType||""}e.bindEvents=function(o){t.container=o,o.addEventListener("contextmenu",fe),o.addEventListener("wheel",e.handleWheel),o.addEventListener("DOMMouseScroll",e.handleWheel),o.addEventListener("pointerenter",e.handlePointerEnter),o.addEventListener("pointerleave",e.handlePointerLeave),o.addEventListener("pointermove",e.handlePointerMove,{passive:!1}),o.addEventListener("pointerdown",e.handlePointerDown,{passive:!1}),o.addEventListener("pointerup",e.handlePointerUp),o.addEventListener("pointercancel",e.handlePointerCancel),document.addEventListener("keypress",e.handleKeyPress),document.addEventListener("keydown",e.handleKeyDown),document.addEventListener("keyup",e.handleKeyUp),document.addEventListener("pointerlockchange",e.handlePointerLockChange),o.style.touchAction="none",o.style.userSelect="none",o.style.webkitTapHighlightColor="rgba(0,0,0,0)"},e.unbindEvents=function(){var o=t.container;o.removeEventListener("contextmenu",fe),o.removeEventListener("wheel",e.handleWheel),o.removeEventListener("DOMMouseScroll",e.handleWheel),o.removeEventListener("pointerenter",e.handlePointerEnter),o.removeEventListener("pointerleave",e.handlePointerLeave),o.removeEventListener("pointermove",e.handlePointerMove,{passive:!1}),o.removeEventListener("pointerdown",e.handlePointerDown,{passive:!1}),o.removeEventListener("pointerup",e.handlePointerUp),o.removeEventListener("pointercancel",e.handlePointerCancel),document.removeEventListener("keypress",e.handleKeyPress),document.removeEventListener("keydown",e.handleKeyDown),document.removeEventListener("keyup",e.handleKeyUp),document.removeEventListener("pointerlockchange",e.handlePointerLockChange),t.container=null,n.clear()},e.handleKeyPress=function(o){var h=s(o);e.keyPressEvent(h)},e.handleKeyDown=function(o){var h=s(o);e.keyDownEvent(h)},e.handleKeyUp=function(o){var h=s(o);e.keyUpEvent(h)},e.handlePointerEnter=function(o){var h=R(R({},i(o)),{},{position:u(o),deviceType:c(o)});e.pointerEnterEvent(h),h.deviceType==="mouse"&&e.mouseEnterEvent(h)},e.handlePointerLeave=function(o){var h=R(R({},i(o)),{},{position:u(o),deviceType:c(o)});e.pointerLeaveEvent(h),h.deviceType==="mouse"&&e.mouseLeaveEvent(h)},e.handlePointerDown=function(o){if(!(o.button>2||e.isPointerLocked()))switch(t.preventDefaultOnPointerDown&&fe(o),o.target.hasPointerCapture(o.pointerId)&&o.target.releasePointerCapture(o.pointerId),t.container.setPointerCapture(o.pointerId),n.has(o.pointerId)&&be("[RenderWindowInteractor] duplicate pointerId detected"),n.set(o.pointerId,{pointerId:o.pointerId,position:u(o)}),o.pointerType){case"pen":case"touch":e.handleTouchStart(o);break;case"mouse":default:e.handleMouseDown(o);break}},e.handlePointerUp=function(o){if(n.has(o.pointerId))switch(t.preventDefaultOnPointerUp&&fe(o),n.delete(o.pointerId),t.container.releasePointerCapture(o.pointerId),o.pointerType){case"pen":case"touch":e.handleTouchEnd(o);break;case"mouse":default:e.handleMouseUp(o);break}},e.handlePointerCancel=function(o){if(n.has(o.pointerId))switch(n.delete(o.pointerId),o.pointerType){case"pen":case"touch":e.handleTouchEnd(o);break;case"mouse":default:e.handleMouseUp(o);break}},e.handlePointerMove=function(o){if(n.has(o.pointerId)){var h=n.get(o.pointerId);h.position=u(o)}switch(o.pointerType){case"pen":case"touch":e.handleTouchMove(o);break;case"mouse":default:e.handleMouseMove(o);break}},e.handleMouseDown=function(o){var h=R(R({},i(o)),{},{position:u(o),deviceType:c(o)});switch(o.button){case 0:e.leftButtonPressEvent(h);break;case 1:e.middleButtonPressEvent(h);break;case 2:e.rightButtonPressEvent(h);break;default:xe("Unknown mouse button pressed: ".concat(o.button));break}},e.requestPointerLock=function(){t.container&&t.container.requestPointerLock()},e.exitPointerLock=function(){var o,h;return(o=(h=document).exitPointerLock)===null||o===void 0?void 0:o.call(h)},e.isPointerLocked=function(){return!!t.container&&document.pointerLockElement===t.container},e.handlePointerLockChange=function(){e.isPointerLocked()?e.startPointerLockEvent():e.endPointerLockEvent()};function f(){t._view&&t.enabled&&t.enableRender&&(t.inRender=!0,t._view.traverseAllPasses(),t.inRender=!1),e.invokeRenderEvent()}e.requestAnimation=function(o){if(o===void 0){xe("undefined requester, can not start animating");return}if(r.has(o)){be("requester is already registered for animating");return}r.add(o),!t.animationRequest&&r.size===1&&!t.xrAnimation&&(t._animationStartTime=Date.now(),t._animationFrameCount=0,t.animationRequest=requestAnimationFrame(e.handleAnimation),e.startAnimationEvent())},e.extendAnimation=function(o){var h=Date.now()+o;t._animationExtendedEnd=Math.max(t._animationExtendedEnd,h),!t.animationRequest&&r.size===0&&!t.xrAnimation&&(t._animationStartTime=Date.now(),t._animationFrameCount=0,t.animationRequest=requestAnimationFrame(e.handleAnimation),e.startAnimationEvent())},e.isAnimating=function(){return t.xrAnimation||t.animationRequest!==null},e.cancelAnimation=function(o){var h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!r.has(o)){if(!h){var d=o&&o.getClassName?o.getClassName():o;be("".concat(d," did not request an animation"))}return}r.delete(o),t.animationRequest&&r.size===0&&Date.now()>t._animationExtendedEnd&&(cancelAnimationFrame(t.animationRequest),t.animationRequest=null,e.endAnimationEvent(),e.render())},e.switchToXRAnimation=function(){t.animationRequest&&(cancelAnimationFrame(t.animationRequest),t.animationRequest=null),t.xrAnimation=!0},e.returnFromXRAnimation=function(){t.xrAnimation=!1,r.size!==0&&(t.recentAnimationFrameRate=10,t.animationRequest=requestAnimationFrame(e.handleAnimation))},e.updateXRGamepads=function(o,h,d){o.inputSources.forEach(function(v){var m=v.gripSpace==null?null:h.getPose(v.gripSpace,d),w=v.gamepad,T=v.handedness;if(w){w.index in t.lastGamepadValues||(t.lastGamepadValues[w.index]={left:{buttons:{}},right:{buttons:{}},none:{buttons:{}}});for(var g=0;g<w.buttons.length;++g)g in t.lastGamepadValues[w.index][T].buttons||(t.lastGamepadValues[w.index][T].buttons[g]=!1),t.lastGamepadValues[w.index][T].buttons[g]!==w.buttons[g].pressed&&m!=null&&(e.button3DEvent({gamepad:w,position:m.transform.position,orientation:m.transform.orientation,pressed:w.buttons[g].pressed,device:v.handedness==="left"?Oe.LeftController:Oe.RightController,input:He[w.mapping]&&He[w.mapping][g]?He[w.mapping][g]:A.Trigger}),t.lastGamepadValues[w.index][T].buttons[g]=w.buttons[g].pressed),t.lastGamepadValues[w.index][T].buttons[g]&&m!=null&&e.move3DEvent({gamepad:w,position:m.transform.position,orientation:m.transform.orientation,device:v.handedness==="left"?Oe.LeftController:Oe.RightController})}})},e.handleMouseMove=function(o){var h=R(R({},i(o)),{},{position:u(o),deviceType:c(o)});t.moveTimeoutID===0?e.startMouseMoveEvent(h):(e.mouseMoveEvent(h),clearTimeout(t.moveTimeoutID)),t.moveTimeoutID=setTimeout(function(){e.endMouseMoveEvent(),t.moveTimeoutID=0},200)},e.handleAnimation=function(){var o=Date.now();t._animationFrameCount++,o-t._animationStartTime>1e3&&t._animationFrameCount>1&&(t.recentAnimationFrameRate=1e3*(t._animationFrameCount-1)/(o-t._animationStartTime),t.lastFrameTime=1/t.recentAnimationFrameRate,e.animationFrameRateUpdateEvent(),t._animationStartTime=o,t._animationFrameCount=1),e.animationEvent(),f(),r.size>0||Date.now()<t._animationExtendedEnd?t.animationRequest=requestAnimationFrame(e.handleAnimation):(cancelAnimationFrame(t.animationRequest),t.animationRequest=null,e.endAnimationEvent(),e.render())},e.handleWheel=function(o){fe(o);var h=R(R(R({},Mo(o)),i(o)),{},{position:u(o),deviceType:c(o)});t.wheelTimeoutID===0&&(Math.abs(h.spinY)>=.3?a=Math.abs(h.spinY):a=1),h.spinY/=a,t.wheelTimeoutID===0?(e.startMouseWheelEvent(h),e.mouseWheelEvent(h)):(e.mouseWheelEvent(h),clearTimeout(t.wheelTimeoutID)),t.mouseScrollDebounceByPass?(e.extendAnimation(600),e.endMouseWheelEvent(),t.wheelTimeoutID=0):t.wheelTimeoutID=setTimeout(function(){e.extendAnimation(600),e.endMouseWheelEvent(),t.wheelTimeoutID=0},200)},e.handleMouseUp=function(o){var h=R(R({},i(o)),{},{position:u(o),deviceType:c(o)});switch(o.button){case 0:e.leftButtonReleaseEvent(h);break;case 1:e.middleButtonReleaseEvent(h);break;case 2:e.rightButtonReleaseEvent(h);break;default:xe("Unknown mouse button released: ".concat(o.button));break}},e.handleTouchStart=function(o){var h=ie(n.values());if(t.recognizeGestures&&h.length>1){var d=Te(n);if(h.length===2){var v=R(R({},i(re)),{},{position:h[0].position,deviceType:c(o)});e.leftButtonReleaseEvent(v)}e.recognizeGesture("TouchStart",d)}else if(h.length===1){var m=R(R({},i(re)),{},{position:u(o),deviceType:c(o)});e.leftButtonPressEvent(m)}},e.handleTouchMove=function(o){var h=ie(n.values());if(t.recognizeGestures&&h.length>1){var d=Te(n);e.recognizeGesture("TouchMove",d)}else if(h.length===1){var v=R(R({},i(re)),{},{position:h[0].position,deviceType:c(o)});e.mouseMoveEvent(v)}},e.handleTouchEnd=function(o){var h=ie(n.values());if(t.recognizeGestures)if(h.length===0){var d=R(R({},i(re)),{},{position:u(o),deviceType:c(o)});e.leftButtonReleaseEvent(d)}else if(h.length===1){var v=Te(n);e.recognizeGesture("TouchEnd",v);var m=R(R({},i(re)),{},{position:h[0].position,deviceType:c(o)});e.leftButtonPressEvent(m)}else{var w=Te(n);e.recognizeGesture("TouchMove",w)}else if(h.length===1){var T=R(R({},i(re)),{},{position:h[0].position,deviceType:c(o)});e.leftButtonReleaseEvent(T)}},e.setView=function(o){t._view!==o&&(t._view=o,t._view.getRenderable().setInteractor(e),e.modified())},e.getFirstRenderer=function(){var o,h,d;return(o=t._view)===null||o===void 0||(h=o.getRenderable())===null||h===void 0||(d=h.getRenderersByReference())===null||d===void 0?void 0:d[0]},e.findPokedRenderer=function(){var o,h,d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!t._view)return null;var m=(o=t._view)===null||o===void 0||(h=o.getRenderable())===null||h===void 0?void 0:h.getRenderers();if(!m||m.length===0)return null;m.sort(function(O,b){return O.getLayer()-b.getLayer()});for(var w=null,T=null,g=null,S=m.length;S--;){var E=m[S];if(t._view.isInViewport(d,v,E)&&E.getInteractive()){g=E;break}w===null&&E.getInteractive()&&(w=E),T===null&&t._view.isInViewport(d,v,E)&&(T=E)}return g===null&&(g=w),g===null&&(g=T),g==null&&(g=m[0]),g},e.render=function(){!e.isAnimating()&&!t.inRender&&f()},Ye.forEach(function(o){var h=o.charAt(0).toLowerCase()+o.slice(1);e["".concat(h,"Event")]=function(d){if(t.enabled){var v=e.getCurrentRenderer();if(!v){jo(`
          Can not forward events without a current renderer on the interactor.
        `);return}var m=R({type:o,pokedRenderer:t.currentRenderer,firstRenderer:e.getFirstRenderer()},d);e["invoke".concat(o)](m)}}}),e.recognizeGesture=function(o,h){if(!(Object.keys(h).length>2)){if(t.startingEventPositions||(t.startingEventPositions={}),o==="TouchStart"){Object.keys(h).forEach(function(pe){t.startingEventPositions[pe]=h[pe]}),t.currentGesture="Start";return}if(o==="TouchEnd"){t.currentGesture==="Pinch"&&(e.render(),e.endPinchEvent()),t.currentGesture==="Rotate"&&(e.render(),e.endRotateEvent()),t.currentGesture==="Pan"&&(e.render(),e.endPanEvent()),t.currentGesture="Start",t.startingEventPositions={};return}var d=0,v=[],m=[];Object.keys(h).forEach(function(pe){v[d]=h[pe],m[d]=t.startingEventPositions[pe],d++});var w=Math.sqrt((m[0].x-m[1].x)*(m[0].x-m[1].x)+(m[0].y-m[1].y)*(m[0].y-m[1].y)),T=Math.sqrt((v[0].x-v[1].x)*(v[0].x-v[1].x)+(v[0].y-v[1].y)*(v[0].y-v[1].y)),g=Vt(Math.atan2(m[1].y-m[0].y,m[1].x-m[0].x)),S=Vt(Math.atan2(v[1].y-v[0].y,v[1].x-v[0].x)),E=S-g;S=S+180>=360?S-180:S+180,g=g+180>=360?g-180:g+180,Math.abs(S-g)<Math.abs(E)&&(E=S-g);var O=[];if(O[0]=(v[0].x-m[0].x+v[1].x-m[1].x)/2,O[1]=(v[0].y-m[0].y+v[1].y-m[1].y)/2,o==="TouchMove")if(t.currentGesture==="Start"){var b=.01*Math.sqrt(t.container.clientWidth*t.container.clientWidth+t.container.clientHeight*t.container.clientHeight);b<15&&(b=15);var M=Math.abs(T-w),_=T*3.1415926*Math.abs(E)/360,L=Math.sqrt(O[0]*O[0]+O[1]*O[1]);if(M>b&&M>_&&M>L){t.currentGesture="Pinch";var $={scale:1,touches:h};e.startPinchEvent($)}else if(_>b&&_>L){t.currentGesture="Rotate";var z={rotation:0,touches:h};e.startRotateEvent(z)}else if(L>b){t.currentGesture="Pan";var N={translation:[0,0],touches:h};e.startPanEvent(N)}}else{if(t.currentGesture==="Rotate"){var oe={rotation:E,touches:h};e.rotateEvent(oe)}if(t.currentGesture==="Pinch"){var J={scale:T/w,touches:h};e.pinchEvent(J)}if(t.currentGesture==="Pan"){var ua={translation:O,touches:h};e.panEvent(ua)}}}},e.handleVisibilityChange=function(){t._animationStartTime=Date.now(),t._animationFrameCount=0},e.setCurrentRenderer=function(o){t._forcedRenderer=!!o,t.currentRenderer=o};var p=e.delete;e.delete=function(){for(;r.size;)e.cancelAnimation(r.values().next().value);typeof document.hidden<"u"&&document.removeEventListener("visibilitychange",e.handleVisibilityChange),t.container&&e.unbindEvents(),p()},typeof document.hidden<"u"&&document.addEventListener("visibilitychange",e.handleVisibilityChange,!1)}var Co={renderWindow:null,interactorStyle:null,picker:null,pickingManager:null,initialized:!1,enabled:!1,enableRender:!0,currentRenderer:null,lightFollowCamera:!0,desiredUpdateRate:30,stillUpdateRate:2,container:null,recognizeGestures:!0,currentGesture:"Start",animationRequest:null,lastFrameTime:.1,recentAnimationFrameRate:10,wheelTimeoutID:0,moveTimeoutID:0,lastGamepadValues:{},preventDefaultOnPointerDown:!1,preventDefaultOnPointerUp:!1,mouseScrollDebounceByPass:!1};function Pt(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(t,Co,r),k.obj(e,t),t._animationExtendedEnd=0,k.event(e,t,"RenderEvent"),Ye.forEach(function(n){return k.event(e,t,n)}),k.get(e,t,["initialized","container","interactorStyle","lastFrameTime","recentAnimationFrameRate","_view"]),k.setGet(e,t,["lightFollowCamera","enabled","enableRender","recognizeGestures","desiredUpdateRate","stillUpdateRate","picker","preventDefaultOnPointerDown","preventDefaultOnPointerUp","mouseScrollDebounceByPass"]),k.moveToProtected(e,t,["view"]),Do(e,t)}var _o=k.newInstance(Pt,"vtkRenderWindowInteractor"),Xt=R({newInstance:_o,extend:Pt,handledEvents:Ye},Xe);function Ht(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Yt(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Ht(Object(r),!0).forEach(function(n){K(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ht(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Lo=k.vtkErrorMacro,Fo=k.VOID;function Uo(e,t,r,n){var a=e.getRenderWindow().getViews()[0];return a.worldToDisplay(t,r,n,e)}function Bo(e,t,r,n){var a=e.getRenderWindow().getViews()[0];return a.displayToWorld(t,r,n,e)}var zo={computeWorldToDisplay:Uo,computeDisplayToWorld:Bo};function Wo(e,t){t.classHierarchy.push("vtkInteractorObserver");var r=Yt({},e);function n(){for(;t.subscribedEvents.length;)t.subscribedEvents.pop().unsubscribe()}function a(){Xt.handledEvents.forEach(function(l){e["handle".concat(l)]&&t.subscribedEvents.push(t._interactor["on".concat(l)](function(y){return t.processEvents?e["handle".concat(l)](y):Fo},t.priority))})}e.setInteractor=function(l){l!==t._interactor&&(n(),t._interactor=l,l&&t.enabled&&a(),e.modified())},e.setEnabled=function(l){l!==t.enabled&&(n(),l&&(t._interactor?a():Lo(`
          The interactor must be set before subscribing to events
        `)),t.enabled=l,e.modified())},e.computeDisplayToWorld=function(l,y,u,i){return l?t._interactor.getView().displayToWorld(y,u,i,l):null},e.computeWorldToDisplay=function(l,y,u,i){return l?t._interactor.getView().worldToDisplay(y,u,i,l):null},e.setPriority=function(l){var y=r.setPriority(l);y&&t._interactor&&(n(),a())}}var $o={enabled:!0,priority:0,processEvents:!0,subscribedEvents:[]};function At(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(t,$o,r),k.obj(e,t),k.event(e,t,"InteractionEvent"),k.event(e,t,"StartInteractionEvent"),k.event(e,t,"EndInteractionEvent"),k.get(e,t,["_interactor","enabled"]),k.setGet(e,t,["priority","processEvents"]),k.moveToProtected(e,t,["interactor"]),Wo(e,t)}var Go=k.newInstance(At,"vtkInteractorObserver"),No=Yt({newInstance:Go,extend:At},zo),Ko={IS_START:0,IS_NONE:0,IS_ROTATE:1,IS_PAN:2,IS_SPIN:3,IS_DOLLY:4,IS_CAMERA_POSE:11,IS_WINDOW_LEVEL:1024,IS_SLICE:1025},Jt={States:Ko};function Qt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Vo(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Qt(Object(r),!0).forEach(function(n){K(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Qt(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var G=Jt.States,Ae={Rotate:G.IS_ROTATE,Pan:G.IS_PAN,Spin:G.IS_SPIN,Dolly:G.IS_DOLLY,CameraPose:G.IS_CAMERA_POSE,WindowLevel:G.IS_WINDOW_LEVEL,Slice:G.IS_SLICE};function qo(e,t){t.classHierarchy.push("vtkInteractorStyle"),Object.keys(Ae).forEach(function(r){k.event(e,t,"Start".concat(r,"Event")),e["start".concat(r)]=function(){t.state===G.IS_NONE&&(t.state=Ae[r],t._interactor.requestAnimation(e),e.invokeStartInteractionEvent({type:"StartInteractionEvent"}),e["invokeStart".concat(r,"Event")]({type:"Start".concat(r,"Event")}))},k.event(e,t,"End".concat(r,"Event")),e["end".concat(r)]=function(){t.state===Ae[r]&&(t.state=G.IS_NONE,t._interactor.cancelAnimation(e),e.invokeEndInteractionEvent({type:"EndInteractionEvent"}),e["invokeEnd".concat(r,"Event")]({type:"End".concat(r,"Event")}),t._interactor.render())}}),e.handleKeyPress=function(r){var n=t._interactor,a=null;switch(r.key){case"r":case"R":r.pokedRenderer.resetCamera(),n.render();break;case"w":case"W":a=r.pokedRenderer.getActors(),a.forEach(function(l){var y=l.getProperty();y.setRepresentationToWireframe&&y.setRepresentationToWireframe()}),n.render();break;case"s":case"S":a=r.pokedRenderer.getActors(),a.forEach(function(l){var y=l.getProperty();y.setRepresentationToSurface&&y.setRepresentationToSurface()}),n.render();break;case"v":case"V":a=r.pokedRenderer.getActors(),a.forEach(function(l){var y=l.getProperty();y.setRepresentationToPoints&&y.setRepresentationToPoints()}),n.render();break}}}var Po={state:G.IS_NONE,handleObservers:1,autoAdjustCameraClippingRange:1};function Zt(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(t,Po,r),No.extend(e,t,r),qo(e,t)}var Xo=k.newInstance(Zt,"vtkInteractorStyle"),Ho=Vo({newInstance:Xo,extend:Zt},Jt);const le={type:"StartInteractionEvent"},It={type:"InteractionEvent"},he={type:"EndInteractionEvent"};function Yo(e,t){t.classHierarchy.push("vtkInteractorStyleRemoteMouse");function r(n){const{buttonLeft:a,buttonMiddle:l,buttonRight:y}=t,u=n.shiftKey?1:0,i=n.controlKey?1:0,s=n.altKey?1:0,c=n.metaKey?1:0,f=a||l||y?"down":"up";let{x:p,y:o}=n.position;return{action:f,x:p,y:o,buttonLeft:a,buttonMiddle:l,buttonRight:y,shiftKey:u,altKey:s,ctrlKey:i,metaKey:c,...t.remoteEventAddOn}}e.handleLeftButtonPress=n=>{t.previousPosition=n.position,t.buttonLeft=1,e.onButtonDown(1,n)},e.handleMiddleButtonPress=n=>{t.previousPosition=n.position,t.buttonMiddle=1,e.onButtonDown(2,n)},e.handleRightButtonPress=n=>{t.previousPosition=n.position,t.buttonRight=1,e.onButtonDown(3,n)},e.handleLeftButtonRelease=n=>{t.buttonLeft=0,e.onButtonUp(1,n)},e.handleMiddleButtonRelease=n=>{t.buttonMiddle=0,e.onButtonUp(2,n)},e.handleRightButtonRelease=n=>{t.buttonRight=0,e.onButtonUp(3,n)},e.onButtonDown=(n,a)=>{e.invokeStartInteractionEvent(le);let l="";n==1?l="LeftButtonPress":n==2?l="MiddleButtonPress":n==3&&(l="RightButtonPress"),e.invokeRemoteMouseEvent({type:l,...r(a)})},e.onButtonUp=(n,a)=>{let l="";n==1?l="LeftButtonRelease":n==2?l="MiddleButtonRelease":n==3&&(l="RightButtonRelease"),e.invokeRemoteMouseEvent({type:l,...r(a)}),e.invokeEndInteractionEvent(he)},e.handleStartMouseWheel=n=>{e.invokeStartInteractionEvent(le),e.invokeRemoteWheelEvent({type:"StartMouseWheel",...r(n),spinY:n.spinY})},e.handleMouseWheel=n=>{let a=!0;if(t.wheelThrottleDelay){const l=Date.now();a=t.wheelThrottleDelay<l-t.wheelLastThrottleTime,a&&(t.wheelLastThrottleTime=l)}a&&(e.invokeRemoteWheelEvent({type:"MouseWheel",...r(n),spinY:n.spinY}),e.invokeInteractionEvent(It))},e.handleEndMouseWheel=()=>{e.invokeRemoteWheelEvent({type:"EndMouseWheel",...t.remoteEventAddOn}),e.invokeEndInteractionEvent(he)},e.handleMouseMove=n=>{const a=Date.now();t.throttleDelay<a-t.lastThrottleTime&&(t.sendMouseMove||t.buttonLeft||t.buttonMiddle||t.buttonRight)&&(t.lastThrottleTime=a,e.invokeRemoteMouseEvent({type:"MouseMove",...r(n)})),e.invokeInteractionEvent(It)},e.handleKeyPress=()=>{},e.handleStartPinch=n=>{e.startDolly();const{scale:a}=n;e.invokeStartInteractionEvent(le),e.invokeRemoteGestureEvent({type:"StartPinch",scale:a,...t.remoteEventAddOn})},e.handlePinch=n=>{const{scale:a}=n;e.invokeRemoteGestureEvent({type:"Pinch",scale:a,...t.remoteEventAddOn})},e.handleEndPinch=()=>{e.endDolly(),e.invokeRemoteGestureEvent({type:"EndPinch",...t.remoteEventAddOn}),e.invokeEndInteractionEvent(he)},e.handleStartRotate=n=>{e.startRotate();const{rotation:a}=n;e.invokeStartInteractionEvent(le),e.invokeRemoteGestureEvent({type:"StartRotate",rotation:a,...t.remoteEventAddOn})},e.handleRotate=n=>{const{rotation:a}=n;e.invokeRemoteGestureEvent({type:"Rotate",rotation:a,...t.remoteEventAddOn})},e.handleEndRotate=()=>{e.endRotate(),e.invokeRemoteGestureEvent({type:"EndRotate",...t.remoteEventAddOn}),e.invokeEndInteractionEvent(he)},e.handleStartPan=n=>{e.startPan();const{translation:a}=n;e.invokeStartInteractionEvent(le),e.invokeRemoteGestureEvent({type:"StartPan",translation:a,...t.remoteEventAddOn})},e.handlePan=n=>{const{translation:a}=n;e.invokeRemoteGestureEvent({type:"Pan",translation:a,...t.remoteEventAddOn})},e.handleEndPan=()=>{e.endPan(),e.invokeRemoteGestureEvent({type:"EndPan",...t.remoteEventAddOn}),e.invokeEndInteractionEvent(he)},e.handleKeyPress=n=>{e.invokeRemoteKeyEvent({type:"keyPress",...n})},e.handleKeyDown=n=>{e.invokeRemoteKeyEvent({type:"keyDown",...n})},e.handleKeyUp=n=>{e.invokeRemoteKeyEvent({type:"keyUp",...n})}}const Ao={buttonLeft:0,buttonMiddle:0,buttonRight:0,sendMouseMove:!1,throttleDelay:33.3,lastThrottleTime:0,wheelThrottleDelay:0,wheelLastThrottleTime:0};function en(e,t,r={}){Object.assign(t,Ao,r),Ho.extend(e,t,r),k.setGet(e,t,["sendMouseMove","remoteEventAddOn","throttleDelay","wheelThrottleDelay"]),k.event(e,t,"RemoteMouseEvent"),k.event(e,t,"RemoteWheelEvent"),k.event(e,t,"RemoteGestureEvent"),k.event(e,t,"RemoteKeyEvent"),Yo(e,t)}const Jo={newInstance:k.newInstance(en,"vtkInteractorStyleRemoteMouse"),extend:en};function Qo(){return new Promise(e=>setTimeout(e,0))}async function Zo(e){if(!(e<0))return new Promise(t=>setTimeout(t,e))}class Io{constructor(t,r=100){this.eventQueue=[],this.processing=!1,this.throttleTimeMs=r,this.processCallback=t,this.eventKeysToIgnore=new Set(["x","y"])}compressEvents(t){if(t.length<2)return[...t];const r=[];for(let n=0;n<t.length;n++){const a=t[n],l=t[n+1];l&&this.canCompressEvents(a,l)||r.push(a)}return r}canCompressEvents(t,r){if(t.type==="MouseWheel"||r.type==="MouseWheel"||Object.keys(t).length!==Object.keys(r).length)return!1;for(let n in t)if(!this.eventKeysToIgnore.has(n)&&t[n]!==r[n])return!1;return!0}sendEvent(t){this.eventQueue.push(t),this.processing||(this.processing=!0,this._processEventQueue().catch(r=>{console.error("Error in _processEventQueue:",r),this.processing=!1}))}async _processEventQueue(){const t=this.compressEvents(this.eventQueue);this.eventQueue.length=0;const r=Date.now();for(const n of t)await this.processCallback(n),await Qo();await Zo(this.throttleTimeMs-Date.now()+r),this.eventQueue.length>0?await this._processEventQueue():this.processing=!1}}const{inject:ea,provide:ta,ref:na,toRefs:ra,onMounted:oa,onBeforeUnmount:aa}=window.Vue,ia=Promise.resolve(!0),tn={DisplayArea:yn,StatisticsDisplay:gn,ImageDisplayArea:Je,RemoteControlledArea:{props:{name:{type:String,default:"default"},origin:{type:String,default:"anonymous"},display:{type:String,default:"image"},sendMouseMove:{type:Boolean,default:!1},eventThrottleMs:{type:Number,default:25},imageStyle:{type:Object,default:()=>({width:"100%"})}},setup(e){const t=na(null),r=ea("trame"),n=new Io(v=>r.client.getConnection().getSession().call("trame.rca.event",[e.name,e.origin,v]),e.eventThrottleMs);let a=[0,0],l={w:10,h:10,p:window.devicePixelRatio},y=!0,u=ia,i=0;function s(v){return v.preventDefault(),{x:v.clientX-a[0],y:l.h-v.clientY+a[1],z:0}}const c=Xt.newInstance({_getScreenEventPositionFor:s,currentRenderer:1}),f=Jo.newInstance();c.setInteractorStyle(f),f.setSendMouseMove(e.sendMouseMove),f.onRemoteMouseEvent(v=>{p(Object.assign({w:l.w,h:l.h},v))}),f.onRemoteWheelEvent(v=>{p(Object.assign({w:l.w,h:l.h},v))}),f.onRemoteGestureEvent(v=>{p(Object.assign({w:l.w,h:l.h},v))}),f.onRemoteKeyEvent(v=>{p(Object.assign({w:l.w,h:l.h},v))}),f.onStartInteractionEvent(v=>{p(v)}),f.onEndInteractionEvent(v=>{p(v)});function p(v){r&&n.sendEvent(v)}function o(){y=!0,i&&(i=0,d())}const h=new ResizeObserver(()=>{if(!t.value)return;const v=t.value.getBoundingClientRect(),{top:m,left:w}=v;l.w=v.width,l.h=v.height,l.p=window.devicePixelRatio,a=[w,m],d()});function d(v){r&&(y?(y=!1,v?u=r.client.getConnection().getSession().call("trame.rca.size",[e.name,e.origin,{...l,...v}]):u=r.client.getConnection().getSession().call("trame.rca.size",[e.name,e.origin,l]),u.finally(o)):i++)}return ta("rcaPushSize",d),oa(()=>{h.observe(t.value),c.initialize(),c.bindEvents(t.value)}),aa(()=>{h.unobserve(t.value),c.unbindEvents(t.value)}),{rootElem:t,...ra(e)}},template:`
    <div ref="rootElem" style="margin: 0; padding: 0; position: relative; width: 100%; height: 100%;">
      <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;">
        <display-area :display="display" :name="name" :origin="origin" :imageStyle="imageStyle" />
        <slot></slot>
      </div>
    </div>
  `},MediaSourceDisplayArea:Qe,VideoDecoderDisplayArea:Ze,RawImageDisplayArea:Ie};function sa(e){Object.keys(tn).forEach(t=>{e.component(t,tn[t])})}Q.install=sa,Object.defineProperty(Q,Symbol.toStringTag,{value:"Module"})});
