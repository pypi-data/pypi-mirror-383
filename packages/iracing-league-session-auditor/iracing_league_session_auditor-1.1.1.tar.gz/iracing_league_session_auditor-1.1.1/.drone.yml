kind: pipeline
name: default
type: docker

steps:
  - name: build
    image: plugins/docker
    settings:
      username:
        from_secret: docker_username
      password:
        from_secret: docker_password
      registry: registry.hub.docker.com
      repo: registry.hub.docker.com/tyleragostino/iracing_auditor
      tags: latest
    when:
      branch:
        - main
  - name: deploy
    image: plugins/webhook
    settings:
      urls: http://192.168.1.125:9996/api/stacks/webhooks/b1fb8123-6c54-439d-839f-11c2ad01a011
    when:
      changeset:
        includes: [ "**/**.py", "**/**.txt", "**/docker_compose.yaml", "**/Dockerfile"  ]

trigger:
  ref:
    - refs/heads/main
