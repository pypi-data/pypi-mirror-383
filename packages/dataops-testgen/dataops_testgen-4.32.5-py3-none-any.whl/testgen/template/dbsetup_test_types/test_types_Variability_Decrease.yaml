test_types:
  id: '1041'
  test_type: Variability_Decrease
  test_name_short: Variability Decrease
  test_name_long: Variability has decreased below threshold
  test_description: |-
    Tests that the spread or dispersion of column values has decreased significantly over baseline, indicating a shift in stability of the measure. This could signal a change in a process or a data quality issue.
  except_message: |-
    The Standard Deviation of the measure has decreased below the defined threshold. This could signal a change in a process or a data quality issue.
  measure_uom: Pct SD shift
  measure_uom_description: |-
    Percent of baseline Standard Deviation
  selection_criteria: |-
    general_type = 'N' AND functional_data_type ilike 'Measure%' AND functional_data_type <> 'Measurement Spike' AND column_name NOT ilike '%latitude%' AND column_name NOT ilike '%longitude%' AND value_ct <> distinct_value_ct AND distinct_value_ct > 10 AND stdev_value > 0 AND avg_value IS NOT NULL AND NOT (distinct_value_ct = max_value - min_value + 1 AND distinct_value_ct > 2)
  dq_score_prevalence_formula: |-
    1
  dq_score_risk_factor: '0.75'
  column_name_prompt: null
  column_name_help: null
  default_parm_columns: baseline_sd,threshold_value
  default_parm_values: |-
    stdev_value, 80
  default_parm_prompts: |-
    Std Deviation at Baseline,Expected Minimum Percent
  default_parm_help: null
  default_severity: Warning
  run_type: CAT
  test_scope: column
  dq_dimension: Accuracy
  health_dimension: Data Drift
  threshold_description: |-
    Expected minimum pct of baseline Standard Deviation (SD)
  result_visualization: line_chart
  result_visualization_params: null
  usage_notes: "This test looks for percent shifts in standard deviation as a measure\
    \ of the stability of a measure over time.  A significant change could indicate\
    \ that new values are erroneous, or that the cohort being evaluated is significantly\
    \ different from baseline.  A decrease in particular could indicate an improved\
    \ process, better precision in measurement, the elimination of outliers, or a\
    \ more homogeneous cohort. "
  active: Y
  cat_test_conditions:
  - id: '7032'
    test_type: Variability_Decrease
    sql_flavor: bigquery
    measure: |-
      100.0 * STDDEV(CAST({COLUMN_NAME} AS FLOAT64)) / {BASELINE_SD}
    test_operator: <
    test_condition: |-
      {THRESHOLD_VALUE}
  - id: '6032'
    test_type: Variability_Decrease
    sql_flavor: databricks
    measure: |-
      100.0*STDDEV_SAMP({COLUMN_NAME}::FLOAT)/{BASELINE_SD}::FLOAT
    test_operator: <
    test_condition: |-
      {THRESHOLD_VALUE}
  - id: '3032'
    test_type: Variability_Decrease
    sql_flavor: mssql
    measure: |-
      100.0*STDEV(CAST({COLUMN_NAME} AS FLOAT))/CAST({BASELINE_SD} AS FLOAT)
    test_operator: <
    test_condition: |-
      {THRESHOLD_VALUE}
  - id: '4032'
    test_type: Variability_Decrease
    sql_flavor: postgresql
    measure: |-
      100.0*STDDEV({COLUMN_NAME}::FLOAT)/{BASELINE_SD}::FLOAT
    test_operator: <
    test_condition: |-
      {THRESHOLD_VALUE}
  - id: '1032'
    test_type: Variability_Decrease
    sql_flavor: redshift
    measure: |-
      100.0*STDDEV({COLUMN_NAME}::FLOAT)/{BASELINE_SD}::FLOAT
    test_operator: <
    test_condition: |-
      {THRESHOLD_VALUE}
  - id: '7032'
    test_type: Variability_Decrease
    sql_flavor: redshift_spectrum
    measure: |-
      100.0*STDDEV({COLUMN_NAME}::FLOAT)/{BASELINE_SD}::FLOAT
    test_operator: <
    test_condition: |-
      {THRESHOLD_VALUE}
  - id: '2032'
    test_type: Variability_Decrease
    sql_flavor: snowflake
    measure: |-
      100.0*STDDEV({COLUMN_NAME}::FLOAT)/{BASELINE_SD}::FLOAT
    test_operator: <
    test_condition: |-
      {THRESHOLD_VALUE}
  - id: '5032'
    test_type: Variability_Decrease
    sql_flavor: trino
    measure: |-
      100.0*STDDEV(CAST({COLUMN_NAME} AS REAL))/{BASELINE_SD}
    test_operator: <
    test_condition: |-
      {THRESHOLD_VALUE}
  target_data_lookups:
  - id: '1395'
    test_id: '1041'
    test_type: Variability_Decrease
    sql_flavor: bigquery
    lookup_type: null
    lookup_query: |-
      SELECT STDDEV_POP(CAST(`{COLUMN_NAME}` AS FLOAT64)) AS current_standard_deviation
      FROM `{TARGET_SCHEMA}`.`{TABLE_NAME}`;
    error_type: Test Results
  - id: '1329'
    test_id: '1041'
    test_type: Variability_Decrease
    sql_flavor: databricks
    lookup_type: null
    lookup_query: |-
      SELECT STDDEV(CAST(`{COLUMN_NAME}` AS FLOAT)) as current_standard_deviation FROM `{TARGET_SCHEMA}`.`{TABLE_NAME}`;
    error_type: Test Results
  - id: '1171'
    test_id: '1041'
    test_type: Variability_Decrease
    sql_flavor: mssql
    lookup_type: null
    lookup_query: |-
      SELECT STDEV(CAST("{COLUMN_NAME}" AS FLOAT)) as current_standard_deviation FROM "{TARGET_SCHEMA}"."{TABLE_NAME}";
    error_type: Test Results
  - id: '1114'
    test_id: '1041'
    test_type: Variability_Decrease
    sql_flavor: postgresql
    lookup_type: null
    lookup_query: |-
      SELECT STDDEV(CAST("{COLUMN_NAME}" AS FLOAT)) as current_standard_deviation FROM "{TARGET_SCHEMA}"."{TABLE_NAME}";
    error_type: Test Results
  - id: '1032'
    test_id: '1041'
    test_type: Variability_Decrease
    sql_flavor: redshift
    lookup_type: null
    lookup_query: |-
      SELECT STDDEV("{COLUMN_NAME}"::FLOAT) as current_standard_deviation FROM "{TARGET_SCHEMA}"."{TABLE_NAME}";
    error_type: Test Results
  - id: '1432'
    test_id: '1041'
    test_type: Variability_Decrease
    sql_flavor: redshift_spectrum
    lookup_type: null
    lookup_query: |-
      SELECT STDDEV(CAST("{COLUMN_NAME}" AS FLOAT)) as current_standard_deviation FROM "{TARGET_SCHEMA}"."{TABLE_NAME}";
    error_type: Test Results
  - id: '1228'
    test_id: '1041'
    test_type: Variability_Decrease
    sql_flavor: snowflake
    lookup_type: null
    lookup_query: |-
      SELECT STDDEV(CAST("{COLUMN_NAME}" AS FLOAT)) as current_standard_deviation FROM "{TARGET_SCHEMA}"."{TABLE_NAME}";
    error_type: Test Results
  test_templates: []
