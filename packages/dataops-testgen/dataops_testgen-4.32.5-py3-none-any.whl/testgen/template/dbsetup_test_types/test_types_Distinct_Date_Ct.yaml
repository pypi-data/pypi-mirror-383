test_types:
  id: '1012'
  test_type: Distinct_Date_Ct
  test_name_short: Date Count
  test_name_long: Count of distinct dates at or above reference
  test_description: |-
    Tests that the count of distinct dates referenced in the column has not dropped vs. baseline data
  except_message: |-
    Drop in count of unique dates recorded in column.
  measure_uom: Unique dates
  measure_uom_description: |-
    Count of unique dates in transactional date column
  selection_criteria: |-
    functional_data_type ILIKE 'Transactional Date%' AND date_days_present > 1 AND functional_table_type ILIKE  '%cumulative%'
  dq_score_prevalence_formula: |-
    (({RECORD_CT}-{PRO_RECORD_CT})::FLOAT*{DISTINCT_VALUE_CT}::FLOAT/NULLIF({PRO_RECORD_CT}::FLOAT, 0))/NULLIF({PRO_RECORD_CT}::FLOAT, 0)
  dq_score_risk_factor: '1.0'
  column_name_prompt: null
  column_name_help: null
  default_parm_columns: baseline_value,threshold_value
  default_parm_values: |-
    date_days_present,date_days_present
  default_parm_prompts: |-
    Distinct Date Count at Baseline,Min Expected Date Count
  default_parm_help: null
  default_severity: Fail
  run_type: CAT
  test_scope: column
  dq_dimension: Timeliness
  health_dimension: Recency
  threshold_description: |-
    Minimum distinct date count expected
  result_visualization: line_chart
  result_visualization_params: null
  usage_notes: |-
    Date Count tests that the count of distinct dates present in the column has not dropped since baseline. The test is relevant for cumulative datasets, where old records are retained. A failure here would indicate missing records, which could be caused by a processing error or changed upstream data sources.
  active: Y
  cat_test_conditions:
  - id: '7007'
    test_type: Distinct_Date_Ct
    sql_flavor: bigquery
    measure: |-
      COUNT(DISTINCT {COLUMN_NAME})
    test_operator: <
    test_condition: |-
      {THRESHOLD_VALUE}
  - id: '6007'
    test_type: Distinct_Date_Ct
    sql_flavor: databricks
    measure: |-
      COUNT(DISTINCT {COLUMN_NAME})
    test_operator: <
    test_condition: |-
      {THRESHOLD_VALUE}
  - id: '3007'
    test_type: Distinct_Date_Ct
    sql_flavor: mssql
    measure: |-
      COUNT(DISTINCT {COLUMN_NAME})
    test_operator: <
    test_condition: |-
      {THRESHOLD_VALUE}
  - id: '4007'
    test_type: Distinct_Date_Ct
    sql_flavor: postgresql
    measure: |-
      COUNT(DISTINCT {COLUMN_NAME})
    test_operator: <
    test_condition: |-
      {THRESHOLD_VALUE}
  - id: '1007'
    test_type: Distinct_Date_Ct
    sql_flavor: redshift
    measure: |-
      COUNT(DISTINCT {COLUMN_NAME})
    test_operator: <
    test_condition: |-
      {THRESHOLD_VALUE}
  - id: '7007'
    test_type: Distinct_Date_Ct
    sql_flavor: redshift_spectrum
    measure: |-
      COUNT(DISTINCT {COLUMN_NAME})
    test_operator: <
    test_condition: |-
      {THRESHOLD_VALUE}
  - id: '2007'
    test_type: Distinct_Date_Ct
    sql_flavor: snowflake
    measure: |-
      COUNT(DISTINCT {COLUMN_NAME})
    test_operator: <
    test_condition: |-
      {THRESHOLD_VALUE}
  - id: '5007'
    test_type: Distinct_Date_Ct
    sql_flavor: trino
    measure: |-
      COUNT(DISTINCT {COLUMN_NAME})
    test_operator: <
    test_condition: |-
      {THRESHOLD_VALUE}
  target_data_lookups:
  - id: '1370'
    test_id: '1012'
    test_type: Distinct_Date_Ct
    sql_flavor: bigquery
    lookup_type: null
    lookup_query: |-
      SELECT `{COLUMN_NAME}`, COUNT(*) AS count
      FROM `{TARGET_SCHEMA}`.`{TABLE_NAME}`
      WHERE `{COLUMN_NAME}` IS NOT NULL
      GROUP BY `{COLUMN_NAME}`
      ORDER BY `{COLUMN_NAME}` DESC
      LIMIT 500;
    error_type: Test Results
  - id: '1304'
    test_id: '1012'
    test_type: Distinct_Date_Ct
    sql_flavor: databricks
    lookup_type: null
    lookup_query: |-
      SELECT DISTINCT `{COLUMN_NAME}`, COUNT(*) AS count FROM `{TARGET_SCHEMA}`.`{TABLE_NAME}` WHERE `{COLUMN_NAME}` IS NOT NULL GROUP BY `{COLUMN_NAME}` ORDER BY `{COLUMN_NAME}` DESC LIMIT 500;
    error_type: Test Results
  - id: '1146'
    test_id: '1012'
    test_type: Distinct_Date_Ct
    sql_flavor: mssql
    lookup_type: null
    lookup_query: |-
      SELECT DISTINCT TOP 500 "{COLUMN_NAME}", COUNT(*) AS count FROM "{TARGET_SCHEMA}"."{TABLE_NAME}" WHERE "{COLUMN_NAME}" IS NOT NULL GROUP BY "{COLUMN_NAME}" ORDER BY "{COLUMN_NAME}" DESC;
    error_type: Test Results
  - id: '1089'
    test_id: '1012'
    test_type: Distinct_Date_Ct
    sql_flavor: postgresql
    lookup_type: null
    lookup_query: |-
      SELECT DISTINCT "{COLUMN_NAME}", COUNT(*) AS count FROM "{TARGET_SCHEMA}"."{TABLE_NAME}" WHERE "{COLUMN_NAME}" IS NOT NULL GROUP BY "{COLUMN_NAME}" ORDER BY "{COLUMN_NAME}" DESC LIMIT 500;
    error_type: Test Results
  - id: '1007'
    test_id: '1012'
    test_type: Distinct_Date_Ct
    sql_flavor: redshift
    lookup_type: null
    lookup_query: |-
      SELECT DISTINCT "{COLUMN_NAME}", COUNT(*) AS count FROM "{TARGET_SCHEMA}"."{TABLE_NAME}" WHERE "{COLUMN_NAME}" IS NOT NULL GROUP BY "{COLUMN_NAME}" ORDER BY "{COLUMN_NAME}" DESC LIMIT 500;
    error_type: Test Results
  - id: '1407'
    test_id: '1012'
    test_type: Distinct_Date_Ct
    sql_flavor: redshift_spectrum
    lookup_type: null
    lookup_query: |-
      SELECT DISTINCT "{COLUMN_NAME}", COUNT(*) AS count FROM "{TARGET_SCHEMA}"."{TABLE_NAME}" WHERE "{COLUMN_NAME}" IS NOT NULL GROUP BY "{COLUMN_NAME}" ORDER BY "{COLUMN_NAME}" DESC LIMIT 500;
    error_type: Test Results
  - id: '1203'
    test_id: '1012'
    test_type: Distinct_Date_Ct
    sql_flavor: snowflake
    lookup_type: null
    lookup_query: |-
      SELECT DISTINCT "{COLUMN_NAME}", COUNT(*) AS count FROM "{TARGET_SCHEMA}"."{TABLE_NAME}" WHERE "{COLUMN_NAME}" IS NOT NULL GROUP BY "{COLUMN_NAME}" ORDER BY "{COLUMN_NAME}" DESC LIMIT 500;
    error_type: Test Results
  test_templates: []
