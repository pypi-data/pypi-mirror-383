"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["82994"],{73097:function(t,i,s){s.a(t,async function(t,e){try{s.r(i),s.d(i,{DEFAULT_DAYS_TO_SHOW:function(){return S},HuiStatisticsGraphCard:function(){return w}});s(46852),s(35748),s(99342),s(65315),s(84136),s(22416),s(5934),s(95013);var n=s(69868),a=s(41484),r=s(4494),h=s(84922),_=s(11991),o=s(75907),c=(s(70490),s(43716)),d=s(36886),g=s(63002),l=s(44630),u=s(8510),y=s(38177),f=t([c,d,g]);[c,d,g]=f.then?(await f)():f;let v,p,m,b=t=>t;const S=30;class w extends h.WF{static async getConfigElement(){return await Promise.all([s.e("42153"),s.e("3654"),s.e("30199"),s.e("11015"),s.e("37824"),s.e("62975"),s.e("55038"),s.e("74644"),s.e("70756"),s.e("76950")]).then(s.bind(s,39788)),document.createElement("hui-statistics-graph-card-editor")}static getStubConfig(t,i,s){const e=(0,l.B)(t,1,i,s,["sensor"],t=>"state_class"in t.attributes);return{type:"statistics-graph",entities:e.length?[e[0]]:[]}}disconnectedCallback(){super.disconnectedCallback(),this._unsubscribeEnergy(),this._interval&&(clearInterval(this._interval),this._interval=void 0)}connectedCallback(){var t;super.connectedCallback(),this.hasUpdated&&(null!==(t=this._config)&&void 0!==t&&t.energy_date_selection?this._subscribeEnergy():void 0===this._interval&&this._setFetchStatisticsTimer(!0))}_subscribeEnergy(){var t;this._energySub||(this._energySub=(0,c.tb)(this.hass,{key:null===(t=this._config)||void 0===t?void 0:t.collection_key}).subscribe(t=>{this._energyStart=t.start,this._energyEnd=t.end,this._getStatistics()}))}_unsubscribeEnergy(){this._energySub&&(this._energySub(),this._energySub=void 0),this._energyStart=void 0,this._energyEnd=void 0}getCardSize(){var t,i,s;return 5+(null!==(t=this._config)&&void 0!==t&&t.title?2:0)+(null!==(i=this._config)&&void 0!==i&&i.hide_legend?0:(null===(s=this._entities)||void 0===s?void 0:s.length)||0)}getGridOptions(){return{columns:12,min_columns:6,min_rows:3}}setConfig(t){if(!t.entities||!Array.isArray(t.entities))throw new Error("Entities need to be an array");if(!t.entities.length)throw new Error("You must include at least one entity");const i=t.entities?(0,y.L)(t.entities,!1):[];this._entities=[],i.forEach(t=>{this._entities.push(t.entity),t.name&&(this._names[t.entity]=t.name)}),"string"==typeof t.stat_types?this._statTypes=[t.stat_types]:t.stat_types?this._statTypes=t.stat_types:this._statTypes=["change","state","sum","min","max","mean"],this._config=t}shouldUpdate(t){return(0,u.pY)(this,t)||t.size>1||!t.has("hass")}willUpdate(t){if(super.willUpdate(t),!this._config||!t.has("_config"))return;const i=t.get("_config");if(this.hass){if(this._config.energy_date_selection&&!this._energySub)return void this._subscribeEnergy();if(!this._config.energy_date_selection&&this._energySub)return this._unsubscribeEnergy(),void this._setFetchStatisticsTimer();this._config.energy_date_selection&&this._energySub&&t.has("_config")&&(null==i?void 0:i.collection_key)!==this._config.collection_key&&(this._unsubscribeEnergy(),this._subscribeEnergy())}t.has("_config")&&(null==i?void 0:i.entities)!==this._config.entities?this._setFetchStatisticsTimer(!0):!t.has("_config")||(null==i?void 0:i.stat_types)===this._config.stat_types&&(null==i?void 0:i.days_to_show)===this._config.days_to_show&&(null==i?void 0:i.period)===this._config.period&&(null==i?void 0:i.unit)===this._config.unit||this._setFetchStatisticsTimer()}async _setFetchStatisticsTimer(t=!1){var i;clearInterval(this._interval),this._interval=0,t&&await this._getStatisticsMetaData(this._entities),await this._getStatistics(),null!==(i=this._config)&&void 0!==i&&i.energy_date_selection||(this._interval=window.setInterval(()=>this._getStatistics(),this._intervalTimeout))}get _period(){var t,i;return null!==(t=null===(i=this._config)||void 0===i?void 0:i.period)&&void 0!==t?t:this._energyStart&&this._energyEnd?(0,d.TI)((0,a.c)(this._energyEnd,this._energyStart)):void 0}render(){var t,i;if(!this.hass||!this._config)return h.s6;const s="number"==typeof(null===(t=this._config.grid_options)||void 0===t?void 0:t.rows);return(0,h.qy)(v||(v=b` <ha-card> ${0} <div class="content ${0}"> <statistics-chart .hass="${0}" .isLoadingData="${0}" .statisticsData="${0}" .metadata="${0}" .period="${0}" .chartType="${0}" .statTypes="${0}" .names="${0}" .unit="${0}" .minYAxis="${0}" .maxYAxis="${0}" .startTime="${0}" .endTime="${0}" .fitYData="${0}" .hideLegend="${0}" .logarithmicScale="${0}" .daysToShow="${0}" .height="${0}" .expandLegend="${0}"></statistics-chart> </div> </ha-card> `),this._config.title?(0,h.qy)(p||(p=b`<h1 class="card-header">${0}</h1>`),this._config.title):h.s6,(0,o.H)({"has-header":!!this._config.title,"has-rows":!(null===(i=this._config.grid_options)||void 0===i||!i.rows)}),this.hass,!this._statistics,this._statistics,this._metadata,this._period,this._config.chart_type||"line",this._statTypes,this._names,this._unit,this._config.min_y_axis,this._config.max_y_axis,this._energyStart,this._energyEnd&&this._energyStart?(0,d.Gs)((0,a.c)(this._energyEnd,this._energyStart),this._energyEnd):void 0,this._config.fit_y_data||!1,this._config.hide_legend||!1,this._config.logarithmic_scale||!1,this._energyStart&&this._energyEnd?(0,a.c)(this._energyEnd,this._energyStart):this._config.days_to_show||S,s?"100%":void 0,this._config.expand_legend)}get _intervalTimeout(){var t;return 1e3*("5minute"===(null===(t=this._config)||void 0===t?void 0:t.period)?5:60)*60}async _getStatisticsMetaData(t){const i=await(0,g.Wr)(this.hass,t),s={};i.forEach(t=>{s[t.statistic_id]=t}),this._metadata=s}async _getStatistics(){var t;const i=null!==(t=this._energyStart)&&void 0!==t?t:(0,r.O)(new Date,24*(this._config.days_to_show||S)+1),s=this._energyEnd;try{let t;if(this._config.unit&&this._metadata){const i=Object.values(this._metadata).find(t=>(0,g.JE)(this.hass,null==t?void 0:t.statistic_id,t)===this._config.unit);i&&(t=i.unit_class,this._unit=this._config.unit)}if(!t&&this._metadata){const i=this._metadata[this._entities[0]];t=null==i?void 0:i.unit_class,this._unit=t&&(0,g.JE)(this.hass,i.statistic_id,i)||void 0}const e=t?{[t]:this._unit}:void 0,n=await(0,g.sz)(this.hass,i,s,this._entities,this._period,e,this._statTypes);this._statistics={},this._entities.forEach(t=>{t in n&&(this._statistics[t]=n[t])})}catch(e){this._statistics=void 0}}constructor(...t){super(...t),this._entities=[],this._names={}}}w.styles=(0,h.AH)(m||(m=b`ha-card{display:flex;flex-direction:column;height:100%}.card-header{padding-bottom:0}.content{padding:16px;flex:1}.has-header{padding-top:0}statistics-chart{height:100%}.has-rows{--chart-max-height:100%}`)),(0,n.__decorate)([(0,_.MZ)({attribute:!1})],w.prototype,"hass",void 0),(0,n.__decorate)([(0,_.wk)()],w.prototype,"_config",void 0),(0,n.__decorate)([(0,_.wk)()],w.prototype,"_statistics",void 0),(0,n.__decorate)([(0,_.wk)()],w.prototype,"_metadata",void 0),(0,n.__decorate)([(0,_.wk)()],w.prototype,"_unit",void 0),(0,n.__decorate)([(0,_.wk)()],w.prototype,"_energyStart",void 0),(0,n.__decorate)([(0,_.wk)()],w.prototype,"_energyEnd",void 0),w=(0,n.__decorate)([(0,_.EM)("hui-statistics-graph-card")],w),e()}catch(v){e(v)}})}}]);
//# sourceMappingURL=82994.cf12ebd1d3fe206b.js.map