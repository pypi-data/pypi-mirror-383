"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["3504"],{94327:function(t,e,a){a.d(e,{Vy:function(){return n},fI:function(){return r},ux:function(){return c}});var s=a(65940),o=a(83510);const i=["#4269d0","#f4bd4a","#ff725c","#6cc5b0","#a463f2","#ff8ab7","#9c6b4e","#97bbf5","#01ab63","#094bad","#c99000","#d84f3e","#49a28f","#048732","#d96895","#8043ce","#7599d1","#7a4c31","#6989f4","#ffd444","#ff957c","#8fe9d3","#62cc71","#ffadda","#c884ff","#badeff","#bf8b6d","#927acc","#97ee3f","#bf3947","#9f5b00","#f48758","#8caed6","#f2b94f","#eff26e","#e43872","#d9b100","#9d7a00","#698cff","#00d27e","#d06800","#009f82","#c49200","#cbe8ff","#fecddf","#c27eb6","#8cd2ce","#c4b8d9","#f883b0","#a49100","#f48800","#27d0df","#a04a9b"];function n(t){return i[t%i.length]}function r(t,e){const a=e.getPropertyValue(`--graph-color-${t+1}`)||n(t);return(0,o.RQ)(a)}const c=(0,s.A)(t=>i.map((e,a)=>r(a,t)),(t,e)=>t[0].getPropertyValue("--graph-color-1")===e[0].getPropertyValue("--graph-color-1"))},71770:function(t,e,a){a(35748),a(12977),a(95013);var s=a(69868),o=a(30103),i=a(86811),n=a(49377),r=a(34800),c=a(84922),d=a(11991);let h,l,p,u,_=t=>t;class f extends o.k{renderOutline(){return this.filled?(0,c.qy)(h||(h=_`<span class="filled"></span>`)):super.renderOutline()}getContainerClasses(){return Object.assign(Object.assign({},super.getContainerClasses()),{},{active:this.active})}renderPrimaryContent(){return(0,c.qy)(l||(l=_` <span class="leading icon" aria-hidden="true"> ${0} </span> <span class="label">${0}</span> <span class="touch"></span> <span class="trailing leading icon" aria-hidden="true"> ${0} </span> `),this.renderLeadingIcon(),this.label,this.renderTrailingIcon())}renderTrailingIcon(){return(0,c.qy)(p||(p=_`<slot name="trailing-icon"></slot>`))}constructor(...t){super(...t),this.filled=!1,this.active=!1}}f.styles=[n.R,r.R,i.R,(0,c.AH)(u||(u=_`:host{--md-sys-color-primary:var(--primary-text-color);--md-sys-color-on-surface:var(--primary-text-color);--md-assist-chip-container-shape:var(
          --ha-assist-chip-container-shape,
          16px
        );--md-assist-chip-outline-color:var(--outline-color);--md-assist-chip-label-text-weight:400}.filled{display:flex;pointer-events:none;border-radius:inherit;inset:0;position:absolute;background-color:var(--ha-assist-chip-filled-container-color)}::slotted([slot=icon]),::slotted([slot=trailing-icon]){display:flex;--mdc-icon-size:var(--md-input-chip-icon-size, 18px);font-size:var(--_label-text-size)!important}.trailing.icon ::slotted(*),.trailing.icon svg{margin-inline-end:unset;margin-inline-start:var(--_icon-label-space)}::before{background:var(--ha-assist-chip-container-color,transparent);opacity:var(--ha-assist-chip-container-opacity, 1)}:where(.active)::before{background:var(--ha-assist-chip-active-container-color);opacity:var(--ha-assist-chip-active-container-opacity)}.label{font-family:var(--ha-font-family-body)}`))],(0,s.__decorate)([(0,d.MZ)({type:Boolean,reflect:!0})],f.prototype,"filled",void 0),(0,s.__decorate)([(0,d.MZ)({type:Boolean})],f.prototype,"active",void 0),f=(0,s.__decorate)([(0,d.EM)("ha-assist-chip")],f)},42029:function(t,e,a){a.d(e,{g:function(){return i}});a(39118);var s=a(83510),o=a(6788);function i(t,e,a,i,n,r){const c=t.getPropertyValue(n+"-"+r).trim(),d=c.length>0?c:t.getPropertyValue(n).trim();let h=(0,s.RQ)(d);return 0===c.length&&r&&(h=(0,s.v2)((0,s.BE)(e?(0,o.T)((0,s.Nc)((0,s.xp)(h)),r):(0,o.d)((0,s.Nc)((0,s.xp)(h)),r)))),i?h+=a?"32":"7F":a&&(h+="7F"),h}},45863:function(t,e,a){a.a(t,async function(t,s){try{a.r(e),a.d(e,{HuiEnergyDevicesDetailGraphCard:function(){return x}});a(79827),a(35748),a(99342),a(9724),a(35058),a(65315),a(837),a(84136),a(22416),a(37089),a(48169),a(12977),a(67579),a(18223),a(30500),a(95013);var o=a(69868),i=a(76174),n=a(30765),r=a(84922),c=a(11991),d=a(75907),h=a(65940),l=a(94327),p=a(42029),u=(a(70490),a(68717)),_=a(43716),f=a(63002),m=a(40328),g=a(8510),v=a(36886),y=a(20051),b=a(8868),k=t([u,_,f,b,v]);[u,_,f,b,v]=k.then?(await k)():k;let S,C,$,w=t=>t;const D="kWh";class x extends((0,m.E)(r.WF)){hassSubscribe(){var t;return[(0,_.tb)(this.hass,{key:null===(t=this._config)||void 0===t?void 0:t.collection_key}).subscribe(t=>{this._data=t})]}getCardSize(){return 3}setConfig(t){this._config=t}shouldUpdate(t){return(0,g.xP)(this,t)||t.size>1||!t.has("hass")}willUpdate(t){(t.has("_config")||t.has("_data"))&&this._processStatistics()}render(){return this.hass&&this._config?(0,r.qy)(S||(S=w` <ha-card> ${0} <div class="content ${0}"> <ha-chart-base .hass="${0}" .data="${0}" .options="${0}" @dataset-hidden="${0}" @dataset-unhidden="${0}"></ha-chart-base> </div> </ha-card> `),this._config.title?(0,r.qy)(C||(C=w`<h1 class="card-header">${0}</h1>`),this._config.title):"",(0,d.H)({"has-header":!!this._config.title}),this.hass,this._chartData,this._createOptions(this._start,this._end,this.hass.locale,this.hass.config,D,this._compareStart,this._compareEnd),this._datasetHidden,this._datasetUnhidden):r.s6}_datasetHidden(t){this._hiddenStats=[...this._hiddenStats,this._getStatIdFromId(t.detail.id)]}_datasetUnhidden(t){this._hiddenStats=this._hiddenStats.filter(e=>e!==this._getStatIdFromId(t.detail.id))}_processStatistics(){if(!this._data)return;const t=this._data;this._start=t.start,this._end=t.end||(0,i.o)(),this._compareStart=t.startCompare,this._compareEnd=t.endCompare;const e=t.stats,a=t.statsCompare,s=getComputedStyle(this),o=t.prefs.device_consumption,n={};o.forEach(t=>{t.included_in_stat&&(n[t.included_in_stat]=n[t.included_in_stat]||[],n[t.included_in_stat].push(t.stat_consumption))});const r={};t.prefs.device_consumption.forEach(t=>{const a=t.stat_consumption in e&&(0,f.$j)(e[t.stat_consumption])||0;r[t.stat_consumption]=a});const c={};t.prefs.device_consumption.forEach(t=>{c[t.stat_consumption]=(n[t.stat_consumption]||[]).reduce((t,e)=>t-r[e],r[t.stat_consumption])});const d=t.prefs.device_consumption.map(t=>t.stat_consumption);d.sort((t,e)=>c[e]-c[t]);const h=[],{summedData:l,compareSummedData:p}=(0,_.gv)(t),u="from_grid"in l||"solar"in l||"from_battery"in l,{consumption:m,compareConsumption:g}=u?(0,_.DR)(l,p):{consumption:void 0,compareConsumption:void 0};if(a){const e=this._processDataSet(s,a,t.statsMetadata,t.prefs.device_consumption,d,n,!0);if(h.push(...e),u){const t=this._processUntracked(s,e,g,!0);h.push(t)}}h.push({id:"compare-placeholder",type:"bar",stack:t.statsCompare?"devicesCompare":"devices",data:[]});const y=this._processDataSet(s,e,t.statsMetadata,t.prefs.device_consumption,d,n);if(h.push(...y),this._legendData=y.map(t=>{var e;return{id:t.id,secondaryIds:[`compare-${t.id}`],name:t.name,itemStyle:{color:t.color,borderColor:null===(e=t.itemStyle)||void 0===e?void 0:e.borderColor}}}),u){var b;const t=this._processUntracked(s,y,m,!1);h.push(t),this._legendData.push({id:t.id,secondaryIds:[`compare-${t.id}`],name:t.name,itemStyle:{color:t.color,borderColor:null===(b=t.itemStyle)||void 0===b?void 0:b.borderColor}})}(0,v.RR)(h),this._chartData=h}_processUntracked(t,e,a,s){const o={};e.forEach(t=>{t.data.forEach(t=>{o[t[s?2:0]]=(o[t[s?2:0]]||0)+t[1]})});const i=(0,v.ok)(this._start,this._compareStart),n=[];Object.keys(a.used_total).sort((t,e)=>Number(t)-Number(e)).forEach(t=>{const e=Number(t),r=[e,a.used_total[t]-(o[t]||0)];s&&(r[2]=r[0],r[0]=i(new Date(e)).getTime()),n.push(r)});const r=Date.now();return{type:"bar",cursor:"default",id:s?`compare-untracked-${r}`:`untracked-${r}`,name:this.hass.localize("ui.panel.lovelace.cards.energy.energy_devices_detail_graph.untracked_consumption"),itemStyle:{borderColor:(0,p.g)(t,this.hass.themes.darkMode,!1,s,"--history-unknown-color")},barMaxWidth:50,color:(0,p.g)(t,this.hass.themes.darkMode,!0,s,"--history-unknown-color"),data:n,stack:s?"devicesCompare":"devices"}}_processDataSet(t,e,a,s,o,i,n=!1){const r=[],c=(0,v.ok)(this._start,this._compareStart);return s.forEach((s,d)=>{var h;const p=o.indexOf(s.stat_consumption);if(null!==(h=this._config)&&void 0!==h&&h.max_devices&&p>=this._config.max_devices)return void console.warn(`Max devices exceeded for ${s.name} (${p} >= ${this._config.max_devices})`);const u=(0,l.fI)(d,t);let _=null;const m=[];if(s.stat_consumption in e){const t=e[s.stat_consumption];for(const a of t){if(null===a.change||void 0===a.change||0===a.change)continue;if(_===a.start)continue;let t=0;(i[s.stat_consumption]||[]).forEach(s=>{var o;const i=e[s];t+=(null==i||null===(o=i.find(t=>t.start===a.start))||void 0===o?void 0:o.change)||0});const o=[a.start,a.change-t];n&&(o[2]=o[0],o[0]=c(new Date(a.start)).getTime()),m.push(o),_=a.start}}const g=(s.name||(0,f.$O)(this.hass,s.stat_consumption,a[s.stat_consumption]))+(s.stat_consumption in i?` (${this.hass.localize("ui.panel.lovelace.cards.energy.energy_devices_detail_graph.untracked")})`:"");r.push({type:"bar",cursor:"default",id:n?`compare-${s.stat_consumption}-${p}`:`${s.stat_consumption}-${p}`,name:g,itemStyle:{borderColor:n?u+"7F":u},barMaxWidth:50,color:n?u+"32":u+"7F",data:m,stack:n?"devicesCompare":"devices"})}),o.map(t=>r.find(e=>this._getStatIdFromId(e.id)===t)).filter(Boolean)}_getStatIdFromId(t){return t.replace(/^compare-/,"").replace(/-\d+$/,"")}constructor(...t){super(...t),this._chartData=[],this._start=(0,n.R)(),this._end=(0,i.o)(),this._hiddenStats=[],this.hassSubscribeRequiredHostProps=["_config"],this._formatTotal=t=>this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.total_consumed",{num:(0,b.ZV)(t,this.hass.locale),unit:D}),this._createOptions=(0,h.A)((t,e,a,s,o,i,n)=>{const r=(0,v.od)(t,e,a,s,o,i,n,this._formatTotal),c=this._legendData?this._legendData.filter(t=>t.id&&this._hiddenStats.includes(this._getStatIdFromId(t.id))).reduce((t,e)=>(t[e.id]=!1,t),{}):{};return Object.assign(Object.assign({},r),{},{legend:{show:!0,type:"custom",data:this._legendData,selected:c},grid:{top:15,bottom:0,left:1,right:1,containLabel:!0}})})}}x.styles=(0,r.AH)($||($=w`.card-header{padding-bottom:0}.content{padding:16px}.has-header{padding-top:0}`)),(0,o.__decorate)([(0,c.MZ)({attribute:!1})],x.prototype,"hass",void 0),(0,o.__decorate)([(0,c.wk)()],x.prototype,"_config",void 0),(0,o.__decorate)([(0,c.wk)()],x.prototype,"_chartData",void 0),(0,o.__decorate)([(0,c.wk)()],x.prototype,"_data",void 0),(0,o.__decorate)([(0,c.wk)()],x.prototype,"_legendData",void 0),(0,o.__decorate)([(0,c.wk)()],x.prototype,"_start",void 0),(0,o.__decorate)([(0,c.wk)()],x.prototype,"_end",void 0),(0,o.__decorate)([(0,c.wk)()],x.prototype,"_compareStart",void 0),(0,o.__decorate)([(0,c.wk)()],x.prototype,"_compareEnd",void 0),(0,o.__decorate)([(0,c.wk)(),(0,y.I)({key:"energy-devices-hidden-stats",state:!0,subscribe:!1})],x.prototype,"_hiddenStats",void 0),x=(0,o.__decorate)([(0,c.EM)("hui-energy-devices-detail-graph-card")],x),s()}catch(S){s(S)}})},74758:function(t,e,a){a.d(e,{o:function(){return n}});var s=a(48869),o=a(27554),i=a(28829);function n(t,e,a){const n=(0,i.b)(t,e)/o.Cg;return(0,s.u)(null==a?void 0:a.roundingMethod)(n)}},76174:function(t,e,a){a.d(e,{o:function(){return o}});var s=a(3313);function o(t){return(0,s.D)(Date.now(),t)}},30765:function(t,e,a){a.d(e,{R:function(){return o}});var s=a(70162);function o(t){return(0,s.o)(Date.now(),t)}}}]);
//# sourceMappingURL=3504.ea04f3c8e6f03989.js.map