export const __webpack_id__="19348";export const __webpack_ids__=["19348"];export const __webpack_modules__={94327:function(e,t,a){a.d(t,{Vy:()=>s,fI:()=>n,ux:()=>l});var r=a(65940),i=a(83510);const o=["#4269d0","#f4bd4a","#ff725c","#6cc5b0","#a463f2","#ff8ab7","#9c6b4e","#97bbf5","#01ab63","#094bad","#c99000","#d84f3e","#49a28f","#048732","#d96895","#8043ce","#7599d1","#7a4c31","#6989f4","#ffd444","#ff957c","#8fe9d3","#62cc71","#ffadda","#c884ff","#badeff","#bf8b6d","#927acc","#97ee3f","#bf3947","#9f5b00","#f48758","#8caed6","#f2b94f","#eff26e","#e43872","#d9b100","#9d7a00","#698cff","#00d27e","#d06800","#009f82","#c49200","#cbe8ff","#fecddf","#c27eb6","#8cd2ce","#c4b8d9","#f883b0","#a49100","#f48800","#27d0df","#a04a9b"];function s(e){return o[e%o.length]}function n(e,t){const a=t.getPropertyValue(`--graph-color-${e+1}`)||s(e);return(0,i.RQ)(a)}const l=(0,r.A)(e=>o.map((t,a)=>n(a,e)),(e,t)=>e[0].getPropertyValue("--graph-color-1")===t[0].getPropertyValue("--graph-color-1"))},37382:function(e,t,a){a.d(t,{D:()=>o});var r=a(10416),i=a.n(r);const o=e=>i()(e,{whiteList:{},stripIgnoreTag:!0,stripIgnoreTagBody:!0})},80475:function(e,t,a){a.a(e,async function(e,t){try{a(99342),a(65315),a(837),a(84136),a(22416),a(37089),a(48169),a(88238),a(34536),a(16257),a(20152),a(44711),a(72108),a(77030);var r=a(69868),i=a(22019),o=a(84922),s=a(56425),n=a(65940),l=a(88006),c=a(35083),d=a(37382),u=a(68717),h=a(83034),_=(a(94124),e([u]));u=(_.then?(await _)():_)[0];const p=5,g=12,f=8,v=5;class y extends o.WF{render(){const e={grid:{top:0,bottom:0,left:0,right:0},tooltip:{trigger:"item",formatter:this._renderTooltip,appendTo:document.body}};return o.qy`<ha-chart-base .data="${this._createData(this.data,this._sizeController.value?.width)}" .options="${e}" height="100%" .extraComponents="${[s.a]}"></ha-chart-base>`}_processLinks(e,t){const a=new Map,r=new Map,i=[];return t.forEach(t=>{const o=e.find(e=>e.id===t.source),s=e.find(e=>e.id===t.target);if(!o||!s)return;const n=r.get(o.id)||0,l=a.get(s.id)||0,c=o.value-n,d=s.value-l,u=Math.min(t.value??c,c,d);a.set(s.id,l+u),r.set(o.id,n+u),u>0&&i.push({...t,value:u})}),i}_findParentIndex(e,t,a){const r=t.find(t=>t.target===e)?.source;if(!r)return-1;let i=0;for(let e=a.length-1;e>=0;e--){const t=a[e],o=t.findIndex(e=>e.id===r);if(-1!==o)return i+o;i+=t.length}return-1}constructor(...e){super(...e),this.data={nodes:[],links:[]},this.vertical=!1,this._sizeController=new l.P(this,{callback:e=>e[0]?.contentRect}),this._renderTooltip=e=>{const t=e.data,a=this.valueFormatter?this.valueFormatter(t.value):t.value;if(t.id){const r=this.data.nodes.find(e=>e.id===t.id);return`${e.marker} ${(0,d.D)(r?.label??t.id)}<br>${a}`}if(t.source&&t.target){const e=this.data.nodes.find(e=>e.id===t.source),r=this.data.nodes.find(e=>e.id===t.target);return`${(0,d.D)(e?.label??t.source)} → ${(0,d.D)(r?.label??t.target)}<br>${a}`}return null},this._createData=(0,n.A)((e,t=0)=>{const a=e.nodes.filter(e=>e.value>0),r=[...new Set(a.map(e=>e.index))].sort(),i=new Map,o=[];r.forEach((t,r)=>{i.set(t,r);const s=a.filter(e=>e.index===t);s.length>0&&o.push(o.length>0?s.sort((t,a)=>{const r=this._findParentIndex(t.id,e.links,o),i=this._findParentIndex(a.id,e.links,o);return r===i?0:-1===r?1:-1===i?-1:r-i}):s)});const s=this._processLinks(a,e.links),n=t/r.length-h.hD-v;return{id:"sankey",type:"sankey",nodes:o.flat().map(e=>({id:e.id,value:e.value,itemStyle:{color:e.color},depth:i.get(e.index)})),links:s,draggable:!1,orient:this.vertical?"vertical":"horizontal",nodeWidth:15,nodeGap:f,lineStyle:{color:"gradient",opacity:.4},layoutIterations:0,label:{formatter:t=>e.nodes.find(e=>e.id===t.data.id)?.label??t.data.id,position:this.vertical?"bottom":"right",distance:v,minMargin:5,overflow:"break"},labelLayout:e=>{if(this.vertical){const t=e.text.split(" ").reduce((e,t)=>e.length>t.length?e:t,""),a=(0,c.W)(t,g),r=e.rect.width+6,i=Math.min(g,r/a*g);return{fontSize:i>1?i:0,width:r,align:"center",dy:-2}}const t=e.rect.height+8,a=Math.min(t/e.labelRect.height*g,g);return{fontSize:a,lineHeight:a,width:n,height:e.rect.height}},top:this.vertical?0:p,bottom:this.vertical?25:p,left:this.vertical?p:0,right:this.vertical?p:n+v,emphasis:{focus:"adjacency"}}})}}y.styles=o.AH`:host{display:block;flex:1;background:var(--ha-card-background,var(--card-background-color))}ha-chart-base{width:100%;height:100%}`,(0,r.__decorate)([(0,i.MZ)({attribute:!1})],y.prototype,"hass",void 0),(0,r.__decorate)([(0,i.MZ)({attribute:!1})],y.prototype,"data",void 0),(0,r.__decorate)([(0,i.MZ)({type:Boolean})],y.prototype,"vertical",void 0),(0,r.__decorate)([(0,i.MZ)({type:String,attribute:!1})],y.prototype,"valueFormatter",void 0),(0,r.__decorate)([(0,i.wk)()],y.prototype,"_sizeController",void 0),y=(0,r.__decorate)([(0,i.EM)("ha-sankey-chart")],y),t()}catch(e){t(e)}})},71770:function(e,t,a){var r=a(69868),i=a(30103),o=a(86811),s=a(49377),n=a(34800),l=a(84922),c=a(22019);class d extends i.k{renderOutline(){return this.filled?l.qy`<span class="filled"></span>`:super.renderOutline()}getContainerClasses(){return{...super.getContainerClasses(),active:this.active}}renderPrimaryContent(){return l.qy` <span class="leading icon" aria-hidden="true"> ${this.renderLeadingIcon()} </span> <span class="label">${this.label}</span> <span class="touch"></span> <span class="trailing leading icon" aria-hidden="true"> ${this.renderTrailingIcon()} </span> `}renderTrailingIcon(){return l.qy`<slot name="trailing-icon"></slot>`}constructor(...e){super(...e),this.filled=!1,this.active=!1}}d.styles=[s.R,n.R,o.R,l.AH`:host{--md-sys-color-primary:var(--primary-text-color);--md-sys-color-on-surface:var(--primary-text-color);--md-assist-chip-container-shape:var(
          --ha-assist-chip-container-shape,
          16px
        );--md-assist-chip-outline-color:var(--outline-color);--md-assist-chip-label-text-weight:400}.filled{display:flex;pointer-events:none;border-radius:inherit;inset:0;position:absolute;background-color:var(--ha-assist-chip-filled-container-color)}::slotted([slot=icon]),::slotted([slot=trailing-icon]){display:flex;--mdc-icon-size:var(--md-input-chip-icon-size, 18px);font-size:var(--_label-text-size)!important}.trailing.icon ::slotted(*),.trailing.icon svg{margin-inline-end:unset;margin-inline-start:var(--_icon-label-space)}::before{background:var(--ha-assist-chip-container-color,transparent);opacity:var(--ha-assist-chip-container-opacity, 1)}:where(.active)::before{background:var(--ha-assist-chip-active-container-color);opacity:var(--ha-assist-chip-active-container-opacity)}.label{font-family:var(--ha-font-family-body)}`],(0,r.__decorate)([(0,c.MZ)({type:Boolean,reflect:!0})],d.prototype,"filled",void 0),(0,r.__decorate)([(0,c.MZ)({type:Boolean})],d.prototype,"active",void 0),d=(0,r.__decorate)([(0,c.EM)("ha-assist-chip")],d)},83034:function(e,t,a){a.d(t,{Es:()=>r,dc:()=>o,hD:()=>i});const r=10,i=30,o=20},63002:function(e,t,a){a.d(t,{$3:()=>g,$O:()=>w,$j:()=>f,ED:()=>o,JE:()=>S,OQ:()=>M,PU:()=>$,Ph:()=>_,Uf:()=>k,W1:()=>p,Wr:()=>d,Z:()=>l,gF:()=>v,iY:()=>y,jU:()=>s,nN:()=>x,p3:()=>c,pJ:()=>h,r_:()=>n,sz:()=>u});a(65315),a(59023);var r=a(72652),i=a(50654),o=function(e){return e[e.NONE=0]="NONE",e[e.ARITHMETIC=1]="ARITHMETIC",e[e.CIRCULAR=2]="CIRCULAR",e}({});const s=59509==a.j?["entity_not_recorded","entity_no_longer_recorded","state_class_removed","units_changed","mean_type_changed","no_state"]:null,n=["L","gal","ft³","m³","CCF","MCF"],l=e=>e.sendMessagePromise({type:"recorder/info"}),c=(e,t)=>e.callWS({type:"recorder/list_statistic_ids",statistic_type:t}),d=(e,t)=>e.callWS({type:"recorder/get_statistics_metadata",statistic_ids:t}),u=(e,t,a,r,i="hour",o,s)=>e.callWS({type:"recorder/statistics_during_period",start_time:t.toISOString(),end_time:a?.toISOString(),statistic_ids:r,period:i,units:o,types:s}),h=(e,t,a,r)=>e.callWS({type:"recorder/statistic_during_period",statistic_id:t,units:r,fixed_period:a.fixed_period?{start_time:a.fixed_period.start instanceof Date?a.fixed_period.start.toISOString():a.fixed_period.start,end_time:a.fixed_period.end instanceof Date?a.fixed_period.end.toISOString():a.fixed_period.end}:void 0,calendar:a.calendar?{..."week"===a.calendar.period?{first_weekday:(0,i.DD)(e.locale).substring(0,3)}:{},...a.calendar}:void 0,rolling_window:a.rolling_window}),_=e=>e.callWS({type:"recorder/validate_statistics"}),p=(e,t,a)=>e.callWS({type:"recorder/update_statistics_metadata",statistic_id:t,unit_of_measurement:a}),g=(e,t)=>e.callWS({type:"recorder/clear_statistics",statistic_ids:t}),f=e=>{let t=null;if(!e)return null;for(const a of e)null!==a.change&&void 0!==a.change&&(null===t?t=a.change:t+=a.change);return t},v=(e,t)=>{let a=null;for(const r of t){if(!(r in e))continue;const t=f(e[r]);null!==t&&(null===a?a=t:a+=t)}return a},y=(e,t)=>e.some(e=>void 0!==e[t]&&null!==e[t]),m=["mean","min","max"],b=["sum","state","change"],x=(e,t)=>!(!m.includes(t)||0===e.mean_type)||!(!b.includes(t)||!e.has_sum),k=(e,t,a,r,i)=>{const o=new Date(a).toISOString();return e.callWS({type:"recorder/adjust_sum_statistics",statistic_id:t,start_time:o,adjustment:r,adjustment_unit_of_measurement:i})},w=(e,t,a)=>{const i=e.states[t];return i?(0,r.u)(i):a?.name||t},S=(e,t,a)=>{let r;return t&&(r=e.states[t]?.attributes.unit_of_measurement),void 0===r?a?.statistics_unit_of_measurement:r},M=e=>e.includes(":"),$=e=>e.callWS({type:"recorder/update_statistics_issues"})},75335:function(e,t,a){a.d(t,{Q:()=>n});var r=a(69868),i=a(22019),o=a(48125),s=a(32211);const n=e=>{class t extends e{connectedCallback(){super.connectedCallback(),this._unsubMql=(0,s.m)("all and (max-width: 450px), all and (max-height: 500px)",e=>{this._isMobileSize=e})}disconnectedCallback(){super.disconnectedCallback(),this._unsubMql?.(),this._unsubMql=void 0}constructor(...e){super(...e),this._isMobileSize=!1,this._isMobileClient=o.M}}return(0,r.__decorate)([(0,i.wk)()],t.prototype,"_isMobileSize",void 0),t}},41970:function(e,t,a){a.a(e,async function(e,r){try{a.r(t);a(99342),a(65315),a(22416);var i=a(69868),o=a(84922),s=a(22019),n=(a(70490),a(86160),a(43716)),l=a(63002),c=a(40328),d=a(80475),u=a(94327),h=a(8868),_=a(73941),p=a(75335),g=e([d,n,h]);[d,n,h]=g.then?(await g)():g;const f={group_by_floor:!0,group_by_area:!0};class v extends((0,c.E)((0,p.Q)(o.WF))){setConfig(e){this._config={...f,...e}}hassSubscribe(){return[(0,n.tb)(this.hass,{key:this._config?.collection_key}).subscribe(e=>{this._data=e})]}getCardSize(){return 5}getGridOptions(){return{columns:12,min_columns:6,rows:6,min_rows:2}}shouldUpdate(e){return e.has("_config")||e.has("_data")||e.has("_isMobileSize")}render(){if(!this._config)return o.s6;if(!this._data)return o.qy`${this.hass.localize("ui.panel.lovelace.cards.energy.loading")}`;const e=this._data.prefs,t=(0,n.E$)(e),{summedData:a,compareSummedData:r}=(0,n.gv)(this._data),{consumption:i,compareConsumption:s}=(0,n.DR)(a,void 0),c=getComputedStyle(this),d=[],h=[],_={id:"home",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_distribution.home"),value:Math.max(0,i.total.used_total),color:c.getPropertyValue("--primary-color").trim(),index:1};if(d.push(_),t.battery){const e=a.total.from_battery??0,t=a.total.to_battery??0;d.push({id:"battery",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_distribution.battery"),value:e,color:c.getPropertyValue("--energy-battery-out-color").trim(),index:0}),h.push({source:"battery",target:"home",value:i.total.used_battery}),d.push({id:"battery_in",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_distribution.battery"),value:t,color:c.getPropertyValue("--energy-battery-in-color").trim(),index:1}),i.total.grid_to_battery>0&&h.push({source:"grid",target:"battery_in",value:i.total.grid_to_battery}),i.total.solar_to_battery>0&&h.push({source:"solar",target:"battery_in",value:i.total.solar_to_battery})}if(t.grid){const e=a.total.from_grid??0;d.push({id:"grid",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_distribution.grid"),value:e,color:c.getPropertyValue("--energy-grid-consumption-color").trim(),index:0}),h.push({source:"grid",target:"home",value:i.total.used_grid})}if(t.solar){const e=a.total.solar??0;d.push({id:"solar",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_distribution.solar"),value:e,color:c.getPropertyValue("--energy-solar-color").trim(),index:0}),h.push({source:"solar",target:"home",value:i.total.used_solar})}if(t.grid&&t.grid[0].flow_to){const e=a.total.to_grid??0;d.push({id:"grid_return",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_distribution.grid"),value:e,color:c.getPropertyValue("--energy-grid-return-color").trim(),index:1}),i.total.battery_to_grid>0&&h.push({source:"battery",target:"grid_return",value:i.total.battery_to_grid}),i.total.solar_to_grid>0&&h.push({source:"solar",target:"grid_return",value:i.total.solar_to_grid})}let p=_.value;const g=[],f={};e.device_consumption.forEach((e,t)=>{const a=e.stat_consumption in this._data.stats&&(0,l.$j)(this._data.stats[e.stat_consumption])||0;if(a<.01)return;const r={id:e.stat_consumption,label:e.name||(0,l.$O)(this.hass,e.stat_consumption,this._data.statsMetadata[e.stat_consumption]),value:a,color:(0,u.fI)(t,c),index:4,parent:e.included_in_stat};r.parent?(f[r.id]=r.parent,h.push({source:r.parent,target:r.id})):p-=a,g.push(r)});const v=g.filter(e=>!f[e.id]),{group_by_area:y,group_by_floor:m}=this._config;if(y||m){const{areas:e,floors:t}=this._groupByFloorAndArea(v);Object.keys(t).sort((e,t)=>(this.hass.floors[t]?.level??-1/0)-(this.hass.floors[e]?.level??-1/0)).forEach(a=>{let r=`floor_${a}`;"no_floor"!==a&&m?(d.push({id:r,label:this.hass.floors[a].name,value:t[a].value,index:2,color:c.getPropertyValue("--primary-color").trim()}),h.push({source:"home",target:r})):r="home",t[a].areas.forEach(t=>{let a;if("no_area"!==t&&y){const i=`area_${t}`;d.push({id:i,label:this.hass.areas[t].name,value:e[t].value,index:3,color:c.getPropertyValue("--primary-color").trim()}),h.push({source:r,target:i,value:e[t].value}),a=i}else a=r;e[t].devices.forEach(e=>{h.push({source:a,target:e.id,value:e.value})})})})}else v.forEach(e=>{h.push({source:"home",target:e.id,value:e.value})});const b=this._getDeviceSections(f,g);b.forEach((e,t)=>{e.forEach(e=>{d.push({...e,index:4+t})})}),p>0&&(d.push({id:"untracked",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_devices_detail_graph.untracked_consumption"),value:p,color:c.getPropertyValue("--state-unavailable-color").trim(),index:3+b.length}),h.push({source:"home",target:"untracked",value:p}));const x=d.some(e=>e.value>0),k="vertical"===this._config.layout||"horizontal"!==this._config.layout&&this._isMobileSize;return o.qy` <ha-card .header="${this._config.title}"> <div class="card-content"> ${x?o.qy`<ha-sankey-chart .data="${{nodes:d,links:h}}" .vertical="${k}" .valueFormatter="${this._valueFormatter}"></ha-sankey-chart>`:o.qy`${this.hass.localize("ui.panel.lovelace.cards.energy.no_data_period")}`} </div> </ha-card> `}_groupByFloorAndArea(e){const t={no_area:{value:0,devices:[]}},a={no_floor:{value:0,areas:["no_area"]}};return e.forEach(e=>{const r=this.hass.states[e.id],{area:i,floor:o}=(0,_.l)(r,this.hass.entities,this.hass.devices,this.hass.areas,this.hass.floors);i?(i.area_id in t?(t[i.area_id].value+=e.value,t[i.area_id].devices.push(e)):t[i.area_id]={value:e.value,devices:[e]},o?o.floor_id in a?(a[o.floor_id].value+=e.value,a[o.floor_id].areas.includes(i.area_id)||a[o.floor_id].areas.push(i.area_id)):a[o.floor_id]={value:e.value,areas:[i.area_id]}:(a.no_floor.value+=e.value,a.no_floor.areas.includes(i.area_id)||a.no_floor.areas.unshift(i.area_id))):(t.no_area.value+=e.value,t.no_area.devices.push(e))}),{areas:t,floors:a}}_getDeviceSections(e,t){const a=[],r=[],i=Object.values(e),o={};return t.forEach(t=>{const o=t.id in e;i.includes(t.id)&&!o?a.push(t):r.push(t)}),Object.entries(e).forEach(([e,t])=>{a.some(e=>e.id===t)||(o[e]=t)}),a.length>0?[a,...this._getDeviceSections(o,r)]:[t]}constructor(...e){super(...e),this.hassSubscribeRequiredHostProps=["_config"],this._valueFormatter=e=>`${(0,h.ZV)(e,this.hass.locale,e<.1?{maximumFractionDigits:3}:void 0)} kWh`}}v.styles=o.AH`:host{display:block;height:calc(var(--row-size,8) * (var(--row-height,50px) + var(--row-gap,0px)) - var(--row-gap,0px))}ha-card{height:100%;display:flex;flex-direction:column}.card-content{flex:1;display:flex}`,(0,i.__decorate)([(0,s.MZ)({attribute:!1})],v.prototype,"hass",void 0),(0,i.__decorate)([(0,s.wk)()],v.prototype,"_config",void 0),(0,i.__decorate)([(0,s.wk)()],v.prototype,"_data",void 0),v=(0,i.__decorate)([(0,s.EM)("hui-energy-sankey-card")],v),r()}catch(e){r(e)}})},48125:function(e,t,a){a.d(t,{M:()=>r});const r=/(?:iphone|android|ipad)/i.test(navigator.userAgent)},35083:function(e,t,a){let r;function i(e,t,a="Roboto, Noto, sans-serif"){r||(r=document.createElement("canvas"));const i=r.getContext("2d");if(!i)return 0;i.font=`${t}px ${a}`;const o=i.measureText(e);return Math.ceil(Math.max(o.actualBoundingBoxRight+o.actualBoundingBoxLeft,o.width))}a.d(t,{W:()=>i})}};
//# sourceMappingURL=19348.bd45f7666ae71324.js.map