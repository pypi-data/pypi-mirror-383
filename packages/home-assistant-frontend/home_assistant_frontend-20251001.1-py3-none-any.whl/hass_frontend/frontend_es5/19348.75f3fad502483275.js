"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["19348"],{94327:function(t,e,a){a.d(e,{Vy:function(){return n},fI:function(){return s},ux:function(){return l}});var r=a(65940),i=a(83510);const o=["#4269d0","#f4bd4a","#ff725c","#6cc5b0","#a463f2","#ff8ab7","#9c6b4e","#97bbf5","#01ab63","#094bad","#c99000","#d84f3e","#49a28f","#048732","#d96895","#8043ce","#7599d1","#7a4c31","#6989f4","#ffd444","#ff957c","#8fe9d3","#62cc71","#ffadda","#c884ff","#badeff","#bf8b6d","#927acc","#97ee3f","#bf3947","#9f5b00","#f48758","#8caed6","#f2b94f","#eff26e","#e43872","#d9b100","#9d7a00","#698cff","#00d27e","#d06800","#009f82","#c49200","#cbe8ff","#fecddf","#c27eb6","#8cd2ce","#c4b8d9","#f883b0","#a49100","#f48800","#27d0df","#a04a9b"];function n(t){return o[t%o.length]}function s(t,e){const a=e.getPropertyValue(`--graph-color-${t+1}`)||n(t);return(0,i.RQ)(a)}const l=(0,r.A)(t=>o.map((e,a)=>s(a,t)),(t,e)=>t[0].getPropertyValue("--graph-color-1")===e[0].getPropertyValue("--graph-color-1"))},37382:function(t,e,a){a.d(e,{D:function(){return o}});var r=a(10416),i=a.n(r);const o=t=>i()(t,{whiteList:{},stripIgnoreTag:!0,stripIgnoreTagBody:!0})},80475:function(t,e,a){a.a(t,async function(t,e){try{a(91949),a(35748),a(99342),a(9724),a(35058),a(41846),a(65315),a(837),a(84136),a(22416),a(37089),a(48169),a(12977),a(88238),a(34536),a(16257),a(20152),a(44711),a(72108),a(77030),a(95013);var r=a(69868),i=a(11991),o=a(84922),n=a(56425),s=a(65940),l=a(88006),c=a(35083),d=a(37382),u=a(68717),h=a(83034),p=(a(94124),t([u,l]));[u,l]=p.then?(await p)():p;let _,f,v=t=>t;const g=5,y=12,b=8,m=5;class x extends o.WF{render(){var t;const e={grid:{top:0,bottom:0,left:0,right:0},tooltip:{trigger:"item",formatter:this._renderTooltip,appendTo:document.body}};return(0,o.qy)(_||(_=v`<ha-chart-base .data="${0}" .options="${0}" height="100%" .extraComponents="${0}"></ha-chart-base>`),this._createData(this.data,null===(t=this._sizeController.value)||void 0===t?void 0:t.width),e,[n.a])}_processLinks(t,e){const a=new Map,r=new Map,i=[];return e.forEach(e=>{var o;const n=t.find(t=>t.id===e.source),s=t.find(t=>t.id===e.target);if(!n||!s)return;const l=r.get(n.id)||0,c=a.get(s.id)||0,d=n.value-l,u=s.value-c,h=Math.min(null!==(o=e.value)&&void 0!==o?o:d,d,u);a.set(s.id,c+h),r.set(n.id,l+h),h>0&&i.push(Object.assign(Object.assign({},e),{},{value:h}))}),i}_findParentIndex(t,e,a){var r;const i=null===(r=e.find(e=>e.target===t))||void 0===r?void 0:r.source;if(!i)return-1;let o=0;for(let n=a.length-1;n>=0;n--){const t=a[n],e=t.findIndex(t=>t.id===i);if(-1!==e)return o+e;o+=t.length}return-1}constructor(...t){super(...t),this.data={nodes:[],links:[]},this.vertical=!1,this._sizeController=new l.P(this,{callback:t=>{var e;return null===(e=t[0])||void 0===e?void 0:e.contentRect}}),this._renderTooltip=t=>{const e=t.data,a=this.valueFormatter?this.valueFormatter(e.value):e.value;if(e.id){var r;const i=this.data.nodes.find(t=>t.id===e.id);return`${t.marker} ${(0,d.D)(null!==(r=null==i?void 0:i.label)&&void 0!==r?r:e.id)}<br>${a}`}if(e.source&&e.target){var i,o;const t=this.data.nodes.find(t=>t.id===e.source),r=this.data.nodes.find(t=>t.id===e.target);return`${(0,d.D)(null!==(i=null==t?void 0:t.label)&&void 0!==i?i:e.source)} → ${(0,d.D)(null!==(o=null==r?void 0:r.label)&&void 0!==o?o:e.target)}<br>${a}`}return null},this._createData=(0,s.A)((t,e=0)=>{const a=t.nodes.filter(t=>t.value>0),r=[...new Set(a.map(t=>t.index))].sort(),i=new Map,o=[];r.forEach((e,r)=>{i.set(e,r);const n=a.filter(t=>t.index===e);n.length>0&&o.push(o.length>0?n.sort((e,a)=>{const r=this._findParentIndex(e.id,t.links,o),i=this._findParentIndex(a.id,t.links,o);return r===i?0:-1===r?1:-1===i?-1:r-i}):n)});const n=this._processLinks(a,t.links),s=e/r.length-h.hD-m;return{id:"sankey",type:"sankey",nodes:o.flat().map(t=>({id:t.id,value:t.value,itemStyle:{color:t.color},depth:i.get(t.index)})),links:n,draggable:!1,orient:this.vertical?"vertical":"horizontal",nodeWidth:15,nodeGap:b,lineStyle:{color:"gradient",opacity:.4},layoutIterations:0,label:{formatter:e=>{var a,r;return null!==(a=null===(r=t.nodes.find(t=>t.id===e.data.id))||void 0===r?void 0:r.label)&&void 0!==a?a:e.data.id},position:this.vertical?"bottom":"right",distance:m,minMargin:5,overflow:"break"},labelLayout:t=>{if(this.vertical){const e=t.text.split(" ").reduce((t,e)=>t.length>e.length?t:e,""),a=(0,c.W)(e,y),r=t.rect.width+6,i=Math.min(y,r/a*y);return{fontSize:i>1?i:0,width:r,align:"center",dy:-2}}const e=t.rect.height+8,a=Math.min(e/t.labelRect.height*y,y);return{fontSize:a,lineHeight:a,width:s,height:t.rect.height}},top:this.vertical?0:g,bottom:this.vertical?25:g,left:this.vertical?g:0,right:this.vertical?g:s+m,emphasis:{focus:"adjacency"}}})}}x.styles=(0,o.AH)(f||(f=v`:host{display:block;flex:1;background:var(--ha-card-background,var(--card-background-color))}ha-chart-base{width:100%;height:100%}`)),(0,r.__decorate)([(0,i.MZ)({attribute:!1})],x.prototype,"hass",void 0),(0,r.__decorate)([(0,i.MZ)({attribute:!1})],x.prototype,"data",void 0),(0,r.__decorate)([(0,i.MZ)({type:Boolean})],x.prototype,"vertical",void 0),(0,r.__decorate)([(0,i.MZ)({type:String,attribute:!1})],x.prototype,"valueFormatter",void 0),(0,r.__decorate)([(0,i.wk)()],x.prototype,"_sizeController",void 0),x=(0,r.__decorate)([(0,i.EM)("ha-sankey-chart")],x),e()}catch(_){e(_)}})},71770:function(t,e,a){a(35748),a(12977),a(95013);var r=a(69868),i=a(30103),o=a(86811),n=a(49377),s=a(34800),l=a(84922),c=a(11991);let d,u,h,p,_=t=>t;class f extends i.k{renderOutline(){return this.filled?(0,l.qy)(d||(d=_`<span class="filled"></span>`)):super.renderOutline()}getContainerClasses(){return Object.assign(Object.assign({},super.getContainerClasses()),{},{active:this.active})}renderPrimaryContent(){return(0,l.qy)(u||(u=_` <span class="leading icon" aria-hidden="true"> ${0} </span> <span class="label">${0}</span> <span class="touch"></span> <span class="trailing leading icon" aria-hidden="true"> ${0} </span> `),this.renderLeadingIcon(),this.label,this.renderTrailingIcon())}renderTrailingIcon(){return(0,l.qy)(h||(h=_`<slot name="trailing-icon"></slot>`))}constructor(...t){super(...t),this.filled=!1,this.active=!1}}f.styles=[n.R,s.R,o.R,(0,l.AH)(p||(p=_`:host{--md-sys-color-primary:var(--primary-text-color);--md-sys-color-on-surface:var(--primary-text-color);--md-assist-chip-container-shape:var(
          --ha-assist-chip-container-shape,
          16px
        );--md-assist-chip-outline-color:var(--outline-color);--md-assist-chip-label-text-weight:400}.filled{display:flex;pointer-events:none;border-radius:inherit;inset:0;position:absolute;background-color:var(--ha-assist-chip-filled-container-color)}::slotted([slot=icon]),::slotted([slot=trailing-icon]){display:flex;--mdc-icon-size:var(--md-input-chip-icon-size, 18px);font-size:var(--_label-text-size)!important}.trailing.icon ::slotted(*),.trailing.icon svg{margin-inline-end:unset;margin-inline-start:var(--_icon-label-space)}::before{background:var(--ha-assist-chip-container-color,transparent);opacity:var(--ha-assist-chip-container-opacity, 1)}:where(.active)::before{background:var(--ha-assist-chip-active-container-color);opacity:var(--ha-assist-chip-active-container-opacity)}.label{font-family:var(--ha-font-family-body)}`))],(0,r.__decorate)([(0,c.MZ)({type:Boolean,reflect:!0})],f.prototype,"filled",void 0),(0,r.__decorate)([(0,c.MZ)({type:Boolean})],f.prototype,"active",void 0),f=(0,r.__decorate)([(0,c.EM)("ha-assist-chip")],f)},83034:function(t,e,a){a.d(e,{Es:function(){return r},dc:function(){return o},hD:function(){return i}});const r=10,i=30,o=20},63002:function(t,e,a){a.a(t,async function(t,r){try{a.d(e,{$3:function(){return g},$O:function(){return M},$j:function(){return y},ED:function(){return s},JE:function(){return $},OQ:function(){return C},PU:function(){return z},Ph:function(){return f},Uf:function(){return S},W1:function(){return v},Wr:function(){return h},Z:function(){return d},gF:function(){return b},iY:function(){return m},jU:function(){return l},nN:function(){return w},p3:function(){return u},pJ:function(){return _},r_:function(){return c},sz:function(){return p}});a(79827),a(35748),a(65315),a(59023),a(12977),a(18223),a(95013);var i=a(72652),o=a(50654),n=t([o]);o=(n.then?(await n)():n)[0];var s=function(t){return t[t.NONE=0]="NONE",t[t.ARITHMETIC=1]="ARITHMETIC",t[t.CIRCULAR=2]="CIRCULAR",t}({});const l=59509==a.j?["entity_not_recorded","entity_no_longer_recorded","state_class_removed","units_changed","mean_type_changed","no_state"]:null,c=["L","gal","ft³","m³","CCF","MCF"],d=t=>t.sendMessagePromise({type:"recorder/info"}),u=(t,e)=>t.callWS({type:"recorder/list_statistic_ids",statistic_type:e}),h=(t,e)=>t.callWS({type:"recorder/get_statistics_metadata",statistic_ids:e}),p=(t,e,a,r,i="hour",o,n)=>t.callWS({type:"recorder/statistics_during_period",start_time:e.toISOString(),end_time:null==a?void 0:a.toISOString(),statistic_ids:r,period:i,units:o,types:n}),_=(t,e,a,r)=>t.callWS({type:"recorder/statistic_during_period",statistic_id:e,units:r,fixed_period:a.fixed_period?{start_time:a.fixed_period.start instanceof Date?a.fixed_period.start.toISOString():a.fixed_period.start,end_time:a.fixed_period.end instanceof Date?a.fixed_period.end.toISOString():a.fixed_period.end}:void 0,calendar:a.calendar?Object.assign(Object.assign({},"week"===a.calendar.period?{first_weekday:(0,o.DD)(t.locale).substring(0,3)}:{}),a.calendar):void 0,rolling_window:a.rolling_window}),f=t=>t.callWS({type:"recorder/validate_statistics"}),v=(t,e,a)=>t.callWS({type:"recorder/update_statistics_metadata",statistic_id:e,unit_of_measurement:a}),g=(t,e)=>t.callWS({type:"recorder/clear_statistics",statistic_ids:e}),y=t=>{let e=null;if(!t)return null;for(const a of t)null!==a.change&&void 0!==a.change&&(null===e?e=a.change:e+=a.change);return e},b=(t,e)=>{let a=null;for(const r of e){if(!(r in t))continue;const e=y(t[r]);null!==e&&(null===a?a=e:a+=e)}return a},m=(t,e)=>t.some(t=>void 0!==t[e]&&null!==t[e]),x=["mean","min","max"],k=["sum","state","change"],w=(t,e)=>!(!x.includes(e)||0===t.mean_type)||!(!k.includes(e)||!t.has_sum),S=(t,e,a,r,i)=>{const o=new Date(a).toISOString();return t.callWS({type:"recorder/adjust_sum_statistics",statistic_id:e,start_time:o,adjustment:r,adjustment_unit_of_measurement:i})},M=(t,e,a)=>{const r=t.states[e];return r?(0,i.u)(r):(null==a?void 0:a.name)||e},$=(t,e,a)=>{let r;var i;e&&(r=null===(i=t.states[e])||void 0===i?void 0:i.attributes.unit_of_measurement);return void 0===r?null==a?void 0:a.statistics_unit_of_measurement:r},C=t=>t.includes(":"),z=t=>t.callWS({type:"recorder/update_statistics_issues"});r()}catch(l){r(l)}})},75335:function(t,e,a){a.d(e,{Q:function(){return s}});a(35748),a(95013);var r=a(69868),i=a(11991),o=a(48125),n=a(32211);const s=t=>{class e extends t{connectedCallback(){super.connectedCallback(),this._unsubMql=(0,n.m)("all and (max-width: 450px), all and (max-height: 500px)",t=>{this._isMobileSize=t})}disconnectedCallback(){var t;super.disconnectedCallback(),null===(t=this._unsubMql)||void 0===t||t.call(this),this._unsubMql=void 0}constructor(...t){super(...t),this._isMobileSize=!1,this._isMobileClient=o.M}}return(0,r.__decorate)([(0,i.wk)()],e.prototype,"_isMobileSize",void 0),e}},41970:function(t,e,a){a.a(t,async function(t,r){try{a.r(e);a(79827),a(35748),a(99342),a(35058),a(86149),a(65315),a(22416),a(12977),a(18223),a(39118),a(95013);var i=a(69868),o=a(84922),n=a(11991),s=(a(70490),a(86160),a(43716)),l=a(63002),c=a(40328),d=a(80475),u=a(94327),h=a(8868),p=a(73941),_=a(75335),f=t([d,s,l,h]);[d,s,l,h]=f.then?(await f)():f;let v,g,y,b,m,x=t=>t;const k={group_by_floor:!0,group_by_area:!0};class w extends((0,c.E)((0,_.Q)(o.WF))){setConfig(t){this._config=Object.assign(Object.assign({},k),t)}hassSubscribe(){var t;return[(0,s.tb)(this.hass,{key:null===(t=this._config)||void 0===t?void 0:t.collection_key}).subscribe(t=>{this._data=t})]}getCardSize(){return 5}getGridOptions(){return{columns:12,min_columns:6,rows:6,min_rows:2}}shouldUpdate(t){return t.has("_config")||t.has("_data")||t.has("_isMobileSize")}render(){if(!this._config)return o.s6;if(!this._data)return(0,o.qy)(v||(v=x`${0}`),this.hass.localize("ui.panel.lovelace.cards.energy.loading"));const t=this._data.prefs,e=(0,s.E$)(t),{summedData:a,compareSummedData:r}=(0,s.gv)(this._data),{consumption:i,compareConsumption:n}=(0,s.DR)(a,void 0),c=getComputedStyle(this),d=[],h=[],p={id:"home",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_distribution.home"),value:Math.max(0,i.total.used_total),color:c.getPropertyValue("--primary-color").trim(),index:1};if(d.push(p),e.battery){var _,f;const t=null!==(_=a.total.from_battery)&&void 0!==_?_:0,e=null!==(f=a.total.to_battery)&&void 0!==f?f:0;d.push({id:"battery",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_distribution.battery"),value:t,color:c.getPropertyValue("--energy-battery-out-color").trim(),index:0}),h.push({source:"battery",target:"home",value:i.total.used_battery}),d.push({id:"battery_in",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_distribution.battery"),value:e,color:c.getPropertyValue("--energy-battery-in-color").trim(),index:1}),i.total.grid_to_battery>0&&h.push({source:"grid",target:"battery_in",value:i.total.grid_to_battery}),i.total.solar_to_battery>0&&h.push({source:"solar",target:"battery_in",value:i.total.solar_to_battery})}if(e.grid){var m;const t=null!==(m=a.total.from_grid)&&void 0!==m?m:0;d.push({id:"grid",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_distribution.grid"),value:t,color:c.getPropertyValue("--energy-grid-consumption-color").trim(),index:0}),h.push({source:"grid",target:"home",value:i.total.used_grid})}if(e.solar){var k;const t=null!==(k=a.total.solar)&&void 0!==k?k:0;d.push({id:"solar",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_distribution.solar"),value:t,color:c.getPropertyValue("--energy-solar-color").trim(),index:0}),h.push({source:"solar",target:"home",value:i.total.used_solar})}if(e.grid&&e.grid[0].flow_to){var w;const t=null!==(w=a.total.to_grid)&&void 0!==w?w:0;d.push({id:"grid_return",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_distribution.grid"),value:t,color:c.getPropertyValue("--energy-grid-return-color").trim(),index:1}),i.total.battery_to_grid>0&&h.push({source:"battery",target:"grid_return",value:i.total.battery_to_grid}),i.total.solar_to_grid>0&&h.push({source:"solar",target:"grid_return",value:i.total.solar_to_grid})}let S=p.value;const M=[],$={};t.device_consumption.forEach((t,e)=>{const a=t.stat_consumption in this._data.stats&&(0,l.$j)(this._data.stats[t.stat_consumption])||0;if(a<.01)return;const r={id:t.stat_consumption,label:t.name||(0,l.$O)(this.hass,t.stat_consumption,this._data.statsMetadata[t.stat_consumption]),value:a,color:(0,u.fI)(e,c),index:4,parent:t.included_in_stat};r.parent?($[r.id]=r.parent,h.push({source:r.parent,target:r.id})):S-=a,M.push(r)});const C=M.filter(t=>!$[t.id]),{group_by_area:z,group_by_floor:O}=this._config;if(z||O){const{areas:t,floors:e}=this._groupByFloorAndArea(C);Object.keys(e).sort((t,e)=>{var a,r,i,o;return(null!==(a=null===(r=this.hass.floors[e])||void 0===r?void 0:r.level)&&void 0!==a?a:-1/0)-(null!==(i=null===(o=this.hass.floors[t])||void 0===o?void 0:o.level)&&void 0!==i?i:-1/0)}).forEach(a=>{let r=`floor_${a}`;"no_floor"!==a&&O?(d.push({id:r,label:this.hass.floors[a].name,value:e[a].value,index:2,color:c.getPropertyValue("--primary-color").trim()}),h.push({source:"home",target:r})):r="home",e[a].areas.forEach(e=>{let a;if("no_area"!==e&&z){const i=`area_${e}`;d.push({id:i,label:this.hass.areas[e].name,value:t[e].value,index:3,color:c.getPropertyValue("--primary-color").trim()}),h.push({source:r,target:i,value:t[e].value}),a=i}else a=r;t[e].devices.forEach(t=>{h.push({source:a,target:t.id,value:t.value})})})})}else C.forEach(t=>{h.push({source:"home",target:t.id,value:t.value})});const E=this._getDeviceSections($,M);E.forEach((t,e)=>{t.forEach(t=>{d.push(Object.assign(Object.assign({},t),{},{index:4+e}))})}),S>0&&(d.push({id:"untracked",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_devices_detail_graph.untracked_consumption"),value:S,color:c.getPropertyValue("--state-unavailable-color").trim(),index:3+E.length}),h.push({source:"home",target:"untracked",value:S}));const I=d.some(t=>t.value>0),j="vertical"===this._config.layout||"horizontal"!==this._config.layout&&this._isMobileSize;return(0,o.qy)(g||(g=x` <ha-card .header="${0}"> <div class="card-content"> ${0} </div> </ha-card> `),this._config.title,I?(0,o.qy)(y||(y=x`<ha-sankey-chart .data="${0}" .vertical="${0}" .valueFormatter="${0}"></ha-sankey-chart>`),{nodes:d,links:h},j,this._valueFormatter):(0,o.qy)(b||(b=x`${0}`),this.hass.localize("ui.panel.lovelace.cards.energy.no_data_period")))}_groupByFloorAndArea(t){const e={no_area:{value:0,devices:[]}},a={no_floor:{value:0,areas:["no_area"]}};return t.forEach(t=>{const r=this.hass.states[t.id],{area:i,floor:o}=(0,p.l)(r,this.hass.entities,this.hass.devices,this.hass.areas,this.hass.floors);i?(i.area_id in e?(e[i.area_id].value+=t.value,e[i.area_id].devices.push(t)):e[i.area_id]={value:t.value,devices:[t]},o?o.floor_id in a?(a[o.floor_id].value+=t.value,a[o.floor_id].areas.includes(i.area_id)||a[o.floor_id].areas.push(i.area_id)):a[o.floor_id]={value:t.value,areas:[i.area_id]}:(a.no_floor.value+=t.value,a.no_floor.areas.includes(i.area_id)||a.no_floor.areas.unshift(i.area_id))):(e.no_area.value+=t.value,e.no_area.devices.push(t))}),{areas:e,floors:a}}_getDeviceSections(t,e){const a=[],r=[],i=Object.values(t),o={};return e.forEach(e=>{const o=e.id in t;i.includes(e.id)&&!o?a.push(e):r.push(e)}),Object.entries(t).forEach(([t,e])=>{a.some(t=>t.id===e)||(o[t]=e)}),a.length>0?[a,...this._getDeviceSections(o,r)]:[e]}constructor(...t){super(...t),this.hassSubscribeRequiredHostProps=["_config"],this._valueFormatter=t=>`${(0,h.ZV)(t,this.hass.locale,t<.1?{maximumFractionDigits:3}:void 0)} kWh`}}w.styles=(0,o.AH)(m||(m=x`:host{display:block;height:calc(var(--row-size,8) * (var(--row-height,50px) + var(--row-gap,0px)) - var(--row-gap,0px))}ha-card{height:100%;display:flex;flex-direction:column}.card-content{flex:1;display:flex}`)),(0,i.__decorate)([(0,n.MZ)({attribute:!1})],w.prototype,"hass",void 0),(0,i.__decorate)([(0,n.wk)()],w.prototype,"_config",void 0),(0,i.__decorate)([(0,n.wk)()],w.prototype,"_data",void 0),w=(0,i.__decorate)([(0,n.EM)("hui-energy-sankey-card")],w),r()}catch(v){r(v)}})},48125:function(t,e,a){a.d(e,{M:function(){return r}});a(67579),a(41190);const r=/(?:iphone|android|ipad)/i.test(navigator.userAgent)},35083:function(t,e,a){let r;function i(t,e,a="Roboto, Noto, sans-serif"){r||(r=document.createElement("canvas"));const i=r.getContext("2d");if(!i)return 0;i.font=`${e}px ${a}`;const o=i.measureText(t);return Math.ceil(Math.max(o.actualBoundingBoxRight+o.actualBoundingBoxLeft,o.width))}a.d(e,{W:function(){return i}})}}]);
//# sourceMappingURL=19348.75f3fad502483275.js.map