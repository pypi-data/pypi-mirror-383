# Qwen Code 安装指南

<cite>
**本文档中引用的文件**
- [README.md](file://README.md)
- [package.json](file://package.json)
- [packages/cli/package.json](file://packages/cli/package.json)
- [docs/cli/authentication.md](file://docs/cli/authentication.md)
- [docs/cli/index.md](file://docs/cli/index.md)
- [docs/deployment.md](file://docs/deployment.md)
- [docs/architecture.md](file://docs/architecture.md)
</cite>

## 目录
1. [简介](#简介)
2. [系统要求](#系统要求)
3. [安装方式概览](#安装方式概览)
4. [通过npm全局安装](#通过npm全局安装)
5. [从源码安装](#从源码安装)
6. [Homebrew安装](#homebrew安装)
7. [操作系统特定配置](#操作系统特定配置)
8. [验证安装](#验证安装)
9. [常见问题解决](#常见问题解决)
10. [故障排除指南](#故障排除指南)

## 简介

Qwen Code 是一个强大的命令行 AI 工作流工具，专为开发者设计，能够增强您的开发工作流程，提供高级代码理解、自动化任务和智能辅助功能。本安装指南将详细介绍所有支持的安装方式，帮助您快速部署并开始使用 Qwen Code。

## 系统要求

在开始安装之前，请确保您的系统满足以下基本要求：

- **Node.js 版本**: ≥20.0.0
- **操作系统**: Windows、macOS 或 Linux
- **内存**: 建议至少 4GB RAM
- **存储空间**: 至少 1GB 可用磁盘空间
- **网络连接**: 需要互联网连接用于初始设置和模型访问

**节来源**
- [README.md](file://README.md#L25-L30)
- [package.json](file://package.json#L3-L5)

## 安装方式概览

Qwen Code 提供多种安装方式以适应不同的使用场景和需求：

```mermaid
flowchart TD
A["选择安装方式"] --> B["npm 全局安装"]
A --> C["源码安装"]
A --> D["Homebrew 安装"]
A --> E["Docker 容器"]
B --> F["最快安装方式<br/>适合普通用户"]
C --> G["开发调试<br/>适合贡献者"]
D --> H["系统集成<br/>适合 macOS/Linux 用户"]
E --> I["隔离环境<br/>适合安全要求高的场景"]
F --> J["验证安装"]
G --> J
H --> J
I --> J
```

## 通过npm全局安装

这是最简单和推荐的安装方式，适合大多数用户。

### 基本安装命令

```bash
# 使用 npm 安装最新版本
npm install -g @qwen-code/qwen-code@latest

# 验证安装
qwen --version
```

### bin 字段配置机制

Qwen Code 的 package.json 中定义了 bin 字段来配置可执行文件：

```json
{
  "bin": {
    "qwen": "bundle/gemini.js"
  }
}
```

这表示：
- 当全局安装时，npm 会在系统的 PATH 中创建一个名为 `qwen` 的可执行文件
- 该可执行文件指向 `bundle/gemini.js` 文件
- 用户可以直接在终端中运行 `qwen` 命令

### 安装过程详解

```mermaid
sequenceDiagram
participant User as 用户
participant NPM as npm 注册表
participant System as 系统路径
User->>NPM : npm install -g @qwen-code/qwen-code
NPM-->>User : 下载包文件
User->>System : 创建全局符号链接
System-->>User : qwen 命令可用
User->>System : qwen --version
System-->>User : 显示版本号
```

**图表来源**
- [package.json](file://package.json#L95-L97)

### 安装验证步骤

1. **检查 Node.js 版本**：
   ```bash
   node --version
   # 应显示 >=20.0.0
   ```

2. **执行安装命令**：
   ```bash
   npm install -g @qwen-code/qwen-code@latest
   ```

3. **验证安装结果**：
   ```bash
   qwen --version
   # 预期输出：0.0.14 或更高版本号
   ```

**节来源**
- [README.md](file://README.md#L35-L40)
- [package.json](file://package.json#L95-L97)

## 从源码安装

对于需要进行开发或调试的用户，可以从源码直接安装。

### 源码安装流程

```bash
# 1. 克隆仓库
git clone https://github.com/QwenLM/qwen-code.git
cd qwen-code

# 2. 安装项目依赖
npm install

# 3. 全局链接本地包
npm install -g .

# 4. 验证安装
qwen --version
```

### 开发模式安装

```mermaid
flowchart LR
A["克隆仓库"] --> B["安装依赖"]
B --> C["构建项目"]
C --> D["全局链接"]
D --> E["验证功能"]
F["开发模式"] --> G["npm run start"]
G --> H["热重载"]
H --> I["实时调试"]
```

### 源码安装的优势

- **最新功能**: 获取最新的开发版本
- **自定义修改**: 可以修改源代码并立即生效
- **调试方便**: 支持断点调试和源码追踪
- **贡献代码**: 便于参与项目开发

### 源码安装注意事项

1. **依赖管理**: 确保所有依赖都正确安装
2. **构建过程**: 某些包可能需要编译原生模块
3. **权限问题**: 可能需要管理员权限进行全局安装
4. **环境变量**: 某些功能可能需要配置环境变量

**节来源**
- [README.md](file://README.md#L41-L45)
- [docs/deployment.md](file://docs/deployment.md#L45-L60)

## Homebrew安装

Homebrew 是 macOS 和 Linux 用户的首选包管理器，提供了便捷的安装体验。

### macOS 安装命令

```bash
# 安装 Homebrew（如果尚未安装）
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# 安装 Qwen Code
brew install qwen-code
```

### Linux 安装命令

```bash
# 更新包索引
sudo apt update

# 安装 Homebrew（如果尚未安装）
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# 安装 Qwen Code
brew install qwen-code
```

### Homebrew 安装特点

- **自动依赖管理**: Homebrew 会自动处理所有依赖关系
- **版本控制**: 支持版本升级和回滚
- **系统集成**: 自动添加到系统的 PATH 中
- **卸载方便**: 可以轻松卸载和清理

### Homebrew 安装验证

```bash
# 检查安装状态
which qwen-code

# 查看版本信息
qwen-code --version

# 测试基本功能
qwen --help
```

**节来源**
- [README.md](file://README.md#L46-L48)

## 操作系统特定配置

不同操作系统需要特定的配置和注意事项。

### Windows 系统配置

```mermaid
flowchart TD
A["Windows 安装"] --> B["安装 Node.js"]
A --> C["配置 PowerShell"]
A --> D["设置环境变量"]
B --> E["下载 LTS 版本"]
C --> F["启用脚本执行"]
D --> G["PATH 配置"]
E --> H["测试安装"]
F --> H
G --> H
```

#### Windows 特定步骤

1. **安装 Node.js**：
   ```powershell
   # 下载并安装 Node.js LTS 版本
   # 访问 https://nodejs.org/ 下载安装程序
   ```

2. **配置 PowerShell**：
   ```powershell
   # 启用脚本执行
   Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
   ```

3. **验证安装**：
   ```powershell
   # 在 PowerShell 中测试
   node --version
   npm --version
   ```

### macOS 系统配置

#### Apple Silicon Mac (M1/M2/M3)

```bash
# 安装 Rosetta 2（如果需要）
softwareupdate --install-rosetta

# 使用 Homebrew 安装
brew install qwen-code
```

#### Intel Mac

```bash
# 直接使用 Homebrew 安装
brew install qwen-code
```

### Linux 系统配置

#### Ubuntu/Debian 系统

```bash
# 更新包索引
sudo apt update

# 安装 Node.js
curl -fsSL https://deb.nodesource.com/setup_lts.x | sudo -E bash -
sudo apt-get install -y nodejs

# 安装 Qwen Code
npm install -g @qwen-code/qwen-code
```

#### CentOS/RHEL 系统

```bash
# 安装 Node.js
curl -fsSL https://rpm.nodesource.com/setup_lts.x | sudo bash -
sudo yum install -y nodejs

# 安装 Qwen Code
npm install -g @qwen-code/qwen-code
```

#### Arch Linux 系统

```bash
# 安装 Node.js
sudo pacman -S nodejs npm

# 安装 Qwen Code
npm install -g @qwen-code/qwen-code
```

### 权限配置

#### 全局安装权限问题

```bash
# 方法1：使用 sudo（不推荐）
sudo npm install -g @qwen-code/qwen-code

# 方法2：修复 npm 全局目录权限（推荐）
mkdir ~/.npm-global
npm config set prefix '~/.npm-global'

# 添加到 PATH（在 ~/.bashrc 或 ~/.zshrc 中）
export PATH=~/.npm-global/bin:$PATH

# 重新安装
npm install -g @qwen-code/qwen-code
```

#### 网络代理配置

```bash
# 设置 npm 代理
npm config set proxy http://proxy.company.com:8080
npm config set https-proxy http://proxy.company.com:8080

# 如果需要认证
npm config set proxy http://username:password@proxy.company.com:8080
```

**节来源**
- [README.md](file://README.md#L25-L30)
- [docs/cli/authentication.md](file://docs/cli/authentication.md#L120-L143)

## 验证安装

安装完成后，需要验证 Qwen Code 是否正确安装并可以正常运行。

### 基本验证命令

```bash
# 检查版本信息
qwen --version

# 查看帮助信息
qwen --help

# 测试基本功能
qwen -p "Hello, Qwen Code!"
```

### 验证输出示例

```bash
$ qwen --version
0.0.14

$ qwen --help
Usage: qwen [options] [command]

Options:
  --version                    输出版本号
  --help                       显示帮助信息
  
Commands:
  init                         初始化配置
  auth                         配置认证
  [prompt]                     直接执行命令
```

### 功能验证清单

1. **核心功能验证**：
   ```bash
   # 测试对话功能
   qwen
   
   # 测试非交互模式
   echo "Test prompt" | qwen
   ```

2. **配置验证**：
   ```bash
   # 检查配置文件位置
   ls ~/.qwen/
   
   # 验证默认设置
   cat ~/.qwen/settings.json
   ```

3. **工具链验证**：
   ```bash
   # 测试文件操作
   qwen -p "List files in current directory"
   
   # 测试代码分析
   qwen -p "Explain this code"
   ```

### 常见验证问题

#### 版本不匹配

```bash
# 问题：版本信息不显示
# 解决方案：
npm cache clean --force
npm install -g @qwen-code/qwen-code@latest
```

#### 命令未找到

```bash
# 问题：找不到 qwen 命令
# 解决方案：
# 检查 PATH 配置
echo $PATH | grep npm-global

# 重新加载 shell 配置
source ~/.bashrc  # 或 source ~/.zshrc
```

**节来源**
- [README.md](file://README.md#L35-L40)
- [docs/cli/index.md](file://docs/cli/index.md#L20-L30)

## 常见问题解决

在安装过程中可能会遇到各种问题，以下是常见问题及其解决方案。

### 权限错误

#### 错误现象
```bash
npm ERR! code EACCES
npm ERR! syscall mkdir
npm ERR! path /usr/local/lib/node_modules
```

#### 解决方案

```mermaid
flowchart TD
A["权限错误"] --> B{"检查安装方式"}
B --> |全局安装| C["修复 npm 权限"]
B --> |本地安装| D["检查用户权限"]
C --> E["使用用户目录"]
C --> F["使用 sudo谨慎"]
E --> G["npm config set prefix '~/.npm-global'"]
F --> H["sudo npm install -g"]
G --> I["更新 PATH"]
H --> I
```

#### 权限修复步骤

1. **修复 npm 全局目录权限**：
   ```bash
   # 创建用户目录
   mkdir ~/.npm-global
   
   # 设置 npm 前缀
   npm config set prefix '~/.npm-global'
   
   # 添加到 PATH
   echo "export PATH=~/.npm-global/bin:\$PATH" >> ~/.bashrc
   source ~/.bashrc
   ```

2. **使用 sudo（仅在必要时）**：
   ```bash
   sudo npm install -g @qwen-code/qwen-code
   ```

### 网络代理配置

#### 企业网络环境

```bash
# 设置 HTTP 代理
npm config set proxy http://proxy.company.com:8080
npm config set https-proxy http://proxy.company.com:8080

# 设置认证信息
npm config set proxy http://username:password@proxy.company.com:8080

# 配置 npm 镜像源（中国用户）
npm config set registry https://registry.npmmirror.com/

# 验证配置
npm config list
```

#### 代理绕过配置

```bash
# 配置 npm 跳过代理的主机
npm config set noproxy "localhost,127.0.0.1,.company.com"

# Docker 代理配置
echo 'export DOCKER_OPTS="--dns 8.8.8.8"' >> ~/.bashrc
```

### 依赖冲突

#### Node.js 版本冲突

```bash
# 检查当前 Node.js 版本
node --version

# 如果版本过低，升级 Node.js
# Windows: 使用 nvm-windows
# macOS: brew install node
# Linux: curl -fsSL https://deb.nodesource.com/setup_lts.x | sudo -E bash -

# 清理 npm 缓存
npm cache clean --force

# 重新安装
npm install -g @qwen-code/qwen-code
```

#### 包版本冲突

```bash
# 检查依赖树
npm ls @qwen-code/qwen-code

# 强制重新安装
npm install -g @qwen-code/qwen-code@latest --force

# 使用特定版本
npm install -g @qwen-code/qwen-code@0.0.14
```

### 磁盘空间不足

#### 磁盘空间检查

```bash
# 检查可用空间
df -h

# 清理临时文件
npm cache clean --force
rm -rf ~/.npm/_cacache

# 清理旧版本包
npm uninstall -g @qwen-code/qwen-code
```

#### 存储优化

```bash
# 设置 npm 缓存目录
npm config set cache ~/.npm-cache --global

# 清理缓存
npm cache verify
```

### 环境变量配置

#### 设置认证环境变量

```bash
# Qwen OAuth 方式
export QWEN_OAUTH_TOKEN="your_token_here"

# OpenAI 兼容 API
export OPENAI_API_KEY="your_api_key_here"
export OPENAI_BASE_URL="https://api.example.com/v1"
export OPENAI_MODEL="gpt-4"

# 保存到配置文件
echo 'export OPENAI_API_KEY="your_api_key_here"' >> ~/.bashrc
echo 'export OPENAI_BASE_URL="https://api.example.com/v1"' >> ~/.bashrc
source ~/.bashrc
```

**节来源**
- [docs/cli/authentication.md](file://docs/cli/authentication.md#L120-L143)

## 故障排除指南

当遇到问题时，可以按照以下步骤进行系统性排查。

### 排查流程图

```mermaid
flowchart TD
A["遇到问题"] --> B["检查错误信息"]
B --> C["确定问题类型"]
C --> D["安装问题"]
C --> E["权限问题"]
C --> F["网络问题"]
C --> G["配置问题"]
D --> H["重新安装"]
E --> I["修复权限"]
F --> J["配置代理"]
G --> K["检查配置"]
H --> L["验证修复"]
I --> L
J --> L
K --> L
L --> M{"问题解决？"}
M --> |是| N["完成"]
M --> |否| O["联系支持"]
```

### 诊断命令集合

#### 基础诊断

```bash
# 检查 Node.js 环境
node --version
npm --version
which node
which npm

# 检查 Qwen Code 安装
which qwen
ls -la $(which qwen)
qwen --version

# 检查网络连接
ping registry.npmjs.org
curl -I https://registry.npmjs.org/@qwen-code/qwen-code
```

#### 详细诊断

```bash
# 详细日志输出
DEBUG=1 qwen --version

# npm 详细信息
npm config list
npm config get registry

# 网络诊断
nslookup registry.npmjs.org
traceroute registry.npmjs.org

# 系统信息
uname -a
cat /etc/os-release
```

### 日志分析

#### 启用调试模式

```bash
# 启用调试模式
export DEBUG=1
qwen -p "test prompt"

# 查看调试日志
qwen --debug -p "test prompt"
```

#### 日志文件位置

```bash
# Windows
C:\Users\%USERNAME%\.qwen\logs\

# macOS/Linux
~/.qwen/logs/
```

### 回滚和恢复

#### 版本回滚

```bash
# 查看已安装版本
npm list -g @qwen-code/qwen-code

# 卸载当前版本
npm uninstall -g @qwen-code/qwen-code

# 安装特定版本
npm install -g @qwen-code/qwen-code@0.0.13

# 验证回滚
qwen --version
```

#### 配置恢复

```bash
# 备份当前配置
cp ~/.qwen/settings.json ~/.qwen/settings.json.backup

# 重置配置
rm -rf ~/.qwen/

# 重新初始化
qwen init
```

### 社区支持

#### 获取帮助

1. **官方文档**：
   - 主页：https://qwenlm.github.io/qwen-code-docs/
   - CLI 文档：docs/cli/index.md

2. **GitHub Issues**：
   - 报告问题：https://github.com/QwenLM/qwen-code/issues
   - 查看已知问题：搜索相关标签

3. **社区论坛**：
   - Stack Overflow 标签：qwen-code
   - Discord 社区：加入相关频道

### 最佳实践建议

#### 安装前准备

1. **备份重要数据**
2. **检查系统资源**
3. **确认网络连接**
4. **阅读官方文档**

#### 安装后维护

1. **定期更新**：
   ```bash
   npm update -g @qwen-code/qwen-code
   ```

2. **监控性能**：
   ```bash
   # 检查内存使用
   ps aux | grep qwen
   
   # 监控磁盘空间
   df -h | grep qwen
   ```

3. **配置备份**：
   ```bash
   # 备份配置文件
   cp -r ~/.qwen ~/.qwen_backup_$(date +%Y%m%d)
   ```

**节来源**
- [docs/cli/authentication.md](file://docs/cli/authentication.md#L120-L143)
- [docs/deployment.md](file://docs/deployment.md#L100-L118)

## 总结

本安装指南涵盖了 Qwen Code 的所有主要安装方式，从简单的 npm 全局安装到复杂的源码编译安装。每种安装方式都有其适用场景：

- **npm 全局安装**：适合大多数用户，简单快捷
- **源码安装**：适合开发者和贡献者
- **Homebrew 安装**：适合 macOS/Linux 用户
- **Docker 容器**：适合需要隔离环境的场景

通过遵循本指南中的步骤和最佳实践，您可以成功安装并配置 Qwen Code，享受其强大的 AI 辅助开发功能。如果在安装过程中遇到任何问题，请参考故障排除部分或寻求社区支持。

记住，正确的安装和配置是充分发挥 Qwen Code 功能的基础。建议在开始使用前仔细阅读相关文档，并根据自己的具体需求选择合适的安装方式。