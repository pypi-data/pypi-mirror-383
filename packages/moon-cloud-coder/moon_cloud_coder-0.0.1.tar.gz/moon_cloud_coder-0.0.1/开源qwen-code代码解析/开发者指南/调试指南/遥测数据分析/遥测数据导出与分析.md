# é¥æµ‹æ•°æ®å¯¼å‡ºä¸åˆ†æ

<cite>
**æœ¬æ–‡æ¡£å¼•ç”¨çš„æ–‡ä»¶**
- [local_telemetry.js](file://scripts/local_telemetry.js)
- [telemetry_gcp.js](file://scripts/telemetry_gcp.js)
- [telemetry.js](file://scripts/telemetry.js)
- [sdk.ts](file://packages/core/src/telemetry/sdk.ts)
- [file-exporters.ts](file://packages/core/src/telemetry/file-exporters.ts)
- [config.ts](file://packages/cli/src/config/config.ts)
- [loggers.test.ts](file://packages/core/src/telemetry/loggers.test.ts)
- [README.md](file://README.md)
</cite>

## ç›®å½•
1. [ç®€ä»‹](#ç®€ä»‹)
2. [é¡¹ç›®ç»“æ„æ¦‚è§ˆ](#é¡¹ç›®ç»“æ„æ¦‚è§ˆ)
3. [æ ¸å¿ƒé¥æµ‹ç»„ä»¶](#æ ¸å¿ƒé¥æµ‹ç»„ä»¶)
4. [æ¶æ„æ¦‚è§ˆ](#æ¶æ„æ¦‚è§ˆ)
5. [è¯¦ç»†ç»„ä»¶åˆ†æ](#è¯¦ç»†ç»„ä»¶åˆ†æ)
6. [é¥æµ‹æ•°æ®å¯¼å‡ºæ–¹æ³•](#é¥æµ‹æ•°æ®å¯¼å‡ºæ–¹æ³•)
7. [æœ¬åœ°Jaegeråˆ†æ](#æœ¬åœ°jaegeråˆ†æ)
8. [Google Cloud Consoleåˆ†æ](#google-cloud-consoleåˆ†æ)
9. [å®é™…æ¡ˆä¾‹åˆ†æ](#å®é™…æ¡ˆä¾‹åˆ†æ)
10. [æ•…éšœæ’é™¤æŒ‡å—](#æ•…éšœæ’é™¤æŒ‡å—)
11. [ç»“è®º](#ç»“è®º)

## ç®€ä»‹

Qwen Codeæä¾›äº†å¼ºå¤§çš„é¥æµ‹æ•°æ®æ”¶é›†å’Œåˆ†æåŠŸèƒ½ï¼Œæ”¯æŒå°†é¥æµ‹æ•°æ®å¯¼å‡ºåˆ°æœ¬åœ°æ–‡ä»¶è¿›è¡Œç¦»çº¿åˆ†æï¼Œå¹¶é€šè¿‡Jaegeræˆ–Google Cloud Consoleè¿›è¡Œå¯è§†åŒ–åˆ†æã€‚æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº†å¦‚ä½•ä½¿ç”¨`--telemetry-outfile`æ ‡å¿—å°†æ•°æ®é‡å®šå‘åˆ°æ–‡ä»¶ï¼Œä»¥åŠå¦‚ä½•é…åˆ`--telemetry-target=local`å’Œç©ºçš„`--telemetry-otlp-endpoint`ä½¿ç”¨ã€‚

é¥æµ‹ç³»ç»ŸåŸºäºOpenTelemetryæ ‡å‡†ï¼Œæ”¯æŒè·Ÿè¸ªï¼ˆTracesï¼‰ã€æŒ‡æ ‡ï¼ˆMetricsï¼‰å’Œæ—¥å¿—ï¼ˆLogsï¼‰çš„æ”¶é›†å’Œåˆ†æã€‚é€šè¿‡æœ¬åœ°æ–‡ä»¶å¯¼å‡ºåŠŸèƒ½ï¼Œå¼€å‘è€…å¯ä»¥åœ¨æ²¡æœ‰ç½‘ç»œè¿æ¥çš„æƒ…å†µä¸‹å¯¹åº”ç”¨æ€§èƒ½è¿›è¡Œæ·±å…¥åˆ†æã€‚

## é¡¹ç›®ç»“æ„æ¦‚è§ˆ

é¥æµ‹åŠŸèƒ½ä¸»è¦åˆ†å¸ƒåœ¨ä»¥ä¸‹å…³é”®ç›®å½•ä¸­ï¼š

```mermaid
graph TB
subgraph "é¥æµ‹è„šæœ¬"
A[scripts/local_telemetry.js]
B[scripts/telemetry_gcp.js]
C[scripts/telemetry.js]
end
subgraph "æ ¸å¿ƒé¥æµ‹æ¨¡å—"
D[packages/core/src/telemetry/sdk.ts]
E[packages/core/src/telemetry/file-exporters.ts]
F[packages/core/src/telemetry/loggers.ts]
end
subgraph "CLIé…ç½®"
G[packages/cli/src/config/config.ts]
end
A --> D
B --> D
C --> A
C --> B
D --> E
D --> F
G --> D
```

**å›¾è¡¨æ¥æº**
- [local_telemetry.js](file://scripts/local_telemetry.js#L1-L220)
- [telemetry_gcp.js](file://scripts/telemetry_gcp.js#L1-L189)
- [sdk.ts](file://packages/core/src/telemetry/sdk.ts#L1-L194)

## æ ¸å¿ƒé¥æµ‹ç»„ä»¶

### é¥æµ‹SDKåˆå§‹åŒ–

é¥æµ‹SDKè´Ÿè´£æ•´ä¸ªé¥æµ‹ç³»ç»Ÿçš„åˆå§‹åŒ–å’Œç®¡ç†ï¼š

```typescript
export function initializeTelemetry(config: Config): void {
  if (telemetryInitialized || !config.getTelemetryEnabled()) {
    return;
  }

  const resource = resourceFromAttributes({
    [SemanticResourceAttributes.SERVICE_NAME]: SERVICE_NAME,
    [SemanticResourceAttributes.SERVICE_VERSION]: process.version,
    'session.id': config.getSessionId(),
  });

  const otlpEndpoint = config.getTelemetryOtlpEndpoint();
  const otlpProtocol = config.getTelemetryOtlpProtocol();
  const parsedEndpoint = parseOtlpEndpoint(otlpEndpoint, otlpProtocol);
  const useOtlp = !!parsedEndpoint;
  const telemetryOutfile = config.getTelemetryOutfile();
}
```

### æ–‡ä»¶å¯¼å‡ºå™¨

æ–‡ä»¶å¯¼å‡ºå™¨è´Ÿè´£å°†é¥æµ‹æ•°æ®å†™å…¥æœ¬åœ°æ–‡ä»¶ï¼š

```typescript
export class FileSpanExporter extends FileExporter implements SpanExporter {
  export(
    spans: ReadableSpan[],
    resultCallback: (result: ExportResult) => void,
  ): void {
    const data = spans.map((span) => this.serialize(span)).join('');
    this.writeStream.write(data, (err) => {
      resultCallback({
        code: err ? ExportResultCode.FAILED : ExportResultCode.SUCCESS,
        error: err || undefined,
      });
    });
  }
}
```

**ç« èŠ‚æ¥æº**
- [sdk.ts](file://packages/core/src/telemetry/sdk.ts#L75-L149)
- [file-exporters.ts](file://packages/core/src/telemetry/file-exporters.ts#L40-L55)

## æ¶æ„æ¦‚è§ˆ

é¥æµ‹ç³»ç»Ÿé‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡ï¼Œæ”¯æŒå¤šç§è¾“å‡ºç›®æ ‡ï¼š

```mermaid
sequenceDiagram
participant CLI as CLIå‘½ä»¤è¡Œ
participant Config as é…ç½®ç®¡ç†
participant SDK as é¥æµ‹SDK
participant Exporter as å¯¼å‡ºå™¨
participant File as æœ¬åœ°æ–‡ä»¶
participant Jaeger as Jaeger UI
participant GCP as Google Cloud
CLI->>Config : è§£æå‘½ä»¤è¡Œå‚æ•°
Config->>SDK : åˆå§‹åŒ–é¥æµ‹é…ç½®
SDK->>SDK : æ£€æŸ¥å¯¼å‡ºç›®æ ‡ç±»å‹
alt æœ¬åœ°æ–‡ä»¶å¯¼å‡º
SDK->>Exporter : åˆ›å»ºFileSpanExporter
SDK->>File : å†™å…¥é¥æµ‹æ•°æ®
else æœ¬åœ°Jaeger
SDK->>Jaeger : å¯åŠ¨JaegeræœåŠ¡
SDK->>Jaeger : å‘é€é¥æµ‹æ•°æ®
else Google Cloud
SDK->>GCP : å‘é€é¥æµ‹æ•°æ®
end
Note over CLI,GCP : æ”¯æŒä¸‰ç§ä¸åŒçš„è¾“å‡ºæ–¹å¼
```

**å›¾è¡¨æ¥æº**
- [sdk.ts](file://packages/core/src/telemetry/sdk.ts#L85-L101)
- [local_telemetry.js](file://scripts/local_telemetry.js#L144-L177)

## è¯¦ç»†ç»„ä»¶åˆ†æ

### æœ¬åœ°é¥æµ‹è„šæœ¬åˆ†æ

æœ¬åœ°é¥æµ‹è„šæœ¬è´Ÿè´£å¯åŠ¨å®Œæ•´çš„æœ¬åœ°é¥æµ‹ç¯å¢ƒï¼š

```mermaid
flowchart TD
Start([å¼€å§‹æœ¬åœ°é¥æµ‹]) --> CheckBinaries["æ£€æŸ¥äºŒè¿›åˆ¶æ–‡ä»¶<br/>otelcol-contrib, jaeger"]
CheckBinaries --> CleanOld["æ¸…ç†æ—§è¿›ç¨‹å’Œæ—¥å¿—"]
CleanOld --> SetConfig["è®¾ç½®é¥æµ‹é…ç½®"]
SetConfig --> StartJaeger["å¯åŠ¨JaegeræœåŠ¡<br/>ç«¯å£: 16686"]
StartJaeger --> StartCollector["å¯åŠ¨OTELæ”¶é›†å™¨<br/>ç«¯å£: 4317"]
StartCollector --> WaitPorts["ç­‰å¾…ç«¯å£å°±ç»ª"]
WaitPorts --> Success["å¯åŠ¨æˆåŠŸ"]
Success --> End([é¥æµ‹ç¯å¢ƒå°±ç»ª])
Start --> Error["å¯åŠ¨å¤±è´¥"]
Error --> Cleanup["æ¸…ç†èµ„æº"]
Cleanup --> End
```

**å›¾è¡¨æ¥æº**
- [local_telemetry.js](file://scripts/local_telemetry.js#L45-L218)

### Google Cloudé¥æµ‹åˆ†æ

Google Cloudé¥æµ‹è„šæœ¬ä¸“é—¨ç”¨äºäº‘ç«¯åˆ†æï¼š

```mermaid
flowchart TD
Start([å¼€å§‹GCPé¥æµ‹]) --> CheckEnv["æ£€æŸ¥ç¯å¢ƒå˜é‡<br/>OTLP_GOOGLE_CLOUD_PROJECT"]
CheckEnv --> CheckAuth["éªŒè¯Google Cloudè®¤è¯"]
CheckAuth --> SetConfig["è®¾ç½®GCPé…ç½®"]
SetConfig --> StartCollector["å¯åŠ¨OTELæ”¶é›†å™¨"]
StartCollector --> WaitPort["ç­‰å¾…ç«¯å£4317å°±ç»ª"]
WaitPort --> Success["å¯åŠ¨æˆåŠŸ"]
Success --> End([GCPé¥æµ‹å°±ç»ª])
CheckEnv --> Error["ç¯å¢ƒå˜é‡ç¼ºå¤±"]
Error --> Help["æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯"]
Help --> End
```

**å›¾è¡¨æ¥æº**
- [telemetry_gcp.js](file://scripts/telemetry_gcp.js#L50-L139)

**ç« èŠ‚æ¥æº**
- [local_telemetry.js](file://scripts/local_telemetry.js#L45-L218)
- [telemetry_gcp.js](file://scripts/telemetry_gcp.js#L50-L139)

## é¥æµ‹æ•°æ®å¯¼å‡ºæ–¹æ³•

### åŸºæœ¬å¯¼å‡ºå‘½ä»¤

è¦å°†é¥æµ‹æ•°æ®å¯¼å‡ºåˆ°æœ¬åœ°æ–‡ä»¶ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

```bash
# åŸºæœ¬æ–‡ä»¶å¯¼å‡º
qwen --telemetry-outfile=/path/to/telemetry.json

# ç»“åˆæœ¬åœ°ç›®æ ‡ä½¿ç”¨
qwen --telemetry-target=local --telemetry-outfile=/path/to/telemetry.json

# å®Œæ•´é…ç½®ç¤ºä¾‹
qwen --telemetry=true \
     --telemetry-target=local \
     --telemetry-otlp-endpoint="" \
     --telemetry-outfile=/tmp/qwen-telemetry.json
```

### CLIå‚æ•°è¯¦è§£

```mermaid
classDiagram
class TelemetryConfig {
+boolean telemetry
+string telemetryTarget
+string telemetryOtlpEndpoint
+string telemetryOtlpProtocol
+boolean telemetryLogPrompts
+string telemetryOutfile
+validateConfig() boolean
+applyDefaults() void
}
class CLIArgs {
+parseArguments() CliArgs
+validateFlags() boolean
+mergeWithSettings() Config
}
class Config {
+getTelemetryEnabled() boolean
+getTelemetryTarget() string
+getTelemetryOutfile() string
+getTelemetryOtlpEndpoint() string
}
CLIArgs --> TelemetryConfig : creates
TelemetryConfig --> Config : converts to
```

**å›¾è¡¨æ¥æº**
- [config.ts](file://packages/cli/src/config/config.ts#L60-L120)
- [config.ts](file://packages/cli/src/config/config.ts#L400-L500)

### å¯¼å‡ºå™¨ç±»å‹é€‰æ‹©

ç³»ç»Ÿæ ¹æ®é…ç½®è‡ªåŠ¨é€‰æ‹©åˆé€‚çš„å¯¼å‡ºå™¨ï¼š

```typescript
if (useOtlp) {
  // ä½¿ç”¨OTLPå¯¼å‡ºå™¨å‘é€åˆ°è¿œç¨‹æœåŠ¡å™¨
  spanExporter = new OTLPTraceExporter({
    url: parsedEndpoint,
    compression: CompressionAlgorithm.GZIP,
  });
} else if (telemetryOutfile) {
  // ä½¿ç”¨æ–‡ä»¶å¯¼å‡ºå™¨å†™å…¥æœ¬åœ°æ–‡ä»¶
  spanExporter = new FileSpanExporter(telemetryOutfile);
} else {
  // ä½¿ç”¨æ§åˆ¶å°å¯¼å‡ºå™¨ï¼ˆé»˜è®¤ï¼‰
  spanExporter = new ConsoleSpanExporter();
}
```

**ç« èŠ‚æ¥æº**
- [sdk.ts](file://packages/core/src/telemetry/sdk.ts#L103-L149)
- [config.ts](file://packages/cli/src/config/config.ts#L60-L120)

## æœ¬åœ°Jaegeråˆ†æ

### å¯åŠ¨Jaegerç¯å¢ƒ

è¦å¯åŠ¨åŒ…å«Jaeger UIçš„æœ¬åœ°é¥æµ‹ç¯å¢ƒï¼š

```bash
# æ–¹æ³•1ï¼šç›´æ¥è¿è¡Œè„šæœ¬
npm run telemetry -- --target=local

# æ–¹æ³•2ï¼šä½¿ç”¨CLIå‚æ•°
qwen --telemetry=true --telemetry-target=local --telemetry-otlp-endpoint=""
```

### è®¿é—®Jaeger UI

å¯åŠ¨å®Œæˆåï¼Œæ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹åœ°å€è®¿é—®Jaegerç•Œé¢ï¼š

- **Jaeger UI**: http://localhost:16686
- **æ—¥å¿—æ–‡ä»¶**: `~/.qwen/otel/collector.log`
- **è¿½è¸ªæ•°æ®**: è‡ªåŠ¨æ”¶é›†å¹¶å­˜å‚¨åœ¨Jaegerä¸­

### JaegeråŠŸèƒ½ç‰¹æ€§

```mermaid
graph LR
subgraph "Jaegerç•Œé¢åŠŸèƒ½"
A[è¿½è¸ªæœç´¢] --> B[è°ƒç”¨é“¾åˆ†æ]
B --> C[æ€§èƒ½åˆ†æ]
C --> D[é”™è¯¯è¯Šæ–­]
D --> E[æœåŠ¡ä¾èµ–å›¾]
end
subgraph "æ•°æ®æº"
F[æœ¬åœ°é¥æµ‹æ•°æ®] --> A
G[å®æ—¶è¿½è¸ª] --> B
H[å†å²è®°å½•] --> C
end
```

### åˆ†æå·¥ä½œæµç¨‹

1. **å¯åŠ¨é¥æµ‹ç¯å¢ƒ**ï¼šè¿è¡Œ`npm run telemetry -- --target=local`
2. **æ‰§è¡Œæ“ä½œ**ï¼šåœ¨å¦ä¸€ä¸ªç»ˆç«¯çª—å£è¿è¡ŒQwen Codeå‘½ä»¤
3. **æŸ¥çœ‹ç»“æœ**ï¼šè®¿é—®http://localhost:16686
4. **åˆ†ææ•°æ®**ï¼šä½¿ç”¨Jaegerçš„æœç´¢å’Œè¿‡æ»¤åŠŸèƒ½

**ç« èŠ‚æ¥æº**
- [local_telemetry.js](file://scripts/local_telemetry.js#L144-L177)

## Google Cloud Consoleåˆ†æ

### è®¾ç½®Google Cloudç¯å¢ƒ

è¦ä½¿ç”¨Google Cloudè¿›è¡Œé¥æµ‹åˆ†æï¼Œéœ€è¦å®Œæˆä»¥ä¸‹æ­¥éª¤ï¼š

```bash
# 1. è®¾ç½®é¡¹ç›®IDç¯å¢ƒå˜é‡
export OTLP_GOOGLE_CLOUD_PROJECT=your-project-id

# 2. è®¤è¯Google Cloud
gcloud auth application-default login

# æˆ–è€…ä½¿ç”¨æœåŠ¡è´¦æˆ·å¯†é’¥
export GOOGLE_APPLICATION_CREDENTIALS=/path/to/service-account.json

# 3. å¯åŠ¨GCPé¥æµ‹
npm run telemetry -- --target=gcp
```

### Google Cloudæ§åˆ¶å°é“¾æ¥

å¯åŠ¨GCPé¥æµ‹åï¼Œæ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹é“¾æ¥è®¿é—®ä¸åŒç±»å‹çš„é¥æµ‹æ•°æ®ï¼š

- **æ—¥å¿—**: https://console.cloud.google.com/logs/query;query=logName%3D%22projects%2Fyour-project-id%2Flogs%2Fgemini_cli%22
- **æŒ‡æ ‡**: https://console.cloud.google.com/monitoring/metrics-explorer
- **è¿½è¸ª**: https://console.cloud.google.com/traces/list

### GCPé…ç½®è¯¦è§£

```yaml
receivers:
  otlp:
    protocols:
      grpc:
        endpoint: "localhost:4317"
processors:
  batch:
    timeout: 1s
exporters:
  googlecloud:
    project: "your-project-id"
    metric:
      prefix: "custom.googleapis.com/gemini_cli"
    log:
      default_log_name: "gemini_cli"
  debug:
    verbosity: detailed
```

**ç« èŠ‚æ¥æº**
- [telemetry_gcp.js](file://scripts/telemetry_gcp.js#L25-L67)
- [telemetry_gcp.js](file://scripts/telemetry_gcp.js#L101-L139)

## å®é™…æ¡ˆä¾‹åˆ†æ

### æ¡ˆä¾‹1ï¼šæ€§èƒ½ç“¶é¢ˆè¯Šæ–­

å‡è®¾æ‚¨å‘ç°Qwen Codeåœ¨å¤„ç†å¤§å‹ä»£ç åº“æ—¶å“åº”ç¼“æ…¢ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œåˆ†æï¼š

```bash
# 1. å¯åŠ¨æœ¬åœ°é¥æµ‹ç¯å¢ƒ
npm run telemetry -- --target=local

# 2. æ‰§è¡Œæ€§èƒ½æµ‹è¯•
qwen --prompt="åˆ†æè¿™ä¸ªä»£ç åº“çš„æ€§èƒ½ç“¶é¢ˆ"

# 3. åœ¨Jaegerä¸­åˆ†æ
# - æœç´¢ç›¸å…³è¿½è¸ª
# - æŸ¥çœ‹å‡½æ•°è°ƒç”¨æ—¶é—´
# - è¯†åˆ«æ…¢é€Ÿæ“ä½œ
```

### æ¡ˆä¾‹2ï¼šå·¥å…·è°ƒç”¨åˆ†æ

å½“æŸä¸ªå·¥å…·é¢‘ç¹å¤±è´¥æ—¶ï¼Œå¯ä»¥åˆ†æå…¶è°ƒç”¨æƒ…å†µï¼š

```bash
# å¯ç”¨æç¤ºæ—¥å¿—è®°å½•
qwen --telemetry=true \
     --telemetry-target=local \
     --telemetry-log-prompts=true \
     --telemetry-outfile=/tmp/tool-analysis.json

# åˆ†æå¯¼å‡ºçš„æ—¥å¿—æ–‡ä»¶
cat /tmp/tool-analysis.json | jq '.events[] | select(.function_name=="edit")'
```

### æ¡ˆä¾‹3ï¼šAPIå“åº”æ—¶é—´åˆ†æ

ç›‘æ§APIè°ƒç”¨çš„å“åº”æ—¶é—´åˆ†å¸ƒï¼š

```bash
# å¯¼å‡ºAPIå“åº”æ•°æ®
qwen --telemetry-outfile=/tmp/api-responses.json

# åˆ†æå“åº”æ—¶é—´
grep '"duration_ms"' /tmp/api-responses.json | jq -r '.duration_ms' | sort -n
```

### æ—¥å¿—æ–‡ä»¶åˆ†æç¤ºä¾‹

```mermaid
flowchart TD
A[å¯¼å‡ºé¥æµ‹æ•°æ®] --> B[åˆ†æå·¥å…·è°ƒç”¨]
A --> C[åˆ†æAPIå“åº”]
A --> D[åˆ†ææ€§èƒ½æŒ‡æ ‡]
B --> E[è¯†åˆ«å¤±è´¥å·¥å…·]
B --> F[åˆ†æè°ƒç”¨é¢‘ç‡]
C --> G[è®¡ç®—å¹³å‡å“åº”æ—¶é—´]
C --> H[è¯†åˆ«è¶…æ—¶è¯·æ±‚]
D --> I[å†…å­˜ä½¿ç”¨åˆ†æ]
D --> J[CPUä½¿ç”¨ç‡åˆ†æ]
E --> K[ä¼˜åŒ–å»ºè®®]
G --> K
I --> K
```

## æ•…éšœæ’é™¤æŒ‡å—

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### 1. æœ¬åœ°é¥æµ‹æ— æ³•å¯åŠ¨

**é—®é¢˜ç—‡çŠ¶**ï¼š
```
ğŸ›‘ Error: OTEL collector failed to start on port 4317.
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# 1. æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :4317

# 2. æ¸…ç†æ—§è¿›ç¨‹
pkill -f "otelcol-contrib"
pkill -f "jaeger"

# 3. é‡æ–°å¯åŠ¨
npm run telemetry -- --target=local
```

#### 2. Google Cloudè®¤è¯å¤±è´¥

**é—®é¢˜ç—‡çŠ¶**ï¼š
```
ğŸ›‘ Error: OTLP_GOOGLE_CLOUD_PROJECT environment variable is not exported.
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# 1. è®¾ç½®é¡¹ç›®ID
export OTLP_GOOGLE_CLOUD_PROJECT=your-project-id

# 2. éªŒè¯è®¤è¯çŠ¶æ€
gcloud auth list

# 3. é‡æ–°è®¤è¯
gcloud auth application-default login
```

#### 3. æ–‡ä»¶æƒé™é—®é¢˜

**é—®é¢˜ç—‡çŠ¶**ï¼š
```
Permission denied: '/path/to/telemetry.json'
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# 1. æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la /path/to/

# 2. ä¿®æ”¹æƒé™æˆ–ä½¿ç”¨ä¸´æ—¶ç›®å½•
chmod 755 /path/to/
# æˆ–
qwen --telemetry-outfile=/tmp/telemetry.json
```

### è°ƒè¯•æŠ€å·§

#### å¯ç”¨è°ƒè¯•æ¨¡å¼

```bash
# å¯ç”¨è¯¦ç»†æ—¥å¿—
qwen --debug --telemetry-outfile=/tmp/debug-telemetry.json

# æŸ¥çœ‹é¥æµ‹é…ç½®
qwen --telemetry=true --telemetry-target=local --telemetry-outfile=/tmp/config.json
```

#### éªŒè¯é¥æµ‹æ•°æ®

```bash
# æ£€æŸ¥å¯¼å‡ºæ–‡ä»¶æ ¼å¼
jq . /tmp/telemetry.json

# ç»Ÿè®¡äº‹ä»¶æ•°é‡
grep -c '{}' /tmp/telemetry.json

# åˆ†æç‰¹å®šäº‹ä»¶ç±»å‹
grep '"event.name": "EVENT_API_RESPONSE"' /tmp/telemetry.json
```

**ç« èŠ‚æ¥æº**
- [local_telemetry.js](file://scripts/local_telemetry.js#L179-L218)
- [telemetry_gcp.js](file://scripts/telemetry_gcp.js#L63-L101)

## ç»“è®º

Qwen Codeçš„é¥æµ‹ç³»ç»Ÿæä¾›äº†å¼ºå¤§è€Œçµæ´»çš„æ•°æ®æ”¶é›†å’Œåˆ†æèƒ½åŠ›ã€‚é€šè¿‡åˆç†ä½¿ç”¨`--telemetry-outfile`æ ‡å¿—ï¼Œå¼€å‘è€…å¯ä»¥ï¼š

1. **ç¦»çº¿åˆ†æ**ï¼šå°†é¥æµ‹æ•°æ®å¯¼å‡ºåˆ°æœ¬åœ°æ–‡ä»¶ï¼Œä¾¿äºç¦»çº¿åˆ†æå’Œè°ƒè¯•
2. **å¤šå¹³å°æ”¯æŒ**ï¼šæ”¯æŒæœ¬åœ°Jaegerå’ŒGoogle Cloudä¸¤ç§åˆ†æå¹³å°
3. **å…¨é¢ç›‘æ§**ï¼šæ”¶é›†è·Ÿè¸ªã€æŒ‡æ ‡å’Œæ—¥å¿—çš„å®Œæ•´æ•°æ®é›†
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šè¯†åˆ«æ€§èƒ½ç“¶é¢ˆå’Œä¼˜åŒ–æœºä¼š

å»ºè®®å¼€å‘è€…æ ¹æ®å…·ä½“éœ€æ±‚é€‰æ‹©åˆé€‚çš„é¥æµ‹é…ç½®ï¼Œå¹¶å®šæœŸåˆ†æé¥æµ‹æ•°æ®ä»¥æŒç»­æ”¹è¿›åº”ç”¨æ€§èƒ½ã€‚é€šè¿‡ç»“åˆæœ¬åœ°åˆ†æå’Œäº‘ç«¯ç›‘æ§ï¼Œå¯ä»¥è·å¾—æœ€å…¨é¢çš„åº”ç”¨è¡Œä¸ºæ´å¯Ÿã€‚