# 命令行参考

<cite>
**本文档中引用的文件**  
- [install.ts](file://packages/cli/src/commands/extensions/install.ts)
- [uninstall.ts](file://packages/cli/src/commands/extensions/uninstall.ts)
- [list.ts](file://packages/cli/src/commands/extensions/list.ts)
- [update.ts](file://packages/cli/src/commands/extensions/update.ts)
- [enable.ts](file://packages/cli/src/commands/extensions/enable.ts)
- [disable.ts](file://packages/cli/src/commands/extensions/disable.ts)
- [link.ts](file://packages/cli/src/commands/extensions/link.ts)
- [new.ts](file://packages/cli/src/commands/extensions/new.ts)
- [add.ts](file://packages/cli/src/commands/mcp/add.ts)
- [remove.ts](file://packages/cli/src/commands/mcp/remove.ts)
- [list.ts](file://packages/cli/src/commands/mcp/list.ts)
- [settings.ts](file://packages/cli/src/config/settings.ts)
- [shell.ts](file://packages/core/src/tools/shell.ts)
- [read-file.ts](file://packages/core/src/tools/read-file.ts)
- [write-file.ts](file://packages/core/src/tools/write-file.ts)
- [memoryTool.ts](file://packages/core/src/tools/memoryTool.ts)
- [extensions.tsx](file://packages/cli/src/commands/extensions.tsx)
- [mcp.ts](file://packages/cli/src/commands/mcp.ts)
- [CommandService.ts](file://packages/cli/src/services/CommandService.ts)
</cite>

## 目录
1. [简介](#简介)
2. [核心功能命令](#核心功能命令)
3. [管理命令](#管理命令)
4. [辅助命令](#辅助命令)
5. [命令处理器与服务调用](#命令处理器与服务调用)
6. [命令关系与使用场景](#命令关系与使用场景)

## 简介
本参考文档系统性地列出了 Gemini CLI 的所有可用命令，涵盖了文件操作、shell 执行、扩展管理、MCP 服务器管理以及调试和帮助等辅助功能。文档详细说明了每个命令的目的、语法结构、支持的标志（flags）和参数，并提供了实际调用示例和预期输出。所有信息均准确反映源码实现，特别是命令处理器和服务调用逻辑。

## 核心功能命令

### 文件操作命令
文件操作命令允许用户与本地文件系统进行交互，包括读取和写入文件。

#### `/read_file` 命令
该命令用于读取指定文件的内容。如果文件过大，内容将被截断，并提供如何读取更多内容的指导。

**目的**：从本地文件系统读取文件内容。
**语法结构**：
```
/read_file <absolute_path> [--offset <number>] [--limit <number>]
```
**支持的参数**：
- `absolute_path` (必需): 要读取的文件的绝对路径。
- `offset` (可选): 对于文本文件，从0开始的行号，用于指定读取的起始位置。
- `limit` (可选): 最大读取行数，与 `offset` 一起使用以分页方式读取大文件。

**实际调用示例**：
```
/read_file /home/user/project/README.md --offset 10 --limit 20
```
**预期输出**：
```
Status: Showing lines 10-29 of 150 total lines.
Action: To read more of the file, you can use the 'offset' and 'limit' parameters in a subsequent 'read_file' call. For example, to read the next section of the file, use offset: 30.

--- FILE CONTENT (truncated) ---
[文件内容的第10到29行]
```

**Section sources**
- [read-file.ts](file://packages/core/src/tools/read-file.ts#L1-L215)

#### `/write_file` 命令
该命令用于将内容写入指定文件。如果文件不存在，将创建新文件。

**目的**：向本地文件系统中的文件写入内容。
**语法结构**：
```
/write_file <file_path> <content>
```
**支持的参数**：
- `file_path` (必需): 要写入的文件的绝对路径。
- `content` (必需): 要写入文件的内容。

**实际调用示例**：
```
/write_file /home/user/project/config.json {"api_key": "abc123", "debug": true}
```
**预期输出**：
```
Successfully overwrote file: /home/user/project/config.json.
```

**Section sources**
- [write-file.ts](file://packages/core/src/tools/write-file.ts#L1-L502)

### Shell 执行命令
Shell 执行命令允许用户在本地环境中运行 shell 命令。

#### `/run_shell_command` 命令
该命令用于执行给定的 shell 命令。在非交互模式下，需要确认才能执行。

**目的**：在本地 shell 环境中执行命令。
**语法结构**：
```
/run_shell_command <command> [--description <string>] [--directory <string>]
```
**支持的参数**：
- `command` (必需): 要执行的 shell 命令。
- `description` (可选): 对命令的简要描述，供用户参考。
- `directory` (可选): 命令执行的目录，如果未提供，则使用项目根目录。

**实际调用示例**：
```
/run_shell_command "ls -la" --description "列出当前目录的所有文件" --directory /home/user/project
```
**预期输出**：
```
Command: ls -la
Directory: /home/user/project
Output: [ls 命令的输出]
Error: (none)
Exit Code: 0
Signal: (none)
Background PIDs: (none)
Process Group PGID: 12345
```

**Section sources**
- [shell.ts](file://packages/core/src/tools/shell.ts#L1-L492)

## 管理命令

### 扩展管理命令
扩展管理命令允许用户安装、卸载、启用、禁用和更新扩展。

#### `/extensions install` 命令
该命令用于从 git 仓库 URL 或本地路径安装扩展。

**目的**：安装一个新的扩展。
**语法结构**：
```
/extensions install [--source <url>] [--path <local_path>] [--ref <git_ref>] [--auto-update]
```
**支持的参数**：
- `source` (可选): 要安装的扩展的 github URL。
- `path` (可选): 本地扩展目录的路径。
- `ref` (可选): 要从中安装的 git 引用。
- `auto-update` (可选): 为此扩展启用自动更新。

**实际调用示例**：
```
/extensions install --source https://github.com/user/my-extension.git --ref main --auto-update
```
**预期输出**：
```
Extension "my-extension" installed successfully and enabled.
```

**Section sources**
- [install.ts](file://packages/cli/src/commands/extensions/install.ts#L1-L104)

#### `/extensions uninstall` 命令
该命令用于卸载已安装的扩展。

**目的**：移除已安装的扩展。
**语法结构**：
```
/extensions uninstall <extension_name>
```
**支持的参数**：
- `extension_name` (必需): 要卸载的扩展的名称。

**实际调用示例**：
```
/extensions uninstall my-extension
```
**预期输出**：
```
Extension "my-extension" uninstalled successfully.
```

**Section sources**
- [uninstall.ts](file://packages/cli/src/commands/extensions/uninstall.ts)

#### `/extensions list` 命令
该命令用于列出所有已安装的扩展。

**目的**：显示所有已安装扩展的列表。
**语法结构**：
```
/extensions list
```
**实际调用示例**：
```
/extensions list
```
**预期输出**：
```
Installed extensions:
- my-extension (enabled)
- another-extension (disabled)
```

**Section sources**
- [list.ts](file://packages/cli/src/commands/extensions/list.ts)

#### `/extensions update` 命令
该命令用于更新已安装的扩展。

**目的**：将已安装的扩展更新到最新版本。
**语法结构**：
```
/extensions update <extension_name>
```
**支持的参数**：
- `extension_name` (必需): 要更新的扩展的名称。

**实际调用示例**：
```
/extensions update my-extension
```
**预期输出**：
```
Extension "my-extension" updated successfully.
```

**Section sources**
- [update.ts](file://packages/cli/src/commands/extensions/update.ts)

#### `/extensions enable` 和 `/extensions disable` 命令
这些命令用于启用或禁用已安装的扩展。

**目的**：控制扩展的启用状态。
**语法结构**：
```
/extensions enable <extension_name>
/extensions disable <extension_name>
```
**支持的参数**：
- `extension_name` (必需): 要启用或禁用的扩展的名称。

**实际调用示例**：
```
/extensions disable my-extension
/extensions enable my-extension
```
**预期输出**：
```
Extension "my-extension" disabled.
Extension "my-extension" enabled.
```

**Section sources**
- [enable.ts](file://packages/cli/src/commands/extensions/enable.ts)
- [disable.ts](file://packages/cli/src/commands/extensions/disable.ts)

### MCP 服务器管理命令
MCP 服务器管理命令允许用户添加、移除和列出 MCP 服务器配置。

#### `/mcp add` 命令
该命令用于添加一个新的 MCP 服务器配置。

**目的**：向配置中添加一个新的 MCP 服务器。
**语法结构**：
```
/mcp add <name> <commandOrUrl> [args...] [--scope <user|project>] [--transport <stdio|sse|http>] [--env <KEY=value>] [--header <"Header: Value">] [--timeout <milliseconds>] [--trust] [--description <string>] [--include-tools <tool1,tool2>] [--exclude-tools <tool1,tool2>]
```
**支持的参数**：
- `name` (必需): 服务器的名称。
- `commandOrUrl` (必需): 命令（stdio）或 URL（sse, http）。
- `args` (可选): 传递给命令的参数。
- `scope` (可选): 配置范围（用户或项目），默认为项目。
- `transport` (可选): 传输类型（stdio, sse, http），默认为 stdio。
- `env` (可选): 设置环境变量。
- `header` (可选): 为 SSE 和 HTTP 传输设置 HTTP 头。
- `timeout` (可选): 设置连接超时（毫秒）。
- `trust` (可选): 信任服务器（绕过所有工具调用确认提示）。
- `description` (可选): 设置服务器的描述。
- `include-tools` (可选): 包含工具的逗号分隔列表。
- `exclude-tools` (可选): 排除工具的逗号分隔列表。

**实际调用示例**：
```
/mcp add my-server "python -m my_server" --transport stdio --env API_KEY=abc123 --trust --description "My local MCP server"
```
**预期输出**：
```
MCP server "my-server" added to project settings. (stdio)
```

**Section sources**
- [add.ts](file://packages/cli/src/commands/mcp/add.ts#L1-L233)

#### `/mcp remove` 命令
该命令用于从配置中移除一个 MCP 服务器。

**目的**：从配置中删除 MCP 服务器。
**语法结构**：
```
/mcp remove <name> [--scope <user|project>]
```
**支持的参数**：
- `name` (必需): 要移除的服务器的名称。
- `scope` (可选): 配置范围（用户或项目），默认为项目。

**实际调用示例**：
```
/mcp remove my-server --scope user
```
**预期输出**：
```
MCP server "my-server" removed from user settings.
```

**Section sources**
- [remove.ts](file://packages/cli/src/commands/mcp/remove.ts)

#### `/mcp list` 命令
该命令用于列出所有配置的 MCP 服务器及其连接状态。

**目的**：显示所有配置的 MCP 服务器及其连接状态。
**语法结构**：
```
/mcp list
```
**实际调用示例**：
```
/mcp list
```
**预期输出**：
```
Configured MCP servers:

✓ my-server: python -m my_server (stdio) - Connected
✗ another-server: http://localhost:8080 (http) - Disconnected
```

**Section sources**
- [list.ts](file://packages/cli/src/commands/mcp/list.ts#L1-L140)

## 辅助命令

### 内存管理命令
内存管理命令允许用户保存和管理长期记忆。

#### `/memory` 命令
该命令用于将特定信息或事实保存到长期记忆中。

**目的**：将重要信息保存到长期记忆中。
**语法结构**：
```
/memory <fact>
```
**支持的参数**：
- `fact` (必需): 要记住的具体事实或信息。

**实际调用示例**：
```
/memory My favorite color is blue.
```
**预期输出**：
```
Okay, I've remembered that: "My favorite color is blue."
```

**Section sources**
- [memoryTool.ts](file://packages/core/src/tools/memoryTool.ts#L1-L377)

### 设置管理命令
设置管理命令允许用户查看和修改配置设置。

#### `/settings` 命令
该命令用于管理用户和项目设置。

**目的**：管理 CLI 的配置设置。
**语法结构**：
```
/settings <scope> <key> <value>
```
**支持的参数**：
- `scope` (必需): 设置范围（用户或项目）。
- `key` (必需): 要设置的配置键。
- `value` (必需): 要设置的配置值。

**实际调用示例**：
```
/settings user ui.theme dark
```
**预期输出**：
```
Setting 'ui.theme' updated to 'dark' in user settings.
```

**Section sources**
- [settings.ts](file://packages/cli/src/config/settings.ts#L1-L798)

## 命令处理器与服务调用
命令处理器和服务调用逻辑是 CLI 的核心，负责解析和执行所有命令。

### 命令服务
命令服务负责发现和加载所有斜杠命令。它使用基于提供者的加载器模式，通过 `ICommandLoader` 实例从特定源（如内置代码、本地文件）获取命令。

**目的**：协调所有斜杠命令的发现和加载。
**实现细节**：
- 使用 `CommandService.create` 工厂方法异步创建和初始化 `CommandService` 实例。
- 运行所有提供的加载器并聚合结果。
- 处理扩展命令的名称冲突，通过重命名为 `extensionName.commandName` 来解决。

**Section sources**
- [CommandService.ts](file://packages/cli/src/services/CommandService.ts#L1-L104)

### 内置命令加载器
内置命令加载器负责加载 CLI 的内置命令。

**目的**：加载 CLI 的内置命令。
**实现细节**：
- 从 `commands` 目录加载所有内置命令。
- 提供命令的元数据和处理逻辑。

**Section sources**
- [BuiltinCommandLoader.ts](file://packages/cli/src/services/BuiltinCommandLoader.ts)

## 命令关系与使用场景
理解命令之间的关系和使用场景对于有效使用 CLI 至关重要。

### 扩展与 MCP 服务器的配合使用
扩展和 MCP 服务器可以协同工作，以提供更强大的功能。例如，一个扩展可以包含一个 MCP 服务器的配置，当扩展被安装时，MCP 服务器也会被自动添加。

**使用场景**：
1. 用户使用 `/extensions install` 命令安装一个包含 MCP 服务器配置的扩展。
2. 扩展安装完成后，使用 `/mcp list` 命令验证 MCP 服务器是否已正确添加。
3. 用户可以使用 `/mcp add` 命令手动添加额外的 MCP 服务器，或使用 `/mcp remove` 命令移除不再需要的服务器。

**示例工作流**：
```
/extensions install --source https://github.com/user/my-extension.git
/mcp list
/mcp add custom-server "python -m custom_server" --transport stdio
```

**Section sources**
- [extensions.tsx](file://packages/cli/src/commands/extensions.tsx#L1-L37)
- [mcp.ts](file://packages/cli/src/commands/mcp.ts#L1-L28)