variables:
  TWINE_USERNAME: "__token__"
  # The api token for publishing to PyPI
  TWINE_PASSWORD: $PIPY_API_TOKEN

stages:
  - publish

publish:
  stage: publish
  image: docker.terrestris.de/python:3.12.11-alpine3.22
  tags:
    - intranet
  only:
    - tags
  script:
    - pip install -e .[publish]
    - sed -i "s/^version = .*/version = \"$CI_COMMIT_TAG\"/" pyproject.toml
    - python -m build
    - twine upload dist/*
