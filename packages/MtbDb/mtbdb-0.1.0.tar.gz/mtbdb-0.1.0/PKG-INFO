Metadata-Version: 2.4
Name: MtbDb
Version: 0.1.0
Summary: MtbDb: Genomics Database Toolkit for Mycobacterium Tuberculosis.
Author-email: HengyuZhou <zhouhengyu23@mails.ucas.ac.cn>
Project-URL: Homepage, https://github.com/16627517673/mtbdb
Classifier: Programming Language :: Python :: 3
Classifier: License :: OSI Approved :: Apache Software License
Classifier: Operating System :: OS Independent
Requires-Python: >=3.8
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: intervaltree>=3.0.2
Requires-Dist: numpy>=1.20.0
Requires-Dist: pandas>=1.2.0
Requires-Dist: scipy>=1.6.0
Requires-Dist: statsmodels>=0.12.0
Provides-Extra: bioinformatics
Dynamic: license-file

# MtbDb: Genomics Database Toolkit for Mycobacterium Tuberculosis

MtbDbæ˜¯ä¸€ä¸ªä¸“é—¨ä¸ºç»“æ ¸åˆ†ææ†èŒï¼ˆMycobacterium Tuberculosisï¼‰åŸºå› ç»„åˆ†æè®¾è®¡çš„Pythonå·¥å…·åŒ…ï¼Œæä¾›äº†ç»“æ ¸èŒåŸºå› ç»„æ•°æ®åº“çš„é«˜æ•ˆæŸ¥è¯¢å’Œåˆ†æåŠŸèƒ½ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ§¬ ç»“æ ¸èŒåŸºå› ç»„æ•°æ®åº“æŸ¥è¯¢
- ğŸ“Š åŸºå› å˜å¼‚åˆ†æ(TBVA)
- ğŸ” åŸºå› è¡¨è¾¾åˆ†æ(TBGEA)
- ğŸ“ˆ ç»Ÿè®¡åˆ†æå’Œå¯è§†åŒ–
- ğŸ”— æ”¯æŒå¤šç§æ•°æ®æ ¼å¼
- ğŸ§ª FASTA/FASTQ/SNPåˆ°VCFè½¬æ¢
- ğŸ“¦ å†…ç½®H37Rvå‚è€ƒåŸºå› ç»„ï¼ˆå¼€ç®±å³ç”¨ï¼‰

## å®‰è£…

### å¿«é€Ÿå¼€å§‹ï¼šä½¿ç”¨Condaï¼ˆå¼ºçƒˆæ¨èï¼‰

å¦‚æœæ‚¨éœ€è¦ä½¿ç”¨FASTA/FASTQè½¬VCFåŠŸèƒ½ï¼Œæ¨èä½¿ç”¨Condaå®‰è£…ï¼Œå¯ä»¥è‡ªåŠ¨é…ç½®æ‰€æœ‰PythonåŒ…å’Œç”Ÿç‰©ä¿¡æ¯å­¦å·¥å…·ï¼š

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/16627517673/mtbdb.git
cd mtbdb

# åˆ›å»ºå¹¶æ¿€æ´»condaç¯å¢ƒ
conda env create -f environment.yml
conda activate mtbdb

# éªŒè¯å®‰è£…
python -c "from mtbdb.tbva import check_all_dependencies; check_all_dependencies()"
```

### ä»…å®‰è£…PythonåŒ…ï¼ˆä¸å«å¤–éƒ¨å·¥å…·ï¼‰

å¦‚æœåªéœ€è¦VCFè§£æå’Œæ³¨é‡ŠåŠŸèƒ½ï¼Œå¯ä»¥ä»…é€šè¿‡pipå®‰è£…ï¼š

#### ä»PyPIå®‰è£…
```bash
pip install MtbDb
```

#### ä»TestPyPIå®‰è£…
```bash
pip install -i https://test.pypi.org/simple/ MtbDb
```

#### ä»æºç å®‰è£…
```bash
git clone https://github.com/16627517673/mtbdb.git
cd mtbdb
pip install -e .
```

## ç¯å¢ƒé…ç½®ä¸ä¾èµ–

### Pythonä¾èµ–
- Python >= 3.8
- intervaltree >= 3.0.2
- numpy >= 1.20.0
- pandas >= 1.2.0
- scipy >= 1.6.0
- statsmodels >= 0.12.0

### å¤–éƒ¨ç”Ÿç‰©ä¿¡æ¯å­¦å·¥å…·ï¼ˆFASTA/FASTQè½¬VCFåŠŸèƒ½æ‰€éœ€ï¼‰

âš ï¸ **é‡è¦**: ä»¥ä¸‹å·¥å…·æ˜¯ç³»ç»ŸäºŒè¿›åˆ¶ç¨‹åºï¼Œ**æ— æ³•é€šè¿‡pipå®‰è£…**

#### FASTAè½¬VCFæ‰€éœ€å·¥å…·
- **MUMmerå¥—ä»¶** (nucmer, delta-filter, show-snps)
  - ç”¨äºå…¨åŸºå› ç»„æ¯”å¯¹å’ŒSNPæå–

#### FASTQè½¬VCFæ‰€éœ€å·¥å…·
- **bwa**: çŸ­readsæ¯”å¯¹
- **samtools**: SAM/BAMæ–‡ä»¶å¤„ç†
- **varscan**: å˜å¼‚æ£€æµ‹
- **fastp**: è´¨é‡æ§åˆ¶
- **fastq-dump** (å¯é€‰): SRAæ–‡ä»¶è§£å‹

#### å®‰è£…è¿™äº›å·¥å…·çš„æ–¹å¼

**æ–¹æ¡ˆ1: ä½¿ç”¨Condaï¼ˆæ¨èï¼‰**
```bash
# æ–¹å¼A: ä½¿ç”¨æä¾›çš„ç¯å¢ƒé…ç½®æ–‡ä»¶
conda env create -f environment.yml
conda activate mtbdb

# æ–¹å¼B: æ‰‹åŠ¨å®‰è£…
conda install -c bioconda mummer bwa samtools varscan fastp sra-tools
```

**æ–¹æ¡ˆ2: ä½¿ç”¨Homebrew (macOS)**
```bash
brew install brewsci/bio/mummer bwa samtools fastp
# varscanéœ€è¦å•ç‹¬ä¸‹è½½JARæ–‡ä»¶
```

**æ–¹æ¡ˆ3: ä»æºç ç¼–è¯‘**
- å‚è€ƒå„å·¥å…·å®˜æ–¹æ–‡æ¡£

#### éªŒè¯å·¥å…·å®‰è£…

```python
from mtbdb.tbva import check_all_dependencies
check_all_dependencies()
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
æ­£åœ¨æ£€æŸ¥MtbDbå¤–éƒ¨å·¥å…·ä¾èµ–...

ã€FASTAè½¬VCFå·¥å…·ã€‘
  nucmer: âœ“ å·²å®‰è£… 4.0.0beta2
  delta-filter: âœ“ å·²å®‰è£…
  show-snps: âœ“ å·²å®‰è£…

ã€FASTQè½¬VCFå·¥å…·ã€‘
  bwa: âœ“ å·²å®‰è£… 0.7.17
  samtools: âœ“ å·²å®‰è£… 1.15
  varscan: âœ“ å·²å®‰è£… 2.4.4
  fastp: âœ“ å·²å®‰è£… 0.23.2
  fastq-dump: âœ“ å·²å®‰è£… (å¯é€‰)

æ€»ç»“: 8/8 å·¥å…·å¯ç”¨
âœ“ æ‰€æœ‰å¿…éœ€å·¥å…·å‡å·²æ­£ç¡®å®‰è£…ï¼
```

## å¿«é€Ÿå¼€å§‹

### å†…ç½®å‚è€ƒåŸºå› ç»„

MtbDbå†…ç½®äº†æ ‡å‡†H37Rvå‚è€ƒåŸºå› ç»„ï¼ˆNC_000962.3ï¼Œ4.4MBï¼‰ï¼ŒåŒ…æ‹¬æ‰€æœ‰å¿…è¦çš„ç´¢å¼•æ–‡ä»¶ï¼š
- H37Rvå®Œæ•´åŸºå› ç»„åºåˆ—ï¼ˆ.faï¼‰
- BWAç´¢å¼•æ–‡ä»¶ï¼ˆ.bwt, .pac, .sa, .amb, .annï¼‰
- samtoolsç´¢å¼•ï¼ˆ.faiï¼‰

**ä¼˜åŠ¿ï¼š**
- âœ… æ— éœ€æ‰‹åŠ¨ä¸‹è½½æˆ–é…ç½®å‚è€ƒåŸºå› ç»„
- âœ… å¼€ç®±å³ç”¨ï¼Œä¸€è¡Œä»£ç å®Œæˆè½¬æ¢
- âœ… åŒæ—¶æ”¯æŒè‡ªå®šä¹‰å‚è€ƒåŸºå› ç»„

```python
from mtbdb.tbva import get_default_reference_fasta

# æŸ¥çœ‹å†…ç½®å‚è€ƒåŸºå› ç»„è·¯å¾„
ref_path = get_default_reference_fasta()
print(f"å†…ç½®å‚è€ƒåŸºå› ç»„: {ref_path}")
# è¾“å‡º: /path/to/mtbdb/data/reference/H37Rv_complete_genome.fa
```

### åŸºç¡€VCFè§£æå’Œæ³¨é‡Š

```python
from mtbdb.tbva import VCFParser, VariantAnnotator

# è§£æVCFæ–‡ä»¶
parser = VCFParser('sample.vcf', filter_pass=True)
snps = parser.get_snps()
indels = parser.get_indels()

# å˜å¼‚æ³¨é‡Š
annotator = VariantAnnotator('sample.vcf')
annotated_variants = annotator.annotate()
```

### FASTAè½¬VCFï¼ˆæ¯”è¾ƒåŸºå› ç»„å­¦ï¼‰

ä½¿ç”¨MUMmerå·¥å…·é“¾æ¯”è¾ƒä¸¤ä¸ªåŸºå› ç»„å¹¶ç”ŸæˆVCFæ–‡ä»¶ï¼š

```python
from mtbdb.tbva import fasta_to_vcf

# æ–¹å¼1ï¼šä½¿ç”¨å†…ç½®H37Rvå‚è€ƒåŸºå› ç»„ï¼ˆæœ€ç®€å•ï¼‰
vcf_file = fasta_to_vcf(
    query_fasta='sample_genome.fasta',
    output_vcf='output/sample.vcf'
)

# æ–¹å¼2ï¼šä½¿ç”¨è‡ªå®šä¹‰å‚è€ƒåŸºå› ç»„
vcf_file = fasta_to_vcf(
    query_fasta='sample_genome.fasta',
    output_vcf='output/sample.vcf',
    reference_fasta='custom_reference.fasta',
    chrom_id='custom_chrom_id'
)

print(f"VCFæ–‡ä»¶å·²ç”Ÿæˆ: {vcf_file}")
```

**å‰ç½®è¦æ±‚ï¼š** MUMmerå·¥å…·å¥—ä»¶ï¼ˆå‚è§[ç¯å¢ƒé…ç½®](#ç¯å¢ƒé…ç½®ä¸ä¾èµ–)ç« èŠ‚ï¼‰

### FASTQè½¬VCFï¼ˆé‡æµ‹åºåˆ†æï¼‰

ä»FASTQæµ‹åºæ•°æ®æ£€æµ‹å˜å¼‚å¹¶ç”ŸæˆVCFæ–‡ä»¶ï¼š

```python
from mtbdb.tbva import fastq_to_vcf

# æ–¹å¼1ï¼šä½¿ç”¨å†…ç½®H37Rvå‚è€ƒåŸºå› ç»„ï¼ˆæœ€ç®€å•ï¼‰
vcf_file = fastq_to_vcf(
    output_dir='output',
    sample_name='ERR181314',
    fastq1='ERR181314_1.fastq.gz',
    fastq2='ERR181314_2.fastq.gz',
    threads=8
)

# æ–¹å¼2ï¼šä½¿ç”¨è‡ªå®šä¹‰å‚è€ƒåŸºå› ç»„
vcf_file = fastq_to_vcf(
    output_dir='output',
    sample_name='sample001',
    fastq1='sample_R1.fastq',
    fastq2='sample_R2.fastq',
    reference_fasta='custom_reference.fa',
    threads=16
)

print(f"VCFæ–‡ä»¶å·²ç”Ÿæˆ: {vcf_file}")
```

**å‰ç½®è¦æ±‚ï¼š** bwa, samtools, fastp, varscanç­‰å·¥å…·ï¼ˆå‚è§[ç¯å¢ƒé…ç½®](#ç¯å¢ƒé…ç½®ä¸ä¾èµ–)ç« èŠ‚ï¼‰

### SNPè½¬VCFï¼ˆå·²æœ‰show-snpsè¾“å‡ºï¼‰

å¦‚æœæ‚¨å·²ç»æœ‰MUMmer show-snpsç”Ÿæˆçš„SNPæ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥è½¬æ¢ä¸ºVCFæ ¼å¼ï¼š

```python
from mtbdb.tbva import snp_to_vcf

# åŸºç¡€ç”¨æ³•ï¼šæœ€ç®€å•çš„è½¬æ¢ï¼ˆä½¿ç”¨H37Rvé»˜è®¤è®¾ç½®ï¼‰
vcf_file = snp_to_vcf(
    snp_file='sample.snps',
    output_vcf='sample.vcf'
)

# å®Œæ•´ç”¨æ³•ï¼šè‡ªå®šä¹‰æŸ“è‰²ä½“IDå’Œå‚è€ƒä¿¡æ¯
vcf_file = snp_to_vcf(
    snp_file='sample.snps',
    output_vcf='sample.vcf',
    chrom_id='NC_000962.3',
    reference_name='H37Rv_genome.fasta',
    filter_indels=True  # è¿‡æ»¤indelï¼Œåªä¿ç•™SNP
)

print(f"VCFæ–‡ä»¶å·²ç”Ÿæˆ: {vcf_file}")
```

**ä¼˜åŠ¿ï¼š**
- âœ… æ— éœ€å¤–éƒ¨å·¥å…·ä¾èµ–ï¼ˆçº¯Pythonå®ç°ï¼‰
- âœ… å¿«é€Ÿè½¬æ¢ï¼ˆç§’çº§å®Œæˆï¼‰
- âœ… é€‚ç”¨äºå·²æœ‰show-snpsè¾“å‡ºçš„åœºæ™¯
- âœ… å¯é…ç½®æŸ“è‰²ä½“IDå’Œå‚è€ƒåŸºå› ç»„ä¿¡æ¯

**ä½¿ç”¨åœºæ™¯ï¼š**
- å·²é€šè¿‡å…¶ä»–æ–¹å¼è¿è¡Œäº†MUMmeræ¯”å¯¹
- éœ€è¦å°†SNPæ•°æ®è½¬æ¢ä¸ºæ ‡å‡†VCFæ ¼å¼
- ä¸å…¶ä»–VCFåˆ†æå·¥å…·é›†æˆ

### å®Œæ•´åˆ†ææµç¨‹ç¤ºä¾‹

ä»FASTQåŸå§‹æ•°æ®åˆ°å˜å¼‚æ³¨é‡Šçš„å®Œæ•´æµç¨‹ï¼š

```python
from mtbdb.tbva import fastq_to_vcf, VCFParser, VariantAnnotator

# ç¬¬1æ­¥ï¼šç”ŸæˆVCFï¼ˆä½¿ç”¨å†…ç½®H37Rvå‚è€ƒåŸºå› ç»„ï¼‰
vcf_file = fastq_to_vcf(
    output_dir='analysis',
    sample_name='sample001',
    fastq1='sample001_R1.fastq',
    fastq2='sample001_R2.fastq',
    threads=16
)

# ç¬¬2æ­¥ï¼šè§£æVCF
parser = VCFParser(vcf_file)
snps = parser.get_snps()
print(f"æ£€æµ‹åˆ° {len(snps)} ä¸ªSNPå˜å¼‚")

# ç¬¬3æ­¥ï¼šå˜å¼‚æ³¨é‡Š
annotator = VariantAnnotator(vcf_file)
results = annotator.annotate()
```

### é…ç½®å‚è€ƒåŸºå› ç»„å’Œå·¥å…·è·¯å¾„

```python
from mtbdb.tbva import set_reference_fasta, set_tool_path

# è®¾ç½®é»˜è®¤å‚è€ƒåŸºå› ç»„
set_reference_fasta('/path/to/H37Rv_complete_genome.fa')

# è®¾ç½®å¤–éƒ¨å·¥å…·è·¯å¾„ï¼ˆå¦‚æœä¸åœ¨ç³»ç»ŸPATHä¸­ï¼‰
set_tool_path('bwa', '/usr/local/bin/bwa')
set_tool_path('samtools', '/usr/local/bin/samtools')
set_tool_path('nucmer', '/opt/mummer/bin/nucmer')
```

æˆ–é€šè¿‡ç¯å¢ƒå˜é‡é…ç½®ï¼š

```bash
export MTBDB_REFERENCE_FASTA=/path/to/H37Rv.fa
export MTBDB_BWA_PATH=/usr/local/bin/bwa
export MTBDB_SAMTOOLS_PATH=/usr/local/bin/samtools
```

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ Apache License 2.0 è®¸å¯è¯ã€‚è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## ä½œè€…

HengyuZhou (zhouhengyu23@mails.ucas.ac.cn)

## é¡¹ç›®ä¸»é¡µ

https://github.com/16627517673/mtbdb
